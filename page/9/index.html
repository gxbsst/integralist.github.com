<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="icon" type="image/png" href="/images/cabin.png" >
    <link href="/styles/main.css" rel="stylesheet">
    
    <title>Integralist -> BBC News Engineer</title>
    
    
    <link rel="alternate" type="application/atom+xml" title="Integralist" href="http://feeds.feedburner.com/Integralist">
  </head>
  <body>
    <nav>
      <h1 class="name">
          <a href="/">Integralist</a> <span class="role">BBC News Engineer</span>
      </h1>
      <div class="menu icon-menu"></div>
      <ul class="nav-links">
        <li class="text-link">
          <a href="/about.html">about</a>
        </li>
        <li class="text-link">
          <a href="/projects.html">projects</a>
        </li>
        <li class="text-link">
          <a href="/archives.html">archives</a>
        </li>
      </ul>
      <div class="social-media">
        <a href="https://github.com/integralist" class="icon-github"></a>
        <a href="https://twitter.com/integralist" class="icon-twitter"></a>
      </div>
    </nav>
    <div class="content">


  <div class="post-head group">
  <a href="/posts/maintainable-css-with-bem/">
    <h1 class="post-title">Maintainable CSS with BEM</h1>
  </a>
  <span class="post-date">2012 &#183; 12 &#183; 9</span>
</div>

<div class="post-body"><h2><a name="what-well-cover" class="anchor" href="#what-well-cover"><span class="header-link"></span></a>What we&#39;ll cover</h2>
<p><em>reading time: approx. 7mins</em></p>
<ul>
<li>Introduction</li>
<li>BEM: Block, Element, Modifier</li>
<li>Example</li>
<li>Why BEM over the others?</li>
<li>Conclusion</li>
</ul>
<h2><a name="introduction" class="anchor" href="#introduction"><span class="header-link"></span></a>Introduction</h2>
<p>This is a super quick post to introduce you to a method of writing more maintainable CSS by using what&#39;s called &quot;<a href="http://bem.info">BEM</a>&quot;.</p>
<p>Update: <a href="http://twitter.com/necolas">@necolas</a> made a comment worth noting, that I&#39;m using a modified version of the BEM naming conventions (BEM is a total framework that goes beyond just naming of classes and writing maintainable CSS). So I thought it best to make note of that here so as to not cause any confusion.</p>
<h2><a name="bem-block-element-modifier" class="anchor" href="#bem-block-element-modifier"><span class="header-link"></span></a>BEM: Block, Element, Modifier</h2>
<p>BEM stands for &quot;Block, Element, Modifier&quot; and is a simple but effective way to group together different components/widgets (as shown by the following visual aid).</p>
<div class="delayed-image-load" data-src="/images/generated/BEM-1024.png" data-width="1024"></div>

<p>Within each defined &#39;Block&#39; you can have multiple &#39;elements&#39; that make up the object, and for each element (depending on where it appears within the block) you might need to &#39;modify&#39; the state of the element.</p>
<p>The principles are similar to other methods of structuring CSS (<a href="https://github.com/stubbornella/oocss/wiki">OOCSS</a>/<a href="http://smacss.com">SMACSS</a>) but they are greatly simplified in comparison without giving up any of the architectural benefits.</p>
<p>The best way to understand BEM is to see an example of how it&#39;s used (see next section). But if you want the full details of its history and some more detailed/visual break down of the concepts then please see the <a href="http://bem.info">BEM</a> website.</p>
<h2><a name="example" class="anchor" href="#example"><span class="header-link"></span></a>Example</h2>
<p>Below we have a money calculator widget. You enter an amount of money (e.g. £2.12p) and when you press on &#39;calculate&#39; it&#39;ll return to you a list of coins required to make up the amount specified.</p>
<p>The HTML is very simple...</p>
<pre><code class="lang-html"><div class="highlight"><pre><span class="nt">&lt;section&gt;</span>
    <span class="nt">&lt;h1&gt;</span>Sterling Calculator<span class="nt">&lt;/h1&gt;</span>
    <span class="nt">&lt;form</span> <span class="na">action=</span><span class="s">&quot;process.php&quot;</span> <span class="na">method=</span><span class="s">&quot;post&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;p&gt;</span>Please enter an amount: (e.g. 92p, <span class="ni">&amp;pound;</span>2.12)<span class="nt">&lt;/p&gt;</span>
        <span class="nt">&lt;p&gt;</span>
            <span class="nt">&lt;input</span> <span class="na">name=</span><span class="s">&quot;amount&quot;</span><span class="nt">&gt;</span> 
            <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;submit&quot;</span> <span class="na">value=</span><span class="s">&quot;Calculate&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;/p&gt;</span>
    <span class="nt">&lt;/form&gt;</span>
<span class="nt">&lt;/section&gt;</span>
</pre></div>
</code></pre>
<p>So lets add in our classes for styling this widget and lets go on to break down what we&#39;ve added and why...</p>
<pre><code class="lang-html"><div class="highlight"><pre><span class="nt">&lt;section</span> <span class="na">class=</span><span class="s">&quot;widget&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;h1</span> <span class="na">class=</span><span class="s">&quot;widget__header&quot;</span><span class="nt">&gt;</span>Sterling Calculator<span class="nt">&lt;/h1&gt;</span>
    <span class="nt">&lt;form</span> <span class="na">class=</span><span class="s">&quot;widget__form&quot;</span> <span class="na">action=</span><span class="s">&quot;process.php&quot;</span> <span class="na">method=</span><span class="s">&quot;post&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;p&gt;</span>Please enter an amount: (e.g. 92p, <span class="ni">&amp;pound;</span>2.12)<span class="nt">&lt;/p&gt;</span>
        <span class="nt">&lt;p&gt;</span>
            <span class="nt">&lt;input</span> <span class="na">name=</span><span class="s">&quot;amount&quot;</span> <span class="na">class=</span><span class="s">&quot;widget__input widget__input--amount&quot;</span><span class="nt">&gt;</span> 
            <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;submit&quot;</span> <span class="na">value=</span><span class="s">&quot;Calculate&quot;</span> <span class="na">class=</span><span class="s">&quot;widget__input widget__input--submit&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;/p&gt;</span>
    <span class="nt">&lt;/form&gt;</span>
<span class="nt">&lt;/section&gt;</span>
</pre></div>
</code></pre>
<p>First thing to notice is that we&#39;ve determined the top level <code>&lt;section&gt;</code> element to be our &#39;block&#39;. This is the top level containing element. We&#39;ve added a class of <code>widget</code> and this will be our namespace for this object/widget (whatever you prefer to call it).</p>
<p>From here on all elements that we added classes to within this &#39;block&#39; will be namespaced to the top level name of <code>widget</code>.</p>
<p>I wanted to style the <code>&lt;form&gt;</code> element so I added the class <code>widget__form</code>. The double underscores allow us to easily recognise a class as being part of the <code>widget</code> block. We see this used on the <code>&lt;input&gt;</code> elements as well: <code>widget__input</code>.</p>
<p>Here is a list of the elements styled…</p>
<ul>
<li><code>widget</code></li>
<li><code>widget__header</code></li>
<li><code>widget__form</code></li>
<li><code>widget__input</code></li>
</ul>
<p>Notice that there are two other classes used: <code>widget__input--amount</code> and <code>widget__input--submit</code>. These are our &#39;modifiers&#39;. They modify the state of our elements.</p>
<p>Let&#39;s look at where these have been used. I&#39;ve applied the same class of <code>widget__input</code> on both <code>&lt;input&gt;</code> elements (because they both have the same base structure/styling). But both elements do have slight differences in their appearance, hence the use of a &#39;modifier&#39; to apply the additional unique styles. </p>
<p>Modifiers are written with two hyphens(dashes) like so: <code>block__element--modifier</code>.</p>
<p>This means that our CSS code for this widget ends up looking like this…</p>
<pre><code class="lang-css"><div class="highlight"><pre><span class="nc">.widget</span> <span class="p">{</span>
    <span class="k">background-color</span><span class="o">:</span> <span class="m">#FC3</span><span class="p">;</span>
<span class="p">}</span>

<span class="nc">.widget__header</span> <span class="p">{</span>
    <span class="k">color</span><span class="o">:</span> <span class="m">#930</span><span class="p">;</span>
    <span class="k">font-size</span><span class="o">:</span> <span class="m">3em</span><span class="p">;</span>
    <span class="k">margin-bottom</span><span class="o">:</span> <span class="m">0.3em</span><span class="p">;</span>
    <span class="k">text-shadow</span><span class="o">:</span> <span class="m">#FFF</span> <span class="m">1px</span> <span class="m">1px</span> <span class="m">2px</span><span class="p">;</span>
<span class="p">}</span>

<span class="nc">.widget__input</span> <span class="p">{</span>
    <span class="o">-</span><span class="n">webkit</span><span class="o">-</span><span class="k">border</span><span class="o">-</span><span class="n">radius</span><span class="o">:</span> <span class="m">5px</span><span class="p">;</span>
       <span class="o">-</span><span class="n">moz</span><span class="o">-</span><span class="k">border</span><span class="o">-</span><span class="n">radius</span><span class="o">:</span> <span class="m">5px</span><span class="p">;</span>
         <span class="o">-</span><span class="n">o</span><span class="o">-</span><span class="k">border</span><span class="o">-</span><span class="n">radius</span><span class="o">:</span> <span class="m">5px</span><span class="p">;</span>
            <span class="k">border</span><span class="o">-</span><span class="n">radius</span><span class="o">:</span> <span class="m">5px</span><span class="p">;</span>

    <span class="k">font-size</span><span class="o">:</span> <span class="m">0.9em</span><span class="p">;</span>
    <span class="k">line-height</span><span class="o">:</span> <span class="m">1</span><span class="o">.</span><span class="m">3</span><span class="p">;</span>
    <span class="k">padding</span><span class="o">:</span> <span class="m">0.4em</span> <span class="m">0.7em</span><span class="p">;</span>
<span class="p">}</span>

<span class="nc">.widget__input--amount</span> <span class="p">{</span>
    <span class="k">border</span><span class="o">:</span> <span class="m">1px</span> <span class="k">solid</span> <span class="m">#930</span><span class="p">;</span>
<span class="p">}</span>

<span class="nc">.widget__input--submit</span> <span class="p">{</span>
    <span class="k">background-color</span><span class="o">:</span> <span class="m">#EEE</span><span class="p">;</span>
    <span class="k">border</span><span class="o">:</span> <span class="m">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</code></pre>
<h2><a name="why-bem-over-the-others" class="anchor" href="#why-bem-over-the-others"><span class="header-link"></span></a>Why BEM over the others?</h2>
<p>I&#39;ve tried a lot of different ways of writing CSS over the years. It went something like this…</p>
<ul>
<li>No structure, everything in one file loaded on every page of a site.</li>
<li>Separate files to try and keep page specific content together, but still no real structure.</li>
<li>Standard <a href="https://github.com/stubbornella/oocss/wiki">OOCSS (Object-Oriented CSS)</a></li>
<li><a href="http://smacss.com">SMACSS (Scalable and Modular Architecture for CSS)</a></li>
</ul>
<p>…and now BEM.</p>
<p><strong>The reason I choose BEM over other methodologies comes down to this: it&#39;s less confusing than the other methods (i.e. SMACSS) but still provides us the good architecture we want (i.e. OOCSS) and with a recognisable terminology.</strong></p>
<p>For me OOCSS isn&#39;t strict enough. It let&#39;s developers go wild with how they name their objects. But I&#39;ve seen that get really messy on larger projects, or projects with more than one developer and because of the lack of strictness in naming conventions developers become confused on what classes are supposed to be doing.</p>
<p>With regards to SMACSS: it&#39;s almost too strict in the sense that I think it&#39;s <em>over structured</em>. When I first started using it I thought this was the solution I had been searching for but all that ended up happening was that I had so many fragmented areas of CSS that I didn&#39;t know where to go first. It was too over whelming.</p>
<p>This might not be the case for some people, but for me these are all instances of the old adage: &quot;<em>don&#39;t make me think</em>&quot;. If I have to think too hard about how something works, or where I need to find the code for something then (in my opinion) that methodology has failed.</p>
<p>BEM succeeds because it provides a good object oriented structure with a familiar terminology and is simple enough to not get in your way.</p>
<p>But like with any tool, it can be misused. In the end it comes down to the overall skill and understanding of the developer.</p>
<h3><a name="simplicity" class="anchor" href="#simplicity"><span class="header-link"></span></a>Simplicity</h3>
<p>As I said before, the reason I find BEM a better option is the simplicity. </p>
<p>Even down to the terminology used is simplified compared to other methodologies. For example, depending on who you talk to about structured CSS you may hear the words: </p>
<ul>
<li>objects</li>
<li>modules</li>
<li>widgets</li>
<li>components</li>
</ul>
<p>…notice the terminology is different but what they refer to are effectively the same thing. No wonder it can become confusing to some people.</p>
<p>BEM is different in that its terminology is based around the environment it works for: HTML and CSS. We all know when working in CSS what a &#39;block&#39; is, it&#39;s the fundamental building block (no pun intended) of how elements on the page are rendered, but that term can also be understood when used like so… </p>
<blockquote>
<p>I saw this block of code the other day, it was hideous.</p>
</blockquote>
<p>…you know within the context of that sentence the person speaking is referring to a chunk of code, a grouping of code.</p>
<p>The word &#39;Block&#39; is simple but a very focused term, and more importantly it is a very familiar term. </p>
<p>We also know when working in CSS that ultimately we&#39;re targeting &#39;elements&#39;. No other word better fits the description, because that is exactly what we&#39;re doing.</p>
<p>And lastly, the word &#39;modifier&#39; again is a simple but fully understood and familiar term used by developers… </p>
<blockquote>
<p>I want to modify this element, how should I do that?</p>
</blockquote>
<h3><a name="but-still-structured" class="anchor" href="#but-still-structured"><span class="header-link"></span></a>But still structured</h3>
<p>But with this simplified terminology/structure it gives us all the tools we need to write maintainable and easily understandable code. BEM easily scales with the size of a project.</p>
<h2><a name="conclusion" class="anchor" href="#conclusion"><span class="header-link"></span></a>Conclusion</h2>
<p>I know I&#39;ve said it before about SMACSS (&quot;<em>wow, I think this is it!</em>&quot;) but even when I first started using SMACSS I still had niggling feelings about &quot;<em>hmm, it&#39;s a little complicated getting this all in place, but it seems to work well</em>&quot;. With BEM I&#39;ve not had any of those concerns. The only initial concern I had was with the look of it. I didn&#39;t like the double underscores or the double dashes. But now I actually like them!</p>
<p>If you want to see more good usage of BEM then I&#39;ll refer you to a small CSS abstraction library called <a href="https://github.com/csswizardry/inuit.css">inuit.css</a> by <a href="http://csswizardry.com/">Harry Roberts</a> as well as <a href="https://github.com/Integralist/integralist.github.com">my own website&#39;s source code</a></p>
</div>

  <div class="comments">
    <a href="/posts/maintainable-css-with-bem/#comments">
      <span class="icon-bubbles"></span>
      Comments
    </a>
  </div>

  <div class="post-head group">
  <a href="/posts/backbone-validation/">
    <h1 class="post-title">Backbone Validation</h1>
  </a>
  <span class="post-date">2012 &#183; 11 &#183; 26</span>
</div>

<div class="post-body"><h2><a name="what-well-cover" class="anchor" href="#what-well-cover"><span class="header-link"></span></a>What we&#39;ll cover</h2>
<p><em>reading time: approx. 17mins</em></p>
<ul>
<li>Introduction</li>
<li>Dependencies</li>
<li>HTML set-up</li>
<li>JavaScript set-up</li>
<li>Validation Module</li>
<li>Conclusion</li>
</ul>
<h2><a name="introduction" class="anchor" href="#introduction"><span class="header-link"></span></a>Introduction</h2>
<p>A while ago I had any issue with validating a form using the Backbone.Model&#39;s <code>validate</code> method and so I went to the official Backbone GitHub issues area to raise a query. The problem I had isn&#39;t necessarily important but the ultimate result I got from the discussion with the maintainers of Backbone was that validating a form using a Model wasn&#39;t really the way you should use a Model.</p>
<p>To me this didn&#39;t make a lot of sense because a form is just data and a Model holds data and so I would have thought using the built-in <code>validate</code> method of the Model would have been the best way to validate the form data. But apparently that&#39;s not considered a best practice using Backbone.</p>
<p>So I decided to create a validation module that would make validating a form (and displaying errors) a little bit easier, because lets face it, validating forms are tedious and boring.</p>
<p>You can download the <a href="https://github.com/Integralist/Backbone-Validation-View">full project code from GitHub</a></p>
<h2><a name="dependencies" class="anchor" href="#dependencies"><span class="header-link"></span></a>Dependencies</h2>
<ul>
<li>Backbone (obviously, so this includes the dependencies required by Backbone)</li>
<li><a href="http://twitter.github.com/hogan.js/">Hogan.js</a> (for loading the error messages)</li>
</ul>
<p>Now although I&#39;ve used Backbone/Hogan you don&#39;t have to. The code is straight forward enough to port over to use whatever you like. You could rewrite the code to not use a framework at all. The principles are very simple.</p>
<h2><a name="html-set-up" class="anchor" href="#html-set-up"><span class="header-link"></span></a>HTML set-up</h2>
<p>OK, so the HTML requires a bit of setting up. Nothing major, but we utilise specific classes and custom data attributes in the HTML to help us validate the form.</p>
<p>For example, we mark-up any mandatory fields with a class of <code>js-mandatory-field</code> - you&#39;ll notice I&#39;ve prefixed the class with &#39;js-&#39; so other developers know that this class has no styles associated with it. It&#39;s literally only used as a JavaScript hook.</p>
<p>We also use a custom data attribute <code>data-message</code> to store specific validation error messages. I prefer having custom messages because otherwise at some point you&#39;ll want to validate a field that doesn&#39;t conform to the known validation methods. So having a custom message for each field gives better feedback to the user.</p>
<p>So as an example here is a form with the mandatory class and the custom data attribute</p>
<pre><code class="lang-html"><div class="highlight"><pre><span class="nt">&lt;input</span> <span class="na">name=</span><span class="s">&quot;card&quot;</span> <span class="na">class=</span><span class="s">&quot;js-mandatory-field&quot;</span> <span class="na">data-message=</span><span class="s">&quot;Please ensure you enter a valid credit card number&quot;</span><span class="nt">&gt;</span>
</pre></div>
</code></pre>
<p>Our full form code looks like this…</p>
<pre><code class="lang-html"><div class="highlight"><pre><span class="nt">&lt;form</span> <span class="na">action=</span><span class="s">&quot;http://www.google.com/&quot;</span> <span class="na">method=</span><span class="s">&quot;post&quot;</span> <span class="na">id=</span><span class="s">&quot;js-form&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;p&gt;</span>Name: <span class="nt">&lt;input</span> <span class="na">name=</span><span class="s">&quot;fullname&quot;</span> <span class="na">class=</span><span class="s">&quot;js-mandatory-field&quot;</span> <span class="na">data-message=</span><span class="s">&quot;Please ensure you enter your full name&quot;</span><span class="nt">&gt;&lt;/p&gt;</span>
    <span class="nt">&lt;p&gt;</span>Date of Birth: <span class="nt">&lt;input</span> <span class="na">name=</span><span class="s">&quot;dob&quot;</span> <span class="na">placeholder=</span><span class="s">&quot;dd/mm/yyyy&quot;</span> <span class="na">class=</span><span class="s">&quot;js-mandatory-field&quot;</span> <span class="na">data-message=</span><span class="s">&quot;Please ensure you enter a valid date format&quot;</span><span class="nt">&gt;&lt;/p&gt;</span>
    <span class="nt">&lt;p&gt;</span>Age: <span class="nt">&lt;input</span> <span class="na">name=</span><span class="s">&quot;age&quot;</span> <span class="na">type=</span><span class="s">&quot;number&quot;</span> <span class="na">class=</span><span class="s">&quot;js-mandatory-field&quot;</span> <span class="na">data-message=</span><span class="s">&quot;Please ensure you enter a valid age&quot;</span><span class="nt">&gt;&lt;/p&gt;</span>
    <span class="nt">&lt;p&gt;</span>Email: <span class="nt">&lt;input</span> <span class="na">name=</span><span class="s">&quot;email&quot;</span> <span class="na">type=</span><span class="s">&quot;email&quot;</span> <span class="na">class=</span><span class="s">&quot;js-mandatory-field&quot;</span> <span class="na">data-message=</span><span class="s">&quot;Please ensure you enter a valid email&quot;</span><span class="nt">&gt;&lt;/p&gt;</span>
    <span class="nt">&lt;p&gt;</span>Mobile: <span class="nt">&lt;input</span> <span class="na">name=</span><span class="s">&quot;mobile&quot;</span> <span class="na">class=</span><span class="s">&quot;js-mandatory-field&quot;</span> <span class="na">data-message=</span><span class="s">&quot;Please ensure you enter a valid mobile number&quot;</span><span class="nt">&gt;&lt;/p&gt;</span>
    <span class="nt">&lt;p&gt;</span>Password (8 alpha-numerical characters, at least either 1 number or 1 text character): <span class="nt">&lt;input</span> <span class="na">name=</span><span class="s">&quot;password&quot;</span> <span class="na">type=</span><span class="s">&quot;password&quot;</span> <span class="na">class=</span><span class="s">&quot;js-mandatory-field&quot;</span> <span class="na">data-message=</span><span class="s">&quot;Please ensure you enter a password that matches the criteria&quot;</span><span class="nt">&gt;&lt;/p&gt;</span>
    <span class="nt">&lt;p&gt;</span>Credit Card: <span class="nt">&lt;input</span> <span class="na">name=</span><span class="s">&quot;card&quot;</span> <span class="na">class=</span><span class="s">&quot;js-mandatory-field&quot;</span> <span class="na">data-message=</span><span class="s">&quot;Please ensure you enter a valid credit card number&quot;</span><span class="nt">&gt;&lt;/p&gt;</span>
    <span class="nt">&lt;p&gt;</span>To proceed please tick this box: <span class="nt">&lt;input</span> <span class="na">name=</span><span class="s">&quot;proceed&quot;</span> <span class="na">type=</span><span class="s">&quot;checkbox&quot;</span> <span class="na">class=</span><span class="s">&quot;js-mandatory-field&quot;</span> <span class="na">data-message=</span><span class="s">&quot;Please ensure you tick the box to proceed&quot;</span><span class="nt">&gt;&lt;/p&gt;</span>
    <span class="nt">&lt;p&gt;&lt;input</span> <span class="na">type=</span><span class="s">&quot;submit&quot;</span> <span class="na">value=</span><span class="s">&quot;Submit Form&quot;</span><span class="nt">&gt;&lt;/p&gt;</span>
<span class="nt">&lt;/form&gt;</span>
</pre></div>
</code></pre>
<h2><a name="javascript-set-up" class="anchor" href="#javascript-set-up"><span class="header-link"></span></a>JavaScript set-up</h2>
<p>Next let&#39;s look at our JavaScript set-up: we&#39;re utilising AMD to help keep our scripts modular and I&#39;m using the <a href="https://github.com/cujojs/curl">Curl.js AMD loader</a>.</p>
<p>So in our HTML file we&#39;ll load up the JavaScript files required…</p>
<pre><code class="lang-html"><div class="highlight"><pre><span class="nt">&lt;script </span><span class="na">src=</span><span class="s">&quot;Assets/Scripts/curl.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
<span class="nt">&lt;script </span><span class="na">src=</span><span class="s">&quot;Assets/Scripts/app.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
</pre></div>
</code></pre>
<p>Inside our app.js file we set-up a configuration object which handles the paths to the different dependencies we&#39;ll be using. We then load the &#39;Validation&#39; module (which is a Backbone.View)…</p>
<pre><code class="lang-js"><div class="highlight"><pre><span class="kd">var</span> <span class="nx">config</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">baseUrl</span><span class="o">:</span> <span class="s1">&#39;./Assets/Scripts/&#39;</span><span class="p">,</span>
    <span class="nx">pluginPath</span><span class="o">:</span> <span class="s1">&#39;plugins&#39;</span><span class="p">,</span>
    <span class="nx">paths</span><span class="o">:</span> <span class="p">{</span>
        <span class="s1">&#39;jquery&#39;</span><span class="o">:</span> <span class="s1">&#39;Libraries/jquery&#39;</span><span class="p">,</span>
        <span class="s1">&#39;lodash&#39;</span><span class="o">:</span> <span class="s1">&#39;Libraries/lodash&#39;</span><span class="p">,</span>
        <span class="s1">&#39;backbone&#39;</span><span class="o">:</span> <span class="s1">&#39;Libraries/backbone&#39;</span>
    <span class="p">},</span>
    <span class="nx">preloads</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;jquery&#39;</span><span class="p">,</span> <span class="s1">&#39;lodash&#39;</span><span class="p">]</span>
<span class="p">};</span>

<span class="cm">/*</span>
<span class="cm">    The `exports` suffix ensures we receive a reference to the global Backbone object</span>
<span class="cm">    It also provides a way to check that the script loaded correctly.</span>
<span class="cm">    Without the `exports` suffix, there&#39;s no way to tell if IE or Opera 404&#39;ed.</span>
<span class="cm"> */</span>
<span class="nx">curl</span><span class="p">(</span><span class="nx">config</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;jquery&#39;</span><span class="p">,</span> <span class="s1">&#39;lodash&#39;</span><span class="p">,</span> <span class="s1">&#39;js!backbone!exports=Backbone&#39;</span><span class="p">],</span> <span class="nx">init</span><span class="p">,</span> <span class="nx">error</span><span class="p">);</span>

<span class="kd">function</span> <span class="nx">init</span> <span class="p">(</span><span class="nx">$</span><span class="p">,</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">Backbone</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">curl</span><span class="p">(</span><span class="s1">&#39;Views/Validation&#39;</span><span class="p">);</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">error</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">warn</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</code></pre>
<p>Now we have our JavaScript set-up lets move onto the Backbone.View that will handle the validation of our form.</p>
<h2><a name="validation-module" class="anchor" href="#validation-module"><span class="header-link"></span></a>Validation Module</h2>
<p>We will go through each of the methods within this module so we can better understand what they&#39;re doing. There are four main methods and the rest are different validation methods.</p>
<p>The four main methods are:</p>
<ul>
<li><code>get_template</code></li>
<li><code>validate</code></li>
<li><code>process_errors</code></li>
<li><code>display_errors</code></li>
</ul>
<p>The validation methods are:</p>
<ul>
<li><code>validate_text</code></li>
<li><code>validate_number</code></li>
<li><code>validate_date</code></li>
<li><code>validate_email</code></li>
<li><code>validate_mobile</code></li>
<li><code>validate_password</code></li>
<li><code>validate_cardnumber</code></li>
<li><code>validate_checkbox</code></li>
</ul>
<p>So within the initialisation stage of the View we do a few things…</p>
<pre><code class="lang-js"><div class="highlight"><pre><span class="nx">initialize</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
    <span class="c1">// Self explanatory: stores all mandatory fields</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">mandatory_fields</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.js-mandatory-field&#39;</span><span class="p">);</span>

    <span class="c1">// This holds the template file we&#39;ll compile with data pulled from server</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">template</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>

    <span class="c1">// This holds the actual rendered template content</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">template_content</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>

    <span class="c1">// We&#39;ll go ahead and grab the error message template file (no point waiting until the last minute and making the user wait).</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">get_template</span><span class="p">();</span>
<span class="p">}}</span>
</pre></div>
</code></pre>
<ul>
<li>Store a reference to all mandatory fields</li>
<li>Create a <code>template</code> property</li>
<li>Create a <code>template_content</code> property</li>
<li>Call the <code>get_template</code> method</li>
</ul>
<p>The reason we call the <code>get_template</code> method straight away (before the form has been submitted) is because it&#39;s a safe assumption that on a form, the user is likely to make an error in the data they submit so why not just go ahead and grab the template we&#39;ll need to render and display errors with.</p>
<p>The <code>get_template</code> method is called immediately but later on we also check to see if we need to try calling it again (e.g. when the user actually submits the form we check to see if <code>this.template</code> holds any value and if it does then we use it, otherwise we call <code>get_template</code> again to grab the data) so this is why we check within that method for a <code>callback</code> to be provided (when the template is loaded we want to continue on and process the errors found)</p>
<pre><code class="lang-js"><div class="highlight"><pre><span class="nx">get_template</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
        <span class="nx">url</span><span class="o">:</span> <span class="s1">&#39;Assets/Templates/FormErrors.txt&#39;</span><span class="p">,</span>
        <span class="nx">dataType</span><span class="o">:</span> <span class="s1">&#39;html&#39;</span><span class="p">,</span>
        <span class="nx">success</span><span class="o">:</span> <span class="nx">_</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">tmp</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">template</span> <span class="o">=</span> <span class="nx">hogan</span><span class="p">.</span><span class="nx">compile</span><span class="p">(</span><span class="nx">tmp</span><span class="p">);</span>

            <span class="k">if</span> <span class="p">(</span><span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">callback</span><span class="p">();</span>
            <span class="p">}</span>
        <span class="p">},</span> <span class="k">this</span><span class="p">)</span>
    <span class="p">});</span>
<span class="p">}</span>
</pre></div>
</code></pre>
<p>We then listen out for the form submission event to happen and call the <code>validate</code> method to handle the event…</p>
<pre><code class="lang-js"><div class="highlight"><pre><span class="nx">events</span><span class="o">:</span> <span class="p">{</span>
    <span class="s1">&#39;submit&#39;</span><span class="o">:</span> <span class="s1">&#39;validate&#39;</span>
<span class="p">}</span>
</pre></div>
</code></pre>
<p>The <code>validate</code> method creates an Array to hold any errors we encounter. The way we determine if there are any errors is to loop through all the mandatory fields and to check the name attribute value to see if we can find a match to known values. If we can&#39;t find a match then we just validate the field to make sure it has a value. If we do find a match (e.g. if the name attribute is &quot;email&quot;) then we know which validation method to pass the field on to validate against.</p>
<p>If the validation method returns <code>true</code> then that means an issue was found and so the field failed the validation and we store the specific error message for that field in the <code>errors</code> Array.</p>
<p>After we&#39;ve been through all the mandatory fields we check to see if the <code>errors</code> Array has any items, if it does then we know we need to process some errors and call <code>this.process_errors</code> and pass the <code>errors</code> Array through to that method.</p>
<pre><code class="lang-js"><div class="highlight"><pre><span class="nx">validate</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
    <span class="kd">var</span> <span class="nx">errors</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="kd">var</span> <span class="nx">method</span><span class="p">;</span>

    <span class="c1">// Loop through all the fields checking for validation errors</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">mandatory_fields</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">index</span><span class="p">,</span> <span class="nx">item</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// First we check what the current field is and validate it against a specific method</span>
        <span class="k">switch</span> <span class="p">(</span><span class="nx">item</span><span class="p">.</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">case</span> <span class="s1">&#39;dob&#39;</span><span class="o">:</span>
                <span class="nx">method</span> <span class="o">=</span> <span class="s1">&#39;validate_date&#39;</span><span class="p">;</span>
                <span class="k">break</span><span class="p">;</span>
            <span class="k">case</span> <span class="s1">&#39;age&#39;</span><span class="o">:</span>
                <span class="nx">method</span> <span class="o">=</span> <span class="s1">&#39;validate_number&#39;</span><span class="p">;</span>
                <span class="k">break</span><span class="p">;</span>
            <span class="k">case</span> <span class="s1">&#39;email&#39;</span><span class="o">:</span>
                <span class="nx">method</span> <span class="o">=</span> <span class="s1">&#39;validate_email&#39;</span><span class="p">;</span>
                <span class="k">break</span><span class="p">;</span>
            <span class="k">case</span> <span class="s1">&#39;mobile&#39;</span><span class="o">:</span>
                <span class="nx">method</span> <span class="o">=</span> <span class="s1">&#39;validate_mobile&#39;</span><span class="p">;</span>
                <span class="k">break</span><span class="p">;</span>
            <span class="k">case</span> <span class="s1">&#39;password&#39;</span><span class="o">:</span>
                <span class="nx">method</span> <span class="o">=</span> <span class="s1">&#39;validate_password&#39;</span><span class="p">;</span>
                <span class="k">break</span><span class="p">;</span>
            <span class="k">case</span> <span class="s1">&#39;card&#39;</span><span class="o">:</span>
                <span class="nx">method</span> <span class="o">=</span> <span class="s1">&#39;validate_cardnumber&#39;</span><span class="p">;</span>
                <span class="k">break</span><span class="p">;</span>
            <span class="k">case</span> <span class="s1">&#39;proceed&#39;</span><span class="o">:</span>
                <span class="nx">method</span> <span class="o">=</span> <span class="s1">&#39;validate_checkbox&#39;</span><span class="p">;</span>
                <span class="k">break</span><span class="p">;</span>
            <span class="k">default</span><span class="o">:</span>
                <span class="nx">method</span> <span class="o">=</span> <span class="s1">&#39;validate_text&#39;</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">[</span><span class="nx">method</span><span class="p">](</span><span class="nx">item</span><span class="p">))</span> <span class="p">{</span>
            <span class="c1">// Store just the messages and not the element itself (we only need the list of messages)</span>
            <span class="nx">errors</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">item</span><span class="p">.</span><span class="nx">getAttribute</span><span class="p">(</span><span class="s1">&#39;data-message&#39;</span><span class="p">));</span>
        <span class="p">}</span>
    <span class="p">},</span> <span class="k">this</span><span class="p">));</span>

    <span class="c1">// If there are any errors then display warning messsage to the user</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">errors</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">process_errors</span><span class="p">(</span><span class="nx">errors</span><span class="p">);</span>
        <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</code></pre>
<p>The first thing the <code>process_errors</code> method does is it makes sure we are only dealing with unique error messages. For example if we have a set of &#39;sort code&#39; fields (which are typically three separate fields) they will all have the same error message but we don&#39;t want that error message displayed three times so the <code>_.unique</code> method ensures our errors are unique.</p>
<p>After that we need to make sure that Hogan.js has the error messages in a format it can handle so we use the <code>map</code> method to convert the data to the relevant format required.</p>
<p>Next we need to convert the jQuery collection into an actual Array for Hogan.js to be able to loop through it.</p>
<p>Finally we check if the template file has been loaded already or not. If it hasn&#39;t then we load it via ajax and then call the <code>display_errors</code> method.</p>
<pre><code class="lang-js"><div class="highlight"><pre><span class="nx">process_errors</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">errors</span><span class="p">)</span> <span class="p">{</span>
    <span class="cm">/*</span>
<span class="cm">        Clean the errors list so we only have unique data.</span>
<span class="cm">        This happens for things like the postcode validation (no point showing the postcode field error message twice)</span>
<span class="cm">     */</span>
    <span class="kd">var</span> <span class="nx">clean_list</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">unique</span><span class="p">(</span><span class="nx">errors</span><span class="p">);</span>

    <span class="c1">// The list needs to be converted into an Object for Hogan.js to compile the data into its template</span>
    <span class="kd">var</span> <span class="nx">converted_list</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nx">clean_list</span><span class="p">).</span><span class="nx">map</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">index</span><span class="p">,</span> <span class="nx">item</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="nx">error</span><span class="o">:</span> <span class="nx">item</span>
        <span class="p">};</span>
    <span class="p">});</span>

    <span class="c1">// Spent far longer on this than I wanted to, but this is it: jQuery collection is not an Array and so needs to be converted to an Array for Hogan.js to compile it</span>
    <span class="kd">var</span> <span class="nx">final_list</span> <span class="o">=</span> <span class="nx">jQuery</span><span class="p">.</span><span class="nx">makeArray</span><span class="p">(</span><span class="nx">converted_list</span><span class="p">);</span>

    <span class="c1">// If the template file has been stored already then we&#39;ll just proceed to render the content</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">template</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">display_errors</span><span class="p">({</span> <span class="nx">errors</span><span class="o">:</span> <span class="nx">final_list</span> <span class="p">});</span>
    <span class="p">}</span> 
    <span class="c1">// Otherwise grab the template file and then render the content</span>
    <span class="k">else</span> <span class="p">{</span>
        <span class="c1">// Have to rebind the `this` value as otherwise it would be equal to the global object (Window)</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">get_template</span><span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">display_errors</span><span class="p">({</span> <span class="nx">errors</span><span class="o">:</span> <span class="nx">final_list</span> <span class="p">});</span>
        <span class="p">},</span> <span class="k">this</span><span class="p">));</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</code></pre>
<p>The <code>display_errors</code> method takes in the object of errors we&#39;ve created and tries to compile it into the template file using Hogan.js</p>
<p>But the first thing the method does is check if any errors already exist in the page. If it finds an errors element then it removes it.</p>
<p>We then compile the data into the template file and insert it into the page (thus displaying the errors to the user).</p>
<p>We then update the URL hash to include the id value of the form errors element we&#39;ve just inserted into the page. This is because on a long form the errors are displayed at the top of the form, but the user may well not see it because the page only shows the bottom half the form, so we redirect the user back up to the top of the form to see the errors.</p>
<p>I know some people will disagree with doing that and would prefer to display an error next to each field but I find that makes the design of the page a lot more complicated, especially when dealing with multiple screen dimensions. I personally prefer to have a single place to display all errors.</p>
<pre><code class="lang-js"><div class="highlight"><pre><span class="nx">display_errors</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// First remove any errors that might already be on the page</span>
    <span class="kd">var</span> <span class="nx">existing_list</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#js-formerrors&#39;</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">existing_list</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">existing_list</span><span class="p">.</span><span class="nx">remove</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="c1">// Render the data into the template</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">template_content</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">template</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>

    <span class="c1">// Insert the error messages into the page</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">prepend</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">template_content</span><span class="p">);</span>

    <span class="cm">/*</span>
<span class="cm">        Focus page to the error message element.</span>
<span class="cm">        Had issue with WebKit where it wouldn&#39;t reposition window to the named anchor unless we reset the hash back to nothing and then set it again to the named anchor</span>
<span class="cm">     */</span>
    <span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">hash</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
    <span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">hash</span> <span class="o">=</span> <span class="s1">&#39;js-formerrors&#39;</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</code></pre>
<p>The full module code is as follows...</p>
<pre><code class="lang-js"><div class="highlight"><pre><span class="nx">define</span><span class="p">([</span><span class="s1">&#39;../Utils/Templating/hogan&#39;</span><span class="p">],</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">hogan</span><span class="p">)</span> <span class="p">{</span>

    <span class="kd">var</span> <span class="nx">Validation</span> <span class="o">=</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">View</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
        <span class="nx">initialize</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
            <span class="c1">// Self explanatory: stores all mandatory fields</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">mandatory_fields</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.js-mandatory-field&#39;</span><span class="p">);</span>

            <span class="c1">// This holds the template file we&#39;ll compile with data pulled from server</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">template</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>

            <span class="c1">// This holds the actual rendered template content</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">template_content</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>

            <span class="c1">// We&#39;ll go ahead and grab the error message template file (no point waiting until the last minute and making the user wait).</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">get_template</span><span class="p">();</span>
        <span class="p">},</span>

        <span class="nx">el</span><span class="o">:</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#js-form&#39;</span><span class="p">),</span>

        <span class="nx">events</span><span class="o">:</span> <span class="p">{</span>
            <span class="s1">&#39;submit&#39;</span><span class="o">:</span> <span class="s1">&#39;validate&#39;</span>
        <span class="p">},</span>

        <span class="nx">get_template</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
                <span class="nx">url</span><span class="o">:</span> <span class="s1">&#39;Assets/Templates/FormErrors.txt&#39;</span><span class="p">,</span>
                <span class="nx">dataType</span><span class="o">:</span> <span class="s1">&#39;html&#39;</span><span class="p">,</span>
                <span class="nx">success</span><span class="o">:</span> <span class="nx">_</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">tmp</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">this</span><span class="p">.</span><span class="nx">template</span> <span class="o">=</span> <span class="nx">hogan</span><span class="p">.</span><span class="nx">compile</span><span class="p">(</span><span class="nx">tmp</span><span class="p">);</span>

                    <span class="k">if</span> <span class="p">(</span><span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
                        <span class="nx">callback</span><span class="p">();</span>
                    <span class="p">}</span>
                <span class="p">},</span> <span class="k">this</span><span class="p">)</span>
            <span class="p">});</span>
        <span class="p">},</span>

        <span class="nx">validate</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
            <span class="kd">var</span> <span class="nx">errors</span> <span class="o">=</span> <span class="p">[];</span>
            <span class="kd">var</span> <span class="nx">method</span><span class="p">;</span>

            <span class="c1">// Loop through all the fields checking for validation errors</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">mandatory_fields</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">index</span><span class="p">,</span> <span class="nx">item</span><span class="p">)</span> <span class="p">{</span>
                <span class="c1">// First we check what the current field is and validate it against a specific method</span>
                <span class="k">switch</span> <span class="p">(</span><span class="nx">item</span><span class="p">.</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">case</span> <span class="s1">&#39;dob&#39;</span><span class="o">:</span>
                        <span class="nx">method</span> <span class="o">=</span> <span class="s1">&#39;validate_date&#39;</span><span class="p">;</span>
                        <span class="k">break</span><span class="p">;</span>
                    <span class="k">case</span> <span class="s1">&#39;age&#39;</span><span class="o">:</span>
                        <span class="nx">method</span> <span class="o">=</span> <span class="s1">&#39;validate_number&#39;</span><span class="p">;</span>
                        <span class="k">break</span><span class="p">;</span>
                    <span class="k">case</span> <span class="s1">&#39;email&#39;</span><span class="o">:</span>
                        <span class="nx">method</span> <span class="o">=</span> <span class="s1">&#39;validate_email&#39;</span><span class="p">;</span>
                        <span class="k">break</span><span class="p">;</span>
                    <span class="k">case</span> <span class="s1">&#39;mobile&#39;</span><span class="o">:</span>
                        <span class="nx">method</span> <span class="o">=</span> <span class="s1">&#39;validate_mobile&#39;</span><span class="p">;</span>
                        <span class="k">break</span><span class="p">;</span>
                    <span class="k">case</span> <span class="s1">&#39;password&#39;</span><span class="o">:</span>
                        <span class="nx">method</span> <span class="o">=</span> <span class="s1">&#39;validate_password&#39;</span><span class="p">;</span>
                        <span class="k">break</span><span class="p">;</span>
                    <span class="k">case</span> <span class="s1">&#39;card&#39;</span><span class="o">:</span>
                        <span class="nx">method</span> <span class="o">=</span> <span class="s1">&#39;validate_cardnumber&#39;</span><span class="p">;</span>
                        <span class="k">break</span><span class="p">;</span>
                    <span class="k">case</span> <span class="s1">&#39;proceed&#39;</span><span class="o">:</span>
                        <span class="nx">method</span> <span class="o">=</span> <span class="s1">&#39;validate_checkbox&#39;</span><span class="p">;</span>
                        <span class="k">break</span><span class="p">;</span>
                    <span class="k">default</span><span class="o">:</span>
                        <span class="nx">method</span> <span class="o">=</span> <span class="s1">&#39;validate_text&#39;</span><span class="p">;</span>
                <span class="p">}</span>

                <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">[</span><span class="nx">method</span><span class="p">](</span><span class="nx">item</span><span class="p">))</span> <span class="p">{</span>
                    <span class="c1">// Store just the messages and not the element itself (we only need the list of messages)</span>
                    <span class="nx">errors</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">item</span><span class="p">.</span><span class="nx">getAttribute</span><span class="p">(</span><span class="s1">&#39;data-message&#39;</span><span class="p">));</span>
                <span class="p">}</span>
            <span class="p">},</span> <span class="k">this</span><span class="p">));</span>

            <span class="c1">// If there are any errors then display warning messsage to the user</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">errors</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">process_errors</span><span class="p">(</span><span class="nx">errors</span><span class="p">);</span>
                <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">},</span>

        <span class="nx">validate_text</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">field</span><span class="p">)</span> <span class="p">{</span>
            <span class="cm">/*</span>
<span class="cm">                If the length is zero (meaning the field is empty) then zero will coerce to false </span>
<span class="cm">                so we return the opposite of that using the ! operator (so the first part of the following condition is met) </span>
<span class="cm">                and if the length is greater than zero then the regex checks to see if the content isn&#39;t just empty spaces.</span>

<span class="cm">                If there was an error then we return true, if there wasn&#39;t an error then undefined will be returned (which coerces to false)</span>
<span class="cm">             */</span>
            <span class="k">if</span> <span class="p">(</span><span class="sr">/^\s+$/</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">field</span><span class="p">.</span><span class="nx">value</span><span class="p">)</span> <span class="o">||</span> <span class="o">!</span><span class="nx">field</span><span class="p">.</span><span class="nx">value</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">},</span>

        <span class="nx">validate_number</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">field</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="sr">/^\D+/</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">field</span><span class="p">.</span><span class="nx">value</span><span class="p">)</span> <span class="o">||</span> <span class="o">!</span><span class="nx">field</span><span class="p">.</span><span class="nx">value</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">},</span>

        <span class="nx">validate_date</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">field</span><span class="p">)</span> <span class="p">{</span>
            <span class="cm">/*</span>
<span class="cm">                The regex allows either double figure formats or singular...</span>
<span class="cm">                00/00/00</span>
<span class="cm">                0/0/0</span>
<span class="cm">             */</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="sr">/^\d{1,2}\/\d{1,2}\/\d{1,2}$/</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">field</span><span class="p">.</span><span class="nx">value</span><span class="p">)</span> <span class="o">||</span> <span class="o">!</span><span class="nx">field</span><span class="p">.</span><span class="nx">value</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">},</span>

        <span class="nx">validate_email</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">field</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">field</span><span class="p">.</span><span class="nx">value</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s2">&quot;@&quot;</span><span class="p">)</span> <span class="o">===</span> <span class="o">-</span><span class="mi">1</span> <span class="o">||</span> <span class="o">!</span><span class="nx">field</span><span class="p">.</span><span class="nx">value</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">},</span>

        <span class="nx">validate_mobile</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">field</span><span class="p">)</span> <span class="p">{</span>
            <span class="cm">/*</span>
<span class="cm">                The regex allows the following formats:</span>
<span class="cm">                    +44 07000000000</span>
<span class="cm">                    07000000000</span>
<span class="cm">                    +4407000000000</span>

<span class="cm">                So there is an optional +000 country code at the start (wrapped in a non-capturing group)</span>
<span class="cm">                We then allow for an optional space after the optional country code</span>
<span class="cm">                Finally we allow for 11 digits (no spaces - but we also strip out any spaces found before running the regex so the &#39;no spaces&#39; thing doesn&#39;t really matter)</span>
<span class="cm">             */</span>
            <span class="kd">var</span> <span class="nx">strip_spaces</span> <span class="o">=</span> <span class="nx">field</span><span class="p">.</span><span class="nx">value</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">);</span> <span class="c1">// some people seem to add odd spacing when enterin numbers?</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="sr">/^(?:\+\d{1,3})?\s?\d{11}$/</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">strip_spaces</span><span class="p">)</span> <span class="o">||</span> <span class="o">!</span><span class="nx">field</span><span class="p">.</span><span class="nx">value</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">},</span>

        <span class="nx">validate_password</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">field</span><span class="p">)</span> <span class="p">{</span>
            <span class="cm">/*</span>
<span class="cm">                The regex makes sure there is at least 8 alpha-numerical characters</span>
<span class="cm">                And that at least one of those values is a number</span>
<span class="cm">                And that at least one of those values is a text character</span>
<span class="cm">                We use a positive lookahead (which checks to see if a sub pattern matches a specific position)</span>
<span class="cm">                The lookahead checks for any character (zero or more times) is followed by a digit (e.g. making sure there is at least one digit)</span>
<span class="cm">                The lookahead then checks for any character (zero or more times) is followed by a text character (e.g. making sure there is at least one text character)</span>
<span class="cm">                Finally after the two lookaheads we have the standard regex which makes sure there is at least 8 alpha-numerical characters</span>
<span class="cm">             */</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="sr">/^(?=.*\d)(?=.*[a-z])\w{8,}/i</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">field</span><span class="p">.</span><span class="nx">value</span><span class="p">))</span> <span class="p">{</span>
                <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">},</span>

        <span class="nx">validate_cardnumber</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">field</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">function</span> <span class="nx">luhn</span> <span class="p">(</span><span class="nx">cardnumber</span><span class="p">)</span> <span class="p">{</span>
                <span class="c1">// Build an array with the digits in the card number</span>
                <span class="kd">var</span> <span class="nx">getdigits</span> <span class="o">=</span> <span class="sr">/\d/g</span><span class="p">;</span>
                <span class="kd">var</span> <span class="nx">digits</span> <span class="o">=</span> <span class="p">[];</span>
                <span class="kd">var</span> <span class="nx">match</span><span class="p">;</span>

                <span class="k">while</span> <span class="p">(</span><span class="nx">match</span> <span class="o">=</span> <span class="nx">getdigits</span><span class="p">.</span><span class="nx">exec</span><span class="p">(</span><span class="nx">cardnumber</span><span class="p">))</span> <span class="p">{</span>
                    <span class="nx">digits</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nb">parseInt</span><span class="p">(</span><span class="nx">match</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">10</span><span class="p">));</span>
                <span class="p">}</span>

                <span class="c1">// Run the Luhn algorithm on the array</span>
                <span class="kd">var</span> <span class="nx">sum</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
                <span class="kd">var</span> <span class="nx">alt</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>

                <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="nx">digits</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span><span class="o">--</span><span class="p">)</span> <span class="p">{</span>
                    <span class="c1">// On every other number in the card sequence...</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nx">alt</span><span class="p">)</span> <span class="p">{</span>
                        <span class="nx">digits</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">*=</span> <span class="mi">2</span><span class="p">;</span> <span class="c1">// multiple the number by itself</span>

                        <span class="c1">// If the number is now over 9 then we&#39;ll minus 9 from the number</span>
                        <span class="k">if</span> <span class="p">(</span><span class="nx">digits</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">9</span><span class="p">)</span> <span class="p">{</span>
                            <span class="nx">digits</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">-=</span> <span class="mi">9</span><span class="p">;</span>
                        <span class="p">}</span>
                    <span class="p">}</span>

                    <span class="c1">// Add this digit onto the current total sum</span>
                    <span class="nx">sum</span> <span class="o">+=</span> <span class="nx">digits</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>

                    <span class="c1">// Alternate</span>
                    <span class="nx">alt</span> <span class="o">=</span> <span class="o">!</span><span class="nx">alt</span><span class="p">;</span>
                <span class="p">}</span>

                <span class="cm">/*</span>
<span class="cm">                    The individual card numbers (after the above algorithm is applied and then when added together) </span>
<span class="cm">                    should be possible to divide by 10 with zero left over</span>
<span class="cm">                 */</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">sum</span> <span class="o">%</span> <span class="mi">10</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                    <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
                <span class="p">}</span>
            <span class="p">}</span>

            <span class="c1">// The following regex was actually borrowed from The Regular Expression Cookbook (co-written by the regex legend @stevenlevithan)</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="sr">/^(?:4[0-9]{12}(?:[0-9]{3})?|5[1-5][0-9]{14}|6(?:011|5[0-9][0-9])[0-9]{12}|3[47][0-9]{13}|3(?:0[0-5]|[68][0-9])[0-9]{11}|(?:2131|1800|35\d{3})\d{11})$/g</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">field</span><span class="p">.</span><span class="nx">value</span><span class="p">))</span> <span class="p">{</span>
                <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="c1">// If the card number appears to be valid we then run the Luhn test</span>
                <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">luhn</span><span class="p">(</span><span class="nx">field</span><span class="p">.</span><span class="nx">value</span><span class="p">))</span> <span class="p">{</span>
                    <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">},</span>

        <span class="nx">validate_checkbox</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">field</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">field</span><span class="p">.</span><span class="nx">checked</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">},</span>

        <span class="nx">process_errors</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">errors</span><span class="p">)</span> <span class="p">{</span>
            <span class="cm">/*</span>
<span class="cm">                Clean the errors list so we only have unique data.</span>
<span class="cm">                This happens for things like the postcode validation (no point showing the postcode field error message twice)</span>
<span class="cm">             */</span>
            <span class="kd">var</span> <span class="nx">clean_list</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">unique</span><span class="p">(</span><span class="nx">errors</span><span class="p">);</span>

            <span class="c1">// The list needs to be converted into an Object for Hogan.js to compile the data into its template</span>
            <span class="kd">var</span> <span class="nx">converted_list</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nx">clean_list</span><span class="p">).</span><span class="nx">map</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">index</span><span class="p">,</span> <span class="nx">item</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">return</span> <span class="p">{</span>
                    <span class="nx">error</span><span class="o">:</span> <span class="nx">item</span>
                <span class="p">};</span>
            <span class="p">});</span>

            <span class="c1">// Spent far longer on this than I wanted to, but this is it: jQuery collection is not an Array and so needs to be converted to an Array for Hogan.js to compile it</span>
            <span class="kd">var</span> <span class="nx">final_list</span> <span class="o">=</span> <span class="nx">jQuery</span><span class="p">.</span><span class="nx">makeArray</span><span class="p">(</span><span class="nx">converted_list</span><span class="p">);</span>

            <span class="c1">// If the template file has been stored already then we&#39;ll just proceed to render the content</span>
            <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">template</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">display_errors</span><span class="p">({</span> <span class="nx">errors</span><span class="o">:</span> <span class="nx">final_list</span> <span class="p">});</span>
            <span class="p">}</span> 
            <span class="c1">// Otherwise grab the template file and then render the content</span>
            <span class="k">else</span> <span class="p">{</span>
                <span class="c1">// Have to rebind the `this` value as otherwise it would be equal to the global object (Window)</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">get_template</span><span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
                    <span class="k">this</span><span class="p">.</span><span class="nx">display_errors</span><span class="p">({</span> <span class="nx">errors</span><span class="o">:</span> <span class="nx">final_list</span> <span class="p">});</span>
                <span class="p">},</span> <span class="k">this</span><span class="p">));</span>
            <span class="p">}</span>
        <span class="p">},</span>

        <span class="nx">display_errors</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// First remove any errors that might already be on the page</span>
            <span class="kd">var</span> <span class="nx">existing_list</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#js-formerrors&#39;</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">existing_list</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">existing_list</span><span class="p">.</span><span class="nx">remove</span><span class="p">();</span>
            <span class="p">}</span>

            <span class="c1">// Render the data into the template</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">template_content</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">template</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>

            <span class="c1">// Insert the error messages into the page</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">prepend</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">template_content</span><span class="p">);</span>

            <span class="cm">/*</span>
<span class="cm">                Focus page to the error message element.</span>
<span class="cm">                Had issue with WebKit where it wouldn&#39;t reposition window to the named anchor unless we reset the hash back to nothing and then set it again to the named anchor</span>
<span class="cm">             */</span>
            <span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">hash</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
            <span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">hash</span> <span class="o">=</span> <span class="s1">&#39;js-formerrors&#39;</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">});</span>

    <span class="k">new</span> <span class="nx">Validation</span><span class="p">();</span>

<span class="p">});</span>
</pre></div>
</code></pre>
<h2><a name="conclusion" class="anchor" href="#conclusion"><span class="header-link"></span></a>Conclusion</h2>
<p>OK, so that&#39;s our full validation method! It looks big but when you break it down it&#39;s not actually that complicated.</p>
<p>It works for me and has made my life a hell of a lot easier whenever I&#39;ve needed to validate a form. Hopefully it helps someone else, or inspires some one to take the principles shown here and to build their own variation so their life is a little easier when dealing with forms.</p>
</div>

  <div class="comments">
    <a href="/posts/backbone-validation/#comments">
      <span class="icon-bubbles"></span>
      Comments
    </a>
  </div>


<div class="pagination group">
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
      <a href="/page/8/" class="newer"> Newer &#8594;</a>
    
  
    
    
  
    
    
      <a href="/page/10/" class="older"> &#8592; Older</a>
    
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
</div>
    </div>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.1/jquery.min.js" type="text/javascript"></script>
    <script src="/scripts/main.js" type="text/javascript"></script>
    <script src="/scripts/Imager.js" type="text/javascript"></script>
    <script>
        var _gaq=[['_setAccount','UA-33159515-1'],['_trackPageview']];
        (function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];
        g.src=('https:'==location.protocol?'//ssl':'//www')+'.google-analytics.com/ga.js';
        s.parentNode.insertBefore(g,s)}(document,'script'));
    </script>
  </body>
</html>

