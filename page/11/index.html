<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="icon" type="image/png" href="/images/cabin.png" >
    <link href="/styles/main.css" rel="stylesheet">
    
    <title>Integralist -> BBC News Engineer</title>
    
    
    <link rel="alternate" type="application/atom+xml" title="Integralist" href="http://feeds.feedburner.com/Integralist">
  </head>
  <body>
    <nav>
      <h1 class="name">
          <a href="/">Integralist</a> <span class="role">BBC News Engineer</span>
      </h1>
      <div class="menu icon-menu"></div>
      <ul class="nav-links">
        <li class="text-link">
          <a href="/about.html">about</a>
        </li>
        <li class="text-link">
          <a href="/projects.html">projects</a>
        </li>
        <li class="text-link">
          <a href="/archives.html">archives</a>
        </li>
      </ul>
      <div class="social-media">
        <a href="https://github.com/integralist" class="icon-github"></a>
        <a href="https://twitter.com/integralist" class="icon-twitter"></a>
      </div>
    </nav>
    <div class="content">


  <div class="post-head group">
  <a href="/posts/javascript-101/">
    <h1 class="post-title">JavaScript 101</h1>
  </a>
  <span class="post-date">2012 &#183; 11 &#183; 24</span>
</div>

<div class="post-body"><h2><a name="what-well-cover" class="anchor" href="#what-well-cover"><span class="header-link"></span></a>What we&#39;ll cover</h2>
<p><em>reading time: approx. 23mins</em></p>
<ul>
<li>Introduction</li>
<li>What is JavaScript</li>
<li>Terminology</li>
<li>Global Object</li>
<li>Variables</li>
<li>Types</li>
<li>Objects</li>
<li>Arrays</li>
<li>Conditional Statements</li>
<li>Coercion</li>
<li>Functions</li>
<li>Code Reuse (inheritance)</li>
<li>Conclusion</li>
</ul>
<h2><a name="introduction" class="anchor" href="#introduction"><span class="header-link"></span></a>Introduction</h2>
<p>I&#39;ve written this <em>very</em> brief guide to JavaScript just as an aid for people new to the language and who need a basic starting point to see what the syntax looks like and to get a feeling for some of its features.</p>
<p>This article&#39;s main purpose is to give readers new to the language a glimpse of the JavaScript environment and to hopefully spur them onto further reading/learning. </p>
<h2><a name="what-is-javascript" class="anchor" href="#what-is-javascript"><span class="header-link"></span></a>What is JavaScript</h2>
<p>JavaScript is a <em>scripting language</em> - this means it is not <em>compiled</em> (like traditional software languages like C or C++) but is executed &#39;line by line&#39; via its host environment at run time (the host environment can be: Web Browser, Server, Command Line, Desktop).</p>
<h2><a name="terminology" class="anchor" href="#terminology"><span class="header-link"></span></a>Terminology</h2>
<table>
<thead>
<tr>
<th>Term</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr>
<td>expression</td>
<td>An expression is a command that the JavaScript engine can <em>evaluate</em> to produce a value</td>
</tr>
<tr>
<td>statement</td>
<td>A statement is a command that can be executed (statements are terminated with a semicolon)</td>
</tr>
<tr>
<td>identifier</td>
<td>A name (e.g. variable name, function name, labels for loops).</td>
</tr>
<tr>
<td>function declaration</td>
<td><code>function myFunction(){ /* code */ }</code></td>
</tr>
<tr>
<td>function expression</td>
<td><code>var myFunction = function(){ /* code */ };</code></td>
</tr>
<tr>
<td>primitive</td>
<td><code>undefined</code>, <code>null</code>, <code>boolean</code>, <code>string</code> and <code>number</code></td>
</tr>
<tr>
<td>operator</td>
<td><code>+</code>, <code>-</code>, <code>!</code>, <code>++</code>, <code>===</code>, <code>&amp;&amp;</code>, <code>typeof</code></td>
</tr>
</tbody>
</table>
<h3><a name="expressions" class="anchor" href="#expressions"><span class="header-link"></span></a>Expressions</h3>
<p>An example of an &#39;expression&#39; would be <code>1+1</code>. </p>
<p>Looks straight forward enough, and it should be. As mentioned above, an expression is simply <em>something</em> that can be interpreted as a value. So <code>1+1</code> (when evaluated by the JavaScript engine) results in an number with a value of two. </p>
<p>Now the expression <code>1+1</code> is pretty useless in a JavaScript program because we&#39;re not doing anything with it. For us to more effectively use this expression we ideally want to store it somewhere so we can reference it later and that&#39;s where &#39;variables&#39; come in (see later on this article).</p>
<h3><a name="statements" class="anchor" href="#statements"><span class="header-link"></span></a>Statements</h3>
<p>Examples of JavaScript &#39;statements&#39;: </p>
<ul>
<li><code>if (condition) { /* code */ }</code></li>
<li><code>while (condition) { /* code */ }</code></li>
<li><code>return</code>, <code>break</code>, <code>throw</code> are single command statements</li>
</ul>
<h2><a name="global-object" class="anchor" href="#global-object"><span class="header-link"></span></a>Global Object</h2>
<p>When the JavaScript interpreter starts up it creates a Global object and any properties/methods added to the Global object are available to the entire JavaScript program.</p>
<p>The global object is a regular object (as per the Object section seen later in this article).</p>
<p>The global object is different depending on the context. In a web browser environment the global object is said to be the <code>window</code> object. But this isn&#39;t completely accurate. The global object happens to have a <code>window</code> property which is set back to the global object itself! A little confusing I know :-) If you open a browser console (e.g. Firefox&#39;s Firebug JavaScript Console, or Safari/Google Chrome&#39;s Console Tool) and enter the command <code>window</code> you&#39;ll see all the properties/methods available on that object - things like <code>window.location</code> will be one option that is listed (this references the location bar API of the web browser).</p>
<p>One quote you&#39;ll hear a lot in JavaScript is:</p>
<blockquote>
<p>Don&#39;t pollute the global environment</p>
</blockquote>
<p>…and what this means is try to avoid creating global properties and methods. The less &#39;globals&#39; you create then the less likely your code will conflict with another piece of code written by someone else that may be included in the same page.</p>
<p>To avoid declaring global properties/methods there are certain &#39;patterns&#39; that have been designed to work around this issue, such as the IIFE pattern…</p>
<pre><code class="lang-js"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> * this pattern is referred to as an IIFE (immediately invoked function expression)</span>
<span class="cm"> * the function is immediately executed and all code within it is scoped to the function</span>
<span class="cm"> * when executed we pass through &#39;this&#39; which refers to the global object</span>
<span class="cm"> * we accept &#39;this&#39; into the function as an argument called &#39;global&#39;</span>
<span class="cm"> */</span>
<span class="kd">var</span> <span class="nx">app</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">global</span><span class="p">)</span> <span class="p">{</span>

    <span class="c1">// private data (private as in: it can&#39;t be accessed from other code outside this function)</span>
    <span class="c1">// note: don&#39;t EVER name your functions like this!</span>
    <span class="kd">function</span> <span class="nx">will_be_made_public_but_cant_be_accessed_directly</span><span class="p">(){</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Private&#39;</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="p">{</span>
        <span class="c1">// public API (private code we&#39;ve chosen to make public)</span>
        <span class="nx">do_something</span><span class="o">:</span> <span class="nx">will_be_made_public_but_cant_be_accessed_directly</span>
    <span class="p">};</span>

<span class="p">}(</span><span class="k">this</span><span class="p">));</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">will_be_made_public_but_cant_be_accessed_directly</span><span class="p">()</span> <span class="c1">// TypeError: Object #&lt;Object&gt; has no method &#39;will_be_made_public_but_cant_be_accessed_directly&#39;</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">do_something</span><span class="p">();</span> <span class="c1">// =&gt; &#39;Private&#39;</span>
</pre></div>
</code></pre>
<p>Another pattern is to use AMD (Asynchronous Module Definition) which is a module based pattern (see: <a href="https://github.com/Integralist/Blog-Posts/blob/master/Beginners-guide-to-AMD-and-RequireJS.md">Beginners guide to AMD and RequireJS</a>)</p>
<h2><a name="variables" class="anchor" href="#variables"><span class="header-link"></span></a>Variables</h2>
<p>Variables hold values/data. </p>
<p>You declare a variable like so: <code>var my_var = 123;</code> - in this example we&#39;ve declared a variable and assigned the value <code>123</code> to it.</p>
<p>You must always declare a variable. An undeclared variable looks like this: <code>my_var = 123;</code> - notice the lack of the <code>var</code> keyword. </p>
<p>Undeclared variables are a bad practice because they cause confusion as to whether the variable should be &#39;global&#39; or not.</p>
<p>Here is a break down of the different variable scenarios:</p>
<ul>
<li>Variable is declared within a function:<br>variable becomes scoped to that function (i.e. it isn&#39;t accessible outside of that function). </li>
<li>Variable is declared at the top level of the script file (e.g. not inside of a function):<br>variable becomes a global variable (i.e. is available any where within the JavaScript program).</li>
<li>Variable is undeclared (e.g. doesn&#39;t matter where in the program the undeclared variable was created):<br>variable becomes a global variable (i.e. is available any where within the JavaScript program).</li>
</ul>
<p>As you can see, missing a <code>var</code> declaration will mean the JavaScript engine will make that undeclared variable a &#39;global&#39; variable (e.g. it is assigned to the Global object).</p>
<p>To see why this is a problem first imagine you have a web page you&#39;re working on and in which you have included a 3rd party JavaScript file (i.e. a script written by another developer). Now imagine the content of that 3rd party script is as follows:</p>
<pre><code class="lang-js"><div class="highlight"><pre><span class="c1">// 3rd party script written by another developer...</span>
<span class="kd">var</span> <span class="nx">my_name</span> <span class="o">=</span> <span class="s1">&#39;Mark&#39;</span><span class="p">;</span>
</pre></div>
</code></pre>
<p>…in this instance, the 3rd party script hasn&#39;t wrapped the line <code>var my_name = &#39;Mark&#39;;</code> inside of an IIFE (see above pattern) so the variable <code>my_name</code> will be created as global property (e.g. it is available any where within the JavaScript program as well as explicitly via <code>window.my_name</code>).</p>
<p>Now you don&#39;t want to overwrite the variable <code>my_name</code> because the 3rd party script that defined it is relying on it being a String with a value of <code>Mark</code> - if you change the value then it could cause the 3rd party code to break.</p>
<p>So now imagine you&#39;re going to add your own code to the page. You write the following…</p>
<pre><code class="lang-js"><div class="highlight"><pre><span class="kd">function</span> <span class="nx">do_something</span><span class="p">(){</span>
    <span class="nx">my_name</span> <span class="o">=</span> <span class="s1">&#39;Bob&#39;</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</code></pre>
<p>…this may cause unintended side effects on the 3rd party code. Why? Because you coincidentally defined a variable by the same name of <code>my_name</code> and although you likely intended it to be scoped to the function <code>do_something</code> you&#39;ve accidentally forgotten the <code>var</code> keyword and so your variable is undeclared, so your variable has been assigned to the Global object, thus overwriting the <code>my_name</code> variable that is already available on the Global object (set by the 3rd party code).</p>
<p>To fix this you would simply make sure you properly declared your variable like so…</p>
<pre><code class="lang-js"><div class="highlight"><pre><span class="kd">function</span> <span class="nx">do_something</span><span class="p">(){</span>
    <span class="kd">var</span> <span class="nx">my_name</span> <span class="o">=</span> <span class="s1">&#39;Bob&#39;</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</code></pre>
<p>So now, even though the variable name is the same, the variable is &#39;scoped&#39; to the <code>do_something</code> function.</p>
<p>In today&#39;s world you&#39;ll be very hard pushed to find a library that sets anything more than one global variable - but it&#39;s an issue to be aware of in case you inherit a code base from a less educated developer.</p>
<p>Global properties aren&#39;t completely avoidable. A library will generally set one global which will act as a &#39;namespace&#39; for their entire app. For example, jQuery sets two globals <code>jQuery</code> and <code>$</code> and all their methods are available through those two globals so unless you&#39;re trying to use <code>jQuery</code> or <code>$</code> as your own namespace then you shouldn&#39;t notice any conflicts. </p>
<p>Most companies name their global namespace after their company: <code>var mycompany_app = /* code */;</code></p>
<h2><a name="types" class="anchor" href="#types"><span class="header-link"></span></a>Types</h2>
<p>JavaScript types are split into two groups: <code>primitive</code> types and <code>reference</code> types. </p>
<p><code>Numbers</code>, <code>Booleans</code>, <code>Strings</code>, <code>Null</code> and <code>Undefined</code> types are primitive. </p>
<p><code>Objects</code>, <code>Arrays</code>, and <code>Functions</code> are reference types. </p>
<p>It&#39;s important to know the different types because at some point in your JavaScript code you&#39;ll want to pass around values and objects and you might notice some issues with doing so. For example, you&#39;ll notice that JavaScript passes <code>Objects</code>/<code>Arrays</code>/<code>Functions</code> by reference, and passes primitives such as <code>Booleans</code>/<code>Strings</code>/<code>Numbers</code>/<code>Null</code>/<code>Undefined</code> by value.</p>
<p>What this means is if you have an Array and want to copy it so you can make changes to the copy (e.g. you want to leave the original as it is) then you might think to do something like this…</p>
<pre><code class="lang-js"><div class="highlight"><pre><span class="kd">var</span> <span class="nx">my_arr</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">];</span>
<span class="kd">var</span> <span class="nx">new_arr</span> <span class="o">=</span> <span class="nx">my_arr</span><span class="p">;</span>

<span class="nx">new_arr</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="s1">&#39;d&#39;</span><span class="p">);</span>
</pre></div>
</code></pre>
<p>…you might think that <code>new_arr</code> will be <code>[&quot;a&quot;, &quot;b&quot;, &quot;c&quot;, &quot;d&quot;]</code> and <code>my_arr</code> would still be equal to <code>[&quot;a&quot;, &quot;b&quot;, &quot;c&quot;]</code> but you&#39;d be wrong because Arrays are passed by &#39;reference&#39; and so your change: <code>new_arr.push(&#39;d&#39;);</code> is effectively doing this: <code>my_arr.push(&#39;d&#39;);</code>, hence <code>my_arr</code> now has the value of <code>[&quot;a&quot;, &quot;b&quot;, &quot;c&quot;, &quot;d&quot;]</code> and so does <code>new_arr</code> because it really is just referencing (i.e. pointing to) <code>my_arr</code>.</p>
<p>So be careful.</p>
<h2><a name="objects" class="anchor" href="#objects"><span class="header-link"></span></a>Objects</h2>
<p>To create a new <code>Object</code> use the syntax: <code>{}</code></p>
<p>For example:</p>
<pre><code class="lang-js"><div class="highlight"><pre><span class="kd">var</span> <span class="nx">obj</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;Mark&#39;</span><span class="p">,</span>
    <span class="nx">location</span><span class="o">:</span> <span class="s1">&#39;London, England&#39;</span>
<span class="p">};</span>
</pre></div>
</code></pre>
<p>A variable added to an Object is known as a &#39;property&#39;.<br>A function added to an Object is known as a &#39;method&#39;  </p>
<p>…this naming convention originates from traditional Object-Oriented languages.</p>
<p>So for example:</p>
<pre><code class="lang-js"><div class="highlight"><pre><span class="kd">var</span> <span class="nx">obj</span> <span class="o">=</span> <span class="p">{</span>
    <span class="cm">/* Property */</span>
        <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;Mark&#39;</span><span class="p">,</span>
    <span class="cm">/* Property */</span>
        <span class="nx">location</span><span class="o">:</span> <span class="s1">&#39;London, England&#39;</span><span class="p">,</span>
    <span class="cm">/* Method */</span>
        <span class="nx">get_details</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
            <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">name</span> <span class="o">+</span> <span class="s1">&#39; is from &#39;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">location</span><span class="p">;</span> <span class="c1">// =&gt; &quot;Mark is from London, England&quot;</span>
        <span class="p">}</span>
<span class="p">};</span>
</pre></div>
</code></pre>
<h3><a name="nearlyeverything-in-javascript-is-an-object" class="anchor" href="#nearlyeverything-in-javascript-is-an-object"><span class="header-link"></span></a>(Nearly)Everything in JavaScript is an Object</h3>
<p>One thing to be clear on is that nearly everything in JavaScript is an object (e.g. Functions, Arrays, Numbers, Strings etc). They all inherit their properties/attributes from the top level Object, and this is made possible in JavaScript via what&#39;s called the &#39;prototype chain&#39;. </p>
<p>We won&#39;t go into the &#39;prototype&#39; too deeply now but the following section will touch on how it works briefly.</p>
<h3><a name="prototype" class="anchor" href="#prototype"><span class="header-link"></span></a>Prototype</h3>
<p>Every Object you create in JavaScript has a hidden object tied to it. This hidden object is called the &#39;prototype&#39; for that object, and what this means is that your object you&#39;ve created will inherit properties from the prototype.</p>
<p>All &#39;objects&#39; that you create (e.g. <code>var obj = {};</code>) have the same prototype object they point to/reference - which is the top level <code>Object</code> in JavaScript. We call this <code>Object.prototype</code>, and this top level <code>Object</code> itself has no prototype (it&#39;s the only object that has no prototype because nothing precedes it).</p>
<p>All built-in Constructors (e.g. <code>Array.prototype</code>, <code>Date.prototype</code>) inherit from the <code>Object.prototype</code> and this linked set of objects is known as the &#39;prototype chain&#39; and is how &#39;inheritance&#39; works (see below for a short mention of inheritance and other forms of code reuse).</p>
<h3><a name="accessing-propertiesmethods" class="anchor" href="#accessing-propertiesmethods"><span class="header-link"></span></a>Accessing properties/methods</h3>
<p>To access properties/methods you can use either the dot notation or the bracket notation. The difference is in whether the property/method name is known at the type of execution or not.</p>
<p>Using the previous example code, if your program was written by you then to access the &#39;name&#39; property you would simply use: <code>obj.name</code> - but if your application accepted input from the user (where by you asked them what property/method they wanted to access) you obviously don&#39;t know before hand what the user is going to choose. In this instance you would use the bracket notation: </p>
<pre><code class="lang-js"><div class="highlight"><pre><span class="kd">var</span> <span class="nx">user_input</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;my_form_input&#39;</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">obj</span><span class="p">[</span><span class="nx">user_input</span><span class="p">]);</span>
</pre></div>
</code></pre>
<p>The other time you&#39;ll need to use bracket notation is if you want to access a property that has special characters:</p>
<pre><code class="lang-js"><div class="highlight"><pre><span class="kd">var</span> <span class="nx">obj</span> <span class="o">=</span> <span class="p">{</span> 
    <span class="s1">&#39;my property&#39;</span><span class="o">:</span> <span class="mi">123</span> <span class="c1">// YOU SHOULD NEVER NEED TO CREATE A PROPERTY NAME LIKE THIS</span>
<span class="p">};</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">obj</span><span class="p">[</span><span class="s1">&#39;my property&#39;</span><span class="p">]);</span>
</pre></div>
</code></pre>
<p>So the majority of the time you&#39;ll just use the dot notation, but depending on the dynamic aspect of your program you may need to use bracket notation every once in a while.</p>
<h3><a name="class-attribute" class="anchor" href="#class-attribute"><span class="header-link"></span></a>Class Attribute</h3>
<p>Every object has a <em>class</em> attribute which provides information about the object&#39;s type. </p>
<p>Sounds pretty useful, but unfortunately neither of the current specifications (ES3 or ES5) allow you to access this attribute!?</p>
<p>But there is a trick to accessing an object&#39;s <em>class</em> attribute and that is to call the <code>toString()</code> method on the top level <code>Object.prototype</code> but using it on the relevant object you want to get the class of. The following example demonstrates the most common use case of accessing the <em>class</em> attribute: trying to work out if an object is actually an <code>Array</code>…</p>
<pre><code class="lang-js"><div class="highlight"><pre><span class="kd">var</span> <span class="nx">arr</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="s1">&#39;c&#39;</span><span class="p">];</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">typeof</span> <span class="nx">arr</span><span class="p">);</span> <span class="c1">// =&gt; &quot;object&quot; - well that&#39;s not right, it should return the type as &#39;Array&#39;! (note: this is a known JavaScript bug)</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nb">Object</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">toString</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">arr</span><span class="p">));</span> <span class="c1">// =&gt; &quot;[object Array]&quot; - that&#39;s more like it</span>
</pre></div>
</code></pre>
<p>…what we&#39;ve done here is used a method available to all <code>Function</code>&#39;s called <code>.call()</code>. What this method does is let you call another function (i.e. borrow a function) but use the calling context as the <code>this</code> value.</p>
<p>That previous sentence probably didn&#39;t make a lot of sense because we&#39;ve not covered <code>this</code> or anything to do with contexts/execution environments etc - but try and stick with it for a moment and understand that what we&#39;ve done is called the <code>Object.prototype</code>&#39;s <code>toString</code> method but we&#39;ve called it as if it was our Array that had executed <code>toString</code>.</p>
<p>The way this trick works actually requires a deep level understanding of how JavaScript handles its conversion of data types: something I definitely wont go into here).</p>
<h2><a name="arrays" class="anchor" href="#arrays"><span class="header-link"></span></a>Arrays</h2>
<p>Arrays are like a simplified Object.</p>
<p>An Object is effectively a mapping of names (identifiers) to values… </p>
<pre><code class="lang-js"><div class="highlight"><pre><span class="kd">var</span> <span class="nx">obj</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">name</span><span class="o">:</span> <span class="nx">value</span><span class="p">,</span>
    <span class="nx">name</span><span class="o">:</span> <span class="nx">value</span><span class="p">,</span>
    <span class="nx">name</span><span class="o">:</span> <span class="nx">value</span>
<span class="p">};</span>
</pre></div>
</code></pre>
<p>…an Array is the same with the exception that the &#39;name&#39; identifiers are automatically incremented numerical values. So an Array like this…</p>
<pre><code class="lang-js"><div class="highlight"><pre><span class="kd">var</span> <span class="nx">arr</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">];</span>
</pre></div>
</code></pre>
<p>…would effectively be similar to the following object…</p>
<pre><code class="lang-js"><div class="highlight"><pre><span class="kd">var</span> <span class="nx">obj</span> <span class="o">=</span> <span class="p">{</span>
    <span class="mi">0</span><span class="o">:</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span>
    <span class="mi">1</span><span class="o">:</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span>
    <span class="mi">2</span><span class="o">:</span> <span class="s1">&#39;c&#39;</span>
<span class="p">};</span>
</pre></div>
</code></pre>
<p>Note: the above object with numerical keys requires you to use the bracket notation to access the identifiers (e.g. <code>obj[0]</code>) as <code>obj.0</code> would result in a <code>SyntaxError: Unexpected number</code>.</p>
<h3><a name="methods" class="anchor" href="#methods"><span class="header-link"></span></a>Methods</h3>
<p>Arrays come with many methods (functions) that let you manipulate and filter the data contained within the Array.</p>
<p>Some methods change the data in the Array (<em>mutators</em>).</p>
<p>Some methods return a new Array with the data changed (<em>accessors</em> - not the best/most descriptive name really,  as it suggests these methods just &#39;access&#39; data when that&#39;s not always the case).</p>
<p>Some methods loop through the data (<em>iterators</em>).</p>
<p>Below are some examples of each…</p>
<table>
<thead>
<tr>
<th>Mutators</th>
<th>Accessors</th>
<th>Iterators</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://developer.mozilla.org/en-US/docs/JavaScript/Reference/Global_Objects/Array/pop">pop</a></td>
<td><a href="https://developer.mozilla.org/en-US/docs/JavaScript/Reference/Global_Objects/Array/concat">concat</a></td>
<td><a href="https://developer.mozilla.org/en-US/docs/JavaScript/Reference/Global_Objects/Array/filter">filter</a></td>
</tr>
<tr>
<td><a href="https://developer.mozilla.org/en-US/docs/JavaScript/Reference/Global_Objects/Array/push">push</a></td>
<td><a href="https://developer.mozilla.org/en-US/docs/JavaScript/Reference/Global_Objects/Array/join">join</a></td>
<td><a href="https://developer.mozilla.org/en-US/docs/JavaScript/Reference/Global_Objects/Array/forEach">forEach</a></td>
</tr>
<tr>
<td><a href="https://developer.mozilla.org/en-US/docs/JavaScript/Reference/Global_Objects/Array/reverse">reverse</a></td>
<td><a href="https://developer.mozilla.org/en-US/docs/JavaScript/Reference/Global_Objects/Array/slice">slice</a></td>
<td><a href="https://developer.mozilla.org/en-US/docs/JavaScript/Reference/Global_Objects/Array/every">every</a></td>
</tr>
<tr>
<td><a href="https://developer.mozilla.org/en-US/docs/JavaScript/Reference/Global_Objects/Array/shift">shift</a></td>
<td><a href="https://developer.mozilla.org/en-US/docs/JavaScript/Reference/Global_Objects/Array/indexOf">indexOf</a></td>
<td><a href="https://developer.mozilla.org/en-US/docs/JavaScript/Reference/Global_Objects/Array/map">map</a></td>
</tr>
<tr>
<td><a href="https://developer.mozilla.org/en-US/docs/JavaScript/Reference/Global_Objects/Array/sort">sort</a></td>
<td><a href="https://developer.mozilla.org/en-US/docs/JavaScript/Reference/Global_Objects/Array/lastIndexOf">lastIndexOf</a></td>
<td><a href="https://developer.mozilla.org/en-US/docs/JavaScript/Reference/Global_Objects/Array/some">some</a></td>
</tr>
<tr>
<td><a href="https://developer.mozilla.org/en-US/docs/JavaScript/Reference/Global_Objects/Array/splice">splice</a></td>
<td></td>
<td><a href="https://developer.mozilla.org/en-US/docs/JavaScript/Reference/Global_Objects/Array/Reduce">reduce</a></td>
</tr>
<tr>
<td><a href="https://developer.mozilla.org/en-US/docs/JavaScript/Reference/Global_Objects/Array/unshift">unshift</a></td>
<td></td>
<td><a href="https://developer.mozilla.org/en-US/docs/JavaScript/Reference/Global_Objects/Array/ReduceRight">reduceRight</a></td>
</tr>
</tbody>
</table>
<h2><a name="conditional-statements" class="anchor" href="#conditional-statements"><span class="header-link"></span></a>Conditional Statements</h2>
<p>Conditional statements are &#39;control logic&#39;. This means that depending on the result of a specified condition the corresponding branch of logic will be executed.</p>
<p>There are a few different conditional statements such as:</p>
<ul>
<li><code>if</code></li>
<li><code>switch</code></li>
<li><code>ternary</code></li>
</ul>
<p>The simplest way to understand them is to see the syntax.</p>
<h3><a name="if-statement" class="anchor" href="#if-statement"><span class="header-link"></span></a>If Statement</h3>
<pre><code class="lang-js"><div class="highlight"><pre><span class="k">if</span> <span class="p">(</span><span class="nx">condition</span><span class="p">)</span> <span class="p">{</span>

    <span class="c1">// if &#39;condition&#39; evaluated to true then run this code</span>

<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">other_condition</span><span class="p">)</span> <span class="p">{</span>

    <span class="c1">// if &#39;other_condition&#39; evaluated to true then run this code</span>

<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>

    <span class="c1">// other wise we&#39;ll run this code as a fallback</span>

<span class="p">}</span>
</pre></div>
</code></pre>
<p>So a basic example would be something like this…</p>
<pre><code class="lang-js"><div class="highlight"><pre><span class="kd">var</span> <span class="nx">can_drink</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">age</span> <span class="o">=</span> <span class="mi">18</span><span class="p">;</span>

<span class="k">if</span> <span class="p">(</span><span class="nx">age</span> <span class="o">&gt;=</span> <span class="mi">18</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">can_drink</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</code></pre>
<h3><a name="switch-statement" class="anchor" href="#switch-statement"><span class="header-link"></span></a>Switch Statement</h3>
<p>If you have lots of checks against the same variable/condition then you&#39;re better off using a <code>switch</code> statement… </p>
<pre><code class="lang-js"><div class="highlight"><pre><span class="k">switch</span> <span class="p">(</span><span class="nx">condition</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">case</span> <span class="nx">x</span><span class="o">:</span>
        <span class="c1">// Execute this code block</span>
        <span class="k">break</span><span class="p">;</span>
    <span class="k">case</span> <span class="nx">y</span><span class="o">:</span>
        <span class="c1">// Execute this code block</span>
        <span class="k">break</span><span class="p">;</span>
    <span class="k">case</span> <span class="nx">z</span><span class="o">:</span>
        <span class="c1">// Execute this code block</span>
        <span class="k">break</span><span class="p">;</span>
    <span class="k">default</span><span class="o">:</span>
        <span class="c1">// Execute this code block</span>
        <span class="k">break</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</code></pre>
<p>An example of using this statement would be… </p>
<pre><code class="lang-js"><div class="highlight"><pre><span class="kd">var</span> <span class="nx">car</span> <span class="o">=</span> <span class="s1">&#39;Porsche&#39;</span><span class="p">;</span>

<span class="k">switch</span> <span class="p">(</span><span class="nx">car</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">case</span> <span class="s1">&#39;Ford&#39;</span><span class="o">:</span>
        <span class="c1">// Execute this code block if car is &#39;Ford&#39;</span>
        <span class="k">break</span><span class="p">;</span>
    <span class="k">case</span> <span class="s1">&#39;Porsche&#39;</span><span class="o">:</span>
        <span class="c1">// Execute this code block if car is &#39;Porsche&#39;</span>
        <span class="k">break</span><span class="p">;</span>
    <span class="k">case</span> <span class="s1">&#39;BMW&#39;</span><span class="o">:</span>
        <span class="c1">// Execute this code block if car is &#39;BMW&#39;</span>
        <span class="k">break</span><span class="p">;</span>
    <span class="k">default</span><span class="o">:</span>
        <span class="c1">// Execute this code block if car is none of the above</span>
        <span class="k">break</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</code></pre>
<h3><a name="ternary-statement" class="anchor" href="#ternary-statement"><span class="header-link"></span></a>Ternary Statement</h3>
<p>For very short <code>if</code> statements you can also use a shortened syntax (a conditional operator sometimes referred to as a &#39;ternary&#39; operator because of its three operands). The syntax is like so…</p>
<pre><code class="lang-js"><div class="highlight"><pre><span class="nx">condition</span> <span class="o">?</span> <span class="kc">true</span> <span class="o">:</span> <span class="kc">false</span>
</pre></div>
</code></pre>
<p>…and can be used like so…</p>
<pre><code class="lang-js"><div class="highlight"><pre><span class="kd">var</span> <span class="nx">age</span> <span class="o">=</span> <span class="mi">18</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">can_drink</span> <span class="o">=</span> <span class="p">(</span><span class="nx">age</span> <span class="o">&gt;=</span> <span class="mi">18</span><span class="p">)</span> <span class="o">?</span> <span class="kc">true</span> <span class="o">:</span> <span class="kc">false</span><span class="p">;</span> <span class="c1">// can_drink will equal a Boolean value of true</span>

<span class="kd">var</span> <span class="nx">x</span> <span class="o">=</span> <span class="s1">&#39;abc&#39;</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">y</span> <span class="o">=</span> <span class="p">(</span><span class="nx">x</span> <span class="o">===</span> <span class="s1">&#39;abc&#39;</span><span class="p">)</span> <span class="o">?</span> <span class="s1">&#39;def&#39;</span> <span class="o">:</span> <span class="s1">&#39;xyz&#39;</span><span class="p">;</span> <span class="c1">// y will equal a String value of &#39;def&#39;</span>
</pre></div>
</code></pre>
<h2><a name="coercion" class="anchor" href="#coercion"><span class="header-link"></span></a>Coercion</h2>
<p>One of the areas of most confusion in JavaScript is its ability to coerce data &#39;types&#39;.</p>
<p>The best thing to do is to just try and take advantage of JavaScript&#39;s ability to coerce objects into different types and use it to your advantage to make your code more succinct.</p>
<p>For example, with an <code>if</code> conditional statement JavaScript will try to coerce the expression into either <code>true</code> or <code>false</code> like so… </p>
<pre><code class="lang-js"><div class="highlight"><pre><span class="kd">var</span> <span class="nx">element</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;js-element&#39;</span><span class="p">);</span>

<span class="k">if</span> <span class="p">(</span><span class="nx">element</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// if the DOM element is available then this conditional</span>
    <span class="c1">// will coerce `element` into a Boolean value of true </span>
    <span class="c1">// and hence the condition will pass.</span>

    <span class="c1">// If the DOM element doesn&#39;t exist then the resulting value will be null</span>
    <span class="c1">// and null is converted into a Boolean value of false </span>
    <span class="c1">// and hence the condition will not pass</span>
<span class="p">}</span>
</pre></div>
</code></pre>
<p>In the above example JavaScript automatically converts the condition into a Boolean, but you can manually coerce a value into a Boolean by using the double negation operator <code>!!</code> like so...</p>
<pre><code class="lang-js"><div class="highlight"><pre><span class="kd">var</span> <span class="nx">obj</span> <span class="o">=</span> <span class="p">{</span> <span class="nx">age</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">year</span><span class="o">:</span> <span class="mi">1980</span> <span class="p">};</span>

<span class="o">!!</span><span class="nx">obj</span><span class="p">.</span><span class="nx">age</span> <span class="c1">// =&gt; false (because zero coerces to false)</span>
<span class="o">!!</span><span class="nx">obj</span><span class="p">.</span><span class="nx">year</span> <span class="c1">// =&gt; true (any number greater than zero coerces to true)</span>
</pre></div>
</code></pre>
<p>You can also use a single negation operator <code>!</code> to return the opposite Boolean value of an object (this is useful for saying &#39;if NOT x&#39;)…</p>
<pre><code class="lang-js"><div class="highlight"><pre><span class="kd">var</span> <span class="nx">bool</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>

<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">bool</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// this statement is executed if &#39;bool&#39; is NOT true (i.e. if it&#39;s false)</span>
<span class="p">}</span>
</pre></div>
</code></pre>
<h3><a name="some-quick-notes" class="anchor" href="#some-quick-notes"><span class="header-link"></span></a>Some quick notes:</h3>
<p>All Objects/Arrays coerce to true (even an empty Array).</p>
<p>An empty String wil coerce to false.</p>
<p>There is a lot to learn about JavaScript&#39;s coercion process, so for full details please see the following article: <a href="http://webreflection.blogspot.co.uk/2010/10/javascript-coercion-demystified.html"><a href="http://webreflection.blogspot.co.uk/2010/10/javascript-coercion-demystified.html">http://webreflection.blogspot.co.uk/2010/10/javascript-coercion-demystified.html</a></a></p>
<h2><a name="functions" class="anchor" href="#functions"><span class="header-link"></span></a>Functions</h2>
<p>Functions make it easier to create re-useable code. They are simply blocks of JavaScript code that can be called/executed multiple times.</p>
<p>An example of the function syntax is as follows…</p>
<pre><code class="lang-js"><div class="highlight"><pre><span class="kd">function</span> <span class="nx">identifier</span> <span class="p">(</span><span class="nx">parameters</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// statements</span>
<span class="p">}</span>
</pre></div>
</code></pre>
<p>…which could be used like so…</p>
<pre><code class="lang-js"><div class="highlight"><pre><span class="kd">function</span> <span class="nx">add</span> <span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">a</span> <span class="o">+</span> <span class="nx">b</span><span class="p">;</span>
<span class="p">}</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">add</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">));</span> <span class="c1">// =&gt; 2</span>
</pre></div>
</code></pre>
<h3><a name="parameters" class="anchor" href="#parameters"><span class="header-link"></span></a>Parameters</h3>
<p>Functions accept any number of &#39;parameters&#39; (also known as &#39;arguments&#39;).</p>
<p>Within a function you can access all arguments via a special <code>arguments</code> property…</p>
<pre><code class="lang-js"><div class="highlight"><pre><span class="kd">function</span> <span class="nx">test</span> <span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">,</span> <span class="nx">c</span><span class="p">)</span> <span class="p">{</span> 
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">arguments</span><span class="p">);</span> 
<span class="p">}</span>

<span class="nx">test</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="c1">// =&gt; [1, 2, 3]</span>
</pre></div>
</code></pre>
<p>…you&#39;ll notice in the above example it looks like the <code>arguments</code> property is an Array but it&#39;s not. It&#39;s an &#39;array-like&#39; object. So you can access the keys values much like an Array but you don&#39;t have access to the Array methods.</p>
<h3><a name="return-values" class="anchor" href="#return-values"><span class="header-link"></span></a>Return values</h3>
<p>If a function doesn&#39;t explicitly return a value (if you look at our <code>add</code> function example above you&#39;ll see we explicitly returned <code>a + b</code>) then the function will have a return value of <code>undefined</code>. Hence when you run certain code snippets in a browsers web console you&#39;ll normally see <code>undefined</code> appear directly underneath the code you&#39;ve just written.</p>
<h3><a name="borrowing-methods" class="anchor" href="#borrowing-methods"><span class="header-link"></span></a>Borrowing methods</h3>
<p>Objects have two core methods made available to them: <code>call</code> and <code>apply</code>.</p>
<p>These two methods are the same (i.e. they do the same thing - which is to call a function <em>indirectly</em> while specifying a value for <code>this</code>) but with one small difference: <code>call</code> requires you pass through any arguments for the function as a comma separated list while <code>apply</code> requires you pass through any arguments for the function as an Array of values.</p>
<p>The purpose of these methods is to allow you to <em>borrow</em> a function/method from another object. The following code demonstrates its usage and how powerful it can be… </p>
<pre><code class="lang-js"><div class="highlight"><pre><span class="kd">var</span> <span class="nx">obj1</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;Bob&#39;</span>
<span class="p">};</span>

<span class="kd">var</span> <span class="nx">obj2</span> <span class="o">=</span> <span class="p">{</span> 
    <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;Mark&#39;</span><span class="p">,</span> 
    <span class="nx">speak</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span> 
        <span class="k">return</span> <span class="s1">&#39;My name is &#39;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">name</span><span class="p">;</span>
    <span class="p">}</span> 
<span class="p">}</span>

<span class="nx">obj2</span><span class="p">.</span><span class="nx">speak</span><span class="p">();</span> <span class="c1">// =&gt; &#39;My name is Mark&#39;</span>

<span class="c1">// obj1 doesn&#39;t have a speak method and we don&#39;t want to add extra code to that object when </span>
<span class="c1">// obj2 already has the same method already defined. We want to be able to just borrow obj2&#39;s &#39;speak&#39; method!</span>

<span class="nx">obj2</span><span class="p">.</span><span class="nx">speak</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">obj1</span><span class="p">);</span> <span class="c1">// =&gt; &#39;My name is Bob&#39;</span>
</pre></div>
</code></pre>
<p>…you can see how by using the <code>call</code> method we can make better use of existing functions and so we become more productive as well as have smaller and more efficient code.</p>
<h2><a name="code-reuse-inheritance" class="anchor" href="#code-reuse-inheritance"><span class="header-link"></span></a>Code Reuse (inheritance)</h2>
<p>The final subject I want to briefly cover is &#39;code reuse&#39;. In most object-oriented programming languages the main principle of code reuse is done via <em>inheritance</em> (this is where you have a base object that all other objects inherit properties/methods from - much like how JavaScript already works! i.e. all objects inherit properties/methods from the top level <code>Object.prototype</code>).</p>
<p>The way you implement inheritance is by taking advantage of the <code>prototype</code> chain in JavaScript.</p>
<p>There are multiple ways to use the prototype chain, one populate way is to try and emulate the &#39;Classical Inheritance&#39; style syntax (i.e. most programming languages have a <code>Class</code> keyword that makes creating objects based off a blueprint Class very easy but JavaScript doesn&#39;t have the concept of Class&#39;es - not yet any way). </p>
<p>An example of how to emulate Class style syntax in JavaScript (currently) is by using functions as &#39;Constructors&#39; like so… </p>
<pre><code class="lang-js"><div class="highlight"><pre><span class="kd">var</span> <span class="nx">Person</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">settings</span><span class="p">)</span> <span class="p">{</span>
   <span class="c1">// Instance properties (any new instances of the Person class will have these properties)</span>
   <span class="k">this</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="nx">settings</span><span class="p">.</span><span class="nx">name</span> <span class="o">||</span> <span class="s1">&#39;no name given&#39;</span><span class="p">;</span>
   <span class="k">this</span><span class="p">.</span><span class="nx">age</span> <span class="o">=</span> <span class="nx">settings</span><span class="p">.</span><span class="nx">age</span> <span class="o">||</span> <span class="s1">&#39;no age given&#39;</span><span class="p">;</span>

   <span class="c1">// Instance method (any new instances of the Person class will have this method)</span>
   <span class="k">this</span><span class="p">.</span><span class="nx">getName</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">name</span><span class="p">;</span>
   <span class="p">};</span>
<span class="p">};</span>

<span class="c1">// Create a new instance of the Person Class</span>
<span class="kd">var</span> <span class="nx">bob</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Person</span><span class="p">({</span> <span class="nx">name</span><span class="o">:</span><span class="s1">&#39;Bob&#39;</span><span class="p">,</span> <span class="nx">age</span><span class="o">:</span><span class="mi">7</span> <span class="p">});</span>

<span class="c1">// Add a method to this instance of the Person Class only (no other instances created will have this method)</span>
<span class="nx">bob</span><span class="p">.</span><span class="nx">getAge</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
   <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">age</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// Test the bob instance has access to both methods</span>
<span class="nx">bob</span><span class="p">.</span><span class="nx">getName</span><span class="p">();</span>
<span class="nx">bob</span><span class="p">.</span><span class="nx">getAge</span><span class="p">();</span>

<span class="c1">// Create another instance of the Person Class</span>
<span class="kd">var</span> <span class="nx">user</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Person</span><span class="p">({</span> <span class="nx">name</span><span class="o">:</span><span class="s1">&#39;Mark&#39;</span> <span class="p">});</span>

<span class="c1">// Notice the user has access to a &#39;getName&#39; method but not a &#39;getAge&#39; method</span>
<span class="nx">user</span><span class="p">.</span><span class="nx">getName</span><span class="p">();</span>

<span class="c1">// I know this will error so I&#39;m wrapping it in a try statement</span>
<span class="k">try</span> <span class="p">{</span>
   <span class="nx">user</span><span class="p">.</span><span class="nx">getAge</span><span class="p">();</span>
<span class="p">}</span> <span class="k">catch</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
   <span class="nx">alert</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span> <span class="c1">// Uncaught TypeError: Object [object Object] has no method &#39;getAge&#39;</span>
<span class="p">}</span>

<span class="c1">// Add a method to the Person Class&#39; prototype chain (all instances of the Person Class will now get this method - even those already defined)</span>
<span class="nx">Person</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">getNameAndAge</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
   <span class="k">return</span> <span class="s1">&#39;Hi, my name is &#39;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">name</span> <span class="o">+</span> <span class="s1">&#39;, and I\&#39;m &#39;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">age</span> <span class="o">+</span> <span class="s1">&#39; years old.&#39;</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// Test this new method is accessible to all instances of the Person Class</span>
<span class="nx">bob</span><span class="p">.</span><span class="nx">getNameAndAge</span><span class="p">();</span>
<span class="nx">user</span><span class="p">.</span><span class="nx">getNameAndAge</span><span class="p">();</span>
</pre></div>
</code></pre>
<h3><a name="composition" class="anchor" href="#composition"><span class="header-link"></span></a>Composition</h3>
<p>There is another code reuse pattern you can use instead of &#39;inheritance&#39; called &#39;composition&#39;. The way it works is instead of inheriting methods/properties from a blueprint/base object you instead borrow the methods using <code>call</code> or <code>apply</code> (as we&#39;ve seen previously). </p>
<p>An example of this is as follows…</p>
<pre><code class="lang-js"><div class="highlight"><pre><span class="kd">var</span> <span class="nx">person</span> <span class="o">=</span> <span class="p">{</span>
        <span class="nx">names</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;James&#39;</span><span class="p">,</span> <span class="s1">&#39;Neil&#39;</span><span class="p">,</span> <span class="s1">&#39;Russ&#39;</span><span class="p">,</span> <span class="s1">&#39;Stuart&#39;</span><span class="p">]</span>
    <span class="p">};</span>

<span class="kd">var</span> <span class="nx">people</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">names</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;Ash&#39;</span><span class="p">,</span> <span class="s1">&#39;Brad&#39;</span><span class="p">,</span> <span class="s1">&#39;Mark&#39;</span><span class="p">,</span> <span class="s1">&#39;Mike&#39;</span><span class="p">],</span>
    <span class="nx">speak</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">which</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="s1">&#39;Hi, my name is &#39;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">names</span><span class="p">[</span><span class="nx">which</span><span class="p">];</span>
    <span class="p">}</span>
<span class="p">};</span>

<span class="c1">// Composition not Inheritance</span>
<span class="nx">people</span><span class="p">.</span><span class="nx">speak</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">person</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span> <span class="c1">// =&gt; &#39;Hi, my name is Neil&#39;</span>
</pre></div>
</code></pre>
<h3><a name="mixins" class="anchor" href="#mixins"><span class="header-link"></span></a>Mixins</h3>
<p>Another code reuse pattern is called a &#39;mixin&#39; - which instead of using &#39;inheritance&#39; we simply copy over the functions/properties we want to use.</p>
<p>The following example demonstrates how this works… </p>
<pre><code class="lang-js"><div class="highlight"><pre><span class="kd">function</span> <span class="nx">extend</span><span class="p">(</span><span class="nx">destination</span><span class="p">,</span> <span class="nx">source</span><span class="p">,</span> <span class="nx">overwrite</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">overwrite</span> <span class="o">=</span> <span class="nx">overwrite</span> <span class="o">||</span> <span class="kc">false</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="k">in</span> <span class="nx">source</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">source</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">i</span><span class="p">))</span> <span class="p">{</span>
            <span class="c1">// If we&#39;re not allowed to overwrite an existing property… </span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">overwrite</span><span class="p">)</span> <span class="p">{</span>
                <span class="c1">// …then we check to see if the property is undefined… </span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">destination</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">===</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
                    <span class="c1">// …if it is then we know we can copy the property to the destination object</span>
                    <span class="nx">destination</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="nx">source</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
                <span class="p">}</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="nx">destination</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="nx">source</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">destination</span><span class="p">;</span> 
<span class="p">}</span>

<span class="kd">var</span> <span class="nx">person</span> <span class="o">=</span> <span class="p">{</span>
        <span class="nx">names</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;James&#39;</span><span class="p">,</span> <span class="s1">&#39;Neil&#39;</span><span class="p">,</span> <span class="s1">&#39;Russ&#39;</span><span class="p">,</span> <span class="s1">&#39;Stuart&#39;</span><span class="p">]</span>
    <span class="p">};</span>

<span class="kd">var</span> <span class="nx">people</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">names</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;Ash&#39;</span><span class="p">,</span> <span class="s1">&#39;Brad&#39;</span><span class="p">,</span> <span class="s1">&#39;Mark&#39;</span><span class="p">,</span> <span class="s1">&#39;Mike&#39;</span><span class="p">],</span>
    <span class="nx">speak</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">which</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="s1">&#39;Hi, my name is &#39;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">names</span><span class="p">[</span><span class="nx">which</span><span class="p">];</span>
    <span class="p">}</span>
<span class="p">};</span>

<span class="nx">extend</span><span class="p">(</span><span class="nx">person</span><span class="p">,</span> <span class="nx">people</span><span class="p">);</span> <span class="c1">// copy properties from `people` to `person`</span>

<span class="c1">// `person` now has a `speak` method it didn&#39;t have originally </span>
<span class="nx">person</span><span class="p">.</span><span class="nx">speak</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span> <span class="c1">// =&gt; &#39;Hi, my name is Neil&#39;</span>
</pre></div>
</code></pre>
<h2><a name="conclusion" class="anchor" href="#conclusion"><span class="header-link"></span></a>Conclusion</h2>
<p>OK, this has been a super brief/quick run through of different JavaScript concepts and language features.</p>
<p>This isn&#39;t supposed to be even remotely an exhaustive discussion - have you seen the size of &#39;JavaScript: The Definitive Guide&#39; !?</p>
<p>Hopefully this has at least been enough to get you started and interested in learning more. If there are any issues or errors then please get in contact and let me know.</p>
</div>

  <div class="comments">
    <a href="/posts/javascript-101/#comments">
      <span class="icon-bubbles"></span>
      Comments
    </a>
  </div>

  <div class="post-head group">
  <a href="/posts/mvc-in-javascript-with-backbone-js/">
    <h1 class="post-title">MVC in JavaScript with Backbone.js</h1>
  </a>
  <span class="post-date">2012 &#183; 8 &#183; 16</span>
</div>

<div class="post-body"><h2><a name="what-well-cover" class="anchor" href="#what-well-cover"><span class="header-link"></span></a>What we&#39;ll cover</h2>
<p><em>reading time: approx. 34mins</em></p>
<ul>
<li>Introduction</li>
<li>What is MVC?</li>
<li>Backbone&#39;s interpretation of MVC</li>
<li>Using AMD Modules and RequireJS</li>
<li>Scope Access</li>
<li>Project</li>
<li>Set-up</li>
<li>Architecture</li>
<li>Wrap-up</li>
<li>Conclusion</li>
</ul>
<h2><a name="introduction" class="anchor" href="#introduction"><span class="header-link"></span></a>Introduction</h2>
<p>I&#39;ll be honest and tell you that I struggled for quite a while to actually see the point of using <a href="http://backbonejs.org/">Backbone.js</a>. </p>
<p>It seemed like a lot of overhead for very little in return.</p>
<p>I also didn&#39;t like the fact that it tied me into using both Underscore and jQuery as dependencies.</p>
<p>Because of this, and because I knew a lot of these so called MVC frameworks weren&#39;t <em>really</em> MVC (in the traditional sense), I decided to &#39;roll my own&#39; and so started writing <a href="https://github.com/Integralist/MVC-Start-up-Kit/tree/library_agnostic">my own MVC library</a> (please do read the articles listed at the end of this post by <a href="http://twitter.com/addyosmani">Addy Osmani</a> for an in-depth look at the massive MV* culture we have at the moment).</p>
<p>My own library worked fine, and it genuinely followed the MVC principles:</p>
<table>
  <tr>
    <th>M (Models)</th>
    <th>V (Views)</th>
    <th>C (Controllers)</th>
  </tr>
  <tr>
    <td>Data</td>
    <td>User Interface</td>
    <td>Logic</td>
  </tr>
</table>

<p>But my own biggest concern was that although my MVC library was <em>structurally</em> equivalent to the proper MVC pattern and the API itself was fairly clean and easy to use, there was a lot of areas where I had too tightly coupled my library to a particular way of working and that made it difficult to re-use on different projects without first spending a lot of time making those tight couplings &#39;loose&#39; again each time.</p>
<p>It was obvious I needed to spend a lot more time on this library of mine for it to be genuinely usable in a production environment, and that&#39;s when I decided to instead take another look into Backbone.js to see what it could offer me, because from all the examples I had looked at in the past the code produced appeared very clean, flexible and well structured. Plus there are <em>lots</em> of agencies/companies implementing Backbone nowadays. So out of all the MVC libraries available (and there are quite a few) it seemed like a pretty safe bet to take another look at it.</p>
<h2><a name="what-is-mvc" class="anchor" href="#what-is-mvc"><span class="header-link"></span></a>What is MVC?</h2>
<p>For those who&#39;ve not heard of the MVC Design Pattern it is quite simple: each letter of the acronym is a separate area of concern…</p>
<h3><a name="m-model" class="anchor" href="#m-model"><span class="header-link"></span></a>M: Model</h3>
<p>A Model is a piece of data.</p>
<p>If you had a photo album then each photo would be a Model.</p>
<p>If you had a car showroom then each car would be a Model.</p>
<p>If you owned a pet store then each animal would be a Model.</p>
<p>You get the idea.</p>
<h3><a name="v-view" class="anchor" href="#v-view"><span class="header-link"></span></a>V: View</h3>
<p>A View is the user interface.</p>
<p>This could literally be anything the user of your program interacts with. So any HTML element could be made into a &#39;View&#39;.</p>
<h3><a name="c-controller" class="anchor" href="#c-controller"><span class="header-link"></span></a>C: Controller</h3>
<p>A Controller is the brains of the program and determines what happens and when.</p>
<h3><a name="communication-between-them" class="anchor" href="#communication-between-them"><span class="header-link"></span></a>Communication between them?</h3>
<p>The traditional concept of MVC states that a Model should only handle its own data and should have no other logic bound to it. So for example, a Model can have a method for getting/updating its data but it should have no logic built-in to determine <em>when</em> it should get that data (that&#39;s what the Controller does). </p>
<p>Both the Model and the View can alert the Controller of any changes or interactions and then the Controller can decide what to do with that information (e.g. when the user selects an option from a drop down menu within the View then the Controller might request specific data from the Model, when the Model gives that data to the Controller then it can pass that onto the View to display).</p>
<p>Typically you&#39;ll have one Controller for every View/Model but you could have multiple Views/Models per Controller.</p>
<h2><a name="backbones-interpretation-of-mvc" class="anchor" href="#backbones-interpretation-of-mvc"><span class="header-link"></span></a>Backbone&#39;s interpretation of MVC</h2>
<p>Backbone.js is much like all the other JavaScript MVC libraries available today (with the exception of Peter Michaux&#39;s <a href="https://github.com/petermichaux/maria/">Maria</a>) where by it&#39;s not strictly MVC but a variation of the pattern.</p>
<p>Addy Osmani (from Google) has covered this subject in-depth and so I highly recommend you review his work (see the bottom of this post for links).</p>
<p>But the basic premise for most of these libraries is that they implement the Model and the View but the Controller is swapped out for something else. So in Backbone&#39;s case it doesn&#39;t have a Controller, instead the View handles both the traditional View responsibilities as well as the Controller logic.</p>
<h3><a name="collections" class="anchor" href="#collections"><span class="header-link"></span></a>Collections?</h3>
<p>Backbone.js also introduces another concept called a &#39;Collection&#39;. A Collection is simply a group of a specific Models. So if you had a Model called &quot;PhotoModel&quot; and you created a few instances of that Model you might want to create a Collection called &quot;PhotoAlbum&quot;. PhotoAlbum would then be a <em>collection</em> of PhotoModels.</p>
<p>Collections trigger events when a Model is added or removed from the Collection and you are able to iterate over the Collection and pull out a specific Model, so they can end up being pretty useful.</p>
<h3><a name="routerhistory" class="anchor" href="#routerhistory"><span class="header-link"></span></a>Router/History?</h3>
<p>Backbone.js provides a History object which monitors the <code>hashchange</code> event and also provides an opt-in HTML5 <code>pushState</code> variation (which falls back to standard AJAX style hash bang navigation).</p>
<p>There is also a Router object provided which handles the set-up of simple URL routing.</p>
<p>So far I&#39;ve only lightly interacted with the <code>Backbone.Router</code>/<code>Backbone.History</code> aspects but I&#39;ve provided examples below of how to utilise them.</p>
<h2><a name="using-amd-modules-and-requirejs" class="anchor" href="#using-amd-modules-and-requirejs"><span class="header-link"></span></a>Using AMD Modules and RequireJS</h2>
<p>Backbone.js can be used with standard <code>&lt;script&gt;</code> tags, so there is no need for you to use a module system such as AMD (or a module loader such as RequireJS). But my personal preference is to using both AMD with RequireJS, and that&#39;s what the example project I&#39;ll show you will use.</p>
<p>I wont go into the details of what AMD is or how to use RequireJS, I&#39;ll instead point you to <a href="https://github.com/Integralist/Blog-Posts/blob/master/Beginners-guide-to-AMD-and-RequireJS.md">another article I&#39;ve written on the subject</a>.</p>
<h2><a name="scope-access" class="anchor" href="#scope-access"><span class="header-link"></span></a>Scope Access</h2>
<p>Because we&#39;re using AMD (which keeps our code self-contained so it doesn&#39;t introduce global variables) it can be awkward (in some situations) to share information across modules.</p>
<p>One thing I wanted to do recently was access a View instance from within another View. After reviewing the situation I found there were multiple ways to do this:</p>
<ul>
<li>Setting an instance property on the other View</li>
<li>Passing the View through as a property of the argument object when creating the other View</li>
<li>Adding a property to a global namespace</li>
</ul>
<p>…which option you go with depends on personal preference more than anything. I went with the second option.</p>
<h2><a name="project" class="anchor" href="#project"><span class="header-link"></span></a>Project</h2>
<p>The project we&#39;ll build is a basic Contact Manager. </p>
<p>The layout will be a <code>&lt;select&gt;</code> menu that is populated with some Contact names.</p>
<p>Selecting a Contact from the menu will display all details for that contact.</p>
<p>Next to the menu will be a form where we can add a new contact and once added it&#39;ll automatically appear within the menu for the user to select to view.</p>
<p>A finished version of this project can be found <a href="https://github.com/Integralist/Backbone-Playground">on my GitHub</a>.</p>
<h2><a name="set-up" class="anchor" href="#set-up"><span class="header-link"></span></a>Set-up</h2>
<p>Let&#39;s take a top level view of our directory structure…</p>
<ul>
<li>/Assets/<ul>
<li>/Includes/<ul>
<li>Contacts.php</li>
</ul>
</li>
<li>/Scripts/<ul>
<li>/App/<ul>
<li>main.js</li>
<li>namespace.js</li>
</ul>
</li>
<li>/Collections/<ul>
<li>Contacts.js</li>
</ul>
</li>
<li>/Models/<ul>
<li>Contact.js</li>
</ul>
</li>
<li>/Routes/<ul>
<li>Routing.js</li>
</ul>
</li>
<li>/Utils/<ul>
<li>backbone.js</li>
<li>jquery.js</li>
<li>lodash.js</li>
</ul>
</li>
<li>/Views/<ul>
<li>AddContact.js</li>
<li>Contact.js</li>
<li>Contacts.js</li>
</ul>
</li>
<li>require.js</li>
</ul>
</li>
<li>/Styles/<ul>
<li>styles.css</li>
</ul>
</li>
</ul>
</li>
<li>index.html</li>
</ul>
<h2><a name="architecture" class="anchor" href="#architecture"><span class="header-link"></span></a>Architecture</h2>
<h3><a name="html" class="anchor" href="#html"><span class="header-link"></span></a>HTML</h3>
<p>The HTML page <code>index.html</code> consists of a few different elements that we&#39;ll use as &#39;Views&#39;. </p>
<p>We have the <code>&lt;select&gt;</code> menu for displaying the initial list of Contacts, the <code>&lt;form&gt;</code> for allowing us to add more Contacts, and an empty <code>&lt;div&gt;</code> which will be used for displaying the full details of the selected contact.</p>
<p>The full HTML page looks like this...</p>
<pre><code class="lang-html"><div class="highlight"><pre><span class="cp">&lt;!doctype html&gt;</span>
<span class="nt">&lt;html</span> <span class="na">dir=</span><span class="s">&quot;ltr&quot;</span> <span class="na">lang=</span><span class="s">&quot;en&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;head&gt;</span>
        <span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">&quot;utf-8&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">&quot;viewport&quot;</span> <span class="na">content=</span><span class="s">&quot;width=device-width, initial-scale=1&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">&quot;author&quot;</span> <span class="na">content=</span><span class="s">&quot;Mark McDonnell&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;title&gt;</span>Backbone.js<span class="nt">&lt;/title&gt;</span>
        <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">href=</span><span class="s">&quot;Assets/Styles/styles.css&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;/head&gt;</span>
    <span class="nt">&lt;body&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;view-contacts&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;select&gt;</span>
                <span class="nt">&lt;option&gt;</span>Please select a user<span class="nt">&lt;/option&gt;</span>
            <span class="nt">&lt;/select&gt;</span>
        <span class="nt">&lt;/div&gt;</span>

        <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;view-contact&quot;</span><span class="nt">&gt;&lt;/div&gt;</span>

        <span class="nt">&lt;form</span> <span class="na">id=</span><span class="s">&quot;view-add&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;p&gt;&lt;input</span> <span class="na">type=</span><span class="s">&quot;text&quot;</span> <span class="na">placeholder=</span><span class="s">&quot;Name&quot;</span> <span class="na">name=</span><span class="s">&quot;fullname&quot;</span><span class="nt">&gt;&lt;/p&gt;</span>
            <span class="nt">&lt;p&gt;&lt;input</span> <span class="na">type=</span><span class="s">&quot;text&quot;</span> <span class="na">placeholder=</span><span class="s">&quot;Age&quot;</span> <span class="na">maxlength=</span><span class="s">&quot;3&quot;</span> <span class="na">name=</span><span class="s">&quot;age&quot;</span><span class="nt">&gt;&lt;/p&gt;</span>
            <span class="nt">&lt;p&gt;&lt;input</span> <span class="na">type=</span><span class="s">&quot;text&quot;</span> <span class="na">placeholder=</span><span class="s">&quot;Address&quot;</span> <span class="na">name=</span><span class="s">&quot;address&quot;</span><span class="nt">&gt;&lt;/p&gt;</span>
            <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;submit&quot;</span> <span class="na">value=</span><span class="s">&quot;Add New Record&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;/form&gt;</span>

        <span class="nt">&lt;script </span><span class="na">data-main=</span><span class="s">&quot;Assets/Scripts/App/main&quot;</span> <span class="na">src=</span><span class="s">&quot;Assets/Scripts/require.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
        <span class="nt">&lt;script </span><span class="na">type=</span><span class="s">&quot;text/template&quot;</span> <span class="na">id=</span><span class="s">&quot;contact_template&quot;</span><span class="nt">&gt;</span>
            <span class="o">&lt;</span><span class="nx">dl</span><span class="o">&gt;</span>
                <span class="o">&lt;</span><span class="nx">dt</span><span class="o">&gt;</span><span class="nx">ID</span><span class="o">&lt;</span><span class="err">/dt&gt;</span>
                <span class="o">&lt;</span><span class="nx">dd</span><span class="o">&gt;&lt;%=</span><span class="nx">id</span><span class="o">%&gt;&lt;</span><span class="err">/dd&gt;</span>
                <span class="o">&lt;</span><span class="nx">dt</span><span class="o">&gt;</span><span class="nx">Name</span><span class="o">&lt;</span><span class="err">/dt&gt;</span>
                <span class="o">&lt;</span><span class="nx">dd</span><span class="o">&gt;&lt;%=</span><span class="nx">name</span><span class="o">%&gt;&lt;</span><span class="err">/dd&gt;</span>
                <span class="o">&lt;</span><span class="nx">dt</span><span class="o">&gt;</span><span class="nx">Age</span><span class="o">&lt;</span><span class="err">/dt&gt;</span>
                <span class="o">&lt;</span><span class="nx">dd</span><span class="o">&gt;&lt;%=</span><span class="nx">age</span><span class="o">%&gt;&lt;</span><span class="err">/dd&gt;</span>
                <span class="o">&lt;</span><span class="nx">dt</span><span class="o">&gt;</span><span class="nx">Address</span><span class="o">&lt;</span><span class="err">/dt&gt;</span>
                <span class="o">&lt;</span><span class="nx">dd</span><span class="o">&gt;&lt;%=</span><span class="nx">address</span><span class="o">%&gt;&lt;</span><span class="err">/dd&gt;</span>
            <span class="o">&lt;</span><span class="err">/dl&gt;</span>
        <span class="nt">&lt;/script&gt;</span>
    <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></div>
</code></pre>
<h3><a name="styles" class="anchor" href="#styles"><span class="header-link"></span></a>Styles</h3>
<p>The styles for this project are just basic - we&#39;re not worrying about design here… </p>
<pre><code class="lang-css"><div class="highlight"><pre><span class="nt">body</span> <span class="p">{</span>
    <span class="k">font</span><span class="o">:</span> <span class="k">normal</span> <span class="n">small</span> <span class="n">Arial</span><span class="o">,</span> <span class="n">Verdana</span><span class="o">,</span> <span class="k">sans-serif</span><span class="p">;</span>
<span class="p">}</span>

<span class="nc">.hide</span> <span class="p">{</span>
    <span class="k">display</span><span class="o">:</span> <span class="k">none</span><span class="p">;</span>
<span class="p">}</span>

<span class="nf">#view-add</span> <span class="p">{</span>
    <span class="k">border</span><span class="o">:</span> <span class="m">1px</span> <span class="k">solid</span> <span class="m">#999</span><span class="p">;</span>
    <span class="k">left</span><span class="o">:</span> <span class="m">350px</span><span class="p">;</span>
    <span class="k">padding-bottom</span><span class="o">:</span> <span class="m">10px</span><span class="p">;</span>
    <span class="k">padding-left</span><span class="o">:</span> <span class="m">10px</span><span class="p">;</span>
    <span class="k">position</span><span class="o">:</span> <span class="k">absolute</span><span class="p">;</span>
    <span class="k">top</span><span class="o">:</span> <span class="m">10px</span><span class="p">;</span>
    <span class="k">width</span><span class="o">:</span> <span class="m">166px</span><span class="p">;</span>
<span class="p">}</span>

<span class="nf">#view-add</span> <span class="nt">div</span> <span class="p">{</span>
    <span class="k">background-color</span><span class="o">:</span> <span class="nb">green</span><span class="p">;</span>
    <span class="k">color</span><span class="o">:</span> <span class="m">#fff</span><span class="p">;</span>
    <span class="k">margin-right</span><span class="o">:</span> <span class="m">10px</span><span class="p">;</span>
    <span class="k">margin-top</span><span class="o">:</span> <span class="m">10px</span><span class="p">;</span>
    <span class="k">padding</span><span class="o">:</span> <span class="m">10px</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</code></pre>
<h3><a name="javascript" class="anchor" href="#javascript"><span class="header-link"></span></a>JavaScript</h3>
<p>RequireJS allows us to utilise just a single <code>&lt;script&gt;</code> tag which points to our main script file that contains the following structure… </p>
<pre><code class="lang-js"><div class="highlight"><pre><span class="nx">requirejs</span><span class="p">.</span><span class="nx">config</span><span class="p">({</span>
    <span class="nx">shim</span><span class="o">:</span> <span class="p">{</span>
        <span class="s1">&#39;../Utils/backbone&#39;</span><span class="o">:</span> <span class="p">{</span>
            <span class="nx">deps</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;../Utils/lodash&#39;</span><span class="p">,</span> <span class="s1">&#39;../Utils/jquery&#39;</span><span class="p">],</span> <span class="c1">// load dependencies</span>
            <span class="nx">exports</span><span class="o">:</span> <span class="s1">&#39;Backbone&#39;</span> <span class="c1">// use the global &#39;Backbone&#39; as the module value</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">});</span>

<span class="nx">require</span><span class="p">([</span><span class="s1">&#39;../Models/Contact&#39;</span><span class="p">,</span> <span class="s1">&#39;../Collections/Contacts&#39;</span><span class="p">,</span> <span class="s1">&#39;../Views/Contacts&#39;</span><span class="p">,</span> <span class="s1">&#39;../Views/AddContact&#39;</span><span class="p">,</span> <span class="s1">&#39;../Views/Contact&#39;</span><span class="p">,</span> <span class="s1">&#39;../Routes/Routing&#39;</span><span class="p">],</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">Contact</span><span class="p">,</span> <span class="nx">Contacts</span><span class="p">,</span> <span class="nx">ContactsView</span><span class="p">,</span> <span class="nx">AddContactView</span><span class="p">,</span> <span class="nx">ContactView</span><span class="p">,</span> <span class="nx">Routing</span><span class="p">)</span> <span class="p">{</span>

    <span class="cm">/**</span>
<span class="cm">     * Model Generation Examples</span>
<span class="cm">     */</span>

    <span class="kd">var</span> <span class="nx">manager</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Contact</span><span class="p">({</span>
        <span class="nx">id</span><span class="o">:</span> <span class="nx">_</span><span class="p">.</span><span class="nx">uniqueId</span><span class="p">(),</span>
        <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;Mark McDonnell&#39;</span><span class="p">,</span>
        <span class="nx">age</span><span class="o">:</span> <span class="mi">30</span>
    <span class="p">});</span>

    <span class="kd">var</span> <span class="nx">developer</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Contact</span><span class="p">({</span>
        <span class="nx">id</span><span class="o">:</span> <span class="nx">_</span><span class="p">.</span><span class="nx">uniqueId</span><span class="p">(),</span>
        <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;Ashley Banks&#39;</span><span class="p">,</span>
        <span class="nx">age</span><span class="o">:</span> <span class="mi">23</span>
    <span class="p">});</span>

    <span class="c1">// The following few lines are used just to demonstrate the Backbone.js API</span>
    <span class="kd">var</span> <span class="nx">dev_name</span> <span class="o">=</span> <span class="nx">developer</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">dev_age</span> <span class="o">=</span> <span class="nx">developer</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;age&#39;</span><span class="p">);</span>

    <span class="nx">developer</span><span class="p">.</span><span class="nx">birthday</span><span class="p">();</span>

    <span class="c1">// The .toJSON() method is a Backbone specific Model/Collection method which returns js object of specified Model</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">dir</span><span class="p">(</span><span class="nx">manager</span><span class="p">.</span><span class="nx">toJSON</span><span class="p">())</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">dir</span><span class="p">(</span><span class="nx">developer</span><span class="p">.</span><span class="nx">toJSON</span><span class="p">());</span>


    <span class="cm">/**</span>
<span class="cm">     * Collection Generation Example</span>
<span class="cm">     */</span>

    <span class="kd">var</span> <span class="nx">contacts</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Contacts</span><span class="p">([</span><span class="nx">manager</span><span class="p">,</span> <span class="nx">developer</span><span class="p">]);</span>

    <span class="c1">// The .toJSON() method is a Backbone specific Model/Collection method which returns js object of specified Model</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">contacts</span><span class="p">.</span><span class="nx">toJSON</span><span class="p">());</span>


    <span class="cm">/**</span>
<span class="cm">     * View for &lt;select&gt; menu of Contacts</span>
<span class="cm">     */</span>

    <span class="kd">var</span> <span class="nx">contacts_view</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ContactsView</span><span class="p">({</span>
        <span class="nx">el</span><span class="o">:</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#view-contacts&#39;</span><span class="p">),</span>
        <span class="nx">collection</span><span class="o">:</span> <span class="nx">contacts</span><span class="p">,</span> <span class="c1">// pass in the Collection into this View</span>

        <span class="cm">/**</span>
<span class="cm">         * View for displaying the selected Contact</span>
<span class="cm">         *</span>
<span class="cm">         * Originally I had created a global namespace property so I could access this View&#39;s &quot;render()&quot; method from within &#39;contacts_view&#39; (/Views/Contacts.js)</span>
<span class="cm">         * And according to people smarter than I (i.e. Addy Osmani from Google) this was the most appropriate solution.</span>
<span class="cm">         * But I since discovered I could pass in additional data when creating a View instance and so that&#39;s what I&#39;ve done here.</span>
<span class="cm">         */</span>

        <span class="nx">associated_view</span><span class="o">:</span> <span class="k">new</span> <span class="nx">ContactView</span><span class="p">({</span>
            <span class="nx">el</span><span class="o">:</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#view-contact&#39;</span><span class="p">),</span>
            <span class="nx">collection</span><span class="o">:</span> <span class="nx">contacts</span>
        <span class="p">})</span>
    <span class="p">});</span>


    <span class="cm">/**</span>
<span class="cm">     * View for &lt;form&gt; to add a new Contact</span>
<span class="cm">     */</span>

    <span class="kd">var</span> <span class="nx">add_contact</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">AddContactView</span><span class="p">({</span>
        <span class="nx">el</span><span class="o">:</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#view-add&#39;</span><span class="p">),</span>
        <span class="nx">collection</span><span class="o">:</span> <span class="nx">contacts</span> <span class="c1">// pass in the Collection into this View</span>
    <span class="p">});</span>


    <span class="cm">/**</span>
<span class="cm">     * Lazy Load Models into Collection</span>
<span class="cm">     */</span>

    <span class="nx">contacts</span><span class="p">.</span><span class="nx">fetch</span><span class="p">({</span>
        <span class="nx">add</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span> <span class="c1">// Prevent resetting the Collection (i.e. instead or clearing the Collection first we just add new Models on top of current set of Models),</span>
        <span class="nx">error</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">collection</span><span class="p">,</span> <span class="nx">resp</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// You can do something on error loading</span>
        <span class="p">},</span>
        <span class="nx">success</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">collection</span><span class="p">,</span> <span class="nx">resp</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// You can do something on successful loading</span>
        <span class="p">}</span>
    <span class="p">});</span>


    <span class="cm">/**</span>
<span class="cm">     * Router/History API Examples</span>
<span class="cm">     */</span>

    <span class="c1">// Create new instance of our Routing Class</span>
    <span class="kd">var</span> <span class="nx">routing</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Routing</span><span class="p">();</span>

    <span class="c1">// Initialize the Router</span>
    <span class="nx">Backbone</span><span class="p">.</span><span class="nx">history</span><span class="p">.</span><span class="nx">start</span><span class="p">({</span> <span class="nx">pushState</span><span class="o">:</span> <span class="kc">true</span> <span class="p">});</span>

<span class="p">});</span>
</pre></div>
</code></pre>
<p>…this breaks down to the following… </p>
<h3><a name="we-set-up-configurations-for-requirejs" class="anchor" href="#we-set-up-configurations-for-requirejs"><span class="header-link"></span></a>We set-up configurations for RequireJS</h3>
<p>Such as Backbone&#39;s dependencies - this is done using RequireJS&#39; <code>shim</code> feature for libraries that aren&#39;t AMD compatible.<br>&nbsp;<br>You&#39;ll also notice we aren&#39;t using the Underscore library, instead we&#39;re using Lo-dash which is a better performing/API compatible utility library.</p>
<pre><code class="lang-js"><div class="highlight"><pre><span class="nx">requirejs</span><span class="p">.</span><span class="nx">config</span><span class="p">({</span>
    <span class="nx">shim</span><span class="o">:</span> <span class="p">{</span>
        <span class="s1">&#39;../Utils/backbone&#39;</span><span class="o">:</span> <span class="p">{</span>
            <span class="nx">deps</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;../Utils/lodash&#39;</span><span class="p">,</span> <span class="s1">&#39;../Utils/jquery&#39;</span><span class="p">],</span> <span class="c1">// load dependencies</span>
            <span class="nx">exports</span><span class="o">:</span> <span class="s1">&#39;Backbone&#39;</span> <span class="c1">// use the global &#39;Backbone&#39; as the module value</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">});</span>
</pre></div>
</code></pre>
<h3><a name="specify-dependencies-and-execute-callback-function-once-all-are-loaded" class="anchor" href="#specify-dependencies-and-execute-callback-function-once-all-are-loaded"><span class="header-link"></span></a>Specify dependencies and execute callback function once all are loaded</h3>
<p>The dependencies we&#39;re loading are the relevant Models, Views, Collections required for this application to work - once loaded we can create new instances of them.</p>
<pre><code class="lang-js"><div class="highlight"><pre><span class="nx">require</span><span class="p">([</span><span class="s1">&#39;../Models/Contact&#39;</span><span class="p">,</span> <span class="s1">&#39;../Collections/Contacts&#39;</span><span class="p">,</span> <span class="s1">&#39;../Views/Contacts&#39;</span><span class="p">,</span> <span class="s1">&#39;../Views/AddContact&#39;</span><span class="p">,</span> <span class="s1">&#39;../Views/Contact&#39;</span><span class="p">,</span> <span class="s1">&#39;../Routes/Routing&#39;</span><span class="p">,</span> <span class="s1">&#39;../Utils/backbone&#39;</span><span class="p">],</span> 
<span class="kd">function</span> <span class="p">(</span><span class="nx">Contact</span><span class="p">,</span> <span class="nx">Contacts</span><span class="p">,</span> <span class="nx">ContactsView</span><span class="p">,</span> <span class="nx">AddContactView</span><span class="p">,</span> <span class="nx">ContactView</span><span class="p">,</span> <span class="nx">Routing</span><span class="p">)</span> <span class="p">{</span>
</pre></div>
</code></pre>
<h3><a name="generate-some-data-for-the-initial-select-menu-population" class="anchor" href="#generate-some-data-for-the-initial-select-menu-population"><span class="header-link"></span></a>Generate some data for the initial <code>&lt;select&gt;</code> menu population</h3>
<p>We&#39;ve loaded the <code>Contact</code> Model and we create two new instances of it and pass in the relevant properties for the Model data.</p>
<pre><code class="lang-js"><div class="highlight"><pre><span class="cm">/**</span>
<span class="cm"> * Model Generation Examples</span>
<span class="cm"> */</span>

<span class="kd">var</span> <span class="nx">manager</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Contact</span><span class="p">({</span>
    <span class="nx">id</span><span class="o">:</span> <span class="nx">_</span><span class="p">.</span><span class="nx">uniqueId</span><span class="p">(),</span>
    <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;Mark McDonnell&#39;</span><span class="p">,</span>
    <span class="nx">age</span><span class="o">:</span> <span class="mi">30</span>
<span class="p">});</span>

<span class="kd">var</span> <span class="nx">developer</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Contact</span><span class="p">({</span>
    <span class="nx">id</span><span class="o">:</span> <span class="nx">_</span><span class="p">.</span><span class="nx">uniqueId</span><span class="p">(),</span>
    <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;Ashley Banks&#39;</span><span class="p">,</span>
    <span class="nx">age</span><span class="o">:</span> <span class="mi">23</span>
<span class="p">});</span>
</pre></div>
</code></pre>
<h3><a name="create-a-collection-that-will-hold-the-model-data-weve-just-created" class="anchor" href="#create-a-collection-that-will-hold-the-model-data-weve-just-created"><span class="header-link"></span></a>Create a Collection that will hold the Model data we&#39;ve just created</h3>
<p>Backbone lets us pass through an Array of Models to instantiate the Collection with</p>
<pre><code class="lang-js"><div class="highlight"><pre><span class="cm">/**</span>
<span class="cm"> * Collection Generation Example</span>
<span class="cm"> */</span>

<span class="kd">var</span> <span class="nx">contacts</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Contacts</span><span class="p">([</span><span class="nx">manager</span><span class="p">,</span> <span class="nx">developer</span><span class="p">]);</span>
</pre></div>
</code></pre>
<h3><a name="create-the-view" class="anchor" href="#create-the-view"><span class="header-link"></span></a>Create the View</h3>
<p>You&#39;ll notice that when creating the view Backbone gives us the ability to pass in specific properties such as the HTML element we want to associate our View object with (in this case I&#39;m passing in the <code>&lt;select&gt;</code> element).  </p>
<p>Backbone also lets us specify a Collection for this View to be associated with (this is so we can watch for any events - such as a adding/removing Models - so we can keep the View in sync with any data changes)  </p>
<p>Lastly, we pass in a custom property I&#39;ve called <code>associated_view</code> and the value of this will be a new instance of <code>ContactView</code> (this View is the empty <code>&lt;div&gt;</code> which will be used to display the details of a specific record as selected by the user of our application). The reason I&#39;ve passed in this View into another View is because I want the <code>contacts_view</code> to have access to the <code>associated_view</code> so when the user selects a Contact we can easily tell <code>contacts_view</code> to render the selected Contact data.</p>
<pre><code class="lang-js"><div class="highlight"><pre><span class="cm">/**</span>
<span class="cm"> * View for &lt;select&gt; menu of Contacts</span>
<span class="cm"> */</span>

<span class="kd">var</span> <span class="nx">contacts_view</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ContactsView</span><span class="p">({</span>
    <span class="nx">el</span><span class="o">:</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#view-contacts&#39;</span><span class="p">),</span>
    <span class="nx">collection</span><span class="o">:</span> <span class="nx">contacts</span><span class="p">,</span> <span class="c1">// pass in the Collection into this View</span>

    <span class="cm">/**</span>
<span class="cm">     * View for displaying the selected Contact</span>
<span class="cm">     */</span>

    <span class="nx">associated_view</span><span class="o">:</span> <span class="k">new</span> <span class="nx">ContactView</span><span class="p">({</span>
        <span class="nx">el</span><span class="o">:</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#view-contact&#39;</span><span class="p">),</span>
        <span class="nx">collection</span><span class="o">:</span> <span class="nx">contacts</span>
    <span class="p">})</span>
<span class="p">});</span>
</pre></div>
</code></pre>
<h3><a name="create-a-view-for-the-form-that-will-create-new-model-data" class="anchor" href="#create-a-view-for-the-form-that-will-create-new-model-data"><span class="header-link"></span></a>Create a View for the <code>&lt;form&gt;</code> that will create new Model data</h3>
<p>What you&#39;ll probably notice is that out of the three Views we have created instances for, they all use the same <code>contacts</code> Collection.</p>
<pre><code class="lang-js"><div class="highlight"><pre><span class="cm">/**</span>
<span class="cm"> * View for &lt;form&gt; to add a new Contact</span>
<span class="cm"> */</span>

<span class="kd">var</span> <span class="nx">add_contact</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">AddContactView</span><span class="p">({</span>
    <span class="nx">el</span><span class="o">:</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#view-add&#39;</span><span class="p">),</span>
    <span class="nx">collection</span><span class="o">:</span> <span class="nx">contacts</span>
<span class="p">});</span>
</pre></div>
</code></pre>
<h3><a name="load-more-model-data-into-our-collection" class="anchor" href="#load-more-model-data-into-our-collection"><span class="header-link"></span></a>Load more Model data into our Collection</h3>
<p>We initially loaded some Model data into our Collection when starting our application, but now we&#39;re using a Backbone provided method called <code>fetch</code> which lets us grab more data from the server and populate our Collection with that server data.</p>
<pre><code class="lang-js"><div class="highlight"><pre><span class="cm">/**</span>
<span class="cm"> * Lazy Load Models into Collection</span>
<span class="cm"> */</span>

<span class="nx">contacts</span><span class="p">.</span><span class="nx">fetch</span><span class="p">({</span>
    <span class="nx">add</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span> <span class="c1">// Prevent resetting the Collection (i.e. instead or clearing the Collection first we just add new Models on top of current set of Models),</span>
    <span class="nx">error</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">collection</span><span class="p">,</span> <span class="nx">resp</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// You can do something on error loading</span>
    <span class="p">},</span>
    <span class="nx">success</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">collection</span><span class="p">,</span> <span class="nx">resp</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// You can do something on successful loading</span>
    <span class="p">}</span>
<span class="p">});</span>
</pre></div>
</code></pre>
<h3><a name="fetching-collection-data" class="anchor" href="#fetching-collection-data"><span class="header-link"></span></a>Fetching Collection Data</h3>
<p>In the previous section we used <code>contacts.fetch</code> to grab Model data from the server.</p>
<p>To be able to understand how it works we need to look at the Collection module now. </p>
<p>As we know in the main JavaScript file we required a load of dependencies such as Models, Views and Collections and the following is the Collection module we loaded - hopefully the comments will adequately explain what&#39;s going on… </p>
<pre><code class="lang-js"><div class="highlight"><pre><span class="c1">// This Collection requires the &#39;Contact&#39; Model and (obviously) Backbone</span>
<span class="nx">define</span><span class="p">([</span><span class="s1">&#39;../Models/Contact&#39;</span><span class="p">,</span> <span class="s1">&#39;../Utils/backbone&#39;</span><span class="p">],</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">Contact</span><span class="p">)</span> <span class="p">{</span>

    <span class="c1">// We set-up a collection of Contact Models</span>
    <span class="c1">// This is so we can manipulate the group of Models more easily</span>
    <span class="kd">var</span> <span class="nx">Contacts</span> <span class="o">=</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">Collection</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
        <span class="c1">// Backbone specific property</span>
        <span class="nx">model</span><span class="o">:</span> <span class="nx">Contact</span><span class="p">,</span>

        <span class="c1">// Backbone specific property</span>
        <span class="nx">url</span><span class="o">:</span> <span class="s1">&#39;/Assets/Includes/Contacts.php&#39;</span><span class="p">,</span>

        <span class="c1">// Backbone specific method</span>
        <span class="nx">initialize</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
            <span class="c1">// Collections fire the events &#39;add&#39; and &#39;remove&#39;</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;add&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">model_added</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>
        <span class="p">},</span>

        <span class="nx">model_added</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">model</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// The View listens out for &#39;model:added&#39;</span>
            <span class="c1">// Once it hears it, it updates the &lt;select&gt; menu to include the latest Model</span>
            <span class="c1">// We pass the latest Model through from here...</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s1">&#39;model:added&#39;</span><span class="p">,</span> <span class="nx">model</span><span class="p">);</span>
        <span class="p">},</span>

        <span class="c1">// We can&#39;t trigger a custom event from within the &#39;initialize&#39; method</span>
        <span class="c1">// because the View listener wont be ready/set-up yet!</span>
        <span class="c1">// So we have to stick it inside a separate method which I call after I set-up the associated View</span>
        <span class="nx">populate</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s1">&#39;contacts:populate&#39;</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">});</span>

    <span class="k">return</span> <span class="nx">Contacts</span><span class="p">;</span>

<span class="p">});</span>
</pre></div>
</code></pre>
<p>You&#39;ll notice this Collection uses the Backbone specific property <code>url</code> which we&#39;ve pointed to a PHP script (you would replace this with whatever back-end you prefer to use: Ruby, Python, ASP.NET etc). </p>
<p>The PHP script we&#39;re using would normally connect to a database and return its data converted into JSON (JSON is the perfect data format for Backbone to process). But in this example we&#39;re simply just manually creating data and converting it to JSON… </p>
<pre><code class="lang-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
    <span class="nv">$json</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
        <span class="k">array</span><span class="p">(</span>
            <span class="s2">&quot;id&quot;</span> <span class="o">=&gt;</span> <span class="mi">99</span><span class="p">,</span>
            <span class="s2">&quot;name&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;Joe Bloggs&quot;</span><span class="p">,</span>
            <span class="s2">&quot;age&quot;</span> <span class="o">=&gt;</span> <span class="mi">12</span><span class="p">,</span> 
            <span class="s2">&quot;address&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;9 Cables Street, London&quot;</span><span class="p">,</span>
            <span class="s2">&quot;role&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;Manager&quot;</span>
        <span class="p">),</span>
        <span class="k">array</span><span class="p">(</span>
            <span class="s2">&quot;id&quot;</span> <span class="o">=&gt;</span> <span class="mi">98</span><span class="p">,</span>
            <span class="s2">&quot;name&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;Dan Smith&quot;</span><span class="p">,</span>
            <span class="s2">&quot;age&quot;</span> <span class="o">=&gt;</span> <span class="mi">23</span><span class="p">,</span> 
            <span class="s2">&quot;address&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;Bambridge Road, Essex&quot;</span><span class="p">,</span>
            <span class="s2">&quot;role&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;Developer&quot;</span>
        <span class="p">),</span>
        <span class="k">array</span><span class="p">(</span>
            <span class="s2">&quot;id&quot;</span> <span class="o">=&gt;</span> <span class="mi">97</span><span class="p">,</span>
            <span class="s2">&quot;name&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;Bradley Few&quot;</span><span class="p">,</span>
            <span class="s2">&quot;age&quot;</span> <span class="o">=&gt;</span> <span class="mi">22</span><span class="p">,</span> 
            <span class="s2">&quot;address&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;Meeson Mead, Leads&quot;</span><span class="p">,</span>
            <span class="s2">&quot;role&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;Developer&quot;</span>
        <span class="p">)</span>
    <span class="p">);</span>

    <span class="k">echo</span> <span class="nb">json_encode</span><span class="p">(</span><span class="nv">$json</span><span class="p">);</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</code></pre>
<p>…Backbone.js then populates the Collection with the new data it has &#39;fetched&#39; from the server application.</p>
<p>You may have also noticed that back in our main JavaScript file (when we called the <code>fetch</code> method) we had specified a property called <code>add</code> and set its value to <code>true</code>. The reason we did this was because if we left that property out then when Backbone fetched the data from the server it would have cleared our Collection of all Model data and replaced it with the data from the server. Setting <code>add: true</code> means we don&#39;t overwrite any existing data but instead add the data on top of what&#39;s already there.</p>
<h3><a name="model-structure" class="anchor" href="#model-structure"><span class="header-link"></span></a>Model Structure</h3>
<p>So far we have a main script file where we have created new instances of some Backbone Views as well as created a Backbone Collection. We&#39;ve populated that Collection with specific Model data, but now lets look at the Model itself that we&#39;ve been using to construct our data from… </p>
<pre><code class="lang-js"><div class="highlight"><pre><span class="nx">define</span><span class="p">([</span><span class="s1">&#39;../Utils/backbone&#39;</span><span class="p">],</span> <span class="kd">function</span><span class="p">(){</span>

    <span class="kd">var</span> <span class="nx">Contact</span> <span class="o">=</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">Model</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
        <span class="c1">// Backbone specific object</span>
        <span class="nx">defaults</span><span class="o">:</span> <span class="p">{</span>
            <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;No name provided&#39;</span><span class="p">,</span>
            <span class="nx">age</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="nx">address</span><span class="o">:</span> <span class="s1">&#39;No address provided&#39;</span>
        <span class="p">},</span>

        <span class="c1">// Backbone specific method</span>
        <span class="nx">initialize</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
            <span class="c1">// Syntax: .on(type:property)</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;change:age&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(){</span>
                <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;\&#39;s age changed to &#39;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;age&#39;</span><span class="p">));</span>
            <span class="p">});</span>

            <span class="k">this</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">model</span><span class="p">,</span> <span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">console</span><span class="p">.</span><span class="nx">warn</span><span class="p">(</span><span class="s1">&#39;Error:&#39;</span><span class="p">,</span> <span class="nx">model</span><span class="p">,</span> <span class="nx">error</span><span class="p">);</span>
            <span class="p">});</span>
        <span class="p">},</span>

        <span class="c1">// Backbone specific method</span>
        <span class="nx">validate</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">attributes</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">attributes</span><span class="p">.</span><span class="nx">id</span> <span class="o">||</span> <span class="nx">attributes</span><span class="p">.</span><span class="nx">id</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">return</span> <span class="s1">&#39;An error has occurred? There should be an id generated!&#39;</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">attributes</span><span class="p">.</span><span class="nx">age</span> <span class="o">!=</span> <span class="s1">&#39;number&#39;</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">return</span> <span class="s1">&#39;Age needs to be a number&#39;</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">},</span>

        <span class="nx">birthday</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
            <span class="kd">var</span> <span class="nx">age</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;age&#39;</span><span class="p">);</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">set</span><span class="p">({</span> <span class="s1">&#39;age&#39;</span><span class="o">:</span> <span class="o">++</span><span class="nx">age</span> <span class="p">});</span>
        <span class="p">}</span>
    <span class="p">});</span>

    <span class="k">return</span> <span class="nx">Contact</span><span class="p">;</span>

<span class="p">});</span>
</pre></div>
</code></pre>
<p>…as you can see the only dependency this module has is Backbone.js itself. Don&#39;t worry about specifying Backbone.js in each module, when we run a build script using RequireJS&#39; optimisation tool it&#39;ll only load one instance of Backbone. </p>
<p>The reason we specify Backbone as a dependency in each of these module files (rather than just specifying it once in the top level main script file) is because if we decided to reuse this specific module in another project then it would be crystal clear what dependencies it has (I know in this example if you saw <code>Backbone.Model</code> then it would seem pretty obvious that Backbone.js would need to be loaded, but doing this is just good practice because some modules can have lots of dependencies and they wont always be that obvious, so it&#39;s best to get into the habit of specifying all dependencies for the sake of helpfulness).</p>
<p>Let&#39;s now break down the specific sections of the Model we&#39;ve created:</p>
<h3><a name="first-we-specify-default-values" class="anchor" href="#first-we-specify-default-values"><span class="header-link"></span></a>First we specify default values</h3>
<p>This is in case (when creating a new Model instance) we don&#39;t have all the values readily available</p>
<pre><code class="lang-js"><div class="highlight"><pre><span class="nx">defaults</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;No name provided&#39;</span><span class="p">,</span>
    <span class="nx">age</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="nx">address</span><span class="o">:</span> <span class="s1">&#39;No address provided&#39;</span>
<span class="p">}</span>
</pre></div>
</code></pre>
<h3><a name="carry-out-some-initial-set-up-stuff-when-a-new-instance-is-created" class="anchor" href="#carry-out-some-initial-set-up-stuff-when-a-new-instance-is-created"><span class="header-link"></span></a>Carry out some initial set-up stuff when a new instance is created</h3>
<p>In this example we want to set-up some event listeners for when the <code>age</code> property is changed as well as when an error occurs.</p>
<pre><code class="lang-js"><div class="highlight"><pre><span class="nx">initialize</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
    <span class="c1">// Syntax: .on(type:property)</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;change:age&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(){</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;\&#39;s age changed to &#39;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;age&#39;</span><span class="p">));</span>
    <span class="p">});</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">model</span><span class="p">,</span> <span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">warn</span><span class="p">(</span><span class="s1">&#39;Error:&#39;</span><span class="p">,</span> <span class="nx">model</span><span class="p">,</span> <span class="nx">error</span><span class="p">);</span>
    <span class="p">});</span>
<span class="p">}</span>
</pre></div>
</code></pre>
<h3><a name="validate-data-before-actually-making-any-changes" class="anchor" href="#validate-data-before-actually-making-any-changes"><span class="header-link"></span></a>Validate data before actually making any changes</h3>
<p>Backbone.js provides a <code>validate</code> method that returns your own specified error message.<br>If the function doesn&#39;t return any value then it is assumed the data is valid.<br>If the function returns <em>any thing</em> then whatever was returned is used as the error message.</p>
<pre><code class="lang-js"><div class="highlight"><pre><span class="nx">validate</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">attributes</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">attributes</span><span class="p">.</span><span class="nx">id</span> <span class="o">||</span> <span class="nx">attributes</span><span class="p">.</span><span class="nx">id</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="s1">&#39;An error has occurred? There should be an id generated!&#39;</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">attributes</span><span class="p">.</span><span class="nx">age</span> <span class="o">!=</span> <span class="s1">&#39;number&#39;</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="s1">&#39;Age needs to be a number&#39;</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</code></pre>
<h3><a name="create-a-custom-birthday-method" class="anchor" href="#create-a-custom-birthday-method"><span class="header-link"></span></a>Create a custom <code>birthday</code> method</h3>
<p>We use two Backbone methods: <code>get</code> and <code>set</code> to increment the age of the user.<br>First we <code>get</code> the current age, then we <code>set</code> the age using the prefixed <code>++</code> increment operator</p>
<pre><code class="lang-js"><div class="highlight"><pre><span class="nx">birthday</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
    <span class="kd">var</span> <span class="nx">age</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;age&#39;</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">set</span><span class="p">({</span> <span class="s1">&#39;age&#39;</span><span class="o">:</span> <span class="o">++</span><span class="nx">age</span> <span class="p">});</span>
<span class="p">}</span>
</pre></div>
</code></pre>
<p>So in our main script file you&#39;ll remember we used this custom method like so… </p>
<pre><code class="lang-js"><div class="highlight"><pre><span class="c1">// Create a new Model instance</span>
<span class="kd">var</span> <span class="nx">developer</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Contact</span><span class="p">({</span>
    <span class="nx">id</span><span class="o">:</span> <span class="nx">_</span><span class="p">.</span><span class="nx">uniqueId</span><span class="p">(),</span>
    <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;Ashley Banks&#39;</span><span class="p">,</span>
    <span class="nx">age</span><span class="o">:</span> <span class="mi">23</span>
<span class="p">});</span>

<span class="c1">// Now effectively set the user&#39;s age to 24</span>
<span class="c1">// i.e. the age was 23 and calling `birthday()` increments the age by one</span>
<span class="nx">developer</span><span class="p">.</span><span class="nx">birthday</span><span class="p">();</span>
</pre></div>
</code></pre>
<h3><a name="view-structures" class="anchor" href="#view-structures"><span class="header-link"></span></a>View Structures</h3>
<p>So again, in our main script file we have created three new View instances. Lets now take a look at each of the View files so we can see what they&#39;re doing and how they work.</p>
<p>If you remember from our main script file we created the following View (well, this is two Views, one inside another)…</p>
<pre><code class="lang-js"><div class="highlight"><pre><span class="cm">/**</span>
<span class="cm"> * View for &lt;select&gt; menu of Contacts</span>
<span class="cm"> */</span>

<span class="kd">var</span> <span class="nx">contacts_view</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ContactsView</span><span class="p">({</span>
    <span class="nx">el</span><span class="o">:</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#view-contacts&#39;</span><span class="p">),</span>
    <span class="nx">collection</span><span class="o">:</span> <span class="nx">contacts</span><span class="p">,</span> <span class="c1">// pass in the Collection into this View</span>

    <span class="cm">/**</span>
<span class="cm">     * View for displaying the selected Contact</span>
<span class="cm">     *</span>
<span class="cm">     * Originally I had created a global namespace property so I could access this View&#39;s &quot;render()&quot; method from within &#39;contacts_view&#39; (/Views/Contacts.js)</span>
<span class="cm">     * And according to people smarter than I (i.e. Addy Osmani from Google) this was the most appropriate solution.</span>
<span class="cm">     * But I since discovered I could pass in additional data when creating a View instance and so that&#39;s what I&#39;ve done here.</span>
<span class="cm">     */</span>

    <span class="nx">associated_view</span><span class="o">:</span> <span class="k">new</span> <span class="nx">ContactView</span><span class="p">({</span>
        <span class="nx">el</span><span class="o">:</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#view-contact&#39;</span><span class="p">),</span>
        <span class="nx">collection</span><span class="o">:</span> <span class="nx">contacts</span>
    <span class="p">})</span>
<span class="p">});</span>
</pre></div>
</code></pre>
<p>…the <code>contacts_view</code> was the <code>&lt;select&gt;</code> menu that held a list of names. The idea being the user selected a name from the list and the details for the selected user was displayed on the page.</p>
<p>So let&#39;s take a look at that particular View file… </p>
<pre><code class="lang-js"><div class="highlight"><pre><span class="nx">define</span><span class="p">([</span><span class="s1">&#39;../Utils/backbone&#39;</span><span class="p">],</span> <span class="kd">function</span><span class="p">(){</span>

    <span class="kd">var</span> <span class="nx">ContactsView</span> <span class="o">=</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">View</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
        <span class="c1">// Backbone specific method</span>
        <span class="nx">initialize</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">select</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;select&#39;</span><span class="p">);</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">collection</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;contacts:populate&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">populate</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">collection</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;model:added&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">update</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">collection</span><span class="p">.</span><span class="nx">populate</span><span class="p">();</span> <span class="c1">// when this completes it triggers the custom event &#39;contacts:populate&#39;</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">associated_view</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">associated_view</span><span class="p">;</span>
        <span class="p">},</span>

        <span class="c1">// Backbone specific &#39;events&#39; management only applies to DOM elements (as this is a &#39;View&#39; after all)</span>
        <span class="c1">// other custom events triggered are handled via &#39;this.on&#39; within the initialize method </span>
        <span class="c1">// because of this we have to use &#39;this.on&#39; within a &#39;Collection&#39;</span>
        <span class="nx">events</span><span class="o">:</span> <span class="p">{</span>
            <span class="s1">&#39;change select&#39;</span><span class="o">:</span> <span class="s1">&#39;display_selected&#39;</span>
        <span class="p">},</span>

        <span class="nx">populate</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
            <span class="kd">var</span> <span class="nx">select</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">select</span><span class="p">;</span> <span class="c1">// scope of this changes within &#39;each&#39; (refers to same thing as the &#39;model&#39; argument)</span>
            <span class="kd">var</span> <span class="nx">frag</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
            <span class="kd">var</span> <span class="nx">option</span><span class="p">;</span>

            <span class="k">this</span><span class="p">.</span><span class="nx">collection</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">model</span><span class="p">){</span>
                <span class="nx">option</span> <span class="o">=</span> <span class="s1">&#39;&lt;option value=&quot;&#39;</span> <span class="o">+</span> <span class="nx">model</span><span class="p">.</span><span class="nx">cid</span> <span class="o">+</span> <span class="s1">&#39;&quot;&gt;&#39;</span> <span class="o">+</span> <span class="nx">model</span><span class="p">.</span><span class="nx">attributes</span><span class="p">.</span><span class="nx">name</span> <span class="o">+</span> <span class="s1">&#39;&lt;/option&gt;&#39;</span><span class="p">;</span>
                <span class="nx">frag</span> <span class="o">+=</span> <span class="nx">option</span><span class="p">;</span>
            <span class="p">},</span> <span class="k">this</span><span class="p">);</span>

            <span class="c1">// We could of had the &#39;append&#39; calls within the loop</span>
            <span class="c1">// but that would have meant multiple DOM interactions</span>
            <span class="nx">select</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="nx">frag</span><span class="p">);</span>
        <span class="p">},</span>

        <span class="nx">display_selected</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">targ</span> <span class="o">=</span> <span class="nx">event</span><span class="p">.</span><span class="nx">target</span><span class="p">;</span>
            <span class="kd">var</span> <span class="nx">selected_option</span> <span class="o">=</span> <span class="nx">targ</span><span class="p">.</span><span class="nx">options</span><span class="p">[</span><span class="nx">targ</span><span class="p">.</span><span class="nx">selectedIndex</span><span class="p">];</span>
            <span class="kd">var</span> <span class="nx">model</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">collection</span><span class="p">.</span><span class="nx">getByCid</span><span class="p">(</span><span class="nx">selected_option</span><span class="p">.</span><span class="nx">value</span><span class="p">);</span>

            <span class="c1">// We call the &#39;render&#39; method on the associated View we passed through when creating this View&#39;s instance</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">associated_view</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="nx">model</span><span class="p">);</span>
        <span class="p">},</span>

        <span class="c1">// &#39;model&#39; is passed through from Collection</span>
        <span class="nx">update</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">model</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">select</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;select&#39;</span><span class="p">);</span>
            <span class="kd">var</span> <span class="nx">option</span> <span class="o">=</span> <span class="s1">&#39;&lt;option value=&quot;&#39;</span> <span class="o">+</span> <span class="nx">model</span><span class="p">.</span><span class="nx">cid</span> <span class="o">+</span> <span class="s1">&#39;&quot;&gt;&#39;</span> <span class="o">+</span> <span class="nx">model</span><span class="p">.</span><span class="nx">attributes</span><span class="p">.</span><span class="nx">name</span> <span class="o">+</span> <span class="s1">&#39;&lt;/option&gt;&#39;</span><span class="p">;</span>
            <span class="nx">select</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="nx">option</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">});</span>

    <span class="k">return</span> <span class="nx">ContactsView</span><span class="p">;</span>

<span class="p">});</span>
</pre></div>
</code></pre>
<p>…and let&#39;s break down what it&#39;s doing… </p>
<h3><a name="carry-out-some-initial-set-up-stuff-when-a-new-instance-is-created" class="anchor" href="#carry-out-some-initial-set-up-stuff-when-a-new-instance-is-created"><span class="header-link"></span></a>Carry out some initial set-up stuff when a new instance is created</h3>
<p>A few things going on here:  </p>
<p>We first grab the <code>&lt;select&gt;</code> element using Backbone&#39;s <code>$el</code> property (this property references the element we passed through to the View&#39;s <code>extend</code> method when creating a new instance. It&#39;s effectively a jQuery wrapped version of the element - which is why we&#39;re able to use jQuery&#39;s <code>find</code> method.  </p>
<p>Next we set-up a couple of event listeners (for custom events) - you&#39;ll remember the Collection triggers the custom events like so <code>this.trigger(&#39;model:added&#39;, model);</code> and <code>this.trigger(&#39;contacts:populate&#39;);</code>.  </p>
<p>This is where it gets a little weird I&#39;m afraid. We now call the Collection&#39;s custom <code>populate</code> method. That method does literally nothing other than trigger the custom event <code>contacts:populate</code>. The reason that method even exists (and why we&#39;re calling it) is because we only want to populate the <code>&lt;select&gt;</code> menu when we know there is data available! We weren&#39;t able to trigger a custom event from the Collections <code>initialize</code> method (which would have been ideal, because once the Collection instance is created would have been a good time to trigger the custom event) and so we&#39;ve had to create our own method within the Collection which we manually call from this View. It&#39;s a bit &quot;arse about face&quot; but that&#39;s just the way it is.  </p>
<p>Lastly we create a property for this instance that points to another View. The reason we do this is because later on in this View&#39;s <code>display_selected</code> method we need to call the associated View&#39;s <code>render</code> method.  </p>
<p>Because we&#39;re using AMD we&#39;ve made our Views into separate modules/files, but because of this we aren&#39;t able to access code outside of a module (our module&#39;s code is protected) - so we&#39;re unable to access the <code>ContactView</code> View unless we pass around a reference to it like we&#39;ve done here.</p>
<pre><code class="lang-js"><div class="highlight"><pre><span class="nx">initialize</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">select</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;select&#39;</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">collection</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;contacts:populate&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">populate</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">collection</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;model:added&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">update</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">collection</span><span class="p">.</span><span class="nx">populate</span><span class="p">();</span> <span class="c1">// when this completes it triggers the custom event &#39;contacts:populate&#39;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">associated_view</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">associated_view</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</code></pre>
<h3><a name="define-some-events" class="anchor" href="#define-some-events"><span class="header-link"></span></a>Define some events</h3>
<p>We specify a &#39;change&#39; event for the <code>&lt;select&gt;</code> element<br>which when triggered executes the <code>display_selected</code> method we&#39;ve created for this View.</p>
<pre><code class="lang-js"><div class="highlight"><pre><span class="nx">events</span><span class="o">:</span> <span class="p">{</span>
    <span class="s1">&#39;change select&#39;</span><span class="o">:</span> <span class="s1">&#39;display_selected&#39;</span>
<span class="p">}</span>
</pre></div>
</code></pre>
<h3><a name="custom-populate-function" class="anchor" href="#custom-populate-function"><span class="header-link"></span></a>Custom <code>populate</code> function</h3>
<p>This method builds up the content of the <code>&lt;select&gt;</code> menu.<br>It does this by looping through the Collection data and accessing each individual Model stored within it.<br>You&#39;ll notice that we set the value of each <code>&lt;option&gt;</code> element to be whatever the <code>cid</code> value for the Model is (the <code>cid</code> value is set automatically by Backbone on each Model)</p>
<pre><code class="lang-js"><div class="highlight"><pre><span class="nx">populate</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
    <span class="kd">var</span> <span class="nx">select</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">select</span><span class="p">;</span> <span class="c1">// scope of this changes within &#39;each&#39; (refers to same thing as the &#39;model&#39; argument)</span>
    <span class="kd">var</span> <span class="nx">frag</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">option</span><span class="p">;</span>

   <span class="k">this</span><span class="p">.</span><span class="nx">collection</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">model</span><span class="p">){</span>
        <span class="nx">option</span> <span class="o">=</span> <span class="s1">&#39;&lt;option value=&quot;&#39;</span> <span class="o">+</span> <span class="nx">model</span><span class="p">.</span><span class="nx">cid</span> <span class="o">+</span> <span class="s1">&#39;&quot;&gt;&#39;</span> <span class="o">+</span> <span class="nx">model</span><span class="p">.</span><span class="nx">attributes</span><span class="p">.</span><span class="nx">name</span> <span class="o">+</span> <span class="s1">&#39;&lt;/option&gt;&#39;</span><span class="p">;</span>
        <span class="nx">frag</span> <span class="o">+=</span> <span class="nx">option</span><span class="p">;</span>
    <span class="p">},</span> <span class="k">this</span><span class="p">);</span>

    <span class="c1">// We could of had the &#39;append&#39; calls within the loop</span>
    <span class="c1">// but that would have meant multiple DOM interactions</span>
    <span class="nx">select</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="nx">frag</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</code></pre>
<h3><a name="custom-display-selected-function" class="anchor" href="#custom-display-selected-function"><span class="header-link"></span></a>Custom <code>display_selected</code> function</h3>
<p>This methods works out which menu item was selected and then<br>uses a Backbone specific method <code>getByCid</code> to access the required Model.<br>We then call the <code>ContactView</code>&#39;s <code>render</code> method and pass through the Model data that needs to be rendered.</p>
<pre><code class="lang-js"><div class="highlight"><pre><span class="nx">display_selected</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">targ</span> <span class="o">=</span> <span class="nx">event</span><span class="p">.</span><span class="nx">target</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">selected_option</span> <span class="o">=</span> <span class="nx">targ</span><span class="p">.</span><span class="nx">options</span><span class="p">[</span><span class="nx">targ</span><span class="p">.</span><span class="nx">selectedIndex</span><span class="p">];</span>
    <span class="kd">var</span> <span class="nx">model</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">collection</span><span class="p">.</span><span class="nx">getByCid</span><span class="p">(</span><span class="nx">selected_option</span><span class="p">.</span><span class="nx">value</span><span class="p">);</span>

    <span class="c1">// We call the &#39;render&#39; method on the associated View we passed through when creating this View&#39;s instance</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">associated_view</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="nx">model</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</code></pre>
<h3><a name="custom-update-function" class="anchor" href="#custom-update-function"><span class="header-link"></span></a>Custom <code>update</code> function</h3>
<p>Every time a Model is added to the Collection it triggers an <code>model:added</code> event.<br>This event causes the View&#39;s <code>update</code> method to be executed, which inserts the new Model directly into the <code>&lt;select&gt;</code> menu.</p>
<pre><code class="lang-js"><div class="highlight"><pre><span class="nx">update</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">model</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">select</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;select&#39;</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">option</span> <span class="o">=</span> <span class="s1">&#39;&lt;option value=&quot;&#39;</span> <span class="o">+</span> <span class="nx">model</span><span class="p">.</span><span class="nx">cid</span> <span class="o">+</span> <span class="s1">&#39;&quot;&gt;&#39;</span> <span class="o">+</span> <span class="nx">model</span><span class="p">.</span><span class="nx">attributes</span><span class="p">.</span><span class="nx">name</span> <span class="o">+</span> <span class="s1">&#39;&lt;/option&gt;&#39;</span><span class="p">;</span>
    <span class="nx">select</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="nx">option</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</code></pre>
<h3><a name="template-for-the-associated-view" class="anchor" href="#template-for-the-associated-view"><span class="header-link"></span></a>Template for the Associated View</h3>
<p>Let&#39;s take a look at the associated View that we created…</p>
<pre><code class="lang-js"><div class="highlight"><pre><span class="nx">define</span><span class="p">([</span><span class="s1">&#39;../Utils/backbone&#39;</span><span class="p">],</span> <span class="kd">function</span><span class="p">(){</span>

    <span class="kd">var</span> <span class="nx">ContactView</span> <span class="o">=</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">View</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
        <span class="nx">render</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">model</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">model</span> <span class="o">=</span> <span class="nx">model</span> <span class="o">||</span> <span class="k">this</span><span class="p">.</span><span class="nx">collection</span><span class="p">.</span><span class="nx">models</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
            <span class="kd">var</span> <span class="nx">attributes</span> <span class="o">=</span> <span class="nx">model</span><span class="p">.</span><span class="nx">attributes</span><span class="p">;</span>
            <span class="kd">var</span> <span class="nx">template</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#contact_template&#39;</span><span class="p">);</span>
            <span class="kd">var</span> <span class="nx">compile</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">template</span><span class="p">(</span><span class="nx">template</span><span class="p">.</span><span class="nx">html</span><span class="p">(),</span> <span class="p">{</span>
                <span class="nx">id</span><span class="o">:</span> <span class="nx">attributes</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span>
                <span class="nx">name</span><span class="o">:</span> <span class="nx">attributes</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span>
                <span class="nx">age</span><span class="o">:</span> <span class="nx">attributes</span><span class="p">.</span><span class="nx">age</span><span class="p">,</span>
                <span class="nx">address</span><span class="o">:</span> <span class="nx">attributes</span><span class="p">.</span><span class="nx">address</span>
            <span class="p">});</span>

            <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">html</span><span class="p">(</span><span class="nx">compile</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">});</span>

    <span class="k">return</span> <span class="nx">ContactView</span><span class="p">;</span>

<span class="p">});</span>
</pre></div>
</code></pre>
<p>…as you can see: it&#39;s a lot simpler! All it consists of is a <code>render</code> method.</p>
<p>The purpose of this View is to display the selected contact details.</p>
<p>When this method is called we pass it the Model that we want to display and then we use Underscore&#39;s <code>_.template</code> method to render the data in HTML.</p>
<p>If you&#39;ve not used a template library before then it simply is just a text file which contains HTML tags where the dynamic content areas are replaced with specific delimiter tags. You would then pass through an object of data to the template library in which is would use to compile the template&#39;s HTML content so its tags are replaced with content from the data object.</p>
<p>For example, if the template was <code>&lt;p&gt;{{fullname}}&lt;/p&gt;</code> (this assumes the template library you&#39;re using requires the delimiter tags to be double braces <code>{ {</code> <code>}}</code> then you could pass in a data object like <code>{ fullname: &#39;Mark&#39; }</code> and then when the template is compiled it would return the HTML like this: <code>&lt;p&gt;Mark&lt;/p&gt;</code>.</p>
<p>Underscore&#39;s <code>_.template</code> method uses different tags: <code>&lt;%=fullname%&gt;</code> and although the internal workings for each template library can be different (each one trying to out perform the other) the general principle of how they work stays the same.</p>
<p>In this example we&#39;ve gotten the content of the template file from within the HTML page itself. If you remember, the main HTML page we had contained a <code>&lt;script&gt;</code> tag with the <code>type</code> attribute value set to <code>text/template</code>. This odd type value causes the browser to ignore it (a browser wont try to execute the HTML content within that script tag as JavaScript because it doesn&#39;t recognise the type value). </p>
<p>Ideally though you&#39;d have the template content as a separate file and then AJAX in that template file. The reason I recommend keeping your template in a separate file is because relying on the browser to not execute a script just because it has an unknown attribute value is very fragile and likely to break in future, but for the purpose of this example it&#39;ll do.</p>
<h3><a name="adding-a-new-model" class="anchor" href="#adding-a-new-model"><span class="header-link"></span></a>Adding a new Model</h3>
<p>We have one more View left to look at, this is the HTML <code>&lt;form&gt;</code> element which lets us add a new contact to the list of contacts…</p>
<pre><code class="lang-js"><div class="highlight"><pre><span class="nx">define</span><span class="p">([</span><span class="s1">&#39;../Models/Contact&#39;</span><span class="p">,</span> <span class="s1">&#39;../Utils/backbone&#39;</span><span class="p">],</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">Contact</span><span class="p">)</span> <span class="p">{</span>

    <span class="kd">var</span> <span class="nx">AddContactView</span> <span class="o">=</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">View</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
        <span class="c1">// Built-in object for handling DOM events</span>
        <span class="nx">events</span><span class="o">:</span> <span class="p">{</span>
            <span class="s1">&#39;click input[type=submit]&#39;</span><span class="o">:</span> <span class="s1">&#39;add_contact&#39;</span>
        <span class="p">},</span>

        <span class="nx">add_contact</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">e</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span> <span class="c1">// prevent form from submitting</span>

            <span class="kd">var</span> <span class="nx">message</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;message-success&#39;</span><span class="p">);</span>
            <span class="kd">var</span> <span class="nx">errors</span> <span class="o">=</span> <span class="p">[];</span>
            <span class="kd">var</span> <span class="nx">fullname</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">el</span><span class="p">.</span><span class="nx">fullname</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>
            <span class="kd">var</span> <span class="nx">age</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">el</span><span class="p">.</span><span class="nx">age</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>
            <span class="kd">var</span> <span class="nx">address</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">el</span><span class="p">.</span><span class="nx">address</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>
            <span class="kd">var</span> <span class="nx">contact</span><span class="p">;</span>

            <span class="c1">// This regex tests for a first name with at least two characters, </span>
            <span class="c1">// followed by an optional middle name with at least two characters (we use a non-capturing group to save the regex engine some work), </span>
            <span class="c1">// followed by the last name with at least two characters.</span>
            <span class="c1">// This regex allows the first-middle name (and the middle-last) to be joined by a hypen (e.g. Georges St-Pierre or Georges-St Pierre)</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="sr">/[\w-]{2,}(?:\s\w{2,})?[\s-]\w{2,}/</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">fullname</span><span class="p">))</span> <span class="p">{</span>
                <span class="nx">errors</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="s1">&#39;Name was invalid&#39;</span><span class="p">);</span>
            <span class="p">}</span> 

            <span class="c1">// We allow ages from 1-999</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="sr">/\d{1,3}/</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">age</span><span class="p">))</span> <span class="p">{</span>
                <span class="nx">errors</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="s1">&#39;Age was invalid (should be numeric value only)&#39;</span><span class="p">);</span>
            <span class="p">}</span>

            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">address</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
                <span class="c1">// Provide a default for the address (mainly because it&#39;s awkward to validate this type of field)</span>
                <span class="nx">address</span> <span class="o">=</span> <span class="s1">&#39;No address provided&#39;</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="c1">// If there are any errors then we can&#39;t proceed</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">errors</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
                <span class="c1">// If the success message (from a previous successful record added) is still visible</span>
                <span class="c1">// then remove it to save from confusing the user.</span>
                <span class="kd">var</span> <span class="nx">success</span><span class="p">;</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">success</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;message-success&#39;</span><span class="p">))</span> <span class="p">{</span>
                    <span class="k">this</span><span class="p">.</span><span class="nx">el</span><span class="p">.</span><span class="nx">removeChild</span><span class="p">(</span><span class="nx">success</span><span class="p">);</span> <span class="c1">// this.el provided by Backbone</span>
                <span class="p">}</span>

                <span class="c1">// Display errors</span>
                <span class="nx">alert</span><span class="p">(</span><span class="nx">errors</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;\n&#39;</span><span class="p">));</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="c1">// There should be an AJAX function to post data to server-side script (for storing in db)</span>
                <span class="c1">// Backbone.Model.save() might be a built-in handler for this, I&#39;m not sure yet?</span>

                <span class="c1">// Create a new Model</span>
                <span class="nx">contact</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Contact</span><span class="p">({</span>
                    <span class="nx">id</span><span class="o">:</span> <span class="nx">_</span><span class="p">.</span><span class="nx">uniqueId</span><span class="p">(),</span>
                    <span class="nx">name</span><span class="o">:</span> <span class="nx">fullname</span><span class="p">,</span>
                    <span class="nx">age</span><span class="o">:</span> <span class="o">+</span><span class="nx">age</span><span class="p">,</span> <span class="c1">// ensure data is an Integer</span>
                    <span class="nx">address</span><span class="o">:</span> <span class="nx">address</span>
                <span class="p">});</span>

                <span class="c1">// Add the new Model into the Contacts Collection</span>
                <span class="c1">// This should trigger an &#39;add&#39; event which means the record is inserted into the &lt;select&gt;</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">collection</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">contact</span><span class="p">);</span>

                <span class="c1">// Display success message and reset the form</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">el</span><span class="p">.</span><span class="nx">reset</span><span class="p">();</span> <span class="c1">// this.el provided by Backbone</span>

                <span class="c1">// Don&#39;t want to see a massive long list of &#39;Record added successfully!&#39; messages</span>
                <span class="c1">// So if one is already there then just remove it first</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">message</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">message</span><span class="p">.</span><span class="nx">parentNode</span><span class="p">.</span><span class="nx">removeChild</span><span class="p">(</span><span class="nx">message</span><span class="p">);</span>
                <span class="p">}</span>

                <span class="c1">// Create an element to hold our success message</span>
                <span class="kd">var</span> <span class="nx">doc</span> <span class="o">=</span> <span class="nb">document</span><span class="p">;</span>
                <span class="kd">var</span> <span class="nx">div</span> <span class="o">=</span> <span class="nx">doc</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;div&#39;</span><span class="p">);</span>
                <span class="kd">var</span> <span class="nx">txt</span> <span class="o">=</span> <span class="nx">doc</span><span class="p">.</span><span class="nx">createTextNode</span><span class="p">(</span><span class="s1">&#39;Record added successfully!&#39;</span><span class="p">);</span>

                <span class="nx">div</span><span class="p">.</span><span class="nx">id</span> <span class="o">=</span> <span class="s1">&#39;message-success&#39;</span><span class="p">;</span>

                <span class="nx">div</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">txt</span><span class="p">);</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">el</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">div</span><span class="p">);</span> <span class="c1">// this.el provided by Backbone</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">});</span>

    <span class="k">return</span> <span class="nx">AddContactView</span><span class="p">;</span>

<span class="p">});</span>
</pre></div>
</code></pre>
<p>…this does a lot of stuff so lets break it down…</p>
<h3><a name="event-listeners" class="anchor" href="#event-listeners"><span class="header-link"></span></a>Event listeners</h3>
<p>We set-up a listener for the <code>click</code> event for the form&#39;s submit button which calls the <code>add_contact</code> method.</p>
<pre><code class="lang-js"><div class="highlight"><pre><span class="nx">events</span><span class="o">:</span> <span class="p">{</span>
    <span class="s1">&#39;click input[type=submit]&#39;</span><span class="o">:</span> <span class="s1">&#39;add_contact&#39;</span>
<span class="p">}</span>
</pre></div>
</code></pre>
<h3><a name="add-a-new-contact-and-validate-the-user-input" class="anchor" href="#add-a-new-contact-and-validate-the-user-input"><span class="header-link"></span></a>Add a new contact and validate the user input</h3>
<p>We call the <code>add_contact</code> method and immediately call <code>e.preventDefault</code> which stops the form from submitting and thus refreshing the page (which we don&#39;t want to have happen as we&#39;ll lose the state of the page).</p>
<pre><code class="lang-js"><div class="highlight"><pre><span class="nx">add_contact</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">e</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>

    <span class="kd">var</span> <span class="nx">message</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;message-success&#39;</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">errors</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="kd">var</span> <span class="nx">fullname</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">el</span><span class="p">.</span><span class="nx">fullname</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">age</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">el</span><span class="p">.</span><span class="nx">age</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">address</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">el</span><span class="p">.</span><span class="nx">address</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">contact</span><span class="p">;</span>

    <span class="c1">// This regex tests for a first name with at least two characters, </span>
    <span class="c1">// followed by an optional middle name with at least two characters (we use a non-capturing group to save the regex engine some work), </span>
    <span class="c1">// followed by the last name with at least two characters.</span>
    <span class="c1">// This regex allows the first-middle name (and the middle-last) to be joined by a hypen (e.g. George St-Pierre or Georges-St Pierre)</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="sr">/[\w-]{2,}(?:\s\w{2,})?[\s-]\w{2,}/</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">fullname</span><span class="p">))</span> <span class="p">{</span>
        <span class="nx">errors</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="s1">&#39;Name was invalid&#39;</span><span class="p">);</span>
    <span class="p">}</span> 

    <span class="c1">// We allow ages from 1-999</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="sr">/\d{1,3}/</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">age</span><span class="p">))</span> <span class="p">{</span>
        <span class="nx">errors</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="s1">&#39;Age was invalid (should be numeric value only)&#39;</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">address</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">address</span> <span class="o">=</span> <span class="s1">&#39;No address provided&#39;</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</code></pre>
<h3><a name="handle-any-invalid-data" class="anchor" href="#handle-any-invalid-data"><span class="header-link"></span></a>Handle any invalid data</h3>
<p>If the success message (from a previous successful record added) is still visible then remove it to save from confusing the user.<br>Then display any errors found.</p>
<pre><code class="lang-js"><div class="highlight"><pre><span class="k">if</span> <span class="p">(</span><span class="nx">errors</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">success</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">success</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;message-success&#39;</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">el</span><span class="p">.</span><span class="nx">removeChild</span><span class="p">(</span><span class="nx">success</span><span class="p">);</span> <span class="c1">// this.el provided by Backbone</span>
    <span class="p">}</span>

    <span class="c1">// Display errors</span>
    <span class="nx">alert</span><span class="p">(</span><span class="nx">errors</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;\n&#39;</span><span class="p">));</span>
<span class="p">}</span>
</pre></div>
</code></pre>
<h3><a name="add-a-new-contact" class="anchor" href="#add-a-new-contact"><span class="header-link"></span></a>Add a new contact</h3>
<p>This adds the new Model data, then updates the <code>&lt;select&gt;</code> menu, then inserts a success message to let the user know the details were added without issue.</p>
<pre><code class="lang-js"><div class="highlight"><pre><span class="k">else</span> <span class="p">{</span>
    <span class="c1">// Create a new Model</span>
    <span class="nx">contact</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Contact</span><span class="p">({</span>
        <span class="nx">id</span><span class="o">:</span> <span class="nx">_</span><span class="p">.</span><span class="nx">uniqueId</span><span class="p">(),</span>
        <span class="nx">name</span><span class="o">:</span> <span class="nx">fullname</span><span class="p">,</span>
        <span class="nx">age</span><span class="o">:</span> <span class="o">+</span><span class="nx">age</span><span class="p">,</span> <span class="c1">// ensure data is an Integer</span>
        <span class="nx">address</span><span class="o">:</span> <span class="nx">address</span>
    <span class="p">});</span>

    <span class="c1">// Add the new Model into the Contacts Collection</span>
    <span class="c1">// This should trigger an &#39;add&#39; event which means the record is inserted into the &lt;select&gt;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">collection</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">contact</span><span class="p">);</span>

    <span class="c1">// Display success message and reset the form</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">el</span><span class="p">.</span><span class="nx">reset</span><span class="p">();</span> <span class="c1">// this.el provided by Backbone</span>

    <span class="c1">// Don&#39;t want to see a massive long list of &#39;Record added successfully!&#39; messages</span>
    <span class="c1">// So if one is already there then just remove it first</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">message</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">message</span><span class="p">.</span><span class="nx">parentNode</span><span class="p">.</span><span class="nx">removeChild</span><span class="p">(</span><span class="nx">message</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="c1">// Create an element to hold our success message</span>
    <span class="kd">var</span> <span class="nx">doc</span> <span class="o">=</span> <span class="nb">document</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">div</span> <span class="o">=</span> <span class="nx">doc</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;div&#39;</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">txt</span> <span class="o">=</span> <span class="nx">doc</span><span class="p">.</span><span class="nx">createTextNode</span><span class="p">(</span><span class="s1">&#39;Record added successfully!&#39;</span><span class="p">);</span>

    <span class="nx">div</span><span class="p">.</span><span class="nx">id</span> <span class="o">=</span> <span class="s1">&#39;message-success&#39;</span><span class="p">;</span>

    <span class="nx">div</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">txt</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">el</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">div</span><span class="p">);</span> <span class="c1">// this.el provided by Backbone</span>
<span class="p">}</span>
</pre></div>
</code></pre>
<h3><a name="url-routing" class="anchor" href="#url-routing"><span class="header-link"></span></a>URL Routing</h3>
<p>I&#39;ve not built in any real routing logic into this particular example application, but I&#39;ve included below part of the example from the Backbone website so you at least have an idea of how it works...</p>
<pre><code class="lang-js"><div class="highlight"><pre><span class="nx">define</span><span class="p">([</span><span class="s1">&#39;../Utils/backbone&#39;</span><span class="p">],</span> <span class="kd">function</span><span class="p">(){</span>

    <span class="kd">var</span> <span class="nx">Routing</span> <span class="o">=</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">Router</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
        <span class="nx">routes</span><span class="o">:</span> <span class="p">{</span>
            <span class="s1">&#39;test&#39;</span><span class="o">:</span> <span class="s1">&#39;test&#39;</span><span class="p">,</span>
            <span class="s1">&#39;search/:query/:page&#39;</span><span class="o">:</span> <span class="s1">&#39;search&#39;</span>
        <span class="p">},</span>

        <span class="nx">test</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;User has accessed this app from /test/&#39;</span><span class="p">);</span>
        <span class="p">},</span>

        <span class="nx">search</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">query</span><span class="p">,</span> <span class="nx">page</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">query</span><span class="p">,</span> <span class="nx">page</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">});</span>

    <span class="k">return</span> <span class="nx">Routing</span><span class="p">;</span>

<span class="p">});</span>
</pre></div>
</code></pre>
<p>...what we have here is a new <code>Router</code> instance where we then defines a set of &#39;routes&#39; into your application. The routes we have defined are:</p>
<ul>
<li><p><a href="http://backbone:8888/#test">http://backbone:8888/#test</a><br>If we access our application with this URL we&#39;ll see a log message of <code>User has accessed this app from /test/</code></p>
</li>
<li><p><a href="http://backbone:8888/#search/testing/p7">http://backbone:8888/#search/testing/p7</a><br>If we access our application with this URL we&#39;ll see a log message of <code>testing, p7</code></p>
</li>
</ul>
<p>...to initialise this Router system we need to trigger it via the main script file... </p>
<pre><code class="lang-js"><div class="highlight"><pre><span class="cm">/**</span>
<span class="cm"> * Router/History API Examples</span>
<span class="cm"> */</span>

<span class="c1">// Create new instance of our Routing Class</span>
<span class="kd">var</span> <span class="nx">routing</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Routing</span><span class="p">();</span>

<span class="c1">// Initialize the Router</span>
<span class="nx">Backbone</span><span class="p">.</span><span class="nx">history</span><span class="p">.</span><span class="nx">start</span><span class="p">({</span> <span class="nx">pushState</span><span class="o">:</span> <span class="kc">true</span> <span class="p">});</span>
</pre></div>
</code></pre>
<p>Instead of displaying basic log messages we would use this routing feature to load a specific application state.</p>
<p>So for example, if we set-up the relevant route then the user could access the application via a URL like: <a href="http://backbone:8888/#contact/99">http://backbone:8888/#contact/99</a> and that could load the contact details for Model item 99.</p>
<p>You also have the facility to take advantage of HTML5&#39;s <code>pushState</code> which removes the need for URL rewriting but does require extra application logic/work. The default for <code>Backbone.Router</code> is to use hashbangs.</p>
<p>If a user accesses the application with a hashbang URL and the application is set-up to use <code>pushState</code> then Backbone will update the URL from the hashbang to the proper HTML5 variation.</p>
<h2><a name="wrap-up" class="anchor" href="#wrap-up"><span class="header-link"></span></a>Wrap-up</h2>
<p>So this is where we end. </p>
<p>We&#39;ve got our three Views set-up, we have our Model defined and contacts created from it and we created a Collection based on that Model type.</p>
<p>The Views and Models/Collection are tied together and the application is functioning as it should be.</p>
<p>There are lots of things we could do to improve this example, but as a basic example of an MVC style application built using Backbone.js I think it does everything it needs to.</p>
<h2><a name="conclusion" class="anchor" href="#conclusion"><span class="header-link"></span></a>Conclusion</h2>
<p>When you start using Backbone.js the concepts can be a bit confusing, but you quickly learn your way around. </p>
<p>Oddly, trying to <em>explain</em> how to use Backbone.js is harder than actually using it! So I would suggest just start using it.</p>
<p>The main <a href="http://www.backbonejs.org/">Backbone.js website</a> is the best documentation available and is the ideal place to start after here. </p>
<p>Also, the following links are excellent resources to understand the MV* concepts discussed at the start of this post.</p>
<h2><a name="links" class="anchor" href="#links"><span class="header-link"></span></a>Links**</h2>
<ul>
<li><a href="http://addyosmani.com/blog/backbone-fundamentals/">Backbone Fundamentals</a></li>
<li><a href="http://addyosmani.com/blog/short-musings-on-javascript-mv-tech-stacks/">Short Musings On JavaScript MV* Tech Stacks</a></li>
<li><a href="http://addyosmani.com/blog/understanding-mvc-and-mvp-for-javascript-and-backbone-developers/">Understanding MVC And MVP (For JavaScript And Backbone Developers)</a></li>
<li><a href="http://addyosmani.com/blog/understanding-mvvm-a-guide-for-javascript-developers/">Understanding MVVM – A Guide For JavaScript Developers</a></li>
<li><a href="http://addyosmani.com/blog/digesting-javascript-mvc-pattern-abuse-or-evolution/">Digesting JavaScript MVC – Pattern Abuse Or Evolution?</a></li>
<li><a href="http://addyosmani.com/blog/javascript-mvc-jungle/">Journey Through The JavaScript MVC Jungle</a></li>
</ul>
</div>

  <div class="comments">
    <a href="/posts/mvc-in-javascript-with-backbone-js/#comments">
      <span class="icon-bubbles"></span>
      Comments
    </a>
  </div>


<div class="pagination group">
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
      <a href="/page/10/" class="newer"> Newer &#8594;</a>
    
  
    
    
  
    
    
      <a href="/page/12/" class="older"> &#8592; Older</a>
    
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
</div>
    </div>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.1/jquery.min.js" type="text/javascript"></script>
    <script src="/scripts/main.js" type="text/javascript"></script>
    <script src="/scripts/Imager.js" type="text/javascript"></script>
    <script>
        var _gaq=[['_setAccount','UA-33159515-1'],['_trackPageview']];
        (function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];
        g.src=('https:'==location.protocol?'//ssl':'//www')+'.google-analytics.com/ga.js';
        s.parentNode.insertBefore(g,s)}(document,'script'));
    </script>
  </body>
</html>

