<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="icon" type="image/png" href="/images/cabin.png" >
    <link href="/styles/main.css" rel="stylesheet">
    
    <title>Integralist -> BBC News Engineer</title>
    
    
    <link rel="alternate" type="application/atom+xml" title="Integralist" href="http://feeds.feedburner.com/Integralist">
  </head>
  <body>
    <nav>
      <h1 class="name">
          <a href="/">Integralist</a>
      </h1>
      <div class="menu icon-menu"></div>
      <ul class="nav-links">
        <li class="text-link">
          <a href="/about.html">about</a>
        </li>
        <li class="text-link">
          <a href="/projects.html">projects</a>
        </li>
        <li class="text-link">
          <a href="/archives.html">archives</a>
        </li>
      </ul>
      <div class="social-media">
        <a href="https://github.com/integralist" class="icon-github"></a>
        <a href="https://twitter.com/integralist" class="icon-twitter"></a>
      </div>
    </nav>
    <div class="content">


  <div class="post-head group">
  <a href="/posts/mvc-in-javascript-with-backbone-js/">
    <h1 class="post-title">MVC in JavaScript with Backbone.js</h1>
  </a>
  <span class="post-date">2012 &#183; 8 &#183; 16</span>
</div>

<div class="post-body"><h2><a name="what-we-ll-cover-reading-time-approx-34mins-"class="anchor" href="#what-we-ll-cover-reading-time-approx-34mins-"><span class="header-link"></span></a>What we&#39;ll cover <em>reading time: approx. 34mins</em></h2>
<ul>
<li>Introduction</li>
<li>What is MVC?</li>
<li>Backbone&#39;s interpretation of MVC</li>
<li>Using AMD Modules and RequireJS</li>
<li>Scope Access</li>
<li>Project</li>
<li>Set-up</li>
<li>Architecture</li>
<li>Wrap-up</li>
<li>Conclusion</li>
</ul>
<h2><a name="introduction"class="anchor" href="#introduction"><span class="header-link"></span></a>Introduction</h2>
<p>I&#39;ll be honest and tell you that I struggled for quite a while to actually see the point of using <a href="http://backbonejs.org/">Backbone.js</a>. </p>
<p>It seemed like a lot of overhead for very little in return.</p>
<p>I also didn&#39;t like the fact that it tied me into using both Underscore and jQuery as dependencies.</p>
<p>Because of this, and because I knew a lot of these so called MVC frameworks weren&#39;t <em>really</em> MVC (in the traditional sense), I decided to &#39;roll my own&#39; and so started writing <a href="https://github.com/Integralist/MVC-Start-up-Kit/tree/library_agnostic">my own MVC library</a> (please do read the articles listed at the end of this post by <a href="http://twitter.com/addyosmani">Addy Osmani</a> for an in-depth look at the massive MV* culture we have at the moment).</p>
<p>My own library worked fine, and it genuinely followed the MVC principles:</p>
<table>
  <tr>
    <th>M (Models)</th>
    <th>V (Views)</th>
    <th>C (Controllers)</th>
  </tr>
  <tr>
    <td>Data</td>
    <td>User Interface</td>
    <td>Logic</td>
  </tr>
</table>

<p>But my own biggest concern was that although my MVC library was <em>structurally</em> equivalent to the proper MVC pattern and the API itself was fairly clean and easy to use, there was a lot of areas where I had too tightly coupled my library to a particular way of working and that made it difficult to re-use on different projects without first spending a lot of time making those tight couplings &#39;loose&#39; again each time.</p>
<p>It was obvious I needed to spend a lot more time on this library of mine for it to be genuinely usable in a production environment, and that&#39;s when I decided to instead take another look into Backbone.js to see what it could offer me, because from all the examples I had looked at in the past the code produced appeared very clean, flexible and well structured. Plus there are <em>lots</em> of agencies/companies implementing Backbone nowadays. So out of all the MVC libraries available (and there are quite a few) it seemed like a pretty safe bet to take another look at it.</p>
<h2><a name="what-is-mvc-"class="anchor" href="#what-is-mvc-"><span class="header-link"></span></a>What is MVC?</h2>
<p>For those who&#39;ve not heard of the MVC Design Pattern it is quite simple: each letter of the acronym is a separate area of concern…</p>
<h3><a name="m-model"class="anchor" href="#m-model"><span class="header-link"></span></a>M: Model</h3>
<p>A Model is a piece of data.</p>
<p>If you had a photo album then each photo would be a Model.</p>
<p>If you had a car showroom then each car would be a Model.</p>
<p>If you owned a pet store then each animal would be a Model.</p>
<p>You get the idea.</p>
<h3><a name="v-view"class="anchor" href="#v-view"><span class="header-link"></span></a>V: View</h3>
<p>A View is the user interface.</p>
<p>This could literally be anything the user of your program interacts with. So any HTML element could be made into a &#39;View&#39;.</p>
<h3><a name="c-controller"class="anchor" href="#c-controller"><span class="header-link"></span></a>C: Controller</h3>
<p>A Controller is the brains of the program and determines what happens and when.</p>
<h3><a name="communication-between-them-"class="anchor" href="#communication-between-them-"><span class="header-link"></span></a>Communication between them?</h3>
<p>The traditional concept of MVC states that a Model should only handle its own data and should have no other logic bound to it. So for example, a Model can have a method for getting/updating its data but it should have no logic built-in to determine <em>when</em> it should get that data (that&#39;s what the Controller does). </p>
<p>Both the Model and the View can alert the Controller of any changes or interactions and then the Controller can decide what to do with that information (e.g. when the user selects an option from a drop down menu within the View then the Controller might request specific data from the Model, when the Model gives that data to the Controller then it can pass that onto the View to display).</p>
<p>Typically you&#39;ll have one Controller for every View/Model but you could have multiple Views/Models per Controller.</p>
<h2><a name="backbone-s-interpretation-of-mvc"class="anchor" href="#backbone-s-interpretation-of-mvc"><span class="header-link"></span></a>Backbone&#39;s interpretation of MVC</h2>
<p>Backbone.js is much like all the other JavaScript MVC libraries available today (with the exception of Peter Michaux&#39;s <a href="https://github.com/petermichaux/maria/">Maria</a>) where by it&#39;s not strictly MVC but a variation of the pattern.</p>
<p>Addy Osmani (from Google) has covered this subject in-depth and so I highly recommend you review his work (see the bottom of this post for links).</p>
<p>But the basic premise for most of these libraries is that they implement the Model and the View but the Controller is swapped out for something else. So in Backbone&#39;s case it doesn&#39;t have a Controller, instead the View handles both the traditional View responsibilities as well as the Controller logic.</p>
<h3><a name="collections-"class="anchor" href="#collections-"><span class="header-link"></span></a>Collections?</h3>
<p>Backbone.js also introduces another concept called a &#39;Collection&#39;. A Collection is simply a group of a specific Models. So if you had a Model called &quot;PhotoModel&quot; and you created a few instances of that Model you might want to create a Collection called &quot;PhotoAlbum&quot;. PhotoAlbum would then be a <em>collection</em> of PhotoModels.</p>
<p>Collections trigger events when a Model is added or removed from the Collection and you are able to iterate over the Collection and pull out a specific Model, so they can end up being pretty useful.</p>
<h3><a name="router-history-"class="anchor" href="#router-history-"><span class="header-link"></span></a>Router/History?</h3>
<p>Backbone.js provides a History object which monitors the <code>hashchange</code> event and also provides an opt-in HTML5 <code>pushState</code> variation (which falls back to standard AJAX style hash bang navigation).</p>
<p>There is also a Router object provided which handles the set-up of simple URL routing.</p>
<p>So far I&#39;ve only lightly interacted with the <code>Backbone.Router</code>/<code>Backbone.History</code> aspects but I&#39;ve provided examples below of how to utilise them.</p>
<h2><a name="using-amd-modules-and-requirejs"class="anchor" href="#using-amd-modules-and-requirejs"><span class="header-link"></span></a>Using AMD Modules and RequireJS</h2>
<p>Backbone.js can be used with standard <code>&lt;script&gt;</code> tags, so there is no need for you to use a module system such as AMD (or a module loader such as RequireJS). But my personal preference is to using both AMD with RequireJS, and that&#39;s what the example project I&#39;ll show you will use.</p>
<p>I wont go into the details of what AMD is or how to use RequireJS, I&#39;ll instead point you to <a href="https://github.com/Integralist/Blog-Posts/blob/master/Beginners-guide-to-AMD-and-RequireJS.md">another article I&#39;ve written on the subject</a>.</p>
<h2><a name="scope-access"class="anchor" href="#scope-access"><span class="header-link"></span></a>Scope Access</h2>
<p>Because we&#39;re using AMD (which keeps our code self-contained so it doesn&#39;t introduce global variables) it can be awkward (in some situations) to share information across modules.</p>
<p>One thing I wanted to do recently was access a View instance from within another View. After reviewing the situation I found there were multiple ways to do this:</p>
<ul>
<li>Setting an instance property on the other View</li>
<li>Passing the View through as a property of the argument object when creating the other View</li>
<li>Adding a property to a global namespace</li>
</ul>
<p>…which option you go with depends on personal preference more than anything. I went with the second option.</p>
<h2><a name="project"class="anchor" href="#project"><span class="header-link"></span></a>Project</h2>
<p>The project we&#39;ll build is a basic Contact Manager. </p>
<p>The layout will be a <code>&lt;select&gt;</code> menu that is populated with some Contact names.</p>
<p>Selecting a Contact from the menu will display all details for that contact.</p>
<p>Next to the menu will be a form where we can add a new contact and once added it&#39;ll automatically appear within the menu for the user to select to view.</p>
<p>A finished version of this project can be found <a href="https://github.com/Integralist/Backbone-Playground">on my GitHub</a>.</p>
<h2><a name="set-up"class="anchor" href="#set-up"><span class="header-link"></span></a>Set-up</h2>
<p>Let&#39;s take a top level view of our directory structure…</p>
<ul>
<li>/Assets/<ul>
<li>/Includes/<ul>
<li>Contacts.php</li>
</ul>
</li>
<li>/Scripts/<ul>
<li>/App/<ul>
<li>main.js</li>
<li>namespace.js</li>
</ul>
</li>
<li>/Collections/<ul>
<li>Contacts.js</li>
</ul>
</li>
<li>/Models/<ul>
<li>Contact.js</li>
</ul>
</li>
<li>/Routes/<ul>
<li>Routing.js</li>
</ul>
</li>
<li>/Utils/<ul>
<li>backbone.js</li>
<li>jquery.js</li>
<li>lodash.js</li>
</ul>
</li>
<li>/Views/<ul>
<li>AddContact.js</li>
<li>Contact.js</li>
<li>Contacts.js</li>
</ul>
</li>
<li>require.js</li>
</ul>
</li>
<li>/Styles/<ul>
<li>styles.css</li>
</ul>
</li>
</ul>
</li>
<li>index.html</li>
</ul>
<h2><a name="architecture"class="anchor" href="#architecture"><span class="header-link"></span></a>Architecture</h2>
<h3><a name="html"class="anchor" href="#html"><span class="header-link"></span></a>HTML</h3>
<p>The HTML page <code>index.html</code> consists of a few different elements that we&#39;ll use as &#39;Views&#39;. </p>
<p>We have the <code>&lt;select&gt;</code> menu for displaying the initial list of Contacts, the <code>&lt;form&gt;</code> for allowing us to add more Contacts, and an empty <code>&lt;div&gt;</code> which will be used for displaying the full details of the selected contact.</p>
<p>The full HTML page looks like this...</p>
<pre><code class="lang-html"><div class="highlight"><pre>    <span class="cp">&lt;!doctype html&gt;</span>
    <span class="nt">&lt;html</span> <span class="na">dir=</span><span class="s">&quot;ltr&quot;</span> <span class="na">lang=</span><span class="s">&quot;en&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;head&gt;</span>
            <span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">&quot;utf-8&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">&quot;viewport&quot;</span> <span class="na">content=</span><span class="s">&quot;width=device-width, initial-scale=1&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">&quot;author&quot;</span> <span class="na">content=</span><span class="s">&quot;Mark McDonnell&quot;</span> <span class="nt">/&gt;</span>
            <span class="nt">&lt;title&gt;</span>Backbone.js<span class="nt">&lt;/title&gt;</span>
            <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">href=</span><span class="s">&quot;Assets/Styles/styles.css&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;/head&gt;</span>
        <span class="nt">&lt;body&gt;</span>
            <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;view-contacts&quot;</span><span class="nt">&gt;</span>
                <span class="nt">&lt;select&gt;</span>
                    <span class="nt">&lt;option&gt;</span>Please select a user<span class="nt">&lt;/option&gt;</span>
                <span class="nt">&lt;/select&gt;</span>
            <span class="nt">&lt;/div&gt;</span>

            <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;view-contact&quot;</span><span class="nt">&gt;&lt;/div&gt;</span>

            <span class="nt">&lt;form</span> <span class="na">id=</span><span class="s">&quot;view-add&quot;</span><span class="nt">&gt;</span>
                <span class="nt">&lt;p&gt;&lt;input</span> <span class="na">type=</span><span class="s">&quot;text&quot;</span> <span class="na">placeholder=</span><span class="s">&quot;Name&quot;</span> <span class="na">name=</span><span class="s">&quot;fullname&quot;</span><span class="nt">&gt;&lt;/p&gt;</span>
                <span class="nt">&lt;p&gt;&lt;input</span> <span class="na">type=</span><span class="s">&quot;text&quot;</span> <span class="na">placeholder=</span><span class="s">&quot;Age&quot;</span> <span class="na">maxlength=</span><span class="s">&quot;3&quot;</span> <span class="na">name=</span><span class="s">&quot;age&quot;</span><span class="nt">&gt;&lt;/p&gt;</span>
                <span class="nt">&lt;p&gt;&lt;input</span> <span class="na">type=</span><span class="s">&quot;text&quot;</span> <span class="na">placeholder=</span><span class="s">&quot;Address&quot;</span> <span class="na">name=</span><span class="s">&quot;address&quot;</span><span class="nt">&gt;&lt;/p&gt;</span>
                <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;submit&quot;</span> <span class="na">value=</span><span class="s">&quot;Add New Record&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;/form&gt;</span>

            <span class="nt">&lt;script </span><span class="na">data-main=</span><span class="s">&quot;Assets/Scripts/App/main&quot;</span> <span class="na">src=</span><span class="s">&quot;Assets/Scripts/require.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
            <span class="nt">&lt;script </span><span class="na">type=</span><span class="s">&quot;text/template&quot;</span> <span class="na">id=</span><span class="s">&quot;contact_template&quot;</span><span class="nt">&gt;</span>
                <span class="o">&lt;</span><span class="nx">dl</span><span class="o">&gt;</span>
                    <span class="o">&lt;</span><span class="nx">dt</span><span class="o">&gt;</span><span class="nx">ID</span><span class="o">&lt;</span><span class="err">/dt&gt;</span>
                    <span class="o">&lt;</span><span class="nx">dd</span><span class="o">&gt;&lt;%=</span><span class="nx">id</span><span class="o">%&gt;&lt;</span><span class="err">/dd&gt;</span>
                    <span class="o">&lt;</span><span class="nx">dt</span><span class="o">&gt;</span><span class="nx">Name</span><span class="o">&lt;</span><span class="err">/dt&gt;</span>
                    <span class="o">&lt;</span><span class="nx">dd</span><span class="o">&gt;&lt;%=</span><span class="nx">name</span><span class="o">%&gt;&lt;</span><span class="err">/dd&gt;</span>
                    <span class="o">&lt;</span><span class="nx">dt</span><span class="o">&gt;</span><span class="nx">Age</span><span class="o">&lt;</span><span class="err">/dt&gt;</span>
                    <span class="o">&lt;</span><span class="nx">dd</span><span class="o">&gt;&lt;%=</span><span class="nx">age</span><span class="o">%&gt;&lt;</span><span class="err">/dd&gt;</span>
                    <span class="o">&lt;</span><span class="nx">dt</span><span class="o">&gt;</span><span class="nx">Address</span><span class="o">&lt;</span><span class="err">/dt&gt;</span>
                    <span class="o">&lt;</span><span class="nx">dd</span><span class="o">&gt;&lt;%=</span><span class="nx">address</span><span class="o">%&gt;&lt;</span><span class="err">/dd&gt;</span>
                <span class="o">&lt;</span><span class="err">/dl&gt;</span>
            <span class="nt">&lt;/script&gt;</span>
        <span class="nt">&lt;/body&gt;</span>
    <span class="nt">&lt;/html&gt;</span>
</pre></div>
</code></pre>
<h3><a name="styles"class="anchor" href="#styles"><span class="header-link"></span></a>Styles</h3>
<p>The styles for this project are just basic - we&#39;re not worrying about design here… </p>
<pre><code class="lang-css"><div class="highlight"><pre>    <span class="nt">body</span> <span class="p">{</span>
        <span class="k">font</span><span class="o">:</span> <span class="k">normal</span> <span class="n">small</span> <span class="n">Arial</span><span class="o">,</span> <span class="n">Verdana</span><span class="o">,</span> <span class="k">sans-serif</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="nc">.hide</span> <span class="p">{</span>
        <span class="k">display</span><span class="o">:</span> <span class="k">none</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="nf">#view-add</span> <span class="p">{</span>
        <span class="k">border</span><span class="o">:</span> <span class="m">1px</span> <span class="k">solid</span> <span class="m">#999</span><span class="p">;</span>
        <span class="k">left</span><span class="o">:</span> <span class="m">350px</span><span class="p">;</span>
        <span class="k">padding-bottom</span><span class="o">:</span> <span class="m">10px</span><span class="p">;</span>
        <span class="k">padding-left</span><span class="o">:</span> <span class="m">10px</span><span class="p">;</span>
        <span class="k">position</span><span class="o">:</span> <span class="k">absolute</span><span class="p">;</span>
        <span class="k">top</span><span class="o">:</span> <span class="m">10px</span><span class="p">;</span>
        <span class="k">width</span><span class="o">:</span> <span class="m">166px</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="nf">#view-add</span> <span class="nt">div</span> <span class="p">{</span>
        <span class="k">background-color</span><span class="o">:</span> <span class="nb">green</span><span class="p">;</span>
        <span class="k">color</span><span class="o">:</span> <span class="m">#fff</span><span class="p">;</span>
        <span class="k">margin-right</span><span class="o">:</span> <span class="m">10px</span><span class="p">;</span>
        <span class="k">margin-top</span><span class="o">:</span> <span class="m">10px</span><span class="p">;</span>
        <span class="k">padding</span><span class="o">:</span> <span class="m">10px</span><span class="p">;</span>
    <span class="p">}</span>
</pre></div>
</code></pre>
<h3><a name="javascript"class="anchor" href="#javascript"><span class="header-link"></span></a>JavaScript</h3>
<p>RequireJS allows us to utilise just a single <code>&lt;script&gt;</code> tag which points to our main script file that contains the following structure… </p>
<pre><code class="lang-js"><div class="highlight"><pre>    <span class="nx">requirejs</span><span class="p">.</span><span class="nx">config</span><span class="p">({</span>
        <span class="nx">shim</span><span class="o">:</span> <span class="p">{</span>
            <span class="s1">&#39;../Utils/backbone&#39;</span><span class="o">:</span> <span class="p">{</span>
                <span class="nx">deps</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;../Utils/lodash&#39;</span><span class="p">,</span> <span class="s1">&#39;../Utils/jquery&#39;</span><span class="p">],</span> <span class="c1">// load dependencies</span>
                <span class="nx">exports</span><span class="o">:</span> <span class="s1">&#39;Backbone&#39;</span> <span class="c1">// use the global &#39;Backbone&#39; as the module value</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">});</span>

    <span class="nx">require</span><span class="p">([</span><span class="s1">&#39;../Models/Contact&#39;</span><span class="p">,</span> <span class="s1">&#39;../Collections/Contacts&#39;</span><span class="p">,</span> <span class="s1">&#39;../Views/Contacts&#39;</span><span class="p">,</span> <span class="s1">&#39;../Views/AddContact&#39;</span><span class="p">,</span> <span class="s1">&#39;../Views/Contact&#39;</span><span class="p">,</span> <span class="s1">&#39;../Routes/Routing&#39;</span><span class="p">],</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">Contact</span><span class="p">,</span> <span class="nx">Contacts</span><span class="p">,</span> <span class="nx">ContactsView</span><span class="p">,</span> <span class="nx">AddContactView</span><span class="p">,</span> <span class="nx">ContactView</span><span class="p">,</span> <span class="nx">Routing</span><span class="p">)</span> <span class="p">{</span>

        <span class="cm">/**</span>
<span class="cm">         * Model Generation Examples</span>
<span class="cm">         */</span>

        <span class="kd">var</span> <span class="nx">manager</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Contact</span><span class="p">({</span>
            <span class="nx">id</span><span class="o">:</span> <span class="nx">_</span><span class="p">.</span><span class="nx">uniqueId</span><span class="p">(),</span>
            <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;Mark McDonnell&#39;</span><span class="p">,</span>
            <span class="nx">age</span><span class="o">:</span> <span class="mi">30</span>
        <span class="p">});</span>

        <span class="kd">var</span> <span class="nx">developer</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Contact</span><span class="p">({</span>
            <span class="nx">id</span><span class="o">:</span> <span class="nx">_</span><span class="p">.</span><span class="nx">uniqueId</span><span class="p">(),</span>
            <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;Ashley Banks&#39;</span><span class="p">,</span>
            <span class="nx">age</span><span class="o">:</span> <span class="mi">23</span>
        <span class="p">});</span>

        <span class="c1">// The following few lines are used just to demonstrate the Backbone.js API</span>
        <span class="kd">var</span> <span class="nx">dev_name</span> <span class="o">=</span> <span class="nx">developer</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">);</span>
        <span class="kd">var</span> <span class="nx">dev_age</span> <span class="o">=</span> <span class="nx">developer</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;age&#39;</span><span class="p">);</span>

        <span class="nx">developer</span><span class="p">.</span><span class="nx">birthday</span><span class="p">();</span>

        <span class="c1">// The .toJSON() method is a Backbone specific Model/Collection method which returns js object of specified Model</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">dir</span><span class="p">(</span><span class="nx">manager</span><span class="p">.</span><span class="nx">toJSON</span><span class="p">())</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">dir</span><span class="p">(</span><span class="nx">developer</span><span class="p">.</span><span class="nx">toJSON</span><span class="p">());</span>


        <span class="cm">/**</span>
<span class="cm">         * Collection Generation Example</span>
<span class="cm">         */</span>

        <span class="kd">var</span> <span class="nx">contacts</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Contacts</span><span class="p">([</span><span class="nx">manager</span><span class="p">,</span> <span class="nx">developer</span><span class="p">]);</span>

        <span class="c1">// The .toJSON() method is a Backbone specific Model/Collection method which returns js object of specified Model</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">contacts</span><span class="p">.</span><span class="nx">toJSON</span><span class="p">());</span>


        <span class="cm">/**</span>
<span class="cm">         * View for &lt;select&gt; menu of Contacts</span>
<span class="cm">         */</span>

        <span class="kd">var</span> <span class="nx">contacts_view</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ContactsView</span><span class="p">({</span>
            <span class="nx">el</span><span class="o">:</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#view-contacts&#39;</span><span class="p">),</span>
            <span class="nx">collection</span><span class="o">:</span> <span class="nx">contacts</span><span class="p">,</span> <span class="c1">// pass in the Collection into this View</span>

            <span class="cm">/**</span>
<span class="cm">             * View for displaying the selected Contact</span>
<span class="cm">             *</span>
<span class="cm">             * Originally I had created a global namespace property so I could access this View&#39;s &quot;render()&quot; method from within &#39;contacts_view&#39; (/Views/Contacts.js)</span>
<span class="cm">             * And according to people smarter than I (i.e. Addy Osmani from Google) this was the most appropriate solution.</span>
<span class="cm">             * But I since discovered I could pass in additional data when creating a View instance and so that&#39;s what I&#39;ve done here.</span>
<span class="cm">             */</span>

            <span class="nx">associated_view</span><span class="o">:</span> <span class="k">new</span> <span class="nx">ContactView</span><span class="p">({</span>
                <span class="nx">el</span><span class="o">:</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#view-contact&#39;</span><span class="p">),</span>
                <span class="nx">collection</span><span class="o">:</span> <span class="nx">contacts</span>
            <span class="p">})</span>
        <span class="p">});</span>


        <span class="cm">/**</span>
<span class="cm">         * View for &lt;form&gt; to add a new Contact</span>
<span class="cm">         */</span>

        <span class="kd">var</span> <span class="nx">add_contact</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">AddContactView</span><span class="p">({</span>
            <span class="nx">el</span><span class="o">:</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#view-add&#39;</span><span class="p">),</span>
            <span class="nx">collection</span><span class="o">:</span> <span class="nx">contacts</span> <span class="c1">// pass in the Collection into this View</span>
        <span class="p">});</span>


        <span class="cm">/**</span>
<span class="cm">         * Lazy Load Models into Collection</span>
<span class="cm">         */</span>

        <span class="nx">contacts</span><span class="p">.</span><span class="nx">fetch</span><span class="p">({</span>
            <span class="nx">add</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span> <span class="c1">// Prevent resetting the Collection (i.e. instead or clearing the Collection first we just add new Models on top of current set of Models),</span>
            <span class="nx">error</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">collection</span><span class="p">,</span> <span class="nx">resp</span><span class="p">)</span> <span class="p">{</span>
                <span class="c1">// You can do something on error loading</span>
            <span class="p">},</span>
            <span class="nx">success</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">collection</span><span class="p">,</span> <span class="nx">resp</span><span class="p">)</span> <span class="p">{</span>
                <span class="c1">// You can do something on successful loading</span>
            <span class="p">}</span>
        <span class="p">});</span>


        <span class="cm">/**</span>
<span class="cm">         * Router/History API Examples</span>
<span class="cm">         */</span>

        <span class="c1">// Create new instance of our Routing Class</span>
        <span class="kd">var</span> <span class="nx">routing</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Routing</span><span class="p">();</span>

        <span class="c1">// Initialize the Router</span>
        <span class="nx">Backbone</span><span class="p">.</span><span class="nx">history</span><span class="p">.</span><span class="nx">start</span><span class="p">({</span> <span class="nx">pushState</span><span class="o">:</span> <span class="kc">true</span> <span class="p">});</span>

    <span class="p">});</span>
</pre></div>
</code></pre>
<p>…this breaks down to the following… </p>
<h3><a name="we-set-up-configurations-for-requirejs"class="anchor" href="#we-set-up-configurations-for-requirejs"><span class="header-link"></span></a>We set-up configurations for RequireJS</h3>
<p>Such as Backbone&#39;s dependencies - this is done using RequireJS&#39; <code>shim</code> feature for libraries that aren&#39;t AMD compatible.<br>&nbsp;<br>You&#39;ll also notice we aren&#39;t using the Underscore library, instead we&#39;re using Lo-dash which is a better performing/API compatible utility library.</p>
<pre><code class="lang-js"><div class="highlight"><pre>    <span class="nx">requirejs</span><span class="p">.</span><span class="nx">config</span><span class="p">({</span>
        <span class="nx">shim</span><span class="o">:</span> <span class="p">{</span>
            <span class="s1">&#39;../Utils/backbone&#39;</span><span class="o">:</span> <span class="p">{</span>
                <span class="nx">deps</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;../Utils/lodash&#39;</span><span class="p">,</span> <span class="s1">&#39;../Utils/jquery&#39;</span><span class="p">],</span> <span class="c1">// load dependencies</span>
                <span class="nx">exports</span><span class="o">:</span> <span class="s1">&#39;Backbone&#39;</span> <span class="c1">// use the global &#39;Backbone&#39; as the module value</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">});</span>
</pre></div>
</code></pre>
<h3><a name="specify-dependencies-and-execute-callback-function-once-all-are-loaded"class="anchor" href="#specify-dependencies-and-execute-callback-function-once-all-are-loaded"><span class="header-link"></span></a>Specify dependencies and execute callback function once all are loaded</h3>
<p>The dependencies we&#39;re loading are the relevant Models, Views, Collections required for this application to work - once loaded we can create new instances of them.</p>
<pre><code class="lang-js"><div class="highlight"><pre>    <span class="nx">require</span><span class="p">([</span><span class="s1">&#39;../Models/Contact&#39;</span><span class="p">,</span> <span class="s1">&#39;../Collections/Contacts&#39;</span><span class="p">,</span> <span class="s1">&#39;../Views/Contacts&#39;</span><span class="p">,</span> <span class="s1">&#39;../Views/AddContact&#39;</span><span class="p">,</span> <span class="s1">&#39;../Views/Contact&#39;</span><span class="p">,</span> <span class="s1">&#39;../Routes/Routing&#39;</span><span class="p">,</span> <span class="s1">&#39;../Utils/backbone&#39;</span><span class="p">],</span> 
    <span class="kd">function</span> <span class="p">(</span><span class="nx">Contact</span><span class="p">,</span> <span class="nx">Contacts</span><span class="p">,</span> <span class="nx">ContactsView</span><span class="p">,</span> <span class="nx">AddContactView</span><span class="p">,</span> <span class="nx">ContactView</span><span class="p">,</span> <span class="nx">Routing</span><span class="p">)</span> <span class="p">{</span>
</pre></div>
</code></pre>
<h3><a name="generate-some-data-for-the-initial-select-menu-population"class="anchor" href="#generate-some-data-for-the-initial-select-menu-population"><span class="header-link"></span></a>Generate some data for the initial <code>&lt;select&gt;</code> menu population</h3>
<p>We&#39;ve loaded the <code>Contact</code> Model and we create two new instances of it and pass in the relevant properties for the Model data.</p>
<pre><code class="lang-js"><div class="highlight"><pre>    <span class="cm">/**</span>
<span class="cm">     * Model Generation Examples</span>
<span class="cm">     */</span>

    <span class="kd">var</span> <span class="nx">manager</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Contact</span><span class="p">({</span>
        <span class="nx">id</span><span class="o">:</span> <span class="nx">_</span><span class="p">.</span><span class="nx">uniqueId</span><span class="p">(),</span>
        <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;Mark McDonnell&#39;</span><span class="p">,</span>
        <span class="nx">age</span><span class="o">:</span> <span class="mi">30</span>
    <span class="p">});</span>

    <span class="kd">var</span> <span class="nx">developer</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Contact</span><span class="p">({</span>
        <span class="nx">id</span><span class="o">:</span> <span class="nx">_</span><span class="p">.</span><span class="nx">uniqueId</span><span class="p">(),</span>
        <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;Ashley Banks&#39;</span><span class="p">,</span>
        <span class="nx">age</span><span class="o">:</span> <span class="mi">23</span>
    <span class="p">});</span>
</pre></div>
</code></pre>
<h3><a name="create-a-collection-that-will-hold-the-model-data-we-ve-just-created"class="anchor" href="#create-a-collection-that-will-hold-the-model-data-we-ve-just-created"><span class="header-link"></span></a>Create a Collection that will hold the Model data we&#39;ve just created</h3>
<p>Backbone lets us pass through an Array of Models to instantiate the Collection with</p>
<pre><code class="lang-js"><div class="highlight"><pre>    <span class="cm">/**</span>
<span class="cm">     * Collection Generation Example</span>
<span class="cm">     */</span>

    <span class="kd">var</span> <span class="nx">contacts</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Contacts</span><span class="p">([</span><span class="nx">manager</span><span class="p">,</span> <span class="nx">developer</span><span class="p">]);</span>
</pre></div>
</code></pre>
<h3><a name="create-the-view"class="anchor" href="#create-the-view"><span class="header-link"></span></a>Create the View</h3>
<p>You&#39;ll notice that when creating the view Backbone gives us the ability to pass in specific properties such as the HTML element we want to associate our View object with (in this case I&#39;m passing in the <code>&lt;select&gt;</code> element).  </p>
<p>Backbone also lets us specify a Collection for this View to be associated with (this is so we can watch for any events - such as a adding/removing Models - so we can keep the View in sync with any data changes)  </p>
<p>Lastly, we pass in a custom property I&#39;ve called <code>associated_view</code> and the value of this will be a new instance of <code>ContactView</code> (this View is the empty <code>&lt;div&gt;</code> which will be used to display the details of a specific record as selected by the user of our application). The reason I&#39;ve passed in this View into another View is because I want the <code>contacts_view</code> to have access to the <code>associated_view</code> so when the user selects a Contact we can easily tell <code>contacts_view</code> to render the selected Contact data.</p>
<pre><code class="lang-js"><div class="highlight"><pre>    <span class="cm">/**</span>
<span class="cm">     * View for &lt;select&gt; menu of Contacts</span>
<span class="cm">     */</span>

    <span class="kd">var</span> <span class="nx">contacts_view</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ContactsView</span><span class="p">({</span>
        <span class="nx">el</span><span class="o">:</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#view-contacts&#39;</span><span class="p">),</span>
        <span class="nx">collection</span><span class="o">:</span> <span class="nx">contacts</span><span class="p">,</span> <span class="c1">// pass in the Collection into this View</span>

        <span class="cm">/**</span>
<span class="cm">         * View for displaying the selected Contact</span>
<span class="cm">         */</span>

        <span class="nx">associated_view</span><span class="o">:</span> <span class="k">new</span> <span class="nx">ContactView</span><span class="p">({</span>
            <span class="nx">el</span><span class="o">:</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#view-contact&#39;</span><span class="p">),</span>
            <span class="nx">collection</span><span class="o">:</span> <span class="nx">contacts</span>
        <span class="p">})</span>
    <span class="p">});</span>
</pre></div>
</code></pre>
<h3><a name="create-a-view-for-the-form-that-will-create-new-model-data"class="anchor" href="#create-a-view-for-the-form-that-will-create-new-model-data"><span class="header-link"></span></a>Create a View for the <code>&lt;form&gt;</code> that will create new Model data</h3>
<p>What you&#39;ll probably notice is that out of the three Views we have created instances for, they all use the same <code>contacts</code> Collection.</p>
<pre><code class="lang-js"><div class="highlight"><pre>    <span class="cm">/**</span>
<span class="cm">     * View for &lt;form&gt; to add a new Contact</span>
<span class="cm">     */</span>

    <span class="kd">var</span> <span class="nx">add_contact</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">AddContactView</span><span class="p">({</span>
        <span class="nx">el</span><span class="o">:</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#view-add&#39;</span><span class="p">),</span>
        <span class="nx">collection</span><span class="o">:</span> <span class="nx">contacts</span>
    <span class="p">});</span>
</pre></div>
</code></pre>
<h3><a name="load-more-model-data-into-our-collection"class="anchor" href="#load-more-model-data-into-our-collection"><span class="header-link"></span></a>Load more Model data into our Collection</h3>
<p>We initially loaded some Model data into our Collection when starting our application, but now we&#39;re using a Backbone provided method called <code>fetch</code> which lets us grab more data from the server and populate our Collection with that server data.</p>
<pre><code class="lang-js"><div class="highlight"><pre>    <span class="cm">/**</span>
<span class="cm">     * Lazy Load Models into Collection</span>
<span class="cm">     */</span>

    <span class="nx">contacts</span><span class="p">.</span><span class="nx">fetch</span><span class="p">({</span>
        <span class="nx">add</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span> <span class="c1">// Prevent resetting the Collection (i.e. instead or clearing the Collection first we just add new Models on top of current set of Models),</span>
        <span class="nx">error</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">collection</span><span class="p">,</span> <span class="nx">resp</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// You can do something on error loading</span>
        <span class="p">},</span>
        <span class="nx">success</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">collection</span><span class="p">,</span> <span class="nx">resp</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// You can do something on successful loading</span>
        <span class="p">}</span>
    <span class="p">});</span>
</pre></div>
</code></pre>
<h3><a name="fetching-collection-data"class="anchor" href="#fetching-collection-data"><span class="header-link"></span></a>Fetching Collection Data</h3>
<p>In the previous section we used <code>contacts.fetch</code> to grab Model data from the server.</p>
<p>To be able to understand how it works we need to look at the Collection module now. </p>
<p>As we know in the main JavaScript file we required a load of dependencies such as Models, Views and Collections and the following is the Collection module we loaded - hopefully the comments will adequately explain what&#39;s going on… </p>
<pre><code class="lang-js"><div class="highlight"><pre>    <span class="c1">// This Collection requires the &#39;Contact&#39; Model and (obviously) Backbone</span>
    <span class="nx">define</span><span class="p">([</span><span class="s1">&#39;../Models/Contact&#39;</span><span class="p">,</span> <span class="s1">&#39;../Utils/backbone&#39;</span><span class="p">],</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">Contact</span><span class="p">)</span> <span class="p">{</span>

        <span class="c1">// We set-up a collection of Contact Models</span>
        <span class="c1">// This is so we can manipulate the group of Models more easily</span>
        <span class="kd">var</span> <span class="nx">Contacts</span> <span class="o">=</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">Collection</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
            <span class="c1">// Backbone specific property</span>
            <span class="nx">model</span><span class="o">:</span> <span class="nx">Contact</span><span class="p">,</span>

            <span class="c1">// Backbone specific property</span>
            <span class="nx">url</span><span class="o">:</span> <span class="s1">&#39;/Assets/Includes/Contacts.php&#39;</span><span class="p">,</span>

            <span class="c1">// Backbone specific method</span>
            <span class="nx">initialize</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
                <span class="c1">// Collections fire the events &#39;add&#39; and &#39;remove&#39;</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;add&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">model_added</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>
            <span class="p">},</span>

            <span class="nx">model_added</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">model</span><span class="p">)</span> <span class="p">{</span>
                <span class="c1">// The View listens out for &#39;model:added&#39;</span>
                <span class="c1">// Once it hears it, it updates the &lt;select&gt; menu to include the latest Model</span>
                <span class="c1">// We pass the latest Model through from here...</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s1">&#39;model:added&#39;</span><span class="p">,</span> <span class="nx">model</span><span class="p">);</span>
            <span class="p">},</span>

            <span class="c1">// We can&#39;t trigger a custom event from within the &#39;initialize&#39; method</span>
            <span class="c1">// because the View listener wont be ready/set-up yet!</span>
            <span class="c1">// So we have to stick it inside a separate method which I call after I set-up the associated View</span>
            <span class="nx">populate</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s1">&#39;contacts:populate&#39;</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">});</span>

        <span class="k">return</span> <span class="nx">Contacts</span><span class="p">;</span>

    <span class="p">});</span>
</pre></div>
</code></pre>
<p>You&#39;ll notice this Collection uses the Backbone specific property <code>url</code> which we&#39;ve pointed to a PHP script (you would replace this with whatever back-end you prefer to use: Ruby, Python, ASP.NET etc). </p>
<p>The PHP script we&#39;re using would normally connect to a database and return its data converted into JSON (JSON is the perfect data format for Backbone to process). But in this example we&#39;re simply just manually creating data and converting it to JSON… </p>
<pre><code class="lang-php"><div class="highlight"><pre><span class="x">    </span><span class="cp">&lt;?php</span>
        <span class="nv">$json</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
            <span class="k">array</span><span class="p">(</span>
                <span class="s2">&quot;id&quot;</span> <span class="o">=&gt;</span> <span class="mi">99</span><span class="p">,</span>
                <span class="s2">&quot;name&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;Joe Bloggs&quot;</span><span class="p">,</span>
                <span class="s2">&quot;age&quot;</span> <span class="o">=&gt;</span> <span class="mi">12</span><span class="p">,</span> 
                <span class="s2">&quot;address&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;9 Cables Street, London&quot;</span><span class="p">,</span>
                <span class="s2">&quot;role&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;Manager&quot;</span>
            <span class="p">),</span>
            <span class="k">array</span><span class="p">(</span>
                <span class="s2">&quot;id&quot;</span> <span class="o">=&gt;</span> <span class="mi">98</span><span class="p">,</span>
                <span class="s2">&quot;name&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;Dan Smith&quot;</span><span class="p">,</span>
                <span class="s2">&quot;age&quot;</span> <span class="o">=&gt;</span> <span class="mi">23</span><span class="p">,</span> 
                <span class="s2">&quot;address&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;Bambridge Road, Essex&quot;</span><span class="p">,</span>
                <span class="s2">&quot;role&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;Developer&quot;</span>
            <span class="p">),</span>
            <span class="k">array</span><span class="p">(</span>
                <span class="s2">&quot;id&quot;</span> <span class="o">=&gt;</span> <span class="mi">97</span><span class="p">,</span>
                <span class="s2">&quot;name&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;Bradley Few&quot;</span><span class="p">,</span>
                <span class="s2">&quot;age&quot;</span> <span class="o">=&gt;</span> <span class="mi">22</span><span class="p">,</span> 
                <span class="s2">&quot;address&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;Meeson Mead, Leads&quot;</span><span class="p">,</span>
                <span class="s2">&quot;role&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;Developer&quot;</span>
            <span class="p">)</span>
        <span class="p">);</span>

        <span class="k">echo</span> <span class="nb">json_encode</span><span class="p">(</span><span class="nv">$json</span><span class="p">);</span>
    <span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</code></pre>
<p>…Backbone.js then populates the Collection with the new data it has &#39;fetched&#39; from the server application.</p>
<p>You may have also noticed that back in our main JavaScript file (when we called the <code>fetch</code> method) we had specified a property called <code>add</code> and set its value to <code>true</code>. The reason we did this was because if we left that property out then when Backbone fetched the data from the server it would have cleared our Collection of all Model data and replaced it with the data from the server. Setting <code>add: true</code> means we don&#39;t overwrite any existing data but instead add the data on top of what&#39;s already there.</p>
<h3><a name="model-structure"class="anchor" href="#model-structure"><span class="header-link"></span></a>Model Structure</h3>
<p>So far we have a main script file where we have created new instances of some Backbone Views as well as created a Backbone Collection. We&#39;ve populated that Collection with specific Model data, but now lets look at the Model itself that we&#39;ve been using to construct our data from… </p>
<pre><code class="lang-js"><div class="highlight"><pre>    <span class="nx">define</span><span class="p">([</span><span class="s1">&#39;../Utils/backbone&#39;</span><span class="p">],</span> <span class="kd">function</span><span class="p">(){</span>

        <span class="kd">var</span> <span class="nx">Contact</span> <span class="o">=</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">Model</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
            <span class="c1">// Backbone specific object</span>
            <span class="nx">defaults</span><span class="o">:</span> <span class="p">{</span>
                <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;No name provided&#39;</span><span class="p">,</span>
                <span class="nx">age</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
                <span class="nx">address</span><span class="o">:</span> <span class="s1">&#39;No address provided&#39;</span>
            <span class="p">},</span>

            <span class="c1">// Backbone specific method</span>
            <span class="nx">initialize</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
                <span class="c1">// Syntax: .on(type:property)</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;change:age&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(){</span>
                    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;\&#39;s age changed to &#39;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;age&#39;</span><span class="p">));</span>
                <span class="p">});</span>

                <span class="k">this</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">model</span><span class="p">,</span> <span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">console</span><span class="p">.</span><span class="nx">warn</span><span class="p">(</span><span class="s1">&#39;Error:&#39;</span><span class="p">,</span> <span class="nx">model</span><span class="p">,</span> <span class="nx">error</span><span class="p">);</span>
                <span class="p">});</span>
            <span class="p">},</span>

            <span class="c1">// Backbone specific method</span>
            <span class="nx">validate</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">attributes</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">attributes</span><span class="p">.</span><span class="nx">id</span> <span class="o">||</span> <span class="nx">attributes</span><span class="p">.</span><span class="nx">id</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">return</span> <span class="s1">&#39;An error has occurred? There should be an id generated!&#39;</span><span class="p">;</span>
                <span class="p">}</span>

                <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">attributes</span><span class="p">.</span><span class="nx">age</span> <span class="o">!=</span> <span class="s1">&#39;number&#39;</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">return</span> <span class="s1">&#39;Age needs to be a number&#39;</span><span class="p">;</span>
                <span class="p">}</span>
            <span class="p">},</span>

            <span class="nx">birthday</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
                <span class="kd">var</span> <span class="nx">age</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;age&#39;</span><span class="p">);</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">set</span><span class="p">({</span> <span class="s1">&#39;age&#39;</span><span class="o">:</span> <span class="o">++</span><span class="nx">age</span> <span class="p">});</span>
            <span class="p">}</span>
        <span class="p">});</span>

        <span class="k">return</span> <span class="nx">Contact</span><span class="p">;</span>

    <span class="p">});</span>
</pre></div>
</code></pre>
<p>…as you can see the only dependency this module has is Backbone.js itself. Don&#39;t worry about specifying Backbone.js in each module, when we run a build script using RequireJS&#39; optimisation tool it&#39;ll only load one instance of Backbone. </p>
<p>The reason we specify Backbone as a dependency in each of these module files (rather than just specifying it once in the top level main script file) is because if we decided to reuse this specific module in another project then it would be crystal clear what dependencies it has (I know in this example if you saw <code>Backbone.Model</code> then it would seem pretty obvious that Backbone.js would need to be loaded, but doing this is just good practice because some modules can have lots of dependencies and they wont always be that obvious, so it&#39;s best to get into the habit of specifying all dependencies for the sake of helpfulness).</p>
<p>Let&#39;s now break down the specific sections of the Model we&#39;ve created:</p>
<h3><a name="first-we-specify-default-values"class="anchor" href="#first-we-specify-default-values"><span class="header-link"></span></a>First we specify default values</h3>
<p>This is in case (when creating a new Model instance) we don&#39;t have all the values readily available</p>
<pre><code class="lang-js"><div class="highlight"><pre>    <span class="nx">defaults</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;No name provided&#39;</span><span class="p">,</span>
        <span class="nx">age</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="nx">address</span><span class="o">:</span> <span class="s1">&#39;No address provided&#39;</span>
    <span class="p">}</span>
</pre></div>
</code></pre>
<h3><a name="carry-out-some-initial-set-up-stuff-when-a-new-instance-is-created"class="anchor" href="#carry-out-some-initial-set-up-stuff-when-a-new-instance-is-created"><span class="header-link"></span></a>Carry out some initial set-up stuff when a new instance is created</h3>
<p>In this example we want to set-up some event listeners for when the <code>age</code> property is changed as well as when an error occurs.</p>
<pre><code class="lang-js"><div class="highlight"><pre>    <span class="nx">initialize</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
        <span class="c1">// Syntax: .on(type:property)</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;change:age&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(){</span>
            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;\&#39;s age changed to &#39;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;age&#39;</span><span class="p">));</span>
        <span class="p">});</span>

        <span class="k">this</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">model</span><span class="p">,</span> <span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">console</span><span class="p">.</span><span class="nx">warn</span><span class="p">(</span><span class="s1">&#39;Error:&#39;</span><span class="p">,</span> <span class="nx">model</span><span class="p">,</span> <span class="nx">error</span><span class="p">);</span>
        <span class="p">});</span>
    <span class="p">}</span>
</pre></div>
</code></pre>
<h3><a name="validate-data-before-actually-making-any-changes"class="anchor" href="#validate-data-before-actually-making-any-changes"><span class="header-link"></span></a>Validate data before actually making any changes</h3>
<p>Backbone.js provides a <code>validate</code> method that returns your own specified error message.<br>If the function doesn&#39;t return any value then it is assumed the data is valid.<br>If the function returns <em>any thing</em> then whatever was returned is used as the error message.</p>
<pre><code class="lang-js"><div class="highlight"><pre>    <span class="nx">validate</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">attributes</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">attributes</span><span class="p">.</span><span class="nx">id</span> <span class="o">||</span> <span class="nx">attributes</span><span class="p">.</span><span class="nx">id</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="s1">&#39;An error has occurred? There should be an id generated!&#39;</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">attributes</span><span class="p">.</span><span class="nx">age</span> <span class="o">!=</span> <span class="s1">&#39;number&#39;</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="s1">&#39;Age needs to be a number&#39;</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
</pre></div>
</code></pre>
<h3><a name="create-a-custom-birthday-method"class="anchor" href="#create-a-custom-birthday-method"><span class="header-link"></span></a>Create a custom <code>birthday</code> method</h3>
<p>We use two Backbone methods: <code>get</code> and <code>set</code> to increment the age of the user.<br>First we <code>get</code> the current age, then we <code>set</code> the age using the prefixed <code>++</code> increment operator</p>
<pre><code class="lang-js"><div class="highlight"><pre>    <span class="nx">birthday</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
        <span class="kd">var</span> <span class="nx">age</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;age&#39;</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">set</span><span class="p">({</span> <span class="s1">&#39;age&#39;</span><span class="o">:</span> <span class="o">++</span><span class="nx">age</span> <span class="p">});</span>
    <span class="p">}</span>
</pre></div>
</code></pre>
<p>So in our main script file you&#39;ll remember we used this custom method like so… </p>
<pre><code class="lang-js"><div class="highlight"><pre>    <span class="c1">// Create a new Model instance</span>
    <span class="kd">var</span> <span class="nx">developer</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Contact</span><span class="p">({</span>
        <span class="nx">id</span><span class="o">:</span> <span class="nx">_</span><span class="p">.</span><span class="nx">uniqueId</span><span class="p">(),</span>
        <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;Ashley Banks&#39;</span><span class="p">,</span>
        <span class="nx">age</span><span class="o">:</span> <span class="mi">23</span>
    <span class="p">});</span>

    <span class="c1">// Now effectively set the user&#39;s age to 24</span>
    <span class="c1">// i.e. the age was 23 and calling `birthday()` increments the age by one</span>
    <span class="nx">developer</span><span class="p">.</span><span class="nx">birthday</span><span class="p">();</span>
</pre></div>
</code></pre>
<h3><a name="view-structures"class="anchor" href="#view-structures"><span class="header-link"></span></a>View Structures</h3>
<p>So again, in our main script file we have created three new View instances. Lets now take a look at each of the View files so we can see what they&#39;re doing and how they work.</p>
<p>If you remember from our main script file we created the following View (well, this is two Views, one inside another)…</p>
<pre><code class="lang-js"><div class="highlight"><pre>    <span class="cm">/**</span>
<span class="cm">     * View for &lt;select&gt; menu of Contacts</span>
<span class="cm">     */</span>

    <span class="kd">var</span> <span class="nx">contacts_view</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ContactsView</span><span class="p">({</span>
        <span class="nx">el</span><span class="o">:</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#view-contacts&#39;</span><span class="p">),</span>
        <span class="nx">collection</span><span class="o">:</span> <span class="nx">contacts</span><span class="p">,</span> <span class="c1">// pass in the Collection into this View</span>

        <span class="cm">/**</span>
<span class="cm">         * View for displaying the selected Contact</span>
<span class="cm">         *</span>
<span class="cm">         * Originally I had created a global namespace property so I could access this View&#39;s &quot;render()&quot; method from within &#39;contacts_view&#39; (/Views/Contacts.js)</span>
<span class="cm">         * And according to people smarter than I (i.e. Addy Osmani from Google) this was the most appropriate solution.</span>
<span class="cm">         * But I since discovered I could pass in additional data when creating a View instance and so that&#39;s what I&#39;ve done here.</span>
<span class="cm">         */</span>

        <span class="nx">associated_view</span><span class="o">:</span> <span class="k">new</span> <span class="nx">ContactView</span><span class="p">({</span>
            <span class="nx">el</span><span class="o">:</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#view-contact&#39;</span><span class="p">),</span>
            <span class="nx">collection</span><span class="o">:</span> <span class="nx">contacts</span>
        <span class="p">})</span>
    <span class="p">});</span>
</pre></div>
</code></pre>
<p>…the <code>contacts_view</code> was the <code>&lt;select&gt;</code> menu that held a list of names. The idea being the user selected a name from the list and the details for the selected user was displayed on the page.</p>
<p>So let&#39;s take a look at that particular View file… </p>
<pre><code class="lang-js"><div class="highlight"><pre>    <span class="nx">define</span><span class="p">([</span><span class="s1">&#39;../Utils/backbone&#39;</span><span class="p">],</span> <span class="kd">function</span><span class="p">(){</span>

        <span class="kd">var</span> <span class="nx">ContactsView</span> <span class="o">=</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">View</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
            <span class="c1">// Backbone specific method</span>
            <span class="nx">initialize</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">select</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;select&#39;</span><span class="p">);</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">collection</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;contacts:populate&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">populate</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">collection</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;model:added&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">update</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">collection</span><span class="p">.</span><span class="nx">populate</span><span class="p">();</span> <span class="c1">// when this completes it triggers the custom event &#39;contacts:populate&#39;</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">associated_view</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">associated_view</span><span class="p">;</span>
            <span class="p">},</span>

            <span class="c1">// Backbone specific &#39;events&#39; management only applies to DOM elements (as this is a &#39;View&#39; after all)</span>
            <span class="c1">// other custom events triggered are handled via &#39;this.on&#39; within the initialize method </span>
            <span class="c1">// because of this we have to use &#39;this.on&#39; within a &#39;Collection&#39;</span>
            <span class="nx">events</span><span class="o">:</span> <span class="p">{</span>
                <span class="s1">&#39;change select&#39;</span><span class="o">:</span> <span class="s1">&#39;display_selected&#39;</span>
            <span class="p">},</span>

            <span class="nx">populate</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
                <span class="kd">var</span> <span class="nx">select</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">select</span><span class="p">;</span> <span class="c1">// scope of this changes within &#39;each&#39; (refers to same thing as the &#39;model&#39; argument)</span>
                <span class="kd">var</span> <span class="nx">frag</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
                <span class="kd">var</span> <span class="nx">option</span><span class="p">;</span>

                <span class="k">this</span><span class="p">.</span><span class="nx">collection</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">model</span><span class="p">){</span>
                    <span class="nx">option</span> <span class="o">=</span> <span class="s1">&#39;&lt;option value=&quot;&#39;</span> <span class="o">+</span> <span class="nx">model</span><span class="p">.</span><span class="nx">cid</span> <span class="o">+</span> <span class="s1">&#39;&quot;&gt;&#39;</span> <span class="o">+</span> <span class="nx">model</span><span class="p">.</span><span class="nx">attributes</span><span class="p">.</span><span class="nx">name</span> <span class="o">+</span> <span class="s1">&#39;&lt;/option&gt;&#39;</span><span class="p">;</span>
                    <span class="nx">frag</span> <span class="o">+=</span> <span class="nx">option</span><span class="p">;</span>
                <span class="p">},</span> <span class="k">this</span><span class="p">);</span>

                <span class="c1">// We could of had the &#39;append&#39; calls within the loop</span>
                <span class="c1">// but that would have meant multiple DOM interactions</span>
                <span class="nx">select</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="nx">frag</span><span class="p">);</span>
            <span class="p">},</span>

            <span class="nx">display_selected</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
                <span class="kd">var</span> <span class="nx">targ</span> <span class="o">=</span> <span class="nx">event</span><span class="p">.</span><span class="nx">target</span><span class="p">;</span>
                <span class="kd">var</span> <span class="nx">selected_option</span> <span class="o">=</span> <span class="nx">targ</span><span class="p">.</span><span class="nx">options</span><span class="p">[</span><span class="nx">targ</span><span class="p">.</span><span class="nx">selectedIndex</span><span class="p">];</span>
                <span class="kd">var</span> <span class="nx">model</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">collection</span><span class="p">.</span><span class="nx">getByCid</span><span class="p">(</span><span class="nx">selected_option</span><span class="p">.</span><span class="nx">value</span><span class="p">);</span>

                <span class="c1">// We call the &#39;render&#39; method on the associated View we passed through when creating this View&#39;s instance</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">associated_view</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="nx">model</span><span class="p">);</span>
            <span class="p">},</span>

            <span class="c1">// &#39;model&#39; is passed through from Collection</span>
            <span class="nx">update</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">model</span><span class="p">)</span> <span class="p">{</span>
                <span class="kd">var</span> <span class="nx">select</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;select&#39;</span><span class="p">);</span>
                <span class="kd">var</span> <span class="nx">option</span> <span class="o">=</span> <span class="s1">&#39;&lt;option value=&quot;&#39;</span> <span class="o">+</span> <span class="nx">model</span><span class="p">.</span><span class="nx">cid</span> <span class="o">+</span> <span class="s1">&#39;&quot;&gt;&#39;</span> <span class="o">+</span> <span class="nx">model</span><span class="p">.</span><span class="nx">attributes</span><span class="p">.</span><span class="nx">name</span> <span class="o">+</span> <span class="s1">&#39;&lt;/option&gt;&#39;</span><span class="p">;</span>
                <span class="nx">select</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="nx">option</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">});</span>

        <span class="k">return</span> <span class="nx">ContactsView</span><span class="p">;</span>

    <span class="p">});</span>
</pre></div>
</code></pre>
<p>…and let&#39;s break down what it&#39;s doing… </p>
<h3><a name="carry-out-some-initial-set-up-stuff-when-a-new-instance-is-created"class="anchor" href="#carry-out-some-initial-set-up-stuff-when-a-new-instance-is-created"><span class="header-link"></span></a>Carry out some initial set-up stuff when a new instance is created</h3>
<p>A few things going on here:  </p>
<p>We first grab the <code>&lt;select&gt;</code> element using Backbone&#39;s <code>$el</code> property (this property references the element we passed through to the View&#39;s <code>extend</code> method when creating a new instance. It&#39;s effectively a jQuery wrapped version of the element - which is why we&#39;re able to use jQuery&#39;s <code>find</code> method.  </p>
<p>Next we set-up a couple of event listeners (for custom events) - you&#39;ll remember the Collection triggers the custom events like so <code>this.trigger(&#39;model:added&#39;, model);</code> and <code>this.trigger(&#39;contacts:populate&#39;);</code>.  </p>
<p>This is where it gets a little weird I&#39;m afraid. We now call the Collection&#39;s custom <code>populate</code> method. That method does literally nothing other than trigger the custom event <code>contacts:populate</code>. The reason that method even exists (and why we&#39;re calling it) is because we only want to populate the <code>&lt;select&gt;</code> menu when we know there is data available! We weren&#39;t able to trigger a custom event from the Collections <code>initialize</code> method (which would have been ideal, because once the Collection instance is created would have been a good time to trigger the custom event) and so we&#39;ve had to create our own method within the Collection which we manually call from this View. It&#39;s a bit &quot;arse about face&quot; but that&#39;s just the way it is.  </p>
<p>Lastly we create a property for this instance that points to another View. The reason we do this is because later on in this View&#39;s <code>display_selected</code> method we need to call the associated View&#39;s <code>render</code> method.  </p>
<p>Because we&#39;re using AMD we&#39;ve made our Views into separate modules/files, but because of this we aren&#39;t able to access code outside of a module (our module&#39;s code is protected) - so we&#39;re unable to access the <code>ContactView</code> View unless we pass around a reference to it like we&#39;ve done here.</p>
<pre><code class="lang-js"><div class="highlight"><pre>    <span class="nx">initialize</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">select</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;select&#39;</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">collection</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;contacts:populate&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">populate</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">collection</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;model:added&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">update</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">collection</span><span class="p">.</span><span class="nx">populate</span><span class="p">();</span> <span class="c1">// when this completes it triggers the custom event &#39;contacts:populate&#39;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">associated_view</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">associated_view</span><span class="p">;</span>
    <span class="p">}</span>
</pre></div>
</code></pre>
<h3><a name="define-some-events"class="anchor" href="#define-some-events"><span class="header-link"></span></a>Define some events</h3>
<p>We specify a &#39;change&#39; event for the <code>&lt;select&gt;</code> element<br>which when triggered executes the <code>display_selected</code> method we&#39;ve created for this View.</p>
<pre><code class="lang-js"><div class="highlight"><pre>    <span class="nx">events</span><span class="o">:</span> <span class="p">{</span>
        <span class="s1">&#39;change select&#39;</span><span class="o">:</span> <span class="s1">&#39;display_selected&#39;</span>
    <span class="p">}</span>
</pre></div>
</code></pre>
<h3><a name="custom-populate-function"class="anchor" href="#custom-populate-function"><span class="header-link"></span></a>Custom <code>populate</code> function</h3>
<p>This method builds up the content of the <code>&lt;select&gt;</code> menu.<br>It does this by looping through the Collection data and accessing each individual Model stored within it.<br>You&#39;ll notice that we set the value of each <code>&lt;option&gt;</code> element to be whatever the <code>cid</code> value for the Model is (the <code>cid</code> value is set automatically by Backbone on each Model)</p>
<pre><code class="lang-js"><div class="highlight"><pre>    <span class="nx">populate</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
        <span class="kd">var</span> <span class="nx">select</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">select</span><span class="p">;</span> <span class="c1">// scope of this changes within &#39;each&#39; (refers to same thing as the &#39;model&#39; argument)</span>
        <span class="kd">var</span> <span class="nx">frag</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
        <span class="kd">var</span> <span class="nx">option</span><span class="p">;</span>

       <span class="k">this</span><span class="p">.</span><span class="nx">collection</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">model</span><span class="p">){</span>
            <span class="nx">option</span> <span class="o">=</span> <span class="s1">&#39;&lt;option value=&quot;&#39;</span> <span class="o">+</span> <span class="nx">model</span><span class="p">.</span><span class="nx">cid</span> <span class="o">+</span> <span class="s1">&#39;&quot;&gt;&#39;</span> <span class="o">+</span> <span class="nx">model</span><span class="p">.</span><span class="nx">attributes</span><span class="p">.</span><span class="nx">name</span> <span class="o">+</span> <span class="s1">&#39;&lt;/option&gt;&#39;</span><span class="p">;</span>
            <span class="nx">frag</span> <span class="o">+=</span> <span class="nx">option</span><span class="p">;</span>
        <span class="p">},</span> <span class="k">this</span><span class="p">);</span>

        <span class="c1">// We could of had the &#39;append&#39; calls within the loop</span>
        <span class="c1">// but that would have meant multiple DOM interactions</span>
        <span class="nx">select</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="nx">frag</span><span class="p">);</span>
    <span class="p">}</span>
</pre></div>
</code></pre>
<h3><a name="custom-display_selected-function"class="anchor" href="#custom-display_selected-function"><span class="header-link"></span></a>Custom <code>display_selected</code> function</h3>
<p>This methods works out which menu item was selected and then<br>uses a Backbone specific method <code>getByCid</code> to access the required Model.<br>We then call the <code>ContactView</code>&#39;s <code>render</code> method and pass through the Model data that needs to be rendered.</p>
<pre><code class="lang-js"><div class="highlight"><pre>    <span class="nx">display_selected</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">targ</span> <span class="o">=</span> <span class="nx">event</span><span class="p">.</span><span class="nx">target</span><span class="p">;</span>
        <span class="kd">var</span> <span class="nx">selected_option</span> <span class="o">=</span> <span class="nx">targ</span><span class="p">.</span><span class="nx">options</span><span class="p">[</span><span class="nx">targ</span><span class="p">.</span><span class="nx">selectedIndex</span><span class="p">];</span>
        <span class="kd">var</span> <span class="nx">model</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">collection</span><span class="p">.</span><span class="nx">getByCid</span><span class="p">(</span><span class="nx">selected_option</span><span class="p">.</span><span class="nx">value</span><span class="p">);</span>

        <span class="c1">// We call the &#39;render&#39; method on the associated View we passed through when creating this View&#39;s instance</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">associated_view</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="nx">model</span><span class="p">);</span>
    <span class="p">}</span>
</pre></div>
</code></pre>
<h3><a name="custom-update-function"class="anchor" href="#custom-update-function"><span class="header-link"></span></a>Custom <code>update</code> function</h3>
<p>Every time a Model is added to the Collection it triggers an <code>model:added</code> event.<br>This event causes the View&#39;s <code>update</code> method to be executed, which inserts the new Model directly into the <code>&lt;select&gt;</code> menu.</p>
<pre><code class="lang-js"><div class="highlight"><pre>    <span class="nx">update</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">model</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">select</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;select&#39;</span><span class="p">);</span>
        <span class="kd">var</span> <span class="nx">option</span> <span class="o">=</span> <span class="s1">&#39;&lt;option value=&quot;&#39;</span> <span class="o">+</span> <span class="nx">model</span><span class="p">.</span><span class="nx">cid</span> <span class="o">+</span> <span class="s1">&#39;&quot;&gt;&#39;</span> <span class="o">+</span> <span class="nx">model</span><span class="p">.</span><span class="nx">attributes</span><span class="p">.</span><span class="nx">name</span> <span class="o">+</span> <span class="s1">&#39;&lt;/option&gt;&#39;</span><span class="p">;</span>
        <span class="nx">select</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="nx">option</span><span class="p">);</span>
    <span class="p">}</span>
</pre></div>
</code></pre>
<h3><a name="template-for-the-associated-view"class="anchor" href="#template-for-the-associated-view"><span class="header-link"></span></a>Template for the Associated View</h3>
<p>Let&#39;s take a look at the associated View that we created…</p>
<pre><code class="lang-js"><div class="highlight"><pre>    <span class="nx">define</span><span class="p">([</span><span class="s1">&#39;../Utils/backbone&#39;</span><span class="p">],</span> <span class="kd">function</span><span class="p">(){</span>

        <span class="kd">var</span> <span class="nx">ContactView</span> <span class="o">=</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">View</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
            <span class="nx">render</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">model</span><span class="p">)</span> <span class="p">{</span>
                <span class="kd">var</span> <span class="nx">model</span> <span class="o">=</span> <span class="nx">model</span> <span class="o">||</span> <span class="k">this</span><span class="p">.</span><span class="nx">collection</span><span class="p">.</span><span class="nx">models</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
                <span class="kd">var</span> <span class="nx">attributes</span> <span class="o">=</span> <span class="nx">model</span><span class="p">.</span><span class="nx">attributes</span><span class="p">;</span>
                <span class="kd">var</span> <span class="nx">template</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#contact_template&#39;</span><span class="p">);</span>
                <span class="kd">var</span> <span class="nx">compile</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">template</span><span class="p">(</span><span class="nx">template</span><span class="p">.</span><span class="nx">html</span><span class="p">(),</span> <span class="p">{</span>
                    <span class="nx">id</span><span class="o">:</span> <span class="nx">attributes</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span>
                    <span class="nx">name</span><span class="o">:</span> <span class="nx">attributes</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span>
                    <span class="nx">age</span><span class="o">:</span> <span class="nx">attributes</span><span class="p">.</span><span class="nx">age</span><span class="p">,</span>
                    <span class="nx">address</span><span class="o">:</span> <span class="nx">attributes</span><span class="p">.</span><span class="nx">address</span>
                <span class="p">});</span>

                <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">html</span><span class="p">(</span><span class="nx">compile</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">});</span>

        <span class="k">return</span> <span class="nx">ContactView</span><span class="p">;</span>

    <span class="p">});</span>
</pre></div>
</code></pre>
<p>…as you can see: it&#39;s a lot simpler! All it consists of is a <code>render</code> method.</p>
<p>The purpose of this View is to display the selected contact details.</p>
<p>When this method is called we pass it the Model that we want to display and then we use Underscore&#39;s <code>_.template</code> method to render the data in HTML.</p>
<p>If you&#39;ve not used a template library before then it simply is just a text file which contains HTML tags where the dynamic content areas are replaced with specific delimiter tags. You would then pass through an object of data to the template library in which is would use to compile the template&#39;s HTML content so its tags are replaced with content from the data object.</p>
<p>For example, if the template was <code>&lt;p&gt;{{fullname}}&lt;/p&gt;</code> (this assumes the template library you&#39;re using requires the delimiter tags to be double braces <code>{ {</code> <code>}}</code> then you could pass in a data object like <code>{ fullname: &#39;Mark&#39; }</code> and then when the template is compiled it would return the HTML like this: <code>&lt;p&gt;Mark&lt;/p&gt;</code>.</p>
<p>Underscore&#39;s <code>_.template</code> method uses different tags: <code>&lt;%=fullname%&gt;</code> and although the internal workings for each template library can be different (each one trying to out perform the other) the general principle of how they work stays the same.</p>
<p>In this example we&#39;ve gotten the content of the template file from within the HTML page itself. If you remember, the main HTML page we had contained a <code>&lt;script&gt;</code> tag with the <code>type</code> attribute value set to <code>text/template</code>. This odd type value causes the browser to ignore it (a browser wont try to execute the HTML content within that script tag as JavaScript because it doesn&#39;t recognise the type value). </p>
<p>Ideally though you&#39;d have the template content as a separate file and then AJAX in that template file. The reason I recommend keeping your template in a separate file is because relying on the browser to not execute a script just because it has an unknown attribute value is very fragile and likely to break in future, but for the purpose of this example it&#39;ll do.</p>
<h3><a name="adding-a-new-model"class="anchor" href="#adding-a-new-model"><span class="header-link"></span></a>Adding a new Model</h3>
<p>We have one more View left to look at, this is the HTML <code>&lt;form&gt;</code> element which lets us add a new contact to the list of contacts…</p>
<pre><code class="lang-js"><div class="highlight"><pre>    <span class="nx">define</span><span class="p">([</span><span class="s1">&#39;../Models/Contact&#39;</span><span class="p">,</span> <span class="s1">&#39;../Utils/backbone&#39;</span><span class="p">],</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">Contact</span><span class="p">)</span> <span class="p">{</span>

        <span class="kd">var</span> <span class="nx">AddContactView</span> <span class="o">=</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">View</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
            <span class="c1">// Built-in object for handling DOM events</span>
            <span class="nx">events</span><span class="o">:</span> <span class="p">{</span>
                <span class="s1">&#39;click input[type=submit]&#39;</span><span class="o">:</span> <span class="s1">&#39;add_contact&#39;</span>
            <span class="p">},</span>

            <span class="nx">add_contact</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">e</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span> <span class="c1">// prevent form from submitting</span>

                <span class="kd">var</span> <span class="nx">message</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;message-success&#39;</span><span class="p">);</span>
                <span class="kd">var</span> <span class="nx">errors</span> <span class="o">=</span> <span class="p">[];</span>
                <span class="kd">var</span> <span class="nx">fullname</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">el</span><span class="p">.</span><span class="nx">fullname</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>
                <span class="kd">var</span> <span class="nx">age</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">el</span><span class="p">.</span><span class="nx">age</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>
                <span class="kd">var</span> <span class="nx">address</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">el</span><span class="p">.</span><span class="nx">address</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>
                <span class="kd">var</span> <span class="nx">contact</span><span class="p">;</span>

                <span class="c1">// This regex tests for a first name with at least two characters, </span>
                <span class="c1">// followed by an optional middle name with at least two characters (we use a non-capturing group to save the regex engine some work), </span>
                <span class="c1">// followed by the last name with at least two characters.</span>
                <span class="c1">// This regex allows the first-middle name (and the middle-last) to be joined by a hypen (e.g. Georges St-Pierre or Georges-St Pierre)</span>
                <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="sr">/[\w-]{2,}(?:\s\w{2,})?[\s-]\w{2,}/</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">fullname</span><span class="p">))</span> <span class="p">{</span>
                    <span class="nx">errors</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="s1">&#39;Name was invalid&#39;</span><span class="p">);</span>
                <span class="p">}</span> 

                <span class="c1">// We allow ages from 1-999</span>
                <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="sr">/\d{1,3}/</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">age</span><span class="p">))</span> <span class="p">{</span>
                    <span class="nx">errors</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="s1">&#39;Age was invalid (should be numeric value only)&#39;</span><span class="p">);</span>
                <span class="p">}</span>

                <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">address</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
                    <span class="c1">// Provide a default for the address (mainly because it&#39;s awkward to validate this type of field)</span>
                    <span class="nx">address</span> <span class="o">=</span> <span class="s1">&#39;No address provided&#39;</span><span class="p">;</span>
                <span class="p">}</span>

                <span class="c1">// If there are any errors then we can&#39;t proceed</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">errors</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
                    <span class="c1">// If the success message (from a previous successful record added) is still visible</span>
                    <span class="c1">// then remove it to save from confusing the user.</span>
                    <span class="kd">var</span> <span class="nx">success</span><span class="p">;</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nx">success</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;message-success&#39;</span><span class="p">))</span> <span class="p">{</span>
                        <span class="k">this</span><span class="p">.</span><span class="nx">el</span><span class="p">.</span><span class="nx">removeChild</span><span class="p">(</span><span class="nx">success</span><span class="p">);</span> <span class="c1">// this.el provided by Backbone</span>
                    <span class="p">}</span>

                    <span class="c1">// Display errors</span>
                    <span class="nx">alert</span><span class="p">(</span><span class="nx">errors</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;\n&#39;</span><span class="p">));</span>
                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                    <span class="c1">// There should be an AJAX function to post data to server-side script (for storing in db)</span>
                    <span class="c1">// Backbone.Model.save() might be a built-in handler for this, I&#39;m not sure yet?</span>

                    <span class="c1">// Create a new Model</span>
                    <span class="nx">contact</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Contact</span><span class="p">({</span>
                        <span class="nx">id</span><span class="o">:</span> <span class="nx">_</span><span class="p">.</span><span class="nx">uniqueId</span><span class="p">(),</span>
                        <span class="nx">name</span><span class="o">:</span> <span class="nx">fullname</span><span class="p">,</span>
                        <span class="nx">age</span><span class="o">:</span> <span class="o">+</span><span class="nx">age</span><span class="p">,</span> <span class="c1">// ensure data is an Integer</span>
                        <span class="nx">address</span><span class="o">:</span> <span class="nx">address</span>
                    <span class="p">});</span>

                    <span class="c1">// Add the new Model into the Contacts Collection</span>
                    <span class="c1">// This should trigger an &#39;add&#39; event which means the record is inserted into the &lt;select&gt;</span>
                    <span class="k">this</span><span class="p">.</span><span class="nx">collection</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">contact</span><span class="p">);</span>

                    <span class="c1">// Display success message and reset the form</span>
                    <span class="k">this</span><span class="p">.</span><span class="nx">el</span><span class="p">.</span><span class="nx">reset</span><span class="p">();</span> <span class="c1">// this.el provided by Backbone</span>

                    <span class="c1">// Don&#39;t want to see a massive long list of &#39;Record added successfully!&#39; messages</span>
                    <span class="c1">// So if one is already there then just remove it first</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nx">message</span><span class="p">)</span> <span class="p">{</span>
                        <span class="nx">message</span><span class="p">.</span><span class="nx">parentNode</span><span class="p">.</span><span class="nx">removeChild</span><span class="p">(</span><span class="nx">message</span><span class="p">);</span>
                    <span class="p">}</span>

                    <span class="c1">// Create an element to hold our success message</span>
                    <span class="kd">var</span> <span class="nx">doc</span> <span class="o">=</span> <span class="nb">document</span><span class="p">;</span>
                    <span class="kd">var</span> <span class="nx">div</span> <span class="o">=</span> <span class="nx">doc</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;div&#39;</span><span class="p">);</span>
                    <span class="kd">var</span> <span class="nx">txt</span> <span class="o">=</span> <span class="nx">doc</span><span class="p">.</span><span class="nx">createTextNode</span><span class="p">(</span><span class="s1">&#39;Record added successfully!&#39;</span><span class="p">);</span>

                    <span class="nx">div</span><span class="p">.</span><span class="nx">id</span> <span class="o">=</span> <span class="s1">&#39;message-success&#39;</span><span class="p">;</span>

                    <span class="nx">div</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">txt</span><span class="p">);</span>
                    <span class="k">this</span><span class="p">.</span><span class="nx">el</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">div</span><span class="p">);</span> <span class="c1">// this.el provided by Backbone</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">});</span>

        <span class="k">return</span> <span class="nx">AddContactView</span><span class="p">;</span>

    <span class="p">});</span>
</pre></div>
</code></pre>
<p>…this does a lot of stuff so lets break it down…</p>
<h3><a name="event-listeners"class="anchor" href="#event-listeners"><span class="header-link"></span></a>Event listeners</h3>
<p>We set-up a listener for the <code>click</code> event for the form&#39;s submit button which calls the <code>add_contact</code> method.</p>
<pre><code class="lang-js"><div class="highlight"><pre>    <span class="nx">events</span><span class="o">:</span> <span class="p">{</span>
        <span class="s1">&#39;click input[type=submit]&#39;</span><span class="o">:</span> <span class="s1">&#39;add_contact&#39;</span>
    <span class="p">}</span>
</pre></div>
</code></pre>
<h3><a name="add-a-new-contact-and-validate-the-user-input"class="anchor" href="#add-a-new-contact-and-validate-the-user-input"><span class="header-link"></span></a>Add a new contact and validate the user input</h3>
<p>We call the <code>add_contact</code> method and immediately call <code>e.preventDefault</code> which stops the form from submitting and thus refreshing the page (which we don&#39;t want to have happen as we&#39;ll lose the state of the page).</p>
<pre><code class="lang-js"><div class="highlight"><pre>    <span class="nx">add_contact</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">e</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>

        <span class="kd">var</span> <span class="nx">message</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;message-success&#39;</span><span class="p">);</span>
        <span class="kd">var</span> <span class="nx">errors</span> <span class="o">=</span> <span class="p">[];</span>
        <span class="kd">var</span> <span class="nx">fullname</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">el</span><span class="p">.</span><span class="nx">fullname</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>
        <span class="kd">var</span> <span class="nx">age</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">el</span><span class="p">.</span><span class="nx">age</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>
        <span class="kd">var</span> <span class="nx">address</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">el</span><span class="p">.</span><span class="nx">address</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>
        <span class="kd">var</span> <span class="nx">contact</span><span class="p">;</span>

        <span class="c1">// This regex tests for a first name with at least two characters, </span>
        <span class="c1">// followed by an optional middle name with at least two characters (we use a non-capturing group to save the regex engine some work), </span>
        <span class="c1">// followed by the last name with at least two characters.</span>
        <span class="c1">// This regex allows the first-middle name (and the middle-last) to be joined by a hypen (e.g. George St-Pierre or Georges-St Pierre)</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="sr">/[\w-]{2,}(?:\s\w{2,})?[\s-]\w{2,}/</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">fullname</span><span class="p">))</span> <span class="p">{</span>
            <span class="nx">errors</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="s1">&#39;Name was invalid&#39;</span><span class="p">);</span>
        <span class="p">}</span> 

        <span class="c1">// We allow ages from 1-999</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="sr">/\d{1,3}/</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">age</span><span class="p">))</span> <span class="p">{</span>
            <span class="nx">errors</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="s1">&#39;Age was invalid (should be numeric value only)&#39;</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">address</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">address</span> <span class="o">=</span> <span class="s1">&#39;No address provided&#39;</span><span class="p">;</span>
        <span class="p">}</span>
</pre></div>
</code></pre>
<h3><a name="handle-any-invalid-data"class="anchor" href="#handle-any-invalid-data"><span class="header-link"></span></a>Handle any invalid data</h3>
<p>If the success message (from a previous successful record added) is still visible then remove it to save from confusing the user.<br>Then display any errors found.</p>
<pre><code class="lang-js"><div class="highlight"><pre>    <span class="k">if</span> <span class="p">(</span><span class="nx">errors</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">success</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">success</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;message-success&#39;</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">el</span><span class="p">.</span><span class="nx">removeChild</span><span class="p">(</span><span class="nx">success</span><span class="p">);</span> <span class="c1">// this.el provided by Backbone</span>
        <span class="p">}</span>

        <span class="c1">// Display errors</span>
        <span class="nx">alert</span><span class="p">(</span><span class="nx">errors</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;\n&#39;</span><span class="p">));</span>
    <span class="p">}</span>
</pre></div>
</code></pre>
<h3><a name="add-a-new-contact"class="anchor" href="#add-a-new-contact"><span class="header-link"></span></a>Add a new contact</h3>
<p>This adds the new Model data, then updates the <code>&lt;select&gt;</code> menu, then inserts a success message to let the user know the details were added without issue.</p>
<pre><code class="lang-js"><div class="highlight"><pre>    <span class="k">else</span> <span class="p">{</span>
        <span class="c1">// Create a new Model</span>
        <span class="nx">contact</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Contact</span><span class="p">({</span>
            <span class="nx">id</span><span class="o">:</span> <span class="nx">_</span><span class="p">.</span><span class="nx">uniqueId</span><span class="p">(),</span>
            <span class="nx">name</span><span class="o">:</span> <span class="nx">fullname</span><span class="p">,</span>
            <span class="nx">age</span><span class="o">:</span> <span class="o">+</span><span class="nx">age</span><span class="p">,</span> <span class="c1">// ensure data is an Integer</span>
            <span class="nx">address</span><span class="o">:</span> <span class="nx">address</span>
        <span class="p">});</span>

        <span class="c1">// Add the new Model into the Contacts Collection</span>
        <span class="c1">// This should trigger an &#39;add&#39; event which means the record is inserted into the &lt;select&gt;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">collection</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">contact</span><span class="p">);</span>

        <span class="c1">// Display success message and reset the form</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">el</span><span class="p">.</span><span class="nx">reset</span><span class="p">();</span> <span class="c1">// this.el provided by Backbone</span>

        <span class="c1">// Don&#39;t want to see a massive long list of &#39;Record added successfully!&#39; messages</span>
        <span class="c1">// So if one is already there then just remove it first</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">message</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">message</span><span class="p">.</span><span class="nx">parentNode</span><span class="p">.</span><span class="nx">removeChild</span><span class="p">(</span><span class="nx">message</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="c1">// Create an element to hold our success message</span>
        <span class="kd">var</span> <span class="nx">doc</span> <span class="o">=</span> <span class="nb">document</span><span class="p">;</span>
        <span class="kd">var</span> <span class="nx">div</span> <span class="o">=</span> <span class="nx">doc</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;div&#39;</span><span class="p">);</span>
        <span class="kd">var</span> <span class="nx">txt</span> <span class="o">=</span> <span class="nx">doc</span><span class="p">.</span><span class="nx">createTextNode</span><span class="p">(</span><span class="s1">&#39;Record added successfully!&#39;</span><span class="p">);</span>

        <span class="nx">div</span><span class="p">.</span><span class="nx">id</span> <span class="o">=</span> <span class="s1">&#39;message-success&#39;</span><span class="p">;</span>

        <span class="nx">div</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">txt</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">el</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">div</span><span class="p">);</span> <span class="c1">// this.el provided by Backbone</span>
    <span class="p">}</span>
</pre></div>
</code></pre>
<h3><a name="url-routing"class="anchor" href="#url-routing"><span class="header-link"></span></a>URL Routing</h3>
<p>I&#39;ve not built in any real routing logic into this particular example application, but I&#39;ve included below part of the example from the Backbone website so you at least have an idea of how it works...</p>
<pre><code class="lang-js"><div class="highlight"><pre>    <span class="nx">define</span><span class="p">([</span><span class="s1">&#39;../Utils/backbone&#39;</span><span class="p">],</span> <span class="kd">function</span><span class="p">(){</span>

        <span class="kd">var</span> <span class="nx">Routing</span> <span class="o">=</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">Router</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
            <span class="nx">routes</span><span class="o">:</span> <span class="p">{</span>
                <span class="s1">&#39;test&#39;</span><span class="o">:</span> <span class="s1">&#39;test&#39;</span><span class="p">,</span>
                <span class="s1">&#39;search/:query/:page&#39;</span><span class="o">:</span> <span class="s1">&#39;search&#39;</span>
            <span class="p">},</span>

            <span class="nx">test</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
                <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;User has accessed this app from /test/&#39;</span><span class="p">);</span>
            <span class="p">},</span>

            <span class="nx">search</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">query</span><span class="p">,</span> <span class="nx">page</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">query</span><span class="p">,</span> <span class="nx">page</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">});</span>

        <span class="k">return</span> <span class="nx">Routing</span><span class="p">;</span>

    <span class="p">});</span>
</pre></div>
</code></pre>
<p>...what we have here is a new <code>Router</code> instance where we then defines a set of &#39;routes&#39; into your application. The routes we have defined are:</p>
<ul>
<li><p><a href="http://backbone:8888/#test">http://backbone:8888/#test</a><br>If we access our application with this URL we&#39;ll see a log message of <code>User has accessed this app from /test/</code></p>
</li>
<li><p><a href="http://backbone:8888/#search/testing/p7">http://backbone:8888/#search/testing/p7</a><br>If we access our application with this URL we&#39;ll see a log message of <code>testing, p7</code></p>
</li>
</ul>
<p>...to initialise this Router system we need to trigger it via the main script file... </p>
<pre><code class="lang-js"><div class="highlight"><pre>    <span class="cm">/**</span>
<span class="cm">     * Router/History API Examples</span>
<span class="cm">     */</span>

    <span class="c1">// Create new instance of our Routing Class</span>
    <span class="kd">var</span> <span class="nx">routing</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Routing</span><span class="p">();</span>

    <span class="c1">// Initialize the Router</span>
    <span class="nx">Backbone</span><span class="p">.</span><span class="nx">history</span><span class="p">.</span><span class="nx">start</span><span class="p">({</span> <span class="nx">pushState</span><span class="o">:</span> <span class="kc">true</span> <span class="p">});</span>
</pre></div>
</code></pre>
<p>Instead of displaying basic log messages we would use this routing feature to load a specific application state.</p>
<p>So for example, if we set-up the relevant route then the user could access the application via a URL like: <a href="http://backbone:8888/#contact/99">http://backbone:8888/#contact/99</a> and that could load the contact details for Model item 99.</p>
<p>You also have the facility to take advantage of HTML5&#39;s <code>pushState</code> which removes the need for URL rewriting but does require extra application logic/work. The default for <code>Backbone.Router</code> is to use hashbangs.</p>
<p>If a user accesses the application with a hashbang URL and the application is set-up to use <code>pushState</code> then Backbone will update the URL from the hashbang to the proper HTML5 variation.</p>
<h2><a name="wrap-up"class="anchor" href="#wrap-up"><span class="header-link"></span></a>Wrap-up</h2>
<p>So this is where we end. </p>
<p>We&#39;ve got our three Views set-up, we have our Model defined and contacts created from it and we created a Collection based on that Model type.</p>
<p>The Views and Models/Collection are tied together and the application is functioning as it should be.</p>
<p>There are lots of things we could do to improve this example, but as a basic example of an MVC style application built using Backbone.js I think it does everything it needs to.</p>
<h2><a name="conclusion"class="anchor" href="#conclusion"><span class="header-link"></span></a>Conclusion</h2>
<p>When you start using Backbone.js the concepts can be a bit confusing, but you quickly learn your way around. </p>
<p>Oddly, trying to <em>explain</em> how to use Backbone.js is harder than actually using it! So I would suggest just start using it.</p>
<p>The main <a href="http://www.backbonejs.org/">Backbone.js website</a> is the best documentation available and is the ideal place to start after here. </p>
<p>Also, the following links are excellent resources to understand the MV* concepts discussed at the start of this post.</p>
<h2><a name="links-"class="anchor" href="#links-"><span class="header-link"></span></a>Links**</h2>
<ul>
<li><a href="http://addyosmani.com/blog/backbone-fundamentals/">Backbone Fundamentals</a></li>
<li><a href="http://addyosmani.com/blog/short-musings-on-javascript-mv-tech-stacks/">Short Musings On JavaScript MV* Tech Stacks</a></li>
<li><a href="http://addyosmani.com/blog/understanding-mvc-and-mvp-for-javascript-and-backbone-developers/">Understanding MVC And MVP (For JavaScript And Backbone Developers)</a></li>
<li><a href="http://addyosmani.com/blog/understanding-mvvm-a-guide-for-javascript-developers/">Understanding MVVM – A Guide For JavaScript Developers</a></li>
<li><a href="http://addyosmani.com/blog/digesting-javascript-mvc-pattern-abuse-or-evolution/">Digesting JavaScript MVC – Pattern Abuse Or Evolution?</a></li>
<li><a href="http://addyosmani.com/blog/javascript-mvc-jungle/">Journey Through The JavaScript MVC Jungle</a></li>
</ul>
</div>

  <div class="comments">
    <a href="/posts/mvc-in-javascript-with-backbone-js/#comments">
      <span class="icon-bubbles"></span>
      Comments
    </a>
  </div>

  <div class="post-head group">
  <a href="/posts/ruby-and-the-sinatra-framework/">
    <h1 class="post-title">Ruby and the Sinatra framework</h1>
  </a>
  <span class="post-date">2012 &#183; 7 &#183; 22</span>
</div>

<div class="post-body"><h2><a name="what-we-ll-cover-reading-time-approx-23mins-"class="anchor" href="#what-we-ll-cover-reading-time-approx-23mins-"><span class="header-link"></span></a>What we&#39;ll cover <em>reading time: approx. 23mins</em></h2>
<ul>
<li>Introduction<ul>
<li>DSL vs GPL</li>
</ul>
</li>
<li>GitHub Repository</li>
<li>Sinatra</li>
<li>Hosting</li>
<li>Example<ul>
<li>Requirements</li>
<li>Set-up</li>
<li>Shotgun</li>
<li>Loading pages</li>
<li>Loading templates</li>
<li>Static resources</li>
<li>Handling errors</li>
<li>Performance</li>
<li>Hosting our application</li>
</ul>
</li>
<li>Conclusions</li>
</ul>
<h2><a name="introduction"class="anchor" href="#introduction"><span class="header-link"></span></a>Introduction</h2>
<p>In my opinion there&#39;s isn&#39;t enough good information on the web about how to get started building a <a href="http://www.ruby-lang.org/" title="The Ruby Programming Language">Ruby</a> based website (unless you want to use the ever popular <a href="http://rubyonrails.org/" title="Ruby on Rails">Ruby on Rails</a> framework). </p>
<p>But even then, it&#39;s not as straight forward as you&#39;d think (not for someone new to the language or server-side coding in general).</p>
<h3><a name="dsl-vs-gpl"class="anchor" href="#dsl-vs-gpl"><span class="header-link"></span></a>DSL vs GPL</h3>
<p>Before we go any further, it&#39;s worth clarifying the difference between a Domain Specific Language (DSL) and a General Purpose Language (GPL). Languages like JavaScript and PHP are DSL&#39;s** because they were designed to be run within a specific &#39;domain&#39; (and by domain we really mean &#39;environment&#39;) such as the web. But languages like Python and Ruby are GPL&#39;s because they can run within many different domains (e.g. Ruby can run on the web, desktop, command line etc).</p>
<p>If we look at a DSL language such as <a href="http://www.php.net/" title="PHP Hypertext Preprocessor">PHP</a>**: it is very easy to build a site using PHP because you can just input some procedural code, upload the file onto a server that supports PHP (and what server doesn&#39;t nowadays) and that&#39;s all there is to it (!now I&#39;m obviously not suggesting this is good practice - I&#39;m just illustrating the point that if you wanted to <strong>just get started</strong> with PHP then that is all there is to it).</p>
<p>With a GPL such as Ruby it isn&#39;t so straight forward (it&#39;s like the old adage &quot;the question is easy when you know the answer&quot;: Ruby can be easy to use and get set-up when you know what you&#39;re doing, but the fundamentals - in my opinion - are difficult to grasp without a helping hand).</p>
<p><em>**PHP (and JavaScript) were designed to be DSL&#39;s but have since evolved more into GPL&#39;s as they can be run on the desktop as well as the web (and many other environments they weren&#39;t originally designed for).</em></p>
<p>My issue with Ruby is that there is no &quot;just get started&quot; guide for those who want to build a site with it but not have to deal with design patterns such as MVC (maybe not straight away at least). I wouldn&#39;t be surprised if developers new to Ruby felt obliged to use Ruby on Rails because it seems to be the only Ruby related framework out there that gets any real spotlight - and I understand why, because it truly is an all encompassing framework - but I wanted a Ruby site without the bloat of a framework like <a href="http://rubyonrails.org/" title="Ruby on Rails">Ruby on Rails</a>. I didn&#39;t want all the confusing MVC structure and features that I&#39;d never use. Hence why I&#39;m writing this now.</p>
<h2><a name="github-repository"class="anchor" href="#github-repository"><span class="header-link"></span></a>GitHub Repository</h2>
<p>You can find an example repository with all code discussed in this article here: <a href="https://github.com/Integralist/passage"><a href="https://github.com/Integralist/passage">https://github.com/Integralist/passage</a></a></p>
<h2><a name="sinatra"class="anchor" href="#sinatra"><span class="header-link"></span></a>Sinatra</h2>
<p>So, let me begin by introducing you to <a href="http://www.sinatrarb.com/" title="Put this in your pipe and smoke it">Sinatra</a>. Sinatra is a micro web framework for Ruby that although small (much smaller than a framework such as Ruby on Rails) is still surprising complex and powerful (I&#39;d highly recommend reading O&#39;Reilly&#39;s book &quot;<a href="http://shop.oreilly.com/product/0636920019664.do" title="Ruby for the Web">Sinatra: Up and Running</a>&quot;).</p>
<p>Sinatra does require you to do a lot of work off your own back, but at the same time it doesn&#39;t enforce a particular style on you. It&#39;s also very easy to get a site up and running with Sinatra and that is hopefully what I&#39;ll demonstrate here today.</p>
<h2><a name="hosting"class="anchor" href="#hosting"><span class="header-link"></span></a>Hosting</h2>
<p>Now running a site locally on your computer is one thing, but you want to be able to share it with the community and let others use it! Ruby hosting is something I&#39;m still looking into but I have found two popular options for those who aren&#39;t willing to put their money where their mouth is just yet (e.g. developers who are just experimenting with Ruby to see if it&#39;ll work for them). These are:</p>
<ul>
<li><a href="http://www.heroku.com/" title="Cloud Application Platform">Heroku</a></li>
<li><a href="https://openshift.redhat.com/app/" title="Develop and Scale Apps in the Cloud">OpenShift</a></li>
</ul>
<p>OpenShift is a relative newcomer to the hosting arena and currently is free (although paid for plans are likely to be introduced soon).</p>
<p>Heroku is one of the most well known and talked about Ruby web hosts and offers both free and paid for options.</p>
<p>This means we can use either one to host our application for free and so allow us to test their services, and if you discover your latest web creation is doing well and getting lots of traffic then these platforms can scale to meet your needs.</p>
<p>For today we&#39;ll be using the first option Heroku, but we&#39;ll come back to the hosting aspect at the end of this article when we&#39;re ready to actually upload our test application.</p>
<h2><a name="example"class="anchor" href="#example"><span class="header-link"></span></a>Example</h2>
<h3><a name="requirements"class="anchor" href="#requirements"><span class="header-link"></span></a>Requirements</h3>
<p>OK, for us to build our application we&#39;re going to need to install the following software...</p>
<ul>
<li>Ruby (Programming Language - see my <a href="https://github.com/Integralist/Blog-Posts/blob/master/Introduction-to-Ruby.md" title="Introduction to Ruby (a front-end developers perspective)">introduction to the Ruby language</a> for more information on how to do this)</li>
<li>Sinatra (Web Framework)</li>
<li>Bundler (Dependancy Manager)</li>
<li>Shotgun (Utility)</li>
<li>Thin (Web Server)</li>
</ul>
<p>When Ruby is installed it provides you with a tool called &#39;gems&#39;. It is a list of code based projects and each one is referred to as a &#39;gem&#39;. These gems are actually hosted publically on <a href="http://rubygems.org/" title="Your community gem host"><a href="http://rubygems.org/">http://rubygems.org/</a></a>. If you ever need a piece of functionality that you don&#39;t fancy writing yourself then you can search for a &#39;gem&#39; that has already been built and download it, and then use it within your application.</p>
<p>For example, you could be looking for a way to send email from your Ruby application. You would then search the Ruby Gems site (or you can do it via the command line) for a gem that provides this functionality. In this instance you would probably find the gem <code>Pony</code> which does exactly this and can be installed simply by running the command <code>gem install pony</code>.</p>
<p>So, with this new knowledge about <code>gems</code> let us start downloading the above software. Start by opening your CLI (Command Line Interface) tool of choice. I&#39;m on a Macintosh so by default that will be the Terminal app. </p>
<p>All we need to do is to execute the following command <code>gem install name_of_gem</code>...</p>
<ul>
<li>Sinatra: <code>gem install sinatra</code></li>
<li>Bundler: <code>gem install bundler</code></li>
<li>Shotgun: <code>gem install shotgun</code></li>
<li>Thin: <code>gem install thin</code></li>
</ul>
<p>To see what &#39;gems&#39; you have already installed you can run the command <code>gem list --local</code> and this will display something similar to this (which is what I have installed on my own machine currently)…</p>
<pre><code class="lang-sh"><div class="highlight"><pre>    bundler <span class="o">(</span>1.1.3<span class="o">)</span>
    cgi_multipart_eof_fix <span class="o">(</span>2.5.0<span class="o">)</span>
    daemons <span class="o">(</span>1.1.8<span class="o">)</span>
    eventmachine <span class="o">(</span>0.12.10<span class="o">)</span>
    fastthread <span class="o">(</span>1.0.7<span class="o">)</span>
    gem_plugin <span class="o">(</span>0.2.3<span class="o">)</span>
    i18n <span class="o">(</span>0.6.0<span class="o">)</span>
    mail <span class="o">(</span>2.4.4<span class="o">)</span>
    mime-types <span class="o">(</span>1.18<span class="o">)</span>
    polyglot <span class="o">(</span>0.3.3<span class="o">)</span>
    pony <span class="o">(</span>1.4<span class="o">)</span>
    rack <span class="o">(</span>1.4.1<span class="o">)</span>
    rack-protection <span class="o">(</span>1.2.0<span class="o">)</span>
    rake <span class="o">(</span>0.9.2.2, 0.9.2<span class="o">)</span>
    rubygems-bundler <span class="o">(</span>0.3.0, 0.2.8<span class="o">)</span>
    sass <span class="o">(</span>3.1.17<span class="o">)</span>
    shotgun <span class="o">(</span>0.9<span class="o">)</span>
    sinatra <span class="o">(</span>1.3.2<span class="o">)</span>
    thin <span class="o">(</span>1.3.1<span class="o">)</span>
    tilt <span class="o">(</span>1.3.3<span class="o">)</span>
    treetop <span class="o">(</span>1.4.10<span class="o">)</span>
</pre></div>
</code></pre>
<h3><a name="set-up"class="anchor" href="#set-up"><span class="header-link"></span></a>Set-up</h3>
<p>Now we have our software set-up, lets open our programming tool of choice and start writing some code.</p>
<p>First thing we want to do is to create a file that will be our application. So lets go ahead and do that and call it <code>app.rb</code> and lets add the following content to it…</p>
<pre><code class="lang-ruby"><div class="highlight"><pre>    <span class="c1">#!/usr/bin/env ruby</span>

    <span class="nb">require</span> <span class="s1">&#39;sinatra&#39;</span>

    <span class="n">get</span> <span class="s1">&#39;/&#39;</span> <span class="k">do</span>
        <span class="s2">&quot;Hello World!&quot;</span>
    <span class="k">end</span>
</pre></div>
</code></pre>
<p>…now open your CLI, direct yourself to the folder where the above file is located and run <code>ruby app.rb</code>.</p>
<p>You should see a message similar to this…</p>
<pre><code class="lang-sh"><div class="highlight"><pre>    <span class="o">==</span> Sinatra/1.3.2 has taken the stage on 4567 <span class="k">for </span>development with backup from Thin
    &gt;&gt; Thin web server <span class="o">(</span>v1.3.1 codename Triple Espresso<span class="o">)</span>
    &gt;&gt; Maximum connections <span class="nb">set </span>to 1024
    &gt;&gt; Listening on 0.0.0.0:4567, CTRL+C to stop
</pre></div>
</code></pre>
<p>You should now be able to open your web browser and go to: <code>http://localhost:4567/</code> and see the message &quot;Hello World!&quot;</p>
<p>If you can then OK, this is our app, good job!</p>
<p>Lets quickly recap what we&#39;ve got in our file:</p>
<ul>
<li><p><code>#!/usr/bin/env ruby</code><br>The first line tells the interpreter that&#39;s trying to run this file that we should interpret this file as a Ruby application.</p>
</li>
<li><p><code>require &#39;sinatra&#39;</code><br>Here we&#39;re loading in the Sinatra framework ready for us to use.</p>
</li>
<li><p><code>get &#39;/&#39; do &quot;Hello World!&quot; end</code><br>This is Sinatra&#39;s &quot;Classic&quot;** DSL syntax which basically says when someone loads the home page show them the message &quot;Hello World!&quot;.</p>
</li>
</ul>
<p><em>**There are two ways to build Sinatra applications: one is the &quot;Classic&quot; way (which we&#39;ll be doing as it&#39;s much easier to understand) and the other is the &quot;Modular&quot; way which doesn&#39;t use the DSL syntax and taps straight into the base Sinatra Class.</em></p>
<h3><a name="shotgun"class="anchor" href="#shotgun"><span class="header-link"></span></a>Shotgun</h3>
<p>One quick note about running your Ruby application: we used <code>ruby app.rb</code> but for development purposes we want to use our <code>shotgun</code> utility instead. </p>
<p>What <code>shotgun</code> does is it restarts the web server for every HTTP request it receives. This is only useful for local development, you wouldn&#39;t do this on a live server as that would just be wasting resources. The reason we use <code>shotgun</code> is because otherwise if we&#39;re running our application using <code>ruby app.rb</code> and decide to make a tweak to our code then we wouldn&#39;t be able to see the change until we restarted the web server! So we&#39;d have to first stop Sinatra (<code>Ctrl+C</code>) and then start it back up again (<code>ruby app.rb</code>) and that&#39;s a lot of hassle when you&#39;re making changes every few seconds and checking them in your web browser. So <code>shotgun</code> helps workaround this issue (while we&#39;re in development). Just run: <code>shotgun app.rb</code> and it&#39;ll take care of the rest**.</p>
<p><em>**One thing I&#39;ve noticed using <code>shotgun</code> is that it can affect other resources. For example, I was caching resources and for some reason when running <code>shotgun</code> I noticed the resources weren&#39;t being cached - but if I shut it down and run <code>ruby app.rb</code> instead then the resources would show as cached? Apparently it has something to do with the internals of how <code>shotgun</code> works and is something to be aware of if you notice something not working then just try running your Ruby application without <code>shotgun</code>.</em></p>
<p>So at this point you&#39;ve got some Ruby code and you&#39;re able to view it in a web browser. Now lets look further at Sinatra&#39;s DSL syntax...</p>
<h3><a name="loading-pages"class="anchor" href="#loading-pages"><span class="header-link"></span></a>Loading pages</h3>
<p>If you wanted to add a new page called &quot;Projects&quot; that you accessed via <code>http://localhost:4567/projects</code> then all you would need to do is add the following code…</p>
<pre><code class="lang-ruby"><div class="highlight"><pre>    <span class="n">get</span> <span class="s1">&#39;/projects&#39;</span> <span class="k">do</span>
        <span class="c1"># page content</span>
    <span class="k">end</span>
</pre></div>
</code></pre>
<p>What we&#39;ve done is created a new &#39;route&#39; - a new way for a user to access your application.</p>
<p>Imagine now that this &#39;projects&#39; page had a login form on it that let the user enter a username and password and this form POST&#39;ed the data entered by the user back to the current page...</p>
<pre><code class="lang-html"><div class="highlight"><pre>    <span class="nt">&lt;form</span> <span class="na">method=</span><span class="s">&quot;post&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;dl&gt;</span>
            <span class="nt">&lt;dt&gt;</span>Name<span class="nt">&lt;/dt&gt;</span>
            <span class="nt">&lt;dd&gt;&lt;input</span> <span class="na">name=</span><span class="s">&quot;user&quot;</span> <span class="na">type=</span><span class="s">&quot;text&quot;</span><span class="nt">&gt;&lt;/dd&gt;</span>
            <span class="nt">&lt;dt&gt;</span>Email<span class="nt">&lt;/dt&gt;</span>
            <span class="nt">&lt;dd&gt;&lt;input</span> <span class="na">name=</span><span class="s">&quot;password&quot;</span> <span class="na">type=</span><span class="s">&quot;password&quot;</span><span class="nt">&gt;&lt;/dd&gt;</span>
        <span class="nt">&lt;/dl&gt;</span>
        <span class="nt">&lt;p&gt;&lt;input</span> <span class="na">type=</span><span class="s">&quot;submit&quot;</span> <span class="na">value=</span><span class="s">&quot;Send&quot;</span><span class="nt">&gt;&lt;/p&gt;</span>
    <span class="nt">&lt;/form&gt;</span>
</pre></div>
</code></pre>
<p>...for you to access the POST&#39;ed data then you would need to add another &#39;route&#39; to handle it. But this time instead of using a <code>get</code> request it would be a <code>post</code> request like so…</p>
<pre><code class="lang-ruby"><div class="highlight"><pre>    <span class="n">post</span> <span class="s1">&#39;/projects&#39;</span> <span class="k">do</span>
        <span class="c1"># do something with the form fields</span>
        <span class="n">user</span> <span class="o">=</span> <span class="n">params</span><span class="o">[</span><span class="ss">:user</span><span class="o">]</span>
        <span class="n">pass</span> <span class="o">=</span> <span class="n">params</span><span class="o">[</span><span class="ss">:password</span><span class="o">]</span>
    <span class="k">end</span>
</pre></div>
</code></pre>
<p>…you&#39;ll notice that the form data is passed to the block using special parameters called <code>params</code>. So in the above example we had two form fields with the names <code>user</code> and <code>password</code> and we&#39;re assigning their values to the variables <code>user</code> and <code>pass</code> where we can now do validation on the values.</p>
<p>You can also use the URL path as a way for the user to interact with your application. For example if you had a page which added two numbers together then it could be handled directly via the URL as follows…</p>
<pre><code class="lang-ruby"><div class="highlight"><pre>    <span class="n">get</span> <span class="s1">&#39;/add/:a/:b&#39;</span> <span class="k">do</span> <span class="o">|</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="o">|</span>
        <span class="s2">&quot;</span><span class="si">#{</span><span class="n">a</span><span class="o">.</span><span class="n">to_i</span> <span class="o">+</span> <span class="n">b</span><span class="o">.</span><span class="n">to_i</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">end</span>
</pre></div>
</code></pre>
<p>…this would display on the page the result of adding <code>a</code> and <code>b</code> together. So if I went to the URL <code>http://localhost:4567/add/2/2</code> then this would display <code>4</code> as that would be the result of <code>2 + 2</code> (which was the two parameters I specified within the URL).</p>
<h3><a name="loading-templates"class="anchor" href="#loading-templates"><span class="header-link"></span></a>Loading templates</h3>
<p>Now at the moment we&#39;re using the fact that with Ruby, the last expression inside a function is what gets returned from that function. These calls to <code>get</code> and <code>post</code> are actually function calls hidden behind an abstraction. So in my original example we were displaying &quot;Hello World!&quot; to the page because that was the last expression inside the <code>get</code> call.</p>
<p>But we ideally want to be displaying HTML to the user! To do this we&#39;ll use &#39;templates&#39;.</p>
<p>Note that templates can be inlined inside your Ruby code, but personally I prefer them to be external because I think that&#39;s a lot cleaner and abides by the &#39;separate of concerns&#39; rule (which I like to keep to whenever possible).</p>
<p>Our code is going to start looking something like this…</p>
<pre><code class="lang-ruby"><div class="highlight"><pre>    <span class="n">get</span> <span class="s1">&#39;/&#39;</span> <span class="k">do</span>
        <span class="n">erb</span> <span class="ss">:home</span>
    <span class="k">end</span>

    <span class="n">get</span> <span class="s1">&#39;/projects&#39;</span> <span class="k">do</span>
        <span class="n">erb</span> <span class="ss">:projects</span>
    <span class="k">end</span>
</pre></div>
</code></pre>
<p>…what this is doing is using ERB (which stands for &#39;Embedded Ruby&#39;) and is the standard templating language available in Ruby - although there are many templating languages you could load and use in its place. What we&#39;ve said here in our code is load the <code>:home</code> template (.erb file) when on the home page, and load the <code>:project</code> template (.erb file) when on the projects page.</p>
<p>By default Sinatra looks for templates inside of a root folder called <code>views</code> (you can change this if you want but I didn&#39;t bother as <code>views</code> made the most sense for a folder containing &#39;templates&#39;).</p>
<p>Inside our <code>views</code> folder we&#39;ll need to create two files then: <code>home.erb</code> and <code>projects.erb</code> and they&#39;ll look a little bit like this…</p>
<pre><code class="lang-html"><div class="highlight"><pre>    <span class="c">&lt;!-- home.erb --&gt;</span>
    <span class="nt">&lt;p&gt;</span>HTML content for my home page<span class="nt">&lt;/p&gt;</span>

    <span class="c">&lt;!-- projects.erb --&gt;</span>
    <span class="nt">&lt;p&gt;</span>HTML content for my projects page<span class="nt">&lt;/p&gt;</span>
</pre></div>
</code></pre>
<p>Now this doesn&#39;t look like much of a HTML page, and that&#39;s because I&#39;m using (or I&#39;m going to be using very shortly) what Sinatra refers to as a main layout file and this &#39;layout&#39; file will contain the rest of my HTML code and will be wrapped around my above templates. </p>
<p>What this means is I can have a &#39;master&#39; HTML file that stays the same for every page and I can load my templates into that master layout. This is done by creating a <code>layout.erb</code> file (also within the <code>views</code> folder). If Sinatra finds a <code>layout.erb</code> file it will automatically use it as a master layout for all your templates.</p>
<p>But if I didn&#39;t create a <code>layout.erb</code> file then I could have modified my templates above to include a full set of HTML like so…</p>
<pre><code class="lang-html"><div class="highlight"><pre>    <span class="c">&lt;!-- home.erb --&gt;</span>
    <span class="cp">&lt;!doctype html&gt;</span>
    <span class="nt">&lt;html&gt;</span>
        <span class="nt">&lt;head&gt;</span>
            <span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">&quot;utf-8&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;title&gt;</span>My Page<span class="nt">&lt;/title&gt;</span>
        <span class="nt">&lt;/head&gt;</span>
        <span class="nt">&lt;body&gt;</span>
           <span class="nt">&lt;p&gt;</span>HTML content for my home page<span class="nt">&lt;/p&gt;</span>
        <span class="nt">&lt;/body&gt;</span>
    <span class="nt">&lt;/html&gt;</span>
</pre></div>
</code></pre>
<p>…but I prefer having a master layout to handle this stuff, so lets create a <code>layout.erb</code> file (within the <code>views</code> folder) and add the following content to it…</p>
<pre><code class="lang-erb"><div class="highlight"><pre><span class="x">    &lt;!-- layout.erb --&gt;</span>
<span class="x">    &lt;!doctype html&gt;</span>
<span class="x">    &lt;html&gt;</span>
<span class="x">        &lt;head&gt;</span>
<span class="x">            &lt;meta charset=&quot;utf-8&quot;&gt;</span>
<span class="x">            &lt;title&gt;My Page&lt;/title&gt;</span>
<span class="x">        &lt;/head&gt;</span>
<span class="x">        &lt;body&gt;</span>
<span class="x">           </span><span class="cp">&lt;%=</span> <span class="k">yield</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">        &lt;/body&gt;</span>
<span class="x">    &lt;/html&gt;</span>
</pre></div>
</code></pre>
<p>…you should notice the Ruby tags <code>&lt;% %&gt;</code> which are used to place Ruby code inside of them. Here we&#39;re telling Ruby to <code>yield</code> to the template file we&#39;re loading. So for example when a user accesses the home page and we load <code>home.erb</code>, we&#39;re effectively loading the <code>layout.erb</code> file and telling it that when it reaches the <code>body</code> tag we want it to load in the content from the <code>home.erb</code> file into it so it will end up rendering in the web browser like this…</p>
<pre><code class="lang-html"><div class="highlight"><pre>    <span class="cp">&lt;!doctype html&gt;</span>
    <span class="nt">&lt;html&gt;</span>
        <span class="nt">&lt;head&gt;</span>
            <span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">&quot;utf-8&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;title&gt;</span>My Page<span class="nt">&lt;/title&gt;</span>
        <span class="nt">&lt;/head&gt;</span>
        <span class="nt">&lt;body&gt;</span>
           <span class="nt">&lt;p&gt;</span>HTML content for my home page<span class="nt">&lt;/p&gt;</span>
        <span class="nt">&lt;/body&gt;</span>
    <span class="nt">&lt;/html&gt;</span>
</pre></div>
</code></pre>
<p>If you want to load a different master layout for a specific page then you can do that also. For example I have a page that I display to users of Internet Explorer version 7 or lower. The master layout for that page is a lot simpler than the other pages of my site in that it loads different stylesheets specifically for this IE page. So in my application file I have the following…</p>
<pre><code class="lang-ruby"><div class="highlight"><pre>    <span class="n">get</span> <span class="s1">&#39;/internet-explorer&#39;</span> <span class="k">do</span>
        <span class="n">erb</span> <span class="ss">:ie</span><span class="p">,</span> <span class="ss">:layout</span> <span class="o">=&gt;</span> <span class="ss">:layout_ie</span>
    <span class="k">end</span>
</pre></div>
</code></pre>
<p>…and what you can see here is that I&#39;m not only telling Sinatra to load the <code>ie.erb</code> file but to also use the <code>layout_ie.erb</code> file as the master layout file for this page rather than the default <code>layout.erb</code>.</p>
<p>One other thing worth mentioning is that you can pass variables from your route block into your template using class instance variables…</p>
<pre><code class="lang-ruby"><div class="highlight"><pre>    <span class="n">post</span> <span class="s1">&#39;/contact&#39;</span> <span class="k">do</span>
        <span class="n">redirect</span> <span class="s2">&quot;/contact-error/name&quot;</span> <span class="k">if</span> <span class="n">params</span><span class="o">[</span><span class="ss">:user</span><span class="o">].</span><span class="n">empty?</span>
        <span class="n">redirect</span> <span class="s2">&quot;/contact-error/email&quot;</span> <span class="k">if</span> <span class="n">params</span><span class="o">[</span><span class="ss">:email</span><span class="o">].</span><span class="n">empty?</span>
        <span class="n">redirect</span> <span class="s2">&quot;/contact-error/message&quot;</span> <span class="k">if</span> <span class="n">params</span><span class="o">[</span><span class="ss">:message</span><span class="o">].</span><span class="n">empty?</span>

        <span class="n">erb</span> <span class="ss">:contact_success</span>
    <span class="k">end</span>

    <span class="n">get</span> <span class="s1">&#39;/contact-error/:field&#39;</span> <span class="k">do</span> <span class="o">|</span><span class="n">field</span><span class="o">|</span>
        <span class="vi">@field</span> <span class="o">=</span> <span class="n">field</span>
        <span class="n">erb</span> <span class="ss">:contact_error</span>
    <span class="k">end</span>
</pre></div>
</code></pre>
<p>…in the above example when a user makes an error on my contact form I redirect them to a page that shows them what field they made an error on. In my template file I have…</p>
<pre><code class="lang-html"><div class="highlight"><pre>    <span class="nt">&lt;p&gt;</span>Sorry there was an error with your form submission. Seems you didn&#39;t fill in the <span class="err">&lt;</span>%= @field %&gt; field.<span class="nt">&lt;/p&gt;</span>
</pre></div>
</code></pre>
<p>…notice I picked up the field from the URL and stored it in a class instance variable and used that variable within my template.</p>
<h3><a name="static-resources"class="anchor" href="#static-resources"><span class="header-link"></span></a>Static resources</h3>
<p>OK, the next thing to be aware of is that Sinatra serves up ALL static resources from a folder called <code>public</code> (again you can change this but I&#39;m happy using it - as the name is perfectly logical already).</p>
<p>What this means is that if you have a file path like: <code>/path/to/file</code> then for that to work you need to have the folders/files within the root <code>public</code> folder otherwise Sinatra can&#39;t locate them. It DOESN&#39;T mean you have to change all your paths to <code>/public/path/to/file</code>. You keep the path the same as it is already but you just move the files/folders inside of a root folder called <code>public</code>.</p>
<p>So for example in all my projects I have my JavaScript files in the following directory…</p>
<p><code>Assets/Scripts/</code></p>
<p>…and all my CSS in the following directory…</p>
<p><code>Assets/Styles/</code></p>
<p>…all I need to do is create an <code>Assets</code> folder within the <code>public</code> folder. Within that I then have the <code>Assets</code> folder, and inside of that is my <code>Scripts</code> and <code>Styles</code> folders which hold the relevant files.</p>
<p>If this sounds a bit confusing then have a look at the GitHub repo linked at the top of this article to see what I&#39;m talking about.</p>
<h3><a name="handling-errors"class="anchor" href="#handling-errors"><span class="header-link"></span></a>Handling errors</h3>
<p>If the user tries to access a page that doesn&#39;t exist then you can direct them to your own <code>404 error</code> page by using the following route…</p>
<pre><code class="lang-ruby"><div class="highlight"><pre>    <span class="n">not_found</span> <span class="k">do</span>
        <span class="n">erb</span> <span class="ss">:notfound</span>
    <span class="k">end</span>
</pre></div>
</code></pre>
<p>…as you can see I&#39;m loading a &#39;notfound.erb&#39; template for the content. This will get called anytime an unknown URL is specified by the user.</p>
<p>One thing you might not want to have happen is if someone types in <code>http://localhost:4567/projects/</code> instead of <code>http://localhost:4567/projects</code> (notice the extra forward-slash at the end of the first example) then that is considered a different &#39;route&#39; and wont be recognised by Sinatra and so the user is directed to the &#39;not found&#39; route. </p>
<p>To fix this you can do the following…</p>
<pre><code class="lang-ruby"><div class="highlight"><pre>    <span class="n">before</span> <span class="k">do</span>
        <span class="n">request</span><span class="o">.</span><span class="n">path_info</span><span class="o">.</span><span class="n">sub!</span> <span class="sr">%r{/$}</span><span class="p">,</span> <span class="s1">&#39;&#39;</span>
    <span class="k">end</span>
</pre></div>
</code></pre>
<p>…the above code block is referred to as a &#39;filter&#39; block and it is executed before every HTTP request. </p>
<p>So what this does is execute <code>request.path_info.sub! %r{/$}, &#39;&#39;</code> <em>before</em> every HTTP request. This code uses a Regular Expression to find the last forward-slash in the path and then removes it if it finds one. Which means it doesn&#39;t matter if the user puts an extra slash at the end of the URL.</p>
<p>Note: there is also a <code>after</code> filter block as well for doing tidy up work (although I&#39;ve not had any reason to use it - yet).</p>
<p>If there is an actual error then you can use…</p>
<pre><code class="lang-ruby"><div class="highlight"><pre>    <span class="n">error</span> <span class="k">do</span>
        <span class="n">erb</span> <span class="ss">:error</span>
    <span class="k">end</span>
</pre></div>
</code></pre>
<p>In a development environment Sinatra tries to be helpful by displaying very detailed error messages. But you may find this overrides your custom error page which you would want to show to a user. So if you want to just test your error page is working correct before you &#39;go live&#39; then simply add <code>disable :show_exceptions</code> to some where near the top of your application file and this will mean the detailed error stack is no longer shown when you encounter an error during development and so you&#39;ll end up seeing what your users will see in the live environment.</p>
<p>Also, within your <code>error.erb</code> template file you can access the error using the environment variable <code>sinatra.error</code>…</p>
<pre><code class="lang-erb"><div class="highlight"><pre><span class="x">    &lt;p&gt;Sorry there was the following error: &lt;strong class=&quot;error&quot;&gt;</span><span class="cp">&lt;%=</span> <span class="n">env</span><span class="o">[</span><span class="s2">&quot;sinatra.error&quot;</span><span class="o">]</span> <span class="cp">%&gt;</span><span class="x">&lt;/strong&gt;&lt;/p&gt;</span>
</pre></div>
</code></pre>
<h3><a name="performance"class="anchor" href="#performance"><span class="header-link"></span></a>Performance</h3>
<p>The performance of your application is very important, and specifically for a web application you want to make sure that all resources are sent to the user as quickly as possible.</p>
<p>Here are some things you can do to help improve the performance of your web application...</p>
<ol>
<li>Cache static resources</li>
<li>Use the <code>Thin</code> Web Server</li>
<li>GZIP all content</li>
</ol>
<h3><a name="cache-static-resources"class="anchor" href="#cache-static-resources"><span class="header-link"></span></a>Cache static resources</h3>
<p>We set the cache control for static resources to approximately 1 month</p>
<p><code>set :static_cache_control, [:public, :max_age =&gt; 2678400]</code></p>
<h3><a name="use-the-thin-web-server"class="anchor" href="#use-the-thin-web-server"><span class="header-link"></span></a>Use the <code>Thin</code> Web Server</h3>
<p>You can also tell Sinatra to use the <code>Thin</code> server rather than the default <code>WEBrick</code> server if it&#39;s available (<code>Thin</code> is a supremely better performing web server so do please use it!)</p>
<pre><code class="lang-ruby"><div class="highlight"><pre>    <span class="c1"># We specify which server we want to use (Thin is tried first and then failing that WEBrick)</span>
    <span class="n">set</span> <span class="ss">:server</span><span class="p">,</span> <span class="sx">%w[thin webrick]</span>
</pre></div>
</code></pre>
<h3><a name="gzip-all-content"class="anchor" href="#gzip-all-content"><span class="header-link"></span></a>GZIP all content</h3>
<p>We can also have the web server automatically GZIP all our static resources (which can reduce the file size of a resource by up to 70%!) such as HTML content, JavaScript files, CSS files by using one line of Ruby code…</p>
<p><code>use Rack::Deflater</code></p>
<p>…this uses the &#39;Rack&#39; middleware application (Rack is what sits behind Sinatra and is the actual HTTP web server interface), but Sinatra hides all of that behind the DSL syntax of <code>get</code> and <code>post</code> calls (nice huh).</p>
<h3><a name="hosting-our-application"class="anchor" href="#hosting-our-application"><span class="header-link"></span></a>Hosting our application</h3>
<p>Right. Let&#39;s get our application uploaded shall we.</p>
<p>This is going to be short and quick…</p>
<ol>
<li>Set-up account (<a href="http://www.heroku.com/" title="Cloud Application Platform">heroku.com</a>)</li>
<li>Install toolbelt (<a href="http://toolbelt.heroku.com/" title="Everything you need to get started using heroku">toolbelt.heroku.com</a>)</li>
<li>Open your Command Line Interface (CLI) and enter:<ul>
<li><code>heroku login</code> (follow on screen instructions)</li>
<li>You may want to add additional SSH keys, if you do use: <code>heroku keys:add</code></li>
<li>To create an app on heroku use: <code>heroku create --stack cedar</code> (you can also do: <code>heroku create yourappname --stack cedar</code>) - <code>cedar</code> will shortly be the <em>default</em> web stack on heroku but for the time being it&#39;s worth including it in the command <code>--stack cedar</code> otherwise your app will be created on an older web stack which isn&#39;t as good.</li>
</ul>
</li>
<li><p>Create a <code>config.ru</code> file and add the following content:  </p>
<pre><code><div class="highlight"><pre> <span class="nx">require</span> <span class="s1">&#39;app&#39;</span> <span class="err">#</span> <span class="nx">where</span> <span class="nx">app</span> <span class="nx">is</span> <span class="nx">the</span> <span class="nx">name</span> <span class="nx">of</span> <span class="nx">your</span> <span class="nx">main</span> <span class="nx">file</span> <span class="nx">that</span> <span class="nx">initializes</span> <span class="nx">your</span> <span class="nx">web</span> <span class="nx">application</span>
 <span class="nx">run</span> <span class="nx">Sinatra</span><span class="o">::</span><span class="nx">Application</span>
</pre></div>
</code></pre>
</li>
<li><p>Create a Gemfile file (no file extension) and add the content:  </p>
</li>
</ol>
<pre><code class="lang-ruby"><div class="highlight"><pre>    <span class="n">source</span> <span class="s1">&#39;http://rubygems.org&#39;</span>
    <span class="n">gem</span> <span class="s1">&#39;sinatra&#39;</span><span class="p">,</span> <span class="s1">&#39;1.3.2&#39;</span>
    <span class="n">gem</span> <span class="s1">&#39;thin&#39;</span><span class="p">,</span> <span class="s1">&#39;1.3.1&#39;</span>
</pre></div>
</code></pre>
<ol>
<li>Go back to your CLI and enter:<ul>
<li><code>bundle install</code> which will create a <code>Gemfile.lock</code> file specifying ALL the dependancies needed for your app to run (you shouldn&#39;t need to manually create your own Gemfile - as I&#39;ve told you to do in step 5. - but just in case <code>bundle install</code> doesn&#39;t work for you then you can at least do it manually).</li>
<li>Create a Procfile (no file extension) and add the content: <code>web: bundle exec ruby app.rb -p $PORT</code><br> e.g.<br> <code>touch Procfile</code>,<br> <code>echo web: bundle exec ruby app.rb -p $PORT &gt; Procfile</code></li>
<li>Commit your files using Git (if you don&#39;t know how to use Git then <a href="https://github.com/Integralist/Blog-Posts/blob/master/How-to-use-Git-and-GitHub.md" title="How to use Git and GitHub">read this introduction</a>)</li>
<li>If you&#39;ve not done this already then create a <code>remote</code> for heroku: <code>git remote add heroku git@heroku.com:xxxxx.git</code> (when you created your app earlier heroku would have generated a remote URL for you to use)</li>
<li><code>git push heroku master</code></li>
<li><code>heroku open</code> will open your default browser to the relevant app URL heroku has given you (they are normally pretty crazy looking URL&#39;s - but you can at some later stage - if you want - register a proper domain and point it to the app on heroku&#39;s server so you don&#39;t have to give out a dodgy long URL to your users)</li>
</ul>
</li>
</ol>
<p>Hopefully if you followed along, and had no errors, then you should see your new app online and hosted by heroku!</p>
<h2><a name="conclusions"class="anchor" href="#conclusions"><span class="header-link"></span></a>Conclusions</h2>
<p>Well, there you have it. Building a website using Sinatra and Ruby, and actually getting it hosted online.</p>
<p>It has been a bit of a whirlwind pace we&#39;ve set here, going through lots of different concepts such as performance tricks and handling errors, through to loading template files etc. But hopefully it wasn&#39;t too fast paced, and you managed to utilise this information to get you up and running. </p>
<p>I&#39;m actually writing this at record pace at home, late at night - feeling very tired, so if this article doesn&#39;t read right, or you think it needs improving then please get in contact and let me know what you think would help improve it (and thus help other people better understand the concepts)</p>
<p>Thanks.</p>
</div>

  <div class="comments">
    <a href="/posts/ruby-and-the-sinatra-framework/#comments">
      <span class="icon-bubbles"></span>
      Comments
    </a>
  </div>


<div class="pagination group">
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
      <a href="/page/7/" class="newer"> Newer &#8594;</a>
    
  
    
    
  
    
    
      <a href="/page/9/" class="older"> &#8592; Older</a>
    
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
</div>
    </div>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.1/jquery.min.js" type="text/javascript"></script>
    <script src="/scripts/main.js" type="text/javascript"></script>
    <script>
        var _gaq=[['_setAccount','UA-33159515-1'],['_trackPageview']];
        (function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];
        g.src=('https:'==location.protocol?'//ssl':'//www')+'.google-analytics.com/ga.js';
        s.parentNode.insertBefore(g,s)}(document,'script'));
    </script>
  </body>
</html>

