<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="icon" type="image/png" href="/images/cabin.png" >
    <link href="/styles/main.css" rel="stylesheet">
    
    <title>Integralist -> BBC News Engineer</title>
    
    
    <link rel="alternate" type="application/atom+xml" title="Integralist" href="http://feeds.feedburner.com/Integralist">
  </head>
  <body>
    <nav>
      <h1 class="name">
          <a href="/">Integralist</a> <span class="role">BBC News Engineer</span>
      </h1>
      <div class="menu icon-menu"></div>
      <ul class="nav-links">
        <li class="text-link">
          <a href="/about.html">about</a>
        </li>
        <li class="text-link">
          <a href="/projects.html">projects</a>
        </li>
        <li class="text-link">
          <a href="/archives.html">archives</a>
        </li>
      </ul>
      <div class="social-media">
        <a href="https://github.com/integralist" class="icon-github"></a>
        <a href="https://twitter.com/integralist" class="icon-twitter"></a>
      </div>
    </nav>
    <div class="content">


  <div class="post-head group">
  <a href="/posts/backbone-validation/">
    <h1 class="post-title">Backbone Validation</h1>
  </a>
  <span class="post-date">2012 &#183; 11 &#183; 26</span>
</div>

<div class="post-body"><h2><a name="what-well-cover" class="anchor" href="#what-well-cover"><span class="header-link"></span></a>What we&#39;ll cover</h2>
<p><em>reading time: approx. 17mins</em></p>
<ul>
<li>Introduction</li>
<li>Dependencies</li>
<li>HTML set-up</li>
<li>JavaScript set-up</li>
<li>Validation Module</li>
<li>Conclusion</li>
</ul>
<h2><a name="introduction" class="anchor" href="#introduction"><span class="header-link"></span></a>Introduction</h2>
<p>A while ago I had any issue with validating a form using the Backbone.Model&#39;s <code>validate</code> method and so I went to the official Backbone GitHub issues area to raise a query. The problem I had isn&#39;t necessarily important but the ultimate result I got from the discussion with the maintainers of Backbone was that validating a form using a Model wasn&#39;t really the way you should use a Model.</p>
<p>To me this didn&#39;t make a lot of sense because a form is just data and a Model holds data and so I would have thought using the built-in <code>validate</code> method of the Model would have been the best way to validate the form data. But apparently that&#39;s not considered a best practice using Backbone.</p>
<p>So I decided to create a validation module that would make validating a form (and displaying errors) a little bit easier, because lets face it, validating forms are tedious and boring.</p>
<p>You can download the <a href="https://github.com/Integralist/Backbone-Validation-View">full project code from GitHub</a></p>
<h2><a name="dependencies" class="anchor" href="#dependencies"><span class="header-link"></span></a>Dependencies</h2>
<ul>
<li>Backbone (obviously, so this includes the dependencies required by Backbone)</li>
<li><a href="http://twitter.github.com/hogan.js/">Hogan.js</a> (for loading the error messages)</li>
</ul>
<p>Now although I&#39;ve used Backbone/Hogan you don&#39;t have to. The code is straight forward enough to port over to use whatever you like. You could rewrite the code to not use a framework at all. The principles are very simple.</p>
<h2><a name="html-set-up" class="anchor" href="#html-set-up"><span class="header-link"></span></a>HTML set-up</h2>
<p>OK, so the HTML requires a bit of setting up. Nothing major, but we utilise specific classes and custom data attributes in the HTML to help us validate the form.</p>
<p>For example, we mark-up any mandatory fields with a class of <code>js-mandatory-field</code> - you&#39;ll notice I&#39;ve prefixed the class with &#39;js-&#39; so other developers know that this class has no styles associated with it. It&#39;s literally only used as a JavaScript hook.</p>
<p>We also use a custom data attribute <code>data-message</code> to store specific validation error messages. I prefer having custom messages because otherwise at some point you&#39;ll want to validate a field that doesn&#39;t conform to the known validation methods. So having a custom message for each field gives better feedback to the user.</p>
<p>So as an example here is a form with the mandatory class and the custom data attribute</p>
<pre><code class="lang-html"><div class="highlight"><pre><span class="nt">&lt;input</span> <span class="na">name=</span><span class="s">&quot;card&quot;</span> <span class="na">class=</span><span class="s">&quot;js-mandatory-field&quot;</span> <span class="na">data-message=</span><span class="s">&quot;Please ensure you enter a valid credit card number&quot;</span><span class="nt">&gt;</span>
</pre></div>
</code></pre>
<p>Our full form code looks like this…</p>
<pre><code class="lang-html"><div class="highlight"><pre><span class="nt">&lt;form</span> <span class="na">action=</span><span class="s">&quot;http://www.google.com/&quot;</span> <span class="na">method=</span><span class="s">&quot;post&quot;</span> <span class="na">id=</span><span class="s">&quot;js-form&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;p&gt;</span>Name: <span class="nt">&lt;input</span> <span class="na">name=</span><span class="s">&quot;fullname&quot;</span> <span class="na">class=</span><span class="s">&quot;js-mandatory-field&quot;</span> <span class="na">data-message=</span><span class="s">&quot;Please ensure you enter your full name&quot;</span><span class="nt">&gt;&lt;/p&gt;</span>
    <span class="nt">&lt;p&gt;</span>Date of Birth: <span class="nt">&lt;input</span> <span class="na">name=</span><span class="s">&quot;dob&quot;</span> <span class="na">placeholder=</span><span class="s">&quot;dd/mm/yyyy&quot;</span> <span class="na">class=</span><span class="s">&quot;js-mandatory-field&quot;</span> <span class="na">data-message=</span><span class="s">&quot;Please ensure you enter a valid date format&quot;</span><span class="nt">&gt;&lt;/p&gt;</span>
    <span class="nt">&lt;p&gt;</span>Age: <span class="nt">&lt;input</span> <span class="na">name=</span><span class="s">&quot;age&quot;</span> <span class="na">type=</span><span class="s">&quot;number&quot;</span> <span class="na">class=</span><span class="s">&quot;js-mandatory-field&quot;</span> <span class="na">data-message=</span><span class="s">&quot;Please ensure you enter a valid age&quot;</span><span class="nt">&gt;&lt;/p&gt;</span>
    <span class="nt">&lt;p&gt;</span>Email: <span class="nt">&lt;input</span> <span class="na">name=</span><span class="s">&quot;email&quot;</span> <span class="na">type=</span><span class="s">&quot;email&quot;</span> <span class="na">class=</span><span class="s">&quot;js-mandatory-field&quot;</span> <span class="na">data-message=</span><span class="s">&quot;Please ensure you enter a valid email&quot;</span><span class="nt">&gt;&lt;/p&gt;</span>
    <span class="nt">&lt;p&gt;</span>Mobile: <span class="nt">&lt;input</span> <span class="na">name=</span><span class="s">&quot;mobile&quot;</span> <span class="na">class=</span><span class="s">&quot;js-mandatory-field&quot;</span> <span class="na">data-message=</span><span class="s">&quot;Please ensure you enter a valid mobile number&quot;</span><span class="nt">&gt;&lt;/p&gt;</span>
    <span class="nt">&lt;p&gt;</span>Password (8 alpha-numerical characters, at least either 1 number or 1 text character): <span class="nt">&lt;input</span> <span class="na">name=</span><span class="s">&quot;password&quot;</span> <span class="na">type=</span><span class="s">&quot;password&quot;</span> <span class="na">class=</span><span class="s">&quot;js-mandatory-field&quot;</span> <span class="na">data-message=</span><span class="s">&quot;Please ensure you enter a password that matches the criteria&quot;</span><span class="nt">&gt;&lt;/p&gt;</span>
    <span class="nt">&lt;p&gt;</span>Credit Card: <span class="nt">&lt;input</span> <span class="na">name=</span><span class="s">&quot;card&quot;</span> <span class="na">class=</span><span class="s">&quot;js-mandatory-field&quot;</span> <span class="na">data-message=</span><span class="s">&quot;Please ensure you enter a valid credit card number&quot;</span><span class="nt">&gt;&lt;/p&gt;</span>
    <span class="nt">&lt;p&gt;</span>To proceed please tick this box: <span class="nt">&lt;input</span> <span class="na">name=</span><span class="s">&quot;proceed&quot;</span> <span class="na">type=</span><span class="s">&quot;checkbox&quot;</span> <span class="na">class=</span><span class="s">&quot;js-mandatory-field&quot;</span> <span class="na">data-message=</span><span class="s">&quot;Please ensure you tick the box to proceed&quot;</span><span class="nt">&gt;&lt;/p&gt;</span>
    <span class="nt">&lt;p&gt;&lt;input</span> <span class="na">type=</span><span class="s">&quot;submit&quot;</span> <span class="na">value=</span><span class="s">&quot;Submit Form&quot;</span><span class="nt">&gt;&lt;/p&gt;</span>
<span class="nt">&lt;/form&gt;</span>
</pre></div>
</code></pre>
<h2><a name="javascript-set-up" class="anchor" href="#javascript-set-up"><span class="header-link"></span></a>JavaScript set-up</h2>
<p>Next let&#39;s look at our JavaScript set-up: we&#39;re utilising AMD to help keep our scripts modular and I&#39;m using the <a href="https://github.com/cujojs/curl">Curl.js AMD loader</a>.</p>
<p>So in our HTML file we&#39;ll load up the JavaScript files required…</p>
<pre><code class="lang-html"><div class="highlight"><pre><span class="nt">&lt;script </span><span class="na">src=</span><span class="s">&quot;Assets/Scripts/curl.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
<span class="nt">&lt;script </span><span class="na">src=</span><span class="s">&quot;Assets/Scripts/app.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
</pre></div>
</code></pre>
<p>Inside our app.js file we set-up a configuration object which handles the paths to the different dependencies we&#39;ll be using. We then load the &#39;Validation&#39; module (which is a Backbone.View)…</p>
<pre><code class="lang-js"><div class="highlight"><pre><span class="kd">var</span> <span class="nx">config</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">baseUrl</span><span class="o">:</span> <span class="s1">&#39;./Assets/Scripts/&#39;</span><span class="p">,</span>
    <span class="nx">pluginPath</span><span class="o">:</span> <span class="s1">&#39;plugins&#39;</span><span class="p">,</span>
    <span class="nx">paths</span><span class="o">:</span> <span class="p">{</span>
        <span class="s1">&#39;jquery&#39;</span><span class="o">:</span> <span class="s1">&#39;Libraries/jquery&#39;</span><span class="p">,</span>
        <span class="s1">&#39;lodash&#39;</span><span class="o">:</span> <span class="s1">&#39;Libraries/lodash&#39;</span><span class="p">,</span>
        <span class="s1">&#39;backbone&#39;</span><span class="o">:</span> <span class="s1">&#39;Libraries/backbone&#39;</span>
    <span class="p">},</span>
    <span class="nx">preloads</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;jquery&#39;</span><span class="p">,</span> <span class="s1">&#39;lodash&#39;</span><span class="p">]</span>
<span class="p">};</span>

<span class="cm">/*</span>
<span class="cm">    The `exports` suffix ensures we receive a reference to the global Backbone object</span>
<span class="cm">    It also provides a way to check that the script loaded correctly.</span>
<span class="cm">    Without the `exports` suffix, there&#39;s no way to tell if IE or Opera 404&#39;ed.</span>
<span class="cm"> */</span>
<span class="nx">curl</span><span class="p">(</span><span class="nx">config</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;jquery&#39;</span><span class="p">,</span> <span class="s1">&#39;lodash&#39;</span><span class="p">,</span> <span class="s1">&#39;js!backbone!exports=Backbone&#39;</span><span class="p">],</span> <span class="nx">init</span><span class="p">,</span> <span class="nx">error</span><span class="p">);</span>

<span class="kd">function</span> <span class="nx">init</span> <span class="p">(</span><span class="nx">$</span><span class="p">,</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">Backbone</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">curl</span><span class="p">(</span><span class="s1">&#39;Views/Validation&#39;</span><span class="p">);</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">error</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">warn</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</code></pre>
<p>Now we have our JavaScript set-up lets move onto the Backbone.View that will handle the validation of our form.</p>
<h2><a name="validation-module" class="anchor" href="#validation-module"><span class="header-link"></span></a>Validation Module</h2>
<p>We will go through each of the methods within this module so we can better understand what they&#39;re doing. There are four main methods and the rest are different validation methods.</p>
<p>The four main methods are:</p>
<ul>
<li><code>get_template</code></li>
<li><code>validate</code></li>
<li><code>process_errors</code></li>
<li><code>display_errors</code></li>
</ul>
<p>The validation methods are:</p>
<ul>
<li><code>validate_text</code></li>
<li><code>validate_number</code></li>
<li><code>validate_date</code></li>
<li><code>validate_email</code></li>
<li><code>validate_mobile</code></li>
<li><code>validate_password</code></li>
<li><code>validate_cardnumber</code></li>
<li><code>validate_checkbox</code></li>
</ul>
<p>So within the initialisation stage of the View we do a few things…</p>
<pre><code class="lang-js"><div class="highlight"><pre><span class="nx">initialize</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
    <span class="c1">// Self explanatory: stores all mandatory fields</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">mandatory_fields</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.js-mandatory-field&#39;</span><span class="p">);</span>

    <span class="c1">// This holds the template file we&#39;ll compile with data pulled from server</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">template</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>

    <span class="c1">// This holds the actual rendered template content</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">template_content</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>

    <span class="c1">// We&#39;ll go ahead and grab the error message template file (no point waiting until the last minute and making the user wait).</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">get_template</span><span class="p">();</span>
<span class="p">}}</span>
</pre></div>
</code></pre>
<ul>
<li>Store a reference to all mandatory fields</li>
<li>Create a <code>template</code> property</li>
<li>Create a <code>template_content</code> property</li>
<li>Call the <code>get_template</code> method</li>
</ul>
<p>The reason we call the <code>get_template</code> method straight away (before the form has been submitted) is because it&#39;s a safe assumption that on a form, the user is likely to make an error in the data they submit so why not just go ahead and grab the template we&#39;ll need to render and display errors with.</p>
<p>The <code>get_template</code> method is called immediately but later on we also check to see if we need to try calling it again (e.g. when the user actually submits the form we check to see if <code>this.template</code> holds any value and if it does then we use it, otherwise we call <code>get_template</code> again to grab the data) so this is why we check within that method for a <code>callback</code> to be provided (when the template is loaded we want to continue on and process the errors found)</p>
<pre><code class="lang-js"><div class="highlight"><pre><span class="nx">get_template</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
        <span class="nx">url</span><span class="o">:</span> <span class="s1">&#39;Assets/Templates/FormErrors.txt&#39;</span><span class="p">,</span>
        <span class="nx">dataType</span><span class="o">:</span> <span class="s1">&#39;html&#39;</span><span class="p">,</span>
        <span class="nx">success</span><span class="o">:</span> <span class="nx">_</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">tmp</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">template</span> <span class="o">=</span> <span class="nx">hogan</span><span class="p">.</span><span class="nx">compile</span><span class="p">(</span><span class="nx">tmp</span><span class="p">);</span>

            <span class="k">if</span> <span class="p">(</span><span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">callback</span><span class="p">();</span>
            <span class="p">}</span>
        <span class="p">},</span> <span class="k">this</span><span class="p">)</span>
    <span class="p">});</span>
<span class="p">}</span>
</pre></div>
</code></pre>
<p>We then listen out for the form submission event to happen and call the <code>validate</code> method to handle the event…</p>
<pre><code class="lang-js"><div class="highlight"><pre><span class="nx">events</span><span class="o">:</span> <span class="p">{</span>
    <span class="s1">&#39;submit&#39;</span><span class="o">:</span> <span class="s1">&#39;validate&#39;</span>
<span class="p">}</span>
</pre></div>
</code></pre>
<p>The <code>validate</code> method creates an Array to hold any errors we encounter. The way we determine if there are any errors is to loop through all the mandatory fields and to check the name attribute value to see if we can find a match to known values. If we can&#39;t find a match then we just validate the field to make sure it has a value. If we do find a match (e.g. if the name attribute is &quot;email&quot;) then we know which validation method to pass the field on to validate against.</p>
<p>If the validation method returns <code>true</code> then that means an issue was found and so the field failed the validation and we store the specific error message for that field in the <code>errors</code> Array.</p>
<p>After we&#39;ve been through all the mandatory fields we check to see if the <code>errors</code> Array has any items, if it does then we know we need to process some errors and call <code>this.process_errors</code> and pass the <code>errors</code> Array through to that method.</p>
<pre><code class="lang-js"><div class="highlight"><pre><span class="nx">validate</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
    <span class="kd">var</span> <span class="nx">errors</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="kd">var</span> <span class="nx">method</span><span class="p">;</span>

    <span class="c1">// Loop through all the fields checking for validation errors</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">mandatory_fields</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">index</span><span class="p">,</span> <span class="nx">item</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// First we check what the current field is and validate it against a specific method</span>
        <span class="k">switch</span> <span class="p">(</span><span class="nx">item</span><span class="p">.</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">case</span> <span class="s1">&#39;dob&#39;</span><span class="o">:</span>
                <span class="nx">method</span> <span class="o">=</span> <span class="s1">&#39;validate_date&#39;</span><span class="p">;</span>
                <span class="k">break</span><span class="p">;</span>
            <span class="k">case</span> <span class="s1">&#39;age&#39;</span><span class="o">:</span>
                <span class="nx">method</span> <span class="o">=</span> <span class="s1">&#39;validate_number&#39;</span><span class="p">;</span>
                <span class="k">break</span><span class="p">;</span>
            <span class="k">case</span> <span class="s1">&#39;email&#39;</span><span class="o">:</span>
                <span class="nx">method</span> <span class="o">=</span> <span class="s1">&#39;validate_email&#39;</span><span class="p">;</span>
                <span class="k">break</span><span class="p">;</span>
            <span class="k">case</span> <span class="s1">&#39;mobile&#39;</span><span class="o">:</span>
                <span class="nx">method</span> <span class="o">=</span> <span class="s1">&#39;validate_mobile&#39;</span><span class="p">;</span>
                <span class="k">break</span><span class="p">;</span>
            <span class="k">case</span> <span class="s1">&#39;password&#39;</span><span class="o">:</span>
                <span class="nx">method</span> <span class="o">=</span> <span class="s1">&#39;validate_password&#39;</span><span class="p">;</span>
                <span class="k">break</span><span class="p">;</span>
            <span class="k">case</span> <span class="s1">&#39;card&#39;</span><span class="o">:</span>
                <span class="nx">method</span> <span class="o">=</span> <span class="s1">&#39;validate_cardnumber&#39;</span><span class="p">;</span>
                <span class="k">break</span><span class="p">;</span>
            <span class="k">case</span> <span class="s1">&#39;proceed&#39;</span><span class="o">:</span>
                <span class="nx">method</span> <span class="o">=</span> <span class="s1">&#39;validate_checkbox&#39;</span><span class="p">;</span>
                <span class="k">break</span><span class="p">;</span>
            <span class="k">default</span><span class="o">:</span>
                <span class="nx">method</span> <span class="o">=</span> <span class="s1">&#39;validate_text&#39;</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">[</span><span class="nx">method</span><span class="p">](</span><span class="nx">item</span><span class="p">))</span> <span class="p">{</span>
            <span class="c1">// Store just the messages and not the element itself (we only need the list of messages)</span>
            <span class="nx">errors</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">item</span><span class="p">.</span><span class="nx">getAttribute</span><span class="p">(</span><span class="s1">&#39;data-message&#39;</span><span class="p">));</span>
        <span class="p">}</span>
    <span class="p">},</span> <span class="k">this</span><span class="p">));</span>

    <span class="c1">// If there are any errors then display warning messsage to the user</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">errors</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">process_errors</span><span class="p">(</span><span class="nx">errors</span><span class="p">);</span>
        <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</code></pre>
<p>The first thing the <code>process_errors</code> method does is it makes sure we are only dealing with unique error messages. For example if we have a set of &#39;sort code&#39; fields (which are typically three separate fields) they will all have the same error message but we don&#39;t want that error message displayed three times so the <code>_.unique</code> method ensures our errors are unique.</p>
<p>After that we need to make sure that Hogan.js has the error messages in a format it can handle so we use the <code>map</code> method to convert the data to the relevant format required.</p>
<p>Next we need to convert the jQuery collection into an actual Array for Hogan.js to be able to loop through it.</p>
<p>Finally we check if the template file has been loaded already or not. If it hasn&#39;t then we load it via ajax and then call the <code>display_errors</code> method.</p>
<pre><code class="lang-js"><div class="highlight"><pre><span class="nx">process_errors</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">errors</span><span class="p">)</span> <span class="p">{</span>
    <span class="cm">/*</span>
<span class="cm">        Clean the errors list so we only have unique data.</span>
<span class="cm">        This happens for things like the postcode validation (no point showing the postcode field error message twice)</span>
<span class="cm">     */</span>
    <span class="kd">var</span> <span class="nx">clean_list</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">unique</span><span class="p">(</span><span class="nx">errors</span><span class="p">);</span>

    <span class="c1">// The list needs to be converted into an Object for Hogan.js to compile the data into its template</span>
    <span class="kd">var</span> <span class="nx">converted_list</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nx">clean_list</span><span class="p">).</span><span class="nx">map</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">index</span><span class="p">,</span> <span class="nx">item</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="nx">error</span><span class="o">:</span> <span class="nx">item</span>
        <span class="p">};</span>
    <span class="p">});</span>

    <span class="c1">// Spent far longer on this than I wanted to, but this is it: jQuery collection is not an Array and so needs to be converted to an Array for Hogan.js to compile it</span>
    <span class="kd">var</span> <span class="nx">final_list</span> <span class="o">=</span> <span class="nx">jQuery</span><span class="p">.</span><span class="nx">makeArray</span><span class="p">(</span><span class="nx">converted_list</span><span class="p">);</span>

    <span class="c1">// If the template file has been stored already then we&#39;ll just proceed to render the content</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">template</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">display_errors</span><span class="p">({</span> <span class="nx">errors</span><span class="o">:</span> <span class="nx">final_list</span> <span class="p">});</span>
    <span class="p">}</span> 
    <span class="c1">// Otherwise grab the template file and then render the content</span>
    <span class="k">else</span> <span class="p">{</span>
        <span class="c1">// Have to rebind the `this` value as otherwise it would be equal to the global object (Window)</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">get_template</span><span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">display_errors</span><span class="p">({</span> <span class="nx">errors</span><span class="o">:</span> <span class="nx">final_list</span> <span class="p">});</span>
        <span class="p">},</span> <span class="k">this</span><span class="p">));</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</code></pre>
<p>The <code>display_errors</code> method takes in the object of errors we&#39;ve created and tries to compile it into the template file using Hogan.js</p>
<p>But the first thing the method does is check if any errors already exist in the page. If it finds an errors element then it removes it.</p>
<p>We then compile the data into the template file and insert it into the page (thus displaying the errors to the user).</p>
<p>We then update the URL hash to include the id value of the form errors element we&#39;ve just inserted into the page. This is because on a long form the errors are displayed at the top of the form, but the user may well not see it because the page only shows the bottom half the form, so we redirect the user back up to the top of the form to see the errors.</p>
<p>I know some people will disagree with doing that and would prefer to display an error next to each field but I find that makes the design of the page a lot more complicated, especially when dealing with multiple screen dimensions. I personally prefer to have a single place to display all errors.</p>
<pre><code class="lang-js"><div class="highlight"><pre><span class="nx">display_errors</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// First remove any errors that might already be on the page</span>
    <span class="kd">var</span> <span class="nx">existing_list</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#js-formerrors&#39;</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">existing_list</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">existing_list</span><span class="p">.</span><span class="nx">remove</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="c1">// Render the data into the template</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">template_content</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">template</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>

    <span class="c1">// Insert the error messages into the page</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">prepend</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">template_content</span><span class="p">);</span>

    <span class="cm">/*</span>
<span class="cm">        Focus page to the error message element.</span>
<span class="cm">        Had issue with WebKit where it wouldn&#39;t reposition window to the named anchor unless we reset the hash back to nothing and then set it again to the named anchor</span>
<span class="cm">     */</span>
    <span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">hash</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
    <span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">hash</span> <span class="o">=</span> <span class="s1">&#39;js-formerrors&#39;</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</code></pre>
<p>The full module code is as follows...</p>
<pre><code class="lang-js"><div class="highlight"><pre><span class="nx">define</span><span class="p">([</span><span class="s1">&#39;../Utils/Templating/hogan&#39;</span><span class="p">],</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">hogan</span><span class="p">)</span> <span class="p">{</span>

    <span class="kd">var</span> <span class="nx">Validation</span> <span class="o">=</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">View</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
        <span class="nx">initialize</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
            <span class="c1">// Self explanatory: stores all mandatory fields</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">mandatory_fields</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.js-mandatory-field&#39;</span><span class="p">);</span>

            <span class="c1">// This holds the template file we&#39;ll compile with data pulled from server</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">template</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>

            <span class="c1">// This holds the actual rendered template content</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">template_content</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>

            <span class="c1">// We&#39;ll go ahead and grab the error message template file (no point waiting until the last minute and making the user wait).</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">get_template</span><span class="p">();</span>
        <span class="p">},</span>

        <span class="nx">el</span><span class="o">:</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#js-form&#39;</span><span class="p">),</span>

        <span class="nx">events</span><span class="o">:</span> <span class="p">{</span>
            <span class="s1">&#39;submit&#39;</span><span class="o">:</span> <span class="s1">&#39;validate&#39;</span>
        <span class="p">},</span>

        <span class="nx">get_template</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
                <span class="nx">url</span><span class="o">:</span> <span class="s1">&#39;Assets/Templates/FormErrors.txt&#39;</span><span class="p">,</span>
                <span class="nx">dataType</span><span class="o">:</span> <span class="s1">&#39;html&#39;</span><span class="p">,</span>
                <span class="nx">success</span><span class="o">:</span> <span class="nx">_</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">tmp</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">this</span><span class="p">.</span><span class="nx">template</span> <span class="o">=</span> <span class="nx">hogan</span><span class="p">.</span><span class="nx">compile</span><span class="p">(</span><span class="nx">tmp</span><span class="p">);</span>

                    <span class="k">if</span> <span class="p">(</span><span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
                        <span class="nx">callback</span><span class="p">();</span>
                    <span class="p">}</span>
                <span class="p">},</span> <span class="k">this</span><span class="p">)</span>
            <span class="p">});</span>
        <span class="p">},</span>

        <span class="nx">validate</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
            <span class="kd">var</span> <span class="nx">errors</span> <span class="o">=</span> <span class="p">[];</span>
            <span class="kd">var</span> <span class="nx">method</span><span class="p">;</span>

            <span class="c1">// Loop through all the fields checking for validation errors</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">mandatory_fields</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">index</span><span class="p">,</span> <span class="nx">item</span><span class="p">)</span> <span class="p">{</span>
                <span class="c1">// First we check what the current field is and validate it against a specific method</span>
                <span class="k">switch</span> <span class="p">(</span><span class="nx">item</span><span class="p">.</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">case</span> <span class="s1">&#39;dob&#39;</span><span class="o">:</span>
                        <span class="nx">method</span> <span class="o">=</span> <span class="s1">&#39;validate_date&#39;</span><span class="p">;</span>
                        <span class="k">break</span><span class="p">;</span>
                    <span class="k">case</span> <span class="s1">&#39;age&#39;</span><span class="o">:</span>
                        <span class="nx">method</span> <span class="o">=</span> <span class="s1">&#39;validate_number&#39;</span><span class="p">;</span>
                        <span class="k">break</span><span class="p">;</span>
                    <span class="k">case</span> <span class="s1">&#39;email&#39;</span><span class="o">:</span>
                        <span class="nx">method</span> <span class="o">=</span> <span class="s1">&#39;validate_email&#39;</span><span class="p">;</span>
                        <span class="k">break</span><span class="p">;</span>
                    <span class="k">case</span> <span class="s1">&#39;mobile&#39;</span><span class="o">:</span>
                        <span class="nx">method</span> <span class="o">=</span> <span class="s1">&#39;validate_mobile&#39;</span><span class="p">;</span>
                        <span class="k">break</span><span class="p">;</span>
                    <span class="k">case</span> <span class="s1">&#39;password&#39;</span><span class="o">:</span>
                        <span class="nx">method</span> <span class="o">=</span> <span class="s1">&#39;validate_password&#39;</span><span class="p">;</span>
                        <span class="k">break</span><span class="p">;</span>
                    <span class="k">case</span> <span class="s1">&#39;card&#39;</span><span class="o">:</span>
                        <span class="nx">method</span> <span class="o">=</span> <span class="s1">&#39;validate_cardnumber&#39;</span><span class="p">;</span>
                        <span class="k">break</span><span class="p">;</span>
                    <span class="k">case</span> <span class="s1">&#39;proceed&#39;</span><span class="o">:</span>
                        <span class="nx">method</span> <span class="o">=</span> <span class="s1">&#39;validate_checkbox&#39;</span><span class="p">;</span>
                        <span class="k">break</span><span class="p">;</span>
                    <span class="k">default</span><span class="o">:</span>
                        <span class="nx">method</span> <span class="o">=</span> <span class="s1">&#39;validate_text&#39;</span><span class="p">;</span>
                <span class="p">}</span>

                <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">[</span><span class="nx">method</span><span class="p">](</span><span class="nx">item</span><span class="p">))</span> <span class="p">{</span>
                    <span class="c1">// Store just the messages and not the element itself (we only need the list of messages)</span>
                    <span class="nx">errors</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">item</span><span class="p">.</span><span class="nx">getAttribute</span><span class="p">(</span><span class="s1">&#39;data-message&#39;</span><span class="p">));</span>
                <span class="p">}</span>
            <span class="p">},</span> <span class="k">this</span><span class="p">));</span>

            <span class="c1">// If there are any errors then display warning messsage to the user</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">errors</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">process_errors</span><span class="p">(</span><span class="nx">errors</span><span class="p">);</span>
                <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">},</span>

        <span class="nx">validate_text</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">field</span><span class="p">)</span> <span class="p">{</span>
            <span class="cm">/*</span>
<span class="cm">                If the length is zero (meaning the field is empty) then zero will coerce to false </span>
<span class="cm">                so we return the opposite of that using the ! operator (so the first part of the following condition is met) </span>
<span class="cm">                and if the length is greater than zero then the regex checks to see if the content isn&#39;t just empty spaces.</span>

<span class="cm">                If there was an error then we return true, if there wasn&#39;t an error then undefined will be returned (which coerces to false)</span>
<span class="cm">             */</span>
            <span class="k">if</span> <span class="p">(</span><span class="sr">/^\s+$/</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">field</span><span class="p">.</span><span class="nx">value</span><span class="p">)</span> <span class="o">||</span> <span class="o">!</span><span class="nx">field</span><span class="p">.</span><span class="nx">value</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">},</span>

        <span class="nx">validate_number</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">field</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="sr">/^\D+/</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">field</span><span class="p">.</span><span class="nx">value</span><span class="p">)</span> <span class="o">||</span> <span class="o">!</span><span class="nx">field</span><span class="p">.</span><span class="nx">value</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">},</span>

        <span class="nx">validate_date</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">field</span><span class="p">)</span> <span class="p">{</span>
            <span class="cm">/*</span>
<span class="cm">                The regex allows either double figure formats or singular...</span>
<span class="cm">                00/00/00</span>
<span class="cm">                0/0/0</span>
<span class="cm">             */</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="sr">/^\d{1,2}\/\d{1,2}\/\d{1,2}$/</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">field</span><span class="p">.</span><span class="nx">value</span><span class="p">)</span> <span class="o">||</span> <span class="o">!</span><span class="nx">field</span><span class="p">.</span><span class="nx">value</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">},</span>

        <span class="nx">validate_email</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">field</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">field</span><span class="p">.</span><span class="nx">value</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s2">&quot;@&quot;</span><span class="p">)</span> <span class="o">===</span> <span class="o">-</span><span class="mi">1</span> <span class="o">||</span> <span class="o">!</span><span class="nx">field</span><span class="p">.</span><span class="nx">value</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">},</span>

        <span class="nx">validate_mobile</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">field</span><span class="p">)</span> <span class="p">{</span>
            <span class="cm">/*</span>
<span class="cm">                The regex allows the following formats:</span>
<span class="cm">                    +44 07000000000</span>
<span class="cm">                    07000000000</span>
<span class="cm">                    +4407000000000</span>

<span class="cm">                So there is an optional +000 country code at the start (wrapped in a non-capturing group)</span>
<span class="cm">                We then allow for an optional space after the optional country code</span>
<span class="cm">                Finally we allow for 11 digits (no spaces - but we also strip out any spaces found before running the regex so the &#39;no spaces&#39; thing doesn&#39;t really matter)</span>
<span class="cm">             */</span>
            <span class="kd">var</span> <span class="nx">strip_spaces</span> <span class="o">=</span> <span class="nx">field</span><span class="p">.</span><span class="nx">value</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">);</span> <span class="c1">// some people seem to add odd spacing when enterin numbers?</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="sr">/^(?:\+\d{1,3})?\s?\d{11}$/</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">strip_spaces</span><span class="p">)</span> <span class="o">||</span> <span class="o">!</span><span class="nx">field</span><span class="p">.</span><span class="nx">value</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">},</span>

        <span class="nx">validate_password</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">field</span><span class="p">)</span> <span class="p">{</span>
            <span class="cm">/*</span>
<span class="cm">                The regex makes sure there is at least 8 alpha-numerical characters</span>
<span class="cm">                And that at least one of those values is a number</span>
<span class="cm">                And that at least one of those values is a text character</span>
<span class="cm">                We use a positive lookahead (which checks to see if a sub pattern matches a specific position)</span>
<span class="cm">                The lookahead checks for any character (zero or more times) is followed by a digit (e.g. making sure there is at least one digit)</span>
<span class="cm">                The lookahead then checks for any character (zero or more times) is followed by a text character (e.g. making sure there is at least one text character)</span>
<span class="cm">                Finally after the two lookaheads we have the standard regex which makes sure there is at least 8 alpha-numerical characters</span>
<span class="cm">             */</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="sr">/^(?=.*\d)(?=.*[a-z])\w{8,}/i</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">field</span><span class="p">.</span><span class="nx">value</span><span class="p">))</span> <span class="p">{</span>
                <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">},</span>

        <span class="nx">validate_cardnumber</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">field</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">function</span> <span class="nx">luhn</span> <span class="p">(</span><span class="nx">cardnumber</span><span class="p">)</span> <span class="p">{</span>
                <span class="c1">// Build an array with the digits in the card number</span>
                <span class="kd">var</span> <span class="nx">getdigits</span> <span class="o">=</span> <span class="sr">/\d/g</span><span class="p">;</span>
                <span class="kd">var</span> <span class="nx">digits</span> <span class="o">=</span> <span class="p">[];</span>
                <span class="kd">var</span> <span class="nx">match</span><span class="p">;</span>

                <span class="k">while</span> <span class="p">(</span><span class="nx">match</span> <span class="o">=</span> <span class="nx">getdigits</span><span class="p">.</span><span class="nx">exec</span><span class="p">(</span><span class="nx">cardnumber</span><span class="p">))</span> <span class="p">{</span>
                    <span class="nx">digits</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nb">parseInt</span><span class="p">(</span><span class="nx">match</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">10</span><span class="p">));</span>
                <span class="p">}</span>

                <span class="c1">// Run the Luhn algorithm on the array</span>
                <span class="kd">var</span> <span class="nx">sum</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
                <span class="kd">var</span> <span class="nx">alt</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>

                <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="nx">digits</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span><span class="o">--</span><span class="p">)</span> <span class="p">{</span>
                    <span class="c1">// On every other number in the card sequence...</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nx">alt</span><span class="p">)</span> <span class="p">{</span>
                        <span class="nx">digits</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">*=</span> <span class="mi">2</span><span class="p">;</span> <span class="c1">// multiple the number by itself</span>

                        <span class="c1">// If the number is now over 9 then we&#39;ll minus 9 from the number</span>
                        <span class="k">if</span> <span class="p">(</span><span class="nx">digits</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">9</span><span class="p">)</span> <span class="p">{</span>
                            <span class="nx">digits</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">-=</span> <span class="mi">9</span><span class="p">;</span>
                        <span class="p">}</span>
                    <span class="p">}</span>

                    <span class="c1">// Add this digit onto the current total sum</span>
                    <span class="nx">sum</span> <span class="o">+=</span> <span class="nx">digits</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>

                    <span class="c1">// Alternate</span>
                    <span class="nx">alt</span> <span class="o">=</span> <span class="o">!</span><span class="nx">alt</span><span class="p">;</span>
                <span class="p">}</span>

                <span class="cm">/*</span>
<span class="cm">                    The individual card numbers (after the above algorithm is applied and then when added together) </span>
<span class="cm">                    should be possible to divide by 10 with zero left over</span>
<span class="cm">                 */</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">sum</span> <span class="o">%</span> <span class="mi">10</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                    <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
                <span class="p">}</span>
            <span class="p">}</span>

            <span class="c1">// The following regex was actually borrowed from The Regular Expression Cookbook (co-written by the regex legend @stevenlevithan)</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="sr">/^(?:4[0-9]{12}(?:[0-9]{3})?|5[1-5][0-9]{14}|6(?:011|5[0-9][0-9])[0-9]{12}|3[47][0-9]{13}|3(?:0[0-5]|[68][0-9])[0-9]{11}|(?:2131|1800|35\d{3})\d{11})$/g</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">field</span><span class="p">.</span><span class="nx">value</span><span class="p">))</span> <span class="p">{</span>
                <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="c1">// If the card number appears to be valid we then run the Luhn test</span>
                <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">luhn</span><span class="p">(</span><span class="nx">field</span><span class="p">.</span><span class="nx">value</span><span class="p">))</span> <span class="p">{</span>
                    <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">},</span>

        <span class="nx">validate_checkbox</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">field</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">field</span><span class="p">.</span><span class="nx">checked</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">},</span>

        <span class="nx">process_errors</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">errors</span><span class="p">)</span> <span class="p">{</span>
            <span class="cm">/*</span>
<span class="cm">                Clean the errors list so we only have unique data.</span>
<span class="cm">                This happens for things like the postcode validation (no point showing the postcode field error message twice)</span>
<span class="cm">             */</span>
            <span class="kd">var</span> <span class="nx">clean_list</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">unique</span><span class="p">(</span><span class="nx">errors</span><span class="p">);</span>

            <span class="c1">// The list needs to be converted into an Object for Hogan.js to compile the data into its template</span>
            <span class="kd">var</span> <span class="nx">converted_list</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nx">clean_list</span><span class="p">).</span><span class="nx">map</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">index</span><span class="p">,</span> <span class="nx">item</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">return</span> <span class="p">{</span>
                    <span class="nx">error</span><span class="o">:</span> <span class="nx">item</span>
                <span class="p">};</span>
            <span class="p">});</span>

            <span class="c1">// Spent far longer on this than I wanted to, but this is it: jQuery collection is not an Array and so needs to be converted to an Array for Hogan.js to compile it</span>
            <span class="kd">var</span> <span class="nx">final_list</span> <span class="o">=</span> <span class="nx">jQuery</span><span class="p">.</span><span class="nx">makeArray</span><span class="p">(</span><span class="nx">converted_list</span><span class="p">);</span>

            <span class="c1">// If the template file has been stored already then we&#39;ll just proceed to render the content</span>
            <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">template</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">display_errors</span><span class="p">({</span> <span class="nx">errors</span><span class="o">:</span> <span class="nx">final_list</span> <span class="p">});</span>
            <span class="p">}</span> 
            <span class="c1">// Otherwise grab the template file and then render the content</span>
            <span class="k">else</span> <span class="p">{</span>
                <span class="c1">// Have to rebind the `this` value as otherwise it would be equal to the global object (Window)</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">get_template</span><span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
                    <span class="k">this</span><span class="p">.</span><span class="nx">display_errors</span><span class="p">({</span> <span class="nx">errors</span><span class="o">:</span> <span class="nx">final_list</span> <span class="p">});</span>
                <span class="p">},</span> <span class="k">this</span><span class="p">));</span>
            <span class="p">}</span>
        <span class="p">},</span>

        <span class="nx">display_errors</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// First remove any errors that might already be on the page</span>
            <span class="kd">var</span> <span class="nx">existing_list</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#js-formerrors&#39;</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">existing_list</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">existing_list</span><span class="p">.</span><span class="nx">remove</span><span class="p">();</span>
            <span class="p">}</span>

            <span class="c1">// Render the data into the template</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">template_content</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">template</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>

            <span class="c1">// Insert the error messages into the page</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">prepend</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">template_content</span><span class="p">);</span>

            <span class="cm">/*</span>
<span class="cm">                Focus page to the error message element.</span>
<span class="cm">                Had issue with WebKit where it wouldn&#39;t reposition window to the named anchor unless we reset the hash back to nothing and then set it again to the named anchor</span>
<span class="cm">             */</span>
            <span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">hash</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
            <span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">hash</span> <span class="o">=</span> <span class="s1">&#39;js-formerrors&#39;</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">});</span>

    <span class="k">new</span> <span class="nx">Validation</span><span class="p">();</span>

<span class="p">});</span>
</pre></div>
</code></pre>
<h2><a name="conclusion" class="anchor" href="#conclusion"><span class="header-link"></span></a>Conclusion</h2>
<p>OK, so that&#39;s our full validation method! It looks big but when you break it down it&#39;s not actually that complicated.</p>
<p>It works for me and has made my life a hell of a lot easier whenever I&#39;ve needed to validate a form. Hopefully it helps someone else, or inspires some one to take the principles shown here and to build their own variation so their life is a little easier when dealing with forms.</p>
</div>

  <div class="comments">
    <a href="/posts/backbone-validation/#comments">
      <span class="icon-bubbles"></span>
      Comments
    </a>
  </div>

  <div class="post-head group">
  <a href="/posts/javascript-101/">
    <h1 class="post-title">JavaScript 101</h1>
  </a>
  <span class="post-date">2012 &#183; 11 &#183; 24</span>
</div>

<div class="post-body"><h2><a name="what-well-cover" class="anchor" href="#what-well-cover"><span class="header-link"></span></a>What we&#39;ll cover</h2>
<p><em>reading time: approx. 23mins</em></p>
<ul>
<li>Introduction</li>
<li>What is JavaScript</li>
<li>Terminology</li>
<li>Global Object</li>
<li>Variables</li>
<li>Types</li>
<li>Objects</li>
<li>Arrays</li>
<li>Conditional Statements</li>
<li>Coercion</li>
<li>Functions</li>
<li>Code Reuse (inheritance)</li>
<li>Conclusion</li>
</ul>
<h2><a name="introduction" class="anchor" href="#introduction"><span class="header-link"></span></a>Introduction</h2>
<p>I&#39;ve written this <em>very</em> brief guide to JavaScript just as an aid for people new to the language and who need a basic starting point to see what the syntax looks like and to get a feeling for some of its features.</p>
<p>This article&#39;s main purpose is to give readers new to the language a glimpse of the JavaScript environment and to hopefully spur them onto further reading/learning. </p>
<h2><a name="what-is-javascript" class="anchor" href="#what-is-javascript"><span class="header-link"></span></a>What is JavaScript</h2>
<p>JavaScript is a <em>scripting language</em> - this means it is not <em>compiled</em> (like traditional software languages like C or C++) but is executed &#39;line by line&#39; via its host environment at run time (the host environment can be: Web Browser, Server, Command Line, Desktop).</p>
<h2><a name="terminology" class="anchor" href="#terminology"><span class="header-link"></span></a>Terminology</h2>
<table>
<thead>
<tr>
<th>Term</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr>
<td>expression</td>
<td>An expression is a command that the JavaScript engine can <em>evaluate</em> to produce a value</td>
</tr>
<tr>
<td>statement</td>
<td>A statement is a command that can be executed (statements are terminated with a semicolon)</td>
</tr>
<tr>
<td>identifier</td>
<td>A name (e.g. variable name, function name, labels for loops).</td>
</tr>
<tr>
<td>function declaration</td>
<td><code>function myFunction(){ /* code */ }</code></td>
</tr>
<tr>
<td>function expression</td>
<td><code>var myFunction = function(){ /* code */ };</code></td>
</tr>
<tr>
<td>primitive</td>
<td><code>undefined</code>, <code>null</code>, <code>boolean</code>, <code>string</code> and <code>number</code></td>
</tr>
<tr>
<td>operator</td>
<td><code>+</code>, <code>-</code>, <code>!</code>, <code>++</code>, <code>===</code>, <code>&amp;&amp;</code>, <code>typeof</code></td>
</tr>
</tbody>
</table>
<h3><a name="expressions" class="anchor" href="#expressions"><span class="header-link"></span></a>Expressions</h3>
<p>An example of an &#39;expression&#39; would be <code>1+1</code>. </p>
<p>Looks straight forward enough, and it should be. As mentioned above, an expression is simply <em>something</em> that can be interpreted as a value. So <code>1+1</code> (when evaluated by the JavaScript engine) results in an number with a value of two. </p>
<p>Now the expression <code>1+1</code> is pretty useless in a JavaScript program because we&#39;re not doing anything with it. For us to more effectively use this expression we ideally want to store it somewhere so we can reference it later and that&#39;s where &#39;variables&#39; come in (see later on this article).</p>
<h3><a name="statements" class="anchor" href="#statements"><span class="header-link"></span></a>Statements</h3>
<p>Examples of JavaScript &#39;statements&#39;: </p>
<ul>
<li><code>if (condition) { /* code */ }</code></li>
<li><code>while (condition) { /* code */ }</code></li>
<li><code>return</code>, <code>break</code>, <code>throw</code> are single command statements</li>
</ul>
<h2><a name="global-object" class="anchor" href="#global-object"><span class="header-link"></span></a>Global Object</h2>
<p>When the JavaScript interpreter starts up it creates a Global object and any properties/methods added to the Global object are available to the entire JavaScript program.</p>
<p>The global object is a regular object (as per the Object section seen later in this article).</p>
<p>The global object is different depending on the context. In a web browser environment the global object is said to be the <code>window</code> object. But this isn&#39;t completely accurate. The global object happens to have a <code>window</code> property which is set back to the global object itself! A little confusing I know :-) If you open a browser console (e.g. Firefox&#39;s Firebug JavaScript Console, or Safari/Google Chrome&#39;s Console Tool) and enter the command <code>window</code> you&#39;ll see all the properties/methods available on that object - things like <code>window.location</code> will be one option that is listed (this references the location bar API of the web browser).</p>
<p>One quote you&#39;ll hear a lot in JavaScript is:</p>
<blockquote>
<p>Don&#39;t pollute the global environment</p>
</blockquote>
<p>…and what this means is try to avoid creating global properties and methods. The less &#39;globals&#39; you create then the less likely your code will conflict with another piece of code written by someone else that may be included in the same page.</p>
<p>To avoid declaring global properties/methods there are certain &#39;patterns&#39; that have been designed to work around this issue, such as the IIFE pattern…</p>
<pre><code class="lang-js"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> * this pattern is referred to as an IIFE (immediately invoked function expression)</span>
<span class="cm"> * the function is immediately executed and all code within it is scoped to the function</span>
<span class="cm"> * when executed we pass through &#39;this&#39; which refers to the global object</span>
<span class="cm"> * we accept &#39;this&#39; into the function as an argument called &#39;global&#39;</span>
<span class="cm"> */</span>
<span class="kd">var</span> <span class="nx">app</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">global</span><span class="p">)</span> <span class="p">{</span>

    <span class="c1">// private data (private as in: it can&#39;t be accessed from other code outside this function)</span>
    <span class="c1">// note: don&#39;t EVER name your functions like this!</span>
    <span class="kd">function</span> <span class="nx">will_be_made_public_but_cant_be_accessed_directly</span><span class="p">(){</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Private&#39;</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="p">{</span>
        <span class="c1">// public API (private code we&#39;ve chosen to make public)</span>
        <span class="nx">do_something</span><span class="o">:</span> <span class="nx">will_be_made_public_but_cant_be_accessed_directly</span>
    <span class="p">};</span>

<span class="p">}(</span><span class="k">this</span><span class="p">));</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">will_be_made_public_but_cant_be_accessed_directly</span><span class="p">()</span> <span class="c1">// TypeError: Object #&lt;Object&gt; has no method &#39;will_be_made_public_but_cant_be_accessed_directly&#39;</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">do_something</span><span class="p">();</span> <span class="c1">// =&gt; &#39;Private&#39;</span>
</pre></div>
</code></pre>
<p>Another pattern is to use AMD (Asynchronous Module Definition) which is a module based pattern (see: <a href="https://github.com/Integralist/Blog-Posts/blob/master/Beginners-guide-to-AMD-and-RequireJS.md">Beginners guide to AMD and RequireJS</a>)</p>
<h2><a name="variables" class="anchor" href="#variables"><span class="header-link"></span></a>Variables</h2>
<p>Variables hold values/data. </p>
<p>You declare a variable like so: <code>var my_var = 123;</code> - in this example we&#39;ve declared a variable and assigned the value <code>123</code> to it.</p>
<p>You must always declare a variable. An undeclared variable looks like this: <code>my_var = 123;</code> - notice the lack of the <code>var</code> keyword. </p>
<p>Undeclared variables are a bad practice because they cause confusion as to whether the variable should be &#39;global&#39; or not.</p>
<p>Here is a break down of the different variable scenarios:</p>
<ul>
<li>Variable is declared within a function:<br>variable becomes scoped to that function (i.e. it isn&#39;t accessible outside of that function). </li>
<li>Variable is declared at the top level of the script file (e.g. not inside of a function):<br>variable becomes a global variable (i.e. is available any where within the JavaScript program).</li>
<li>Variable is undeclared (e.g. doesn&#39;t matter where in the program the undeclared variable was created):<br>variable becomes a global variable (i.e. is available any where within the JavaScript program).</li>
</ul>
<p>As you can see, missing a <code>var</code> declaration will mean the JavaScript engine will make that undeclared variable a &#39;global&#39; variable (e.g. it is assigned to the Global object).</p>
<p>To see why this is a problem first imagine you have a web page you&#39;re working on and in which you have included a 3rd party JavaScript file (i.e. a script written by another developer). Now imagine the content of that 3rd party script is as follows:</p>
<pre><code class="lang-js"><div class="highlight"><pre><span class="c1">// 3rd party script written by another developer...</span>
<span class="kd">var</span> <span class="nx">my_name</span> <span class="o">=</span> <span class="s1">&#39;Mark&#39;</span><span class="p">;</span>
</pre></div>
</code></pre>
<p>…in this instance, the 3rd party script hasn&#39;t wrapped the line <code>var my_name = &#39;Mark&#39;;</code> inside of an IIFE (see above pattern) so the variable <code>my_name</code> will be created as global property (e.g. it is available any where within the JavaScript program as well as explicitly via <code>window.my_name</code>).</p>
<p>Now you don&#39;t want to overwrite the variable <code>my_name</code> because the 3rd party script that defined it is relying on it being a String with a value of <code>Mark</code> - if you change the value then it could cause the 3rd party code to break.</p>
<p>So now imagine you&#39;re going to add your own code to the page. You write the following…</p>
<pre><code class="lang-js"><div class="highlight"><pre><span class="kd">function</span> <span class="nx">do_something</span><span class="p">(){</span>
    <span class="nx">my_name</span> <span class="o">=</span> <span class="s1">&#39;Bob&#39;</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</code></pre>
<p>…this may cause unintended side effects on the 3rd party code. Why? Because you coincidentally defined a variable by the same name of <code>my_name</code> and although you likely intended it to be scoped to the function <code>do_something</code> you&#39;ve accidentally forgotten the <code>var</code> keyword and so your variable is undeclared, so your variable has been assigned to the Global object, thus overwriting the <code>my_name</code> variable that is already available on the Global object (set by the 3rd party code).</p>
<p>To fix this you would simply make sure you properly declared your variable like so…</p>
<pre><code class="lang-js"><div class="highlight"><pre><span class="kd">function</span> <span class="nx">do_something</span><span class="p">(){</span>
    <span class="kd">var</span> <span class="nx">my_name</span> <span class="o">=</span> <span class="s1">&#39;Bob&#39;</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</code></pre>
<p>So now, even though the variable name is the same, the variable is &#39;scoped&#39; to the <code>do_something</code> function.</p>
<p>In today&#39;s world you&#39;ll be very hard pushed to find a library that sets anything more than one global variable - but it&#39;s an issue to be aware of in case you inherit a code base from a less educated developer.</p>
<p>Global properties aren&#39;t completely avoidable. A library will generally set one global which will act as a &#39;namespace&#39; for their entire app. For example, jQuery sets two globals <code>jQuery</code> and <code>$</code> and all their methods are available through those two globals so unless you&#39;re trying to use <code>jQuery</code> or <code>$</code> as your own namespace then you shouldn&#39;t notice any conflicts. </p>
<p>Most companies name their global namespace after their company: <code>var mycompany_app = /* code */;</code></p>
<h2><a name="types" class="anchor" href="#types"><span class="header-link"></span></a>Types</h2>
<p>JavaScript types are split into two groups: <code>primitive</code> types and <code>reference</code> types. </p>
<p><code>Numbers</code>, <code>Booleans</code>, <code>Strings</code>, <code>Null</code> and <code>Undefined</code> types are primitive. </p>
<p><code>Objects</code>, <code>Arrays</code>, and <code>Functions</code> are reference types. </p>
<p>It&#39;s important to know the different types because at some point in your JavaScript code you&#39;ll want to pass around values and objects and you might notice some issues with doing so. For example, you&#39;ll notice that JavaScript passes <code>Objects</code>/<code>Arrays</code>/<code>Functions</code> by reference, and passes primitives such as <code>Booleans</code>/<code>Strings</code>/<code>Numbers</code>/<code>Null</code>/<code>Undefined</code> by value.</p>
<p>What this means is if you have an Array and want to copy it so you can make changes to the copy (e.g. you want to leave the original as it is) then you might think to do something like this…</p>
<pre><code class="lang-js"><div class="highlight"><pre><span class="kd">var</span> <span class="nx">my_arr</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">];</span>
<span class="kd">var</span> <span class="nx">new_arr</span> <span class="o">=</span> <span class="nx">my_arr</span><span class="p">;</span>

<span class="nx">new_arr</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="s1">&#39;d&#39;</span><span class="p">);</span>
</pre></div>
</code></pre>
<p>…you might think that <code>new_arr</code> will be <code>[&quot;a&quot;, &quot;b&quot;, &quot;c&quot;, &quot;d&quot;]</code> and <code>my_arr</code> would still be equal to <code>[&quot;a&quot;, &quot;b&quot;, &quot;c&quot;]</code> but you&#39;d be wrong because Arrays are passed by &#39;reference&#39; and so your change: <code>new_arr.push(&#39;d&#39;);</code> is effectively doing this: <code>my_arr.push(&#39;d&#39;);</code>, hence <code>my_arr</code> now has the value of <code>[&quot;a&quot;, &quot;b&quot;, &quot;c&quot;, &quot;d&quot;]</code> and so does <code>new_arr</code> because it really is just referencing (i.e. pointing to) <code>my_arr</code>.</p>
<p>So be careful.</p>
<h2><a name="objects" class="anchor" href="#objects"><span class="header-link"></span></a>Objects</h2>
<p>To create a new <code>Object</code> use the syntax: <code>{}</code></p>
<p>For example:</p>
<pre><code class="lang-js"><div class="highlight"><pre><span class="kd">var</span> <span class="nx">obj</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;Mark&#39;</span><span class="p">,</span>
    <span class="nx">location</span><span class="o">:</span> <span class="s1">&#39;London, England&#39;</span>
<span class="p">};</span>
</pre></div>
</code></pre>
<p>A variable added to an Object is known as a &#39;property&#39;.<br>A function added to an Object is known as a &#39;method&#39;  </p>
<p>…this naming convention originates from traditional Object-Oriented languages.</p>
<p>So for example:</p>
<pre><code class="lang-js"><div class="highlight"><pre><span class="kd">var</span> <span class="nx">obj</span> <span class="o">=</span> <span class="p">{</span>
    <span class="cm">/* Property */</span>
        <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;Mark&#39;</span><span class="p">,</span>
    <span class="cm">/* Property */</span>
        <span class="nx">location</span><span class="o">:</span> <span class="s1">&#39;London, England&#39;</span><span class="p">,</span>
    <span class="cm">/* Method */</span>
        <span class="nx">get_details</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
            <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">name</span> <span class="o">+</span> <span class="s1">&#39; is from &#39;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">location</span><span class="p">;</span> <span class="c1">// =&gt; &quot;Mark is from London, England&quot;</span>
        <span class="p">}</span>
<span class="p">};</span>
</pre></div>
</code></pre>
<h3><a name="nearlyeverything-in-javascript-is-an-object" class="anchor" href="#nearlyeverything-in-javascript-is-an-object"><span class="header-link"></span></a>(Nearly)Everything in JavaScript is an Object</h3>
<p>One thing to be clear on is that nearly everything in JavaScript is an object (e.g. Functions, Arrays, Numbers, Strings etc). They all inherit their properties/attributes from the top level Object, and this is made possible in JavaScript via what&#39;s called the &#39;prototype chain&#39;. </p>
<p>We won&#39;t go into the &#39;prototype&#39; too deeply now but the following section will touch on how it works briefly.</p>
<h3><a name="prototype" class="anchor" href="#prototype"><span class="header-link"></span></a>Prototype</h3>
<p>Every Object you create in JavaScript has a hidden object tied to it. This hidden object is called the &#39;prototype&#39; for that object, and what this means is that your object you&#39;ve created will inherit properties from the prototype.</p>
<p>All &#39;objects&#39; that you create (e.g. <code>var obj = {};</code>) have the same prototype object they point to/reference - which is the top level <code>Object</code> in JavaScript. We call this <code>Object.prototype</code>, and this top level <code>Object</code> itself has no prototype (it&#39;s the only object that has no prototype because nothing precedes it).</p>
<p>All built-in Constructors (e.g. <code>Array.prototype</code>, <code>Date.prototype</code>) inherit from the <code>Object.prototype</code> and this linked set of objects is known as the &#39;prototype chain&#39; and is how &#39;inheritance&#39; works (see below for a short mention of inheritance and other forms of code reuse).</p>
<h3><a name="accessing-propertiesmethods" class="anchor" href="#accessing-propertiesmethods"><span class="header-link"></span></a>Accessing properties/methods</h3>
<p>To access properties/methods you can use either the dot notation or the bracket notation. The difference is in whether the property/method name is known at the type of execution or not.</p>
<p>Using the previous example code, if your program was written by you then to access the &#39;name&#39; property you would simply use: <code>obj.name</code> - but if your application accepted input from the user (where by you asked them what property/method they wanted to access) you obviously don&#39;t know before hand what the user is going to choose. In this instance you would use the bracket notation: </p>
<pre><code class="lang-js"><div class="highlight"><pre><span class="kd">var</span> <span class="nx">user_input</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;my_form_input&#39;</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">obj</span><span class="p">[</span><span class="nx">user_input</span><span class="p">]);</span>
</pre></div>
</code></pre>
<p>The other time you&#39;ll need to use bracket notation is if you want to access a property that has special characters:</p>
<pre><code class="lang-js"><div class="highlight"><pre><span class="kd">var</span> <span class="nx">obj</span> <span class="o">=</span> <span class="p">{</span> 
    <span class="s1">&#39;my property&#39;</span><span class="o">:</span> <span class="mi">123</span> <span class="c1">// YOU SHOULD NEVER NEED TO CREATE A PROPERTY NAME LIKE THIS</span>
<span class="p">};</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">obj</span><span class="p">[</span><span class="s1">&#39;my property&#39;</span><span class="p">]);</span>
</pre></div>
</code></pre>
<p>So the majority of the time you&#39;ll just use the dot notation, but depending on the dynamic aspect of your program you may need to use bracket notation every once in a while.</p>
<h3><a name="class-attribute" class="anchor" href="#class-attribute"><span class="header-link"></span></a>Class Attribute</h3>
<p>Every object has a <em>class</em> attribute which provides information about the object&#39;s type. </p>
<p>Sounds pretty useful, but unfortunately neither of the current specifications (ES3 or ES5) allow you to access this attribute!?</p>
<p>But there is a trick to accessing an object&#39;s <em>class</em> attribute and that is to call the <code>toString()</code> method on the top level <code>Object.prototype</code> but using it on the relevant object you want to get the class of. The following example demonstrates the most common use case of accessing the <em>class</em> attribute: trying to work out if an object is actually an <code>Array</code>…</p>
<pre><code class="lang-js"><div class="highlight"><pre><span class="kd">var</span> <span class="nx">arr</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="s1">&#39;c&#39;</span><span class="p">];</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">typeof</span> <span class="nx">arr</span><span class="p">);</span> <span class="c1">// =&gt; &quot;object&quot; - well that&#39;s not right, it should return the type as &#39;Array&#39;! (note: this is a known JavaScript bug)</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nb">Object</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">toString</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">arr</span><span class="p">));</span> <span class="c1">// =&gt; &quot;[object Array]&quot; - that&#39;s more like it</span>
</pre></div>
</code></pre>
<p>…what we&#39;ve done here is used a method available to all <code>Function</code>&#39;s called <code>.call()</code>. What this method does is let you call another function (i.e. borrow a function) but use the calling context as the <code>this</code> value.</p>
<p>That previous sentence probably didn&#39;t make a lot of sense because we&#39;ve not covered <code>this</code> or anything to do with contexts/execution environments etc - but try and stick with it for a moment and understand that what we&#39;ve done is called the <code>Object.prototype</code>&#39;s <code>toString</code> method but we&#39;ve called it as if it was our Array that had executed <code>toString</code>.</p>
<p>The way this trick works actually requires a deep level understanding of how JavaScript handles its conversion of data types: something I definitely wont go into here).</p>
<h2><a name="arrays" class="anchor" href="#arrays"><span class="header-link"></span></a>Arrays</h2>
<p>Arrays are like a simplified Object.</p>
<p>An Object is effectively a mapping of names (identifiers) to values… </p>
<pre><code class="lang-js"><div class="highlight"><pre><span class="kd">var</span> <span class="nx">obj</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">name</span><span class="o">:</span> <span class="nx">value</span><span class="p">,</span>
    <span class="nx">name</span><span class="o">:</span> <span class="nx">value</span><span class="p">,</span>
    <span class="nx">name</span><span class="o">:</span> <span class="nx">value</span>
<span class="p">};</span>
</pre></div>
</code></pre>
<p>…an Array is the same with the exception that the &#39;name&#39; identifiers are automatically incremented numerical values. So an Array like this…</p>
<pre><code class="lang-js"><div class="highlight"><pre><span class="kd">var</span> <span class="nx">arr</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">];</span>
</pre></div>
</code></pre>
<p>…would effectively be similar to the following object…</p>
<pre><code class="lang-js"><div class="highlight"><pre><span class="kd">var</span> <span class="nx">obj</span> <span class="o">=</span> <span class="p">{</span>
    <span class="mi">0</span><span class="o">:</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span>
    <span class="mi">1</span><span class="o">:</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span>
    <span class="mi">2</span><span class="o">:</span> <span class="s1">&#39;c&#39;</span>
<span class="p">};</span>
</pre></div>
</code></pre>
<p>Note: the above object with numerical keys requires you to use the bracket notation to access the identifiers (e.g. <code>obj[0]</code>) as <code>obj.0</code> would result in a <code>SyntaxError: Unexpected number</code>.</p>
<h3><a name="methods" class="anchor" href="#methods"><span class="header-link"></span></a>Methods</h3>
<p>Arrays come with many methods (functions) that let you manipulate and filter the data contained within the Array.</p>
<p>Some methods change the data in the Array (<em>mutators</em>).</p>
<p>Some methods return a new Array with the data changed (<em>accessors</em> - not the best/most descriptive name really,  as it suggests these methods just &#39;access&#39; data when that&#39;s not always the case).</p>
<p>Some methods loop through the data (<em>iterators</em>).</p>
<p>Below are some examples of each…</p>
<table>
<thead>
<tr>
<th>Mutators</th>
<th>Accessors</th>
<th>Iterators</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://developer.mozilla.org/en-US/docs/JavaScript/Reference/Global_Objects/Array/pop">pop</a></td>
<td><a href="https://developer.mozilla.org/en-US/docs/JavaScript/Reference/Global_Objects/Array/concat">concat</a></td>
<td><a href="https://developer.mozilla.org/en-US/docs/JavaScript/Reference/Global_Objects/Array/filter">filter</a></td>
</tr>
<tr>
<td><a href="https://developer.mozilla.org/en-US/docs/JavaScript/Reference/Global_Objects/Array/push">push</a></td>
<td><a href="https://developer.mozilla.org/en-US/docs/JavaScript/Reference/Global_Objects/Array/join">join</a></td>
<td><a href="https://developer.mozilla.org/en-US/docs/JavaScript/Reference/Global_Objects/Array/forEach">forEach</a></td>
</tr>
<tr>
<td><a href="https://developer.mozilla.org/en-US/docs/JavaScript/Reference/Global_Objects/Array/reverse">reverse</a></td>
<td><a href="https://developer.mozilla.org/en-US/docs/JavaScript/Reference/Global_Objects/Array/slice">slice</a></td>
<td><a href="https://developer.mozilla.org/en-US/docs/JavaScript/Reference/Global_Objects/Array/every">every</a></td>
</tr>
<tr>
<td><a href="https://developer.mozilla.org/en-US/docs/JavaScript/Reference/Global_Objects/Array/shift">shift</a></td>
<td><a href="https://developer.mozilla.org/en-US/docs/JavaScript/Reference/Global_Objects/Array/indexOf">indexOf</a></td>
<td><a href="https://developer.mozilla.org/en-US/docs/JavaScript/Reference/Global_Objects/Array/map">map</a></td>
</tr>
<tr>
<td><a href="https://developer.mozilla.org/en-US/docs/JavaScript/Reference/Global_Objects/Array/sort">sort</a></td>
<td><a href="https://developer.mozilla.org/en-US/docs/JavaScript/Reference/Global_Objects/Array/lastIndexOf">lastIndexOf</a></td>
<td><a href="https://developer.mozilla.org/en-US/docs/JavaScript/Reference/Global_Objects/Array/some">some</a></td>
</tr>
<tr>
<td><a href="https://developer.mozilla.org/en-US/docs/JavaScript/Reference/Global_Objects/Array/splice">splice</a></td>
<td></td>
<td><a href="https://developer.mozilla.org/en-US/docs/JavaScript/Reference/Global_Objects/Array/Reduce">reduce</a></td>
</tr>
<tr>
<td><a href="https://developer.mozilla.org/en-US/docs/JavaScript/Reference/Global_Objects/Array/unshift">unshift</a></td>
<td></td>
<td><a href="https://developer.mozilla.org/en-US/docs/JavaScript/Reference/Global_Objects/Array/ReduceRight">reduceRight</a></td>
</tr>
</tbody>
</table>
<h2><a name="conditional-statements" class="anchor" href="#conditional-statements"><span class="header-link"></span></a>Conditional Statements</h2>
<p>Conditional statements are &#39;control logic&#39;. This means that depending on the result of a specified condition the corresponding branch of logic will be executed.</p>
<p>There are a few different conditional statements such as:</p>
<ul>
<li><code>if</code></li>
<li><code>switch</code></li>
<li><code>ternary</code></li>
</ul>
<p>The simplest way to understand them is to see the syntax.</p>
<h3><a name="if-statement" class="anchor" href="#if-statement"><span class="header-link"></span></a>If Statement</h3>
<pre><code class="lang-js"><div class="highlight"><pre><span class="k">if</span> <span class="p">(</span><span class="nx">condition</span><span class="p">)</span> <span class="p">{</span>

    <span class="c1">// if &#39;condition&#39; evaluated to true then run this code</span>

<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">other_condition</span><span class="p">)</span> <span class="p">{</span>

    <span class="c1">// if &#39;other_condition&#39; evaluated to true then run this code</span>

<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>

    <span class="c1">// other wise we&#39;ll run this code as a fallback</span>

<span class="p">}</span>
</pre></div>
</code></pre>
<p>So a basic example would be something like this…</p>
<pre><code class="lang-js"><div class="highlight"><pre><span class="kd">var</span> <span class="nx">can_drink</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">age</span> <span class="o">=</span> <span class="mi">18</span><span class="p">;</span>

<span class="k">if</span> <span class="p">(</span><span class="nx">age</span> <span class="o">&gt;=</span> <span class="mi">18</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">can_drink</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</code></pre>
<h3><a name="switch-statement" class="anchor" href="#switch-statement"><span class="header-link"></span></a>Switch Statement</h3>
<p>If you have lots of checks against the same variable/condition then you&#39;re better off using a <code>switch</code> statement… </p>
<pre><code class="lang-js"><div class="highlight"><pre><span class="k">switch</span> <span class="p">(</span><span class="nx">condition</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">case</span> <span class="nx">x</span><span class="o">:</span>
        <span class="c1">// Execute this code block</span>
        <span class="k">break</span><span class="p">;</span>
    <span class="k">case</span> <span class="nx">y</span><span class="o">:</span>
        <span class="c1">// Execute this code block</span>
        <span class="k">break</span><span class="p">;</span>
    <span class="k">case</span> <span class="nx">z</span><span class="o">:</span>
        <span class="c1">// Execute this code block</span>
        <span class="k">break</span><span class="p">;</span>
    <span class="k">default</span><span class="o">:</span>
        <span class="c1">// Execute this code block</span>
        <span class="k">break</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</code></pre>
<p>An example of using this statement would be… </p>
<pre><code class="lang-js"><div class="highlight"><pre><span class="kd">var</span> <span class="nx">car</span> <span class="o">=</span> <span class="s1">&#39;Porsche&#39;</span><span class="p">;</span>

<span class="k">switch</span> <span class="p">(</span><span class="nx">car</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">case</span> <span class="s1">&#39;Ford&#39;</span><span class="o">:</span>
        <span class="c1">// Execute this code block if car is &#39;Ford&#39;</span>
        <span class="k">break</span><span class="p">;</span>
    <span class="k">case</span> <span class="s1">&#39;Porsche&#39;</span><span class="o">:</span>
        <span class="c1">// Execute this code block if car is &#39;Porsche&#39;</span>
        <span class="k">break</span><span class="p">;</span>
    <span class="k">case</span> <span class="s1">&#39;BMW&#39;</span><span class="o">:</span>
        <span class="c1">// Execute this code block if car is &#39;BMW&#39;</span>
        <span class="k">break</span><span class="p">;</span>
    <span class="k">default</span><span class="o">:</span>
        <span class="c1">// Execute this code block if car is none of the above</span>
        <span class="k">break</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</code></pre>
<h3><a name="ternary-statement" class="anchor" href="#ternary-statement"><span class="header-link"></span></a>Ternary Statement</h3>
<p>For very short <code>if</code> statements you can also use a shortened syntax (a conditional operator sometimes referred to as a &#39;ternary&#39; operator because of its three operands). The syntax is like so…</p>
<pre><code class="lang-js"><div class="highlight"><pre><span class="nx">condition</span> <span class="o">?</span> <span class="kc">true</span> <span class="o">:</span> <span class="kc">false</span>
</pre></div>
</code></pre>
<p>…and can be used like so…</p>
<pre><code class="lang-js"><div class="highlight"><pre><span class="kd">var</span> <span class="nx">age</span> <span class="o">=</span> <span class="mi">18</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">can_drink</span> <span class="o">=</span> <span class="p">(</span><span class="nx">age</span> <span class="o">&gt;=</span> <span class="mi">18</span><span class="p">)</span> <span class="o">?</span> <span class="kc">true</span> <span class="o">:</span> <span class="kc">false</span><span class="p">;</span> <span class="c1">// can_drink will equal a Boolean value of true</span>

<span class="kd">var</span> <span class="nx">x</span> <span class="o">=</span> <span class="s1">&#39;abc&#39;</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">y</span> <span class="o">=</span> <span class="p">(</span><span class="nx">x</span> <span class="o">===</span> <span class="s1">&#39;abc&#39;</span><span class="p">)</span> <span class="o">?</span> <span class="s1">&#39;def&#39;</span> <span class="o">:</span> <span class="s1">&#39;xyz&#39;</span><span class="p">;</span> <span class="c1">// y will equal a String value of &#39;def&#39;</span>
</pre></div>
</code></pre>
<h2><a name="coercion" class="anchor" href="#coercion"><span class="header-link"></span></a>Coercion</h2>
<p>One of the areas of most confusion in JavaScript is its ability to coerce data &#39;types&#39;.</p>
<p>The best thing to do is to just try and take advantage of JavaScript&#39;s ability to coerce objects into different types and use it to your advantage to make your code more succinct.</p>
<p>For example, with an <code>if</code> conditional statement JavaScript will try to coerce the expression into either <code>true</code> or <code>false</code> like so… </p>
<pre><code class="lang-js"><div class="highlight"><pre><span class="kd">var</span> <span class="nx">element</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;js-element&#39;</span><span class="p">);</span>

<span class="k">if</span> <span class="p">(</span><span class="nx">element</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// if the DOM element is available then this conditional</span>
    <span class="c1">// will coerce `element` into a Boolean value of true </span>
    <span class="c1">// and hence the condition will pass.</span>

    <span class="c1">// If the DOM element doesn&#39;t exist then the resulting value will be null</span>
    <span class="c1">// and null is converted into a Boolean value of false </span>
    <span class="c1">// and hence the condition will not pass</span>
<span class="p">}</span>
</pre></div>
</code></pre>
<p>In the above example JavaScript automatically converts the condition into a Boolean, but you can manually coerce a value into a Boolean by using the double negation operator <code>!!</code> like so...</p>
<pre><code class="lang-js"><div class="highlight"><pre><span class="kd">var</span> <span class="nx">obj</span> <span class="o">=</span> <span class="p">{</span> <span class="nx">age</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">year</span><span class="o">:</span> <span class="mi">1980</span> <span class="p">};</span>

<span class="o">!!</span><span class="nx">obj</span><span class="p">.</span><span class="nx">age</span> <span class="c1">// =&gt; false (because zero coerces to false)</span>
<span class="o">!!</span><span class="nx">obj</span><span class="p">.</span><span class="nx">year</span> <span class="c1">// =&gt; true (any number greater than zero coerces to true)</span>
</pre></div>
</code></pre>
<p>You can also use a single negation operator <code>!</code> to return the opposite Boolean value of an object (this is useful for saying &#39;if NOT x&#39;)…</p>
<pre><code class="lang-js"><div class="highlight"><pre><span class="kd">var</span> <span class="nx">bool</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>

<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">bool</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// this statement is executed if &#39;bool&#39; is NOT true (i.e. if it&#39;s false)</span>
<span class="p">}</span>
</pre></div>
</code></pre>
<h3><a name="some-quick-notes" class="anchor" href="#some-quick-notes"><span class="header-link"></span></a>Some quick notes:</h3>
<p>All Objects/Arrays coerce to true (even an empty Array).</p>
<p>An empty String wil coerce to false.</p>
<p>There is a lot to learn about JavaScript&#39;s coercion process, so for full details please see the following article: <a href="http://webreflection.blogspot.co.uk/2010/10/javascript-coercion-demystified.html"><a href="http://webreflection.blogspot.co.uk/2010/10/javascript-coercion-demystified.html">http://webreflection.blogspot.co.uk/2010/10/javascript-coercion-demystified.html</a></a></p>
<h2><a name="functions" class="anchor" href="#functions"><span class="header-link"></span></a>Functions</h2>
<p>Functions make it easier to create re-useable code. They are simply blocks of JavaScript code that can be called/executed multiple times.</p>
<p>An example of the function syntax is as follows…</p>
<pre><code class="lang-js"><div class="highlight"><pre><span class="kd">function</span> <span class="nx">identifier</span> <span class="p">(</span><span class="nx">parameters</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// statements</span>
<span class="p">}</span>
</pre></div>
</code></pre>
<p>…which could be used like so…</p>
<pre><code class="lang-js"><div class="highlight"><pre><span class="kd">function</span> <span class="nx">add</span> <span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">a</span> <span class="o">+</span> <span class="nx">b</span><span class="p">;</span>
<span class="p">}</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">add</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">));</span> <span class="c1">// =&gt; 2</span>
</pre></div>
</code></pre>
<h3><a name="parameters" class="anchor" href="#parameters"><span class="header-link"></span></a>Parameters</h3>
<p>Functions accept any number of &#39;parameters&#39; (also known as &#39;arguments&#39;).</p>
<p>Within a function you can access all arguments via a special <code>arguments</code> property…</p>
<pre><code class="lang-js"><div class="highlight"><pre><span class="kd">function</span> <span class="nx">test</span> <span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">,</span> <span class="nx">c</span><span class="p">)</span> <span class="p">{</span> 
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">arguments</span><span class="p">);</span> 
<span class="p">}</span>

<span class="nx">test</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="c1">// =&gt; [1, 2, 3]</span>
</pre></div>
</code></pre>
<p>…you&#39;ll notice in the above example it looks like the <code>arguments</code> property is an Array but it&#39;s not. It&#39;s an &#39;array-like&#39; object. So you can access the keys values much like an Array but you don&#39;t have access to the Array methods.</p>
<h3><a name="return-values" class="anchor" href="#return-values"><span class="header-link"></span></a>Return values</h3>
<p>If a function doesn&#39;t explicitly return a value (if you look at our <code>add</code> function example above you&#39;ll see we explicitly returned <code>a + b</code>) then the function will have a return value of <code>undefined</code>. Hence when you run certain code snippets in a browsers web console you&#39;ll normally see <code>undefined</code> appear directly underneath the code you&#39;ve just written.</p>
<h3><a name="borrowing-methods" class="anchor" href="#borrowing-methods"><span class="header-link"></span></a>Borrowing methods</h3>
<p>Objects have two core methods made available to them: <code>call</code> and <code>apply</code>.</p>
<p>These two methods are the same (i.e. they do the same thing - which is to call a function <em>indirectly</em> while specifying a value for <code>this</code>) but with one small difference: <code>call</code> requires you pass through any arguments for the function as a comma separated list while <code>apply</code> requires you pass through any arguments for the function as an Array of values.</p>
<p>The purpose of these methods is to allow you to <em>borrow</em> a function/method from another object. The following code demonstrates its usage and how powerful it can be… </p>
<pre><code class="lang-js"><div class="highlight"><pre><span class="kd">var</span> <span class="nx">obj1</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;Bob&#39;</span>
<span class="p">};</span>

<span class="kd">var</span> <span class="nx">obj2</span> <span class="o">=</span> <span class="p">{</span> 
    <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;Mark&#39;</span><span class="p">,</span> 
    <span class="nx">speak</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span> 
        <span class="k">return</span> <span class="s1">&#39;My name is &#39;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">name</span><span class="p">;</span>
    <span class="p">}</span> 
<span class="p">}</span>

<span class="nx">obj2</span><span class="p">.</span><span class="nx">speak</span><span class="p">();</span> <span class="c1">// =&gt; &#39;My name is Mark&#39;</span>

<span class="c1">// obj1 doesn&#39;t have a speak method and we don&#39;t want to add extra code to that object when </span>
<span class="c1">// obj2 already has the same method already defined. We want to be able to just borrow obj2&#39;s &#39;speak&#39; method!</span>

<span class="nx">obj2</span><span class="p">.</span><span class="nx">speak</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">obj1</span><span class="p">);</span> <span class="c1">// =&gt; &#39;My name is Bob&#39;</span>
</pre></div>
</code></pre>
<p>…you can see how by using the <code>call</code> method we can make better use of existing functions and so we become more productive as well as have smaller and more efficient code.</p>
<h2><a name="code-reuse-inheritance" class="anchor" href="#code-reuse-inheritance"><span class="header-link"></span></a>Code Reuse (inheritance)</h2>
<p>The final subject I want to briefly cover is &#39;code reuse&#39;. In most object-oriented programming languages the main principle of code reuse is done via <em>inheritance</em> (this is where you have a base object that all other objects inherit properties/methods from - much like how JavaScript already works! i.e. all objects inherit properties/methods from the top level <code>Object.prototype</code>).</p>
<p>The way you implement inheritance is by taking advantage of the <code>prototype</code> chain in JavaScript.</p>
<p>There are multiple ways to use the prototype chain, one populate way is to try and emulate the &#39;Classical Inheritance&#39; style syntax (i.e. most programming languages have a <code>Class</code> keyword that makes creating objects based off a blueprint Class very easy but JavaScript doesn&#39;t have the concept of Class&#39;es - not yet any way). </p>
<p>An example of how to emulate Class style syntax in JavaScript (currently) is by using functions as &#39;Constructors&#39; like so… </p>
<pre><code class="lang-js"><div class="highlight"><pre><span class="kd">var</span> <span class="nx">Person</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">settings</span><span class="p">)</span> <span class="p">{</span>
   <span class="c1">// Instance properties (any new instances of the Person class will have these properties)</span>
   <span class="k">this</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="nx">settings</span><span class="p">.</span><span class="nx">name</span> <span class="o">||</span> <span class="s1">&#39;no name given&#39;</span><span class="p">;</span>
   <span class="k">this</span><span class="p">.</span><span class="nx">age</span> <span class="o">=</span> <span class="nx">settings</span><span class="p">.</span><span class="nx">age</span> <span class="o">||</span> <span class="s1">&#39;no age given&#39;</span><span class="p">;</span>

   <span class="c1">// Instance method (any new instances of the Person class will have this method)</span>
   <span class="k">this</span><span class="p">.</span><span class="nx">getName</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">name</span><span class="p">;</span>
   <span class="p">};</span>
<span class="p">};</span>

<span class="c1">// Create a new instance of the Person Class</span>
<span class="kd">var</span> <span class="nx">bob</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Person</span><span class="p">({</span> <span class="nx">name</span><span class="o">:</span><span class="s1">&#39;Bob&#39;</span><span class="p">,</span> <span class="nx">age</span><span class="o">:</span><span class="mi">7</span> <span class="p">});</span>

<span class="c1">// Add a method to this instance of the Person Class only (no other instances created will have this method)</span>
<span class="nx">bob</span><span class="p">.</span><span class="nx">getAge</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
   <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">age</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// Test the bob instance has access to both methods</span>
<span class="nx">bob</span><span class="p">.</span><span class="nx">getName</span><span class="p">();</span>
<span class="nx">bob</span><span class="p">.</span><span class="nx">getAge</span><span class="p">();</span>

<span class="c1">// Create another instance of the Person Class</span>
<span class="kd">var</span> <span class="nx">user</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Person</span><span class="p">({</span> <span class="nx">name</span><span class="o">:</span><span class="s1">&#39;Mark&#39;</span> <span class="p">});</span>

<span class="c1">// Notice the user has access to a &#39;getName&#39; method but not a &#39;getAge&#39; method</span>
<span class="nx">user</span><span class="p">.</span><span class="nx">getName</span><span class="p">();</span>

<span class="c1">// I know this will error so I&#39;m wrapping it in a try statement</span>
<span class="k">try</span> <span class="p">{</span>
   <span class="nx">user</span><span class="p">.</span><span class="nx">getAge</span><span class="p">();</span>
<span class="p">}</span> <span class="k">catch</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
   <span class="nx">alert</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span> <span class="c1">// Uncaught TypeError: Object [object Object] has no method &#39;getAge&#39;</span>
<span class="p">}</span>

<span class="c1">// Add a method to the Person Class&#39; prototype chain (all instances of the Person Class will now get this method - even those already defined)</span>
<span class="nx">Person</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">getNameAndAge</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
   <span class="k">return</span> <span class="s1">&#39;Hi, my name is &#39;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">name</span> <span class="o">+</span> <span class="s1">&#39;, and I\&#39;m &#39;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">age</span> <span class="o">+</span> <span class="s1">&#39; years old.&#39;</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// Test this new method is accessible to all instances of the Person Class</span>
<span class="nx">bob</span><span class="p">.</span><span class="nx">getNameAndAge</span><span class="p">();</span>
<span class="nx">user</span><span class="p">.</span><span class="nx">getNameAndAge</span><span class="p">();</span>
</pre></div>
</code></pre>
<h3><a name="composition" class="anchor" href="#composition"><span class="header-link"></span></a>Composition</h3>
<p>There is another code reuse pattern you can use instead of &#39;inheritance&#39; called &#39;composition&#39;. The way it works is instead of inheriting methods/properties from a blueprint/base object you instead borrow the methods using <code>call</code> or <code>apply</code> (as we&#39;ve seen previously). </p>
<p>An example of this is as follows…</p>
<pre><code class="lang-js"><div class="highlight"><pre><span class="kd">var</span> <span class="nx">person</span> <span class="o">=</span> <span class="p">{</span>
        <span class="nx">names</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;James&#39;</span><span class="p">,</span> <span class="s1">&#39;Neil&#39;</span><span class="p">,</span> <span class="s1">&#39;Russ&#39;</span><span class="p">,</span> <span class="s1">&#39;Stuart&#39;</span><span class="p">]</span>
    <span class="p">};</span>

<span class="kd">var</span> <span class="nx">people</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">names</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;Ash&#39;</span><span class="p">,</span> <span class="s1">&#39;Brad&#39;</span><span class="p">,</span> <span class="s1">&#39;Mark&#39;</span><span class="p">,</span> <span class="s1">&#39;Mike&#39;</span><span class="p">],</span>
    <span class="nx">speak</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">which</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="s1">&#39;Hi, my name is &#39;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">names</span><span class="p">[</span><span class="nx">which</span><span class="p">];</span>
    <span class="p">}</span>
<span class="p">};</span>

<span class="c1">// Composition not Inheritance</span>
<span class="nx">people</span><span class="p">.</span><span class="nx">speak</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">person</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span> <span class="c1">// =&gt; &#39;Hi, my name is Neil&#39;</span>
</pre></div>
</code></pre>
<h3><a name="mixins" class="anchor" href="#mixins"><span class="header-link"></span></a>Mixins</h3>
<p>Another code reuse pattern is called a &#39;mixin&#39; - which instead of using &#39;inheritance&#39; we simply copy over the functions/properties we want to use.</p>
<p>The following example demonstrates how this works… </p>
<pre><code class="lang-js"><div class="highlight"><pre><span class="kd">function</span> <span class="nx">extend</span><span class="p">(</span><span class="nx">destination</span><span class="p">,</span> <span class="nx">source</span><span class="p">,</span> <span class="nx">overwrite</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">overwrite</span> <span class="o">=</span> <span class="nx">overwrite</span> <span class="o">||</span> <span class="kc">false</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="k">in</span> <span class="nx">source</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">source</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">i</span><span class="p">))</span> <span class="p">{</span>
            <span class="c1">// If we&#39;re not allowed to overwrite an existing property… </span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">overwrite</span><span class="p">)</span> <span class="p">{</span>
                <span class="c1">// …then we check to see if the property is undefined… </span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">destination</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">===</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
                    <span class="c1">// …if it is then we know we can copy the property to the destination object</span>
                    <span class="nx">destination</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="nx">source</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
                <span class="p">}</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="nx">destination</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="nx">source</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">destination</span><span class="p">;</span> 
<span class="p">}</span>

<span class="kd">var</span> <span class="nx">person</span> <span class="o">=</span> <span class="p">{</span>
        <span class="nx">names</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;James&#39;</span><span class="p">,</span> <span class="s1">&#39;Neil&#39;</span><span class="p">,</span> <span class="s1">&#39;Russ&#39;</span><span class="p">,</span> <span class="s1">&#39;Stuart&#39;</span><span class="p">]</span>
    <span class="p">};</span>

<span class="kd">var</span> <span class="nx">people</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">names</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;Ash&#39;</span><span class="p">,</span> <span class="s1">&#39;Brad&#39;</span><span class="p">,</span> <span class="s1">&#39;Mark&#39;</span><span class="p">,</span> <span class="s1">&#39;Mike&#39;</span><span class="p">],</span>
    <span class="nx">speak</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">which</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="s1">&#39;Hi, my name is &#39;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">names</span><span class="p">[</span><span class="nx">which</span><span class="p">];</span>
    <span class="p">}</span>
<span class="p">};</span>

<span class="nx">extend</span><span class="p">(</span><span class="nx">person</span><span class="p">,</span> <span class="nx">people</span><span class="p">);</span> <span class="c1">// copy properties from `people` to `person`</span>

<span class="c1">// `person` now has a `speak` method it didn&#39;t have originally </span>
<span class="nx">person</span><span class="p">.</span><span class="nx">speak</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span> <span class="c1">// =&gt; &#39;Hi, my name is Neil&#39;</span>
</pre></div>
</code></pre>
<h2><a name="conclusion" class="anchor" href="#conclusion"><span class="header-link"></span></a>Conclusion</h2>
<p>OK, this has been a super brief/quick run through of different JavaScript concepts and language features.</p>
<p>This isn&#39;t supposed to be even remotely an exhaustive discussion - have you seen the size of &#39;JavaScript: The Definitive Guide&#39; !?</p>
<p>Hopefully this has at least been enough to get you started and interested in learning more. If there are any issues or errors then please get in contact and let me know.</p>
</div>

  <div class="comments">
    <a href="/posts/javascript-101/#comments">
      <span class="icon-bubbles"></span>
      Comments
    </a>
  </div>


<div class="pagination group">
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
      <a href="/page/9/" class="newer"> Newer &#8594;</a>
    
  
    
    
  
    
    
      <a href="/page/11/" class="older"> &#8592; Older</a>
    
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
</div>
    </div>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.1/jquery.min.js" type="text/javascript"></script>
    <script src="/scripts/main.js" type="text/javascript"></script>
    <script src="/scripts/Imager.js" type="text/javascript"></script>
    <script>
        var _gaq=[['_setAccount','UA-33159515-1'],['_trackPageview']];
        (function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];
        g.src=('https:'==location.protocol?'//ssl':'//www')+'.google-analytics.com/ga.js';
        s.parentNode.insertBefore(g,s)}(document,'script'));
    </script>
  </body>
</html>

