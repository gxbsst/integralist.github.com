<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="icon" type="image/png" href="/images/cabin.png" >
    <link href="/styles/main.css" rel="stylesheet">
    
    <title>Integralist -> BBC News Engineer</title>
    
    
    <link rel="alternate" type="application/atom+xml" title="Integralist" href="http://feeds.feedburner.com/Integralist">
  </head>
  <body>
    <nav>
      <h1 class="name">
          <a href="/">Integralist</a> <span class="role">BBC News Engineer</span>
      </h1>
      <div class="menu icon-menu"></div>
      <ul class="nav-links">
        <li class="text-link">
          <a href="/about.html">about</a>
        </li>
        <li class="text-link">
          <a href="/projects.html">projects</a>
        </li>
        <li class="text-link">
          <a href="/archives.html">archives</a>
        </li>
      </ul>
      <div class="social-media">
        <a href="https://github.com/integralist" class="icon-github"></a>
        <a href="https://twitter.com/integralist" class="icon-twitter"></a>
      </div>
    </nav>
    <div class="content">


  <div class="post-head group">
  <a href="/posts/vim-workflow-part-deux/">
    <h1 class="post-title">Vim Workflow (Part Deux)</h1>
  </a>
  <span class="post-date">2013 &#183; 11 &#183; 17</span>
</div>

<div class="post-body"><h2><a name="what-well-cover" class="anchor" href="#what-well-cover"><span class="header-link"></span></a>What we&#39;ll cover</h2>
<p><em>reading time: approx. 27mins</em></p>
<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#no-more-tmux">No more tmux</a></li>
<li><a href="#vim-windows">Vim windows</a></li>
<li><a href="#long-running-commands">Long running commands</a></li>
<li><a href="#managing-windows">Managing windows</a></li>
<li><a href="#plugins">Plugins</a><ul>
<li><a href="#ctrl-p">Ctrl-p</a></li>
<li><a href="#ack">Ack</a></li>
<li><a href="#plugins">EndWise</a></li>
<li><a href="#plugins">Powerline</a></li>
<li><a href="#nerdtree">NERDTree</a></li>
<li><a href="#surround">Surround</a></li>
<li><a href="#plugins">HTML5</a></li>
<li><a href="#plugins">Tabular</a></li>
</ul>
</li>
<li><a href="#configuration">Configuration</a></li>
<li><a href="#useful-vim-featurescommands">Useful Vim features/commands</a><ul>
<li><a href="#search-and-replace-across-multiple-files">Search and Replace across multiple
files</a></li>
<li><a href="#moving-between-brackets">Moving between brackets</a></li>
<li><a href="#auto-indenting">Auto indenting</a></li>
<li><a href="#changing-content">Changing content</a></li>
<li><a href="#selecting-content">Selecting content</a></li>
<li><a href="#using-the-register">Using the register</a></li>
<li><a href="#buffer-management">Buffer management</a></li>
<li><a href="#jump-list">Jump List</a></li>
<li><a href="#change-list">Change List</a></li>
<li><a href="#case-insensitive-searching">Case Insensitive Searching</a></li>
<li><a href="#regular-expressions">Regular Expressions</a></li>
<li><a href="#removing-line-spaces">Removing line spaces</a></li>
<li><a href="#switching-case">Switching case</a></li>
<li><a href="#moving-forward-and-backwards-by-code-not">Moving forward and backwards by code not
words</a></li>
<li><a href="#repeating-yourself">Repeating yourself</a></li>
<li><a href="#appending-to-end-of-a-line">Appending to end of a line</a></li>
<li><a href="#searching-for-current-word">Searching for current word</a></li>
</ul>
</li>
<li><a href="#conclusion">Conclusion</a></li>
</ul>
<h2><a name="introduction" class="anchor" href="#introduction"><span class="header-link"></span></a>Introduction</h2>
<p>If you&#39;ve not read over my two previous Vim posts (<a href="http://www.integralist.co.uk/posts/a-guide-to-getting-started-with-vim/">A guide to getting started with Vim</a> and <a href="http://www.integralist.co.uk/posts/vim-workflow/">Vim Workflow</a>) then I suggest you do that
first as that&#39;ll give you an idea of how I use Vim and what my previous workflow
was like.</p>
<p>I&#39;ve decided that it was time to simplify my Vim set-up and to better automate
and understand some processes. </p>
<p>Note: not all of this was related to just Vim but my general dotfiles set-up as well.</p>
<p>Hopefully by sharing my updated workflow you might pick up some techniques that
you like and want to utilise yourself (or maybe not).</p>
<h2><a name="no-more-tmux" class="anchor" href="#no-more-tmux"><span class="header-link"></span></a>No more tmux</h2>
<p>I love <a href="http://tmux.sourceforge.net/">tmux</a> but for all its power I pretty much
only ever used it for spliting the screen into panes (or Windows if you&#39;re
talking Vim terminology).</p>
<p>The one really cool feature of a pane in tmux was the fact that it could just be
pointed at a terminal shell (so I could run shell commands without affecting my
current Vim window).</p>
<p>So why would I give that up? What am I using now?</p>
<p>Well, I&#39;m just using Vim&#39;s standard windows feature! So let me explain <em>how</em> I use Vim windows...</p>
<p><strong>Update</strong>: just to be clear that I do still use tmux but only when I&#39;m doing TDD or refactoring with tests. That is the one instance where I&#39;ll fire up two tmux panes (one to hold Vim and the other to be a terminal running my tests -&gt; this makes the &#39;red, green, refactor&#39; feedback loop nice and tight).</p>
<h2><a name="vim-windows" class="anchor" href="#vim-windows"><span class="header-link"></span></a>Vim windows</h2>
<p>When I create a new window in Vim (same as a tmux pane), the new window
holds a copy of the current file. I then just use the Ctrl-p plugin to
open another file (see the below section on plugins if you&#39;re not sure what
Ctrl-p is).</p>
<p>If I want to run a command I will typically push Vim into the background and run
the command, simple (it doesn&#39;t need to be more complicated than that). </p>
<p>To do this you press <code>Ctrl-z</code> which will take you out of Vim and
back into the shell where you can run your commands. You then press <code>fg</code> to
bring Vim back to be the (f)ore (ground) process.</p>
<h2><a name="long-running-commands" class="anchor" href="#long-running-commands"><span class="header-link"></span></a>Long running commands</h2>
<p>If you have a long running command (e.g. <code>grunt watch</code>) then this is where the
tmux pane would be really handy, because I could open a new pane and leave it
running alongside working in Vim. This isn&#39;t possible in Vim, but the solution
is just as easy: open a new tab!</p>
<p>If you have a long running command such as a grunt task which watches
files and then compiles them when they are updated, then you&#39;re not going to
really be interested in looking at that output (well, majority of the time
you&#39;re not). So just have it run in a separate tab and you can easily switch back
over to it to see the output if you want. You can then just easily switch back to
the Vim tab when you&#39;re ready.</p>
<p>Is this a perfect solution? Of course not.<br>Does it mean I can drop a dependency? Absolutely.</p>
<p>If I can make life simpler (within reason) then I think that&#39;s a better
situation to be in.</p>
<p><strong>UPDATE:</strong></p>
<p>As pointed out by <a href="http://twitter.com/kenturamon">@kenturamon</a>, he uses Guard to
run his Ruby tests and for proper TDD (test-driven development) he needs
a constant feedback loop rather than switching tabs all the time. In situations
like that then using tmux is the best bet. You don&#39;t have to use tmux all the
time but I have no issue with using the best tool for the job when the
circumstances dictate it.</p>
<h2><a name="managing-windows" class="anchor" href="#managing-windows"><span class="header-link"></span></a>Managing windows</h2>
<p>The default keys for moving around and manipulating Vim&#39;s windows are a bit ugly
and awkward to use.</p>
<p>I find that I use the &lt;leader&gt; key <code>\</code> all the time. It&#39;s in the perfect
spot for my fingers to hit it whenever I need it. So I map a few of the window
keys to use the leader key instead...</p>
<pre><code class="lang-vim"><div class="highlight"><pre><span class="c">&quot; Make handling Vim windows easier</span>
map <span class="p">&lt;</span>leader<span class="p">&gt;</span><span class="k">w</span><span class="p">-</span> <span class="p">&lt;</span>C<span class="p">-</span>W<span class="p">&gt;-</span> <span class="c">&quot; smaller</span>
map <span class="p">&lt;</span>leader<span class="p">&gt;</span><span class="k">w</span><span class="p">+</span> <span class="p">&lt;</span>C<span class="p">-</span>W<span class="p">&gt;+</span> <span class="c">&quot; larger</span>
map <span class="p">&lt;</span>leader<span class="p">&gt;</span><span class="k">w</span>[ <span class="p">&lt;</span>C<span class="p">-</span>W<span class="p">&gt;=</span> <span class="c">&quot; equal</span>
map <span class="p">&lt;</span>leader<span class="p">&gt;</span><span class="k">w</span>] <span class="p">&lt;</span>C<span class="p">-</span>W<span class="p">&gt;</span>_ <span class="c">&quot; fill screen</span>

<span class="c">&quot; Make splitting Vim windows easier</span>
map <span class="p">&lt;</span>leader<span class="p">&gt;</span>; <span class="p">&lt;</span>C<span class="p">-</span>W<span class="p">&gt;</span><span class="k">s</span>
map <span class="p">&lt;</span>leader<span class="p">&gt;</span>` <span class="p">&lt;</span>C<span class="p">-</span>W<span class="p">&gt;</span><span class="k">v</span>
</pre></div>
</code></pre>
<p>...as you can see, if I want to create a horizontal split window then I just
press: <code>\;</code> and if I want the vertical equivalent I just press: \`</p>
<p>If I want the current window to fill the screen I press: <code>\w]</code> and if I want all
windows to be equal size again then I press: <code>\w[</code>.</p>
<p>Finally if I want the current window to be slightly larger, then I press: <code>\w+</code>
or <code>\w-</code> if I want it slightly smaller.</p>
<p>If you have lots of split windows open and you want to close them all then <code>:q</code>
wont work that well as it means you&#39;ll have to close each window individually.
Instead run <code>:only</code> to close all windows except the current one and then run
<code>:q</code> to close the last one.</p>
<p>If you split the current screen into too many windows you may find the full
screen feature is no longer very effective (because there are so many split
screens, the current window doesn&#39;t have much space left over to fill up), then you can
instead move that window out into a separate Tab by executing <code>Ctrl-w</code> followed by <code>Shift-T</code>.</p>
<p>But be aware of two things:</p>
<ol>
<li>this moves the split window completely into a new tab (so doesn&#39;t stay as a
split window as well)</li>
<li>this is rarely needed for me any way (I hardly have more than 4 files open at
once, if I do I&#39;m clearly doing too much)</li>
</ol>
<p>So there you have it. Nice, simple and quick solutions which mean I don&#39;t require the full range of tmux features. </p>
<p>This gives me the majority of the functionality I need when dealing with files.</p>
<h3><a name="tabs" class="anchor" href="#tabs"><span class="header-link"></span></a>Tabs</h3>
<p>Vim&#39;s tab feature is something I very rarely use but like I say, if you&#39;re using
Vim&#39;s window features like I am, and once in a while when you do find full screening a window pane
isn&#39;t working out, then extracting that window out into a tab is the only way to go (in
tmux you can just press <code>Ctrl-z</code> and that would properly full screen the current
pane - but not using tmux any more isn&#39;t really much of an issue for me nowadays and so I can
live with the standard full screen feature available to Vim windows).</p>
<p>In case you&#39;re wondering you can create a new tab with the command <code>:tabnew</code> and
you can move between tabs using <code>gt</code> which moves forward through your tab list
and <code>gT</code> to move backwards through the tab list.</p>
<p>You can also close all tab instances except the current one using <code>:tabo</code> (as a 
shortcut for <code>:tabonly</code>).</p>
<p>To move to a specific tab then just use <code>ngt</code> where <code>n</code> is the number of the tab
you want to switch to. So for example if you have four tabs open then <code>4gt</code> will
switch you to the fourth tab.</p>
<p>Finally you can rearrange tabs if you want to. I&#39;m not sure why I&#39;m going into
so much detail about tabs when it&#39;s very rare that I use them, but because they
do crop up every once in a while it&#39;s nice to know what&#39;s possible (i.e. the
better you understand your craft and your tool of choice the more efficient you
can be). To move a tab simply execute <code>:tabmove n</code> where <code>n</code> is the space you
want it to occupy. If you don&#39;t specify a number then the tab will be moved to
the end of the tab list. But be aware that the tab list is zero-indexed so
moving to the first space would be <code>:tabmove 0</code>.</p>
<h2><a name="plugins" class="anchor" href="#plugins"><span class="header-link"></span></a>Plugins</h2>
<p>So there are quite a few plugins I use, some of the most vital ones I&#39;ll list below:</p>
<ul>
<li><a href="http://www.github.com/kien/ctrlp.vim">Ctrl-p</a></li>
<li><a href="http://www.github.com/mileszs/ack.vim">Ack</a> (well, I use
<a href="http://www.github.com/ggreer/the_silver_searcher">Ag</a> behind the scenes)</li>
<li><a href="http://www.github.com/tpope/vim-endwise">EndWise</a></li>
<li><a href="http://www.github.com/Lokaltog/powerline">Powerline</a></li>
<li><a href="https://github.com/scrooloose/nerdtree">NERDTree</a></li>
<li><a href="http://www.github.com/tpope/vim-surround">Surround</a></li>
<li><a href="http://www.github.com/othree/html5.vim">HTML5</a></li>
<li><a href="http://www.github.com/godlygeek/tabular">Tabular</a></li>
</ul>
<p>I&#39;ll discuss just a couple of them in more detail...</p>
<h3><a name="ctrl-p" class="anchor" href="#ctrl-p"><span class="header-link"></span></a>Ctrl-p</h3>
<p><strong>Opening multiple files</strong></p>
<p>Although Ctrl-p is execellent for fuzzy searching for a particular file and opening 
it really quickly, most people don&#39;t take advantage of all its features such as
the ability to open multiple files at once.</p>
<p>When you open Ctrl-p (I have it mapped to <code>\t</code> for quicker access) you can press
<code>Ctrl-z</code> multiple times for each file you want to open and then press either
<code>Ctrl-x</code> to open them in horizontal split window panes, or <code>Ctrl-o</code> to open them
in vertical split window panes.</p>
<p><strong>Refreshing the list of files</strong></p>
<p>This is a simple tip but I&#39;m sure some people aren&#39;t aware that when you add a new 
file whilst Vim is still open then Ctrl-p would have cached the intial set of
files in that directory (and sub directories) and so it wont have any new files
created within its cache.</p>
<p>To refresh the cache simply press the <code>F5</code> key when Ctrl-p is open.</p>
<h3><a name="ack" class="anchor" href="#ack"><span class="header-link"></span></a>Ack</h3>
<p>I wont go into the details of how to use Ack as I&#39;ve covered this in a previous
Vim post (so go read that instead). I will say that being able to carry out
global searches is incredibly useful and something I do on a regular basis and
so if you&#39;re not taking advantage of vimgrep, Ack or Ag or whatever search tool
then you&#39;re missing a trick.</p>
<h3><a name="nerdtree" class="anchor" href="#nerdtree"><span class="header-link"></span></a>NERDTree</h3>
<p>Again, I&#39;ve covered NERDTree in a previous post so if you&#39;re after the basics
then go read that first.</p>
<p><strong>Bookmarks</strong></p>
<p>There are some useful things you can do with NERDTree outside of simple file
system viewing and one of those is &quot;Bookmarks&quot;.</p>
<p>When your cursor is on a particular directory or file then enter the command
<code>:bookmark my_bookmark_name</code>.</p>
<p>Next time you open NERDTree you can press <code>B</code> to show your bookmarks and then
hit enter on <code>my_bookmark_name</code> and it&#39;ll take you directly to the bookmarked
directory/file.</p>
<p><strong>Modifying files and folders</strong></p>
<p>Press <code>m</code> to bring up a menu that lets you add, edit
or delete the currently highlighted file or folder. Just follow the instructions on
the screen.</p>
<p><strong>Easy toggling</strong></p>
<p>I&#39;ve mapped <code>\&#39;</code> to the command <code>:NERDTreeToggle&lt;cr&gt;</code> so it is a lot quicker and
easier to toggle the NERDTree open and closed.</p>
<p><strong>Searching</strong></p>
<p>If you have a very long list of directories which you
have to scroll through, then because NERDTree is essentially just another Vim window
you can use the <code>/</code> search feature to quickly skip ahead to the item you&#39;re
interested in.</p>
<h3><a name="surround" class="anchor" href="#surround"><span class="header-link"></span></a>Surround</h3>
<p>This is an awesome plugin that does one thing and does it well. It allows you to
quickly change the surrounding tabs or quotation marks of a selection or word.</p>
<p>The basic command is <code>cs</code> followed by either <code>t</code> for tag or <code>&quot;</code> or <code>&#39;</code> or
whatever the surround syntax is.</p>
<p>So for example, to change <code>&lt;p&gt;text&lt;/p&gt;</code> to <code>&lt;div&gt;test&lt;/div&gt;</code> just run
<code>cst&lt;div&gt;</code>.</p>
<p>If you have <code>&quot;test&quot;</code> and you want <code>&#39;test&#39;</code> instead then just run <code>cs&quot;&#39;</code>.</p>
<p>You can also delete the delimiters (surrounding syntax) using <code>d</code> instead of
<code>c</code>. </p>
<p>So for example, if you have <code>&quot;test&quot;</code> and you want to remove the quotations then just use <code>ds&quot;</code>.</p>
<p>You can also add syntax to a word that doesn&#39;t have it by doing <code>ysiw</code> followed
by the punctuation you want to surround the word with (e.g. <code>ysiw]</code> to have
square brackets around the word).</p>
<p>Note: when adding surrounding syntax be aware that the right side bracket is
what you should use if you want no space, and the left side bracket if you want
a space included. For example, if you wanted <code>[ abc ]</code> then run <code>ysiw[</code>. But if
you want <code>[abc]</code> then use <code>ysiw]</code> instead.</p>
<p>The standard syntax for adding surrounding syntax is <code>ys</code> followed by your
selection command (e.g. this could be <code>$</code> to select to the end of the line)
followed by the punctuation you want to use.</p>
<h2><a name="configuration" class="anchor" href="#configuration"><span class="header-link"></span></a>Configuration</h2>
<p>For the full configuration set-up have a look at my &quot;<a href="https://github.com/Integralist/Fresh-Install">Fresh Install</a>&quot; repo.
Below are just a few different vim settings (most are outright stolen from
my colleague <a href="https://github.com/sthulb">Simon Thulbourn</a> so do take a look at
his dotfile set-up).</p>
<h3><a name="settings" class="anchor" href="#settings"><span class="header-link"></span></a>Settings</h3>
<pre><code class="lang-vim"><div class="highlight"><pre><span class="c">&quot; switch syntax highlighting on, when the terminal has colors</span>
<span class="nb">syntax</span> <span class="k">on</span>

<span class="c">&quot; use vim, not vi api</span>
<span class="k">set</span> <span class="nb">nocompatible</span>

<span class="c">&quot; no backup files</span>
<span class="k">set</span> <span class="nb">nobackup</span>

<span class="c">&quot; no write backup</span>
<span class="k">set</span> <span class="nb">nowritebackup</span>

<span class="c">&quot; no swap file</span>
<span class="k">set</span> <span class="nb">noswapfile</span>

<span class="c">&quot; command history</span>
<span class="k">set</span> <span class="k">history</span><span class="p">=</span><span class="m">100</span>

<span class="c">&quot; always show cursor</span>
<span class="k">set</span> <span class="nb">ruler</span>

<span class="c">&quot; show incomplete commands</span>
<span class="k">set</span> <span class="nb">showcmd</span>

<span class="c">&quot; incremental searching</span>
<span class="k">set</span> <span class="nb">incsearch</span>

<span class="c">&quot; highlight search</span>
<span class="k">set</span> <span class="nb">hlsearch</span>

<span class="c">&quot; ignore case in search</span>
<span class="k">set</span> <span class="nb">smartcase</span>

<span class="c">&quot; make sure any searches /searchPhrase doesn&#39;t need the \c escape character</span>
<span class="k">set</span> <span class="nb">ignorecase</span>

<span class="c">&quot; a buffer is marked as ‘hidden’ if it has unsaved changes, and it is not</span>
currently loaded <span class="k">in</span> <span class="k">a</span> <span class="nb">window</span>
<span class="c">&quot; if you try and quit Vim while there are hidden buffers, you will raise an</span>
error:
<span class="c">&quot; E162: No write since last change for buffer “a.txt”</span>
<span class="k">set</span> <span class="nb">hidden</span>

<span class="c">&quot; disable folding because it is evil</span>
<span class="k">set</span> <span class="nb">nofoldenable</span>

<span class="c">&quot; turn word wrap off</span>
<span class="k">set</span> <span class="nb">nowrap</span>

<span class="c">&quot; scroll with more context</span>
<span class="k">set</span> <span class="nb">scrolloff</span><span class="p">=</span><span class="m">10</span>

<span class="c">&quot; allow backspace to delete end of line, indent and start of line characters</span>
<span class="k">set</span> <span class="nb">backspace</span><span class="p">=</span>indent<span class="p">,</span><span class="nb">eol</span><span class="p">,</span><span class="k">start</span>

<span class="c">&quot; convert tabs to spaces</span>
<span class="k">set</span> <span class="nb">expandtab</span>

<span class="c">&quot; set tab size</span>
<span class="k">set</span> <span class="nb">tabstop</span><span class="p">=</span><span class="m">4</span>

<span class="c">&quot; the number of spaces inserted for a tab</span>
<span class="k">set</span> <span class="nb">shiftwidth</span><span class="p">=</span><span class="m">4</span>

<span class="c">&quot; turn on line numbers</span>
<span class="k">set</span> <span class="k">number</span>

<span class="c">&quot; highlight tailing whitespace</span>
<span class="k">set</span> <span class="nb">list</span> <span class="nb">listchars</span><span class="p">=</span><span class="k">tab</span>:\ \ <span class="p">,</span>trail:·

<span class="c">&quot; get rid of the delay when pressing O (for example)</span>
<span class="c">&quot; http://stackoverflow.com/questions/2158516/vim-delay-before-o-opens-a-new-line</span>
<span class="k">set</span> <span class="nb">timeout</span> <span class="nb">timeoutlen</span><span class="p">=</span><span class="m">1000</span> <span class="nb">ttimeoutlen</span><span class="p">=</span><span class="m">100</span>

<span class="c">&quot; always show status bar</span>
<span class="k">set</span> <span class="nb">laststatus</span><span class="p">=</span><span class="m">2</span>

<span class="c">&quot; set the status line to something useful</span>
<span class="k">set</span> <span class="nb">statusline</span><span class="p">=</span>%<span class="k">f</span>\ %<span class="p">=</span>L:%<span class="k">l</span>/%L\ %<span class="k">c</span>\ <span class="p">(</span>%<span class="k">p</span>%%<span class="p">)</span>

<span class="c">&quot; hide the toolbar</span>
<span class="k">set</span> <span class="nb">guioptions</span><span class="p">-=</span>T

<span class="c">&quot; utf encoding</span>
<span class="k">set</span> <span class="nb">encoding</span><span class="p">=</span>utf<span class="m">-8</span>

<span class="c">&quot; autoload files that have changed outside of vim</span>
<span class="k">set</span> <span class="nb">autoread</span>

<span class="c">&quot; use system clipboard</span>
<span class="c">&quot;</span>
http:<span class="sr">//</span>stackoverflow.<span class="k">com</span><span class="sr">/questions/</span><span class="m">8134647</span>/copy<span class="p">-</span>and<span class="p">-</span><span class="nb">paste</span><span class="p">-</span><span class="k">in</span><span class="p">-</span><span class="k">vim</span><span class="p">-</span>via<span class="p">-</span>keyboard<span class="p">-</span>between<span class="p">-</span>different<span class="p">-</span>mac<span class="p">-</span>terminals
<span class="k">set</span> <span class="nb">clipboard</span><span class="p">+=</span>unnamed

<span class="c">&quot; don&#39;t show intro</span>
<span class="k">set</span> <span class="nb">shortmess</span><span class="p">+=</span>I

<span class="c">&quot; better splits</span>
<span class="k">set</span> <span class="nb">splitbelow</span>
<span class="k">set</span> <span class="nb">splitright</span>
</pre></div>
</code></pre>
<h3><a name="file-types" class="anchor" href="#file-types"><span class="header-link"></span></a>File types</h3>
<pre><code class="lang-vim"><div class="highlight"><pre><span class="c">&quot; turn indentation on</span>
<span class="k">filetype</span> indent <span class="k">on</span>

<span class="c">&quot; enable filetype plugins</span>
<span class="k">filetype</span> plugin <span class="k">on</span>
</pre></div>
</code></pre>
<h3><a name="commands" class="anchor" href="#commands"><span class="header-link"></span></a>Commands</h3>
<pre><code class="lang-vim"><div class="highlight"><pre><span class="c">&quot; jump to last cursor</span>
autocmd <span class="nb">BufReadPost</span> *
  \ <span class="k">if</span> line<span class="p">(</span><span class="s2">&quot;&#39;\&quot;&quot;</span><span class="p">)</span> <span class="p">&gt;</span> <span class="m">0</span> &amp;&amp; line<span class="p">(</span><span class="s2">&quot;&#39;\&quot;&quot;</span><span class="p">)</span> <span class="p">&lt;=</span> line<span class="p">(</span><span class="s2">&quot;$&quot;</span><span class="p">)</span> <span class="p">|</span>
  \   exe <span class="s2">&quot;normal g`\&quot;&quot;</span> <span class="p">|</span>
  \ <span class="k">endif</span>

<span class="k">fun</span><span class="p">!</span> StripTrailingWhitespace<span class="p">()</span>
<span class="c">    &quot; don&#39;t strip on these filetypes</span>
    <span class="k">if</span> &amp;<span class="nb">ft</span> <span class="p">=~</span> <span class="s1">&#39;markdown&#39;</span>
        <span class="k">return</span>
    <span class="k">endif</span>
    %<span class="k">s</span><span class="sr">/\s\+$/</span>/<span class="k">e</span>
<span class="k">endfun</span>
autocmd <span class="nb">BufWritePre</span> * <span class="k">call</span> StripTrailingWhitespace<span class="p">()</span>

<span class="c">&quot; file formats</span>
autocmd Filetype gitcommit <span class="k">setlocal</span> <span class="k">spell</span> <span class="nb">textwidth</span><span class="p">=</span><span class="m">72</span>
autocmd Filetype markdown <span class="k">setlocal</span> <span class="nb">textwidth</span><span class="p">=</span><span class="m">80</span>
autocmd <span class="nb">FileType</span> cucumber<span class="p">,</span><span class="k">ruby</span><span class="p">,</span>yaml <span class="k">setl</span> <span class="k">sw</span><span class="p">=</span><span class="m">2</span> <span class="k">sts</span><span class="p">=</span><span class="m">2</span> <span class="nb">et</span>

<span class="c">&quot; specify syntax highlighting for specific files</span>
<span class="k">au</span> Bufread<span class="p">,</span><span class="nb">BufNewFile</span> *.spv <span class="k">set</span> <span class="k">filetype</span><span class="p">=</span>php
<span class="k">au</span> Bufread<span class="p">,</span><span class="nb">BufNewFile</span> *.md <span class="k">set</span> <span class="k">filetype</span><span class="p">=</span>markdown <span class="c">&quot; Vim interprets .md as</span>
<span class="s1">&#39;modula2&#39;</span> otherwise<span class="p">,</span> see :<span class="k">set</span> <span class="k">filetype</span>?
</pre></div>
</code></pre>
<h3><a name="plugins" class="anchor" href="#plugins"><span class="header-link"></span></a>Plugins</h3>
<pre><code class="lang-vim"><div class="highlight"><pre><span class="c">&quot; Declare bundles are handled via Vundle</span>
<span class="k">set</span> <span class="nb">rtp</span><span class="p">+=</span>$HOME<span class="sr">/.vim/</span>bundle/vundle
<span class="k">call</span> vundle#rc<span class="p">()</span>

<span class="c">&quot; Let Vundle manage Vundle</span>
Bundle <span class="s1">&#39;gmarik/vundle&#39;</span>

<span class="c">&quot; CtrlP</span>
Bundle <span class="s1">&#39;kien/ctrlp.vim&#39;</span>
map <span class="p">&lt;</span>leader<span class="p">&gt;</span><span class="k">t</span> <span class="p">&lt;</span>C<span class="p">-</span><span class="k">p</span><span class="p">&gt;</span>
map <span class="p">&lt;</span>leader<span class="p">&gt;</span><span class="k">y</span> :CtrlPBuffer<span class="p">&lt;</span><span class="k">cr</span><span class="p">&gt;</span>
<span class="k">let</span> <span class="k">g</span>:ctrlp_show_hidden<span class="p">=</span><span class="m">1</span>
<span class="k">let</span> <span class="k">g</span>:ctrlp_working_path_mode<span class="p">=</span><span class="m">0</span>
<span class="k">let</span> <span class="k">g</span>:ctrlp_max_height<span class="p">=</span><span class="m">30</span>
<span class="k">set</span> <span class="nb">wildignore</span><span class="p">+=</span>*<span class="sr">/.git/</span>*<span class="p">,</span>*<span class="sr">/.hg/</span>*<span class="p">,</span>*<span class="sr">/.svn/</span>*.<span class="p">,</span>*/.DS_Store

<span class="c">&quot; Tomorrow Night Theme</span>
Bundle <span class="s1">&#39;jlangston/tomorrow-night-vim&#39;</span>
<span class="p">:</span><span class="k">silent</span><span class="p">!</span> :<span class="k">colorscheme</span> tomorrow<span class="p">-</span>night<span class="p">-</span>bright

<span class="c">&quot; Markdown</span>
Bundle <span class="s1">&#39;tpope/vim-markdown&#39;</span>

<span class="c">&quot; Markdown (allow piping of markdown files to the browser)</span>
<span class="k">au</span> <span class="nb">BufEnter</span><span class="p">,</span><span class="nb">BufNew</span> *.md map <span class="p">&lt;</span>enter<span class="p">&gt;</span> :<span class="k">wa</span>\<span class="p">|!</span>rbfu rdiscount % \<span class="p">|</span> bcat<span class="p">&lt;</span><span class="k">cr</span><span class="p">&gt;</span>

<span class="c">&quot; Cucumber</span>
Bundle <span class="s1">&#39;tpope/vim-cucumber&#39;</span>

<span class="c">&quot; Tags</span>
<span class="c">&quot; First run `ctags -R` within the root directory (this is installed via</span>
Homebrew<span class="p">)</span>
<span class="c">&quot; Second within your file, on a method/class/object (whatever) press `Ctrl+]`</span>
Bundle <span class="s1">&#39;xolox/vim-misc&#39;</span>
Bundle <span class="s1">&#39;majutsushi/tagbar&#39;</span>
<span class="k">let</span> <span class="k">g</span>:tagbar_ctags_bin<span class="p">=</span><span class="s1">&#39;/usr/local/bin/ctags&#39;</span>

<span class="c">&quot; Tags</span>
<span class="c">&quot; Open Tagbar when pressing &lt;leader&gt;b</span>
<span class="c">&quot; And automatically close it after selecting something</span>
<span class="p">:</span>map <span class="p">&lt;</span>leader<span class="p">&gt;</span><span class="k">b</span> :TagbarOpenAutoClose<span class="p">&lt;</span><span class="k">cr</span><span class="p">&gt;</span>

<span class="c">&quot; Tab completion</span>
Bundle <span class="s1">&#39;ervandew/supertab&#39;</span>

<span class="c">&quot; Enable repeating supported plugin maps with &#39;.&#39;</span>
Bundle <span class="s1">&#39;tpope/vim-repeat&#39;</span>

<span class="c">&quot; Comment out stuff</span>
Bundle <span class="s1">&#39;tpope/vim-commentary.git&#39;</span>

<span class="c">&quot; Ack (uses Ag behind the scenes)</span>
Bundle <span class="s1">&#39;mileszs/ack.vim&#39;</span>
<span class="k">let</span> <span class="k">g</span>:ackprg <span class="p">=</span> <span class="s1">&#39;ag --nogroup --nocolor --column&#39;</span>

<span class="c">&quot; Applies `end` keyword to relevant lines of ruby code</span>
Bundle <span class="s1">&#39;tpope/vim-endwise&#39;</span>

<span class="c">&quot; Status line design improvements</span>
Bundle <span class="s1">&#39;Lokaltog/powerline&#39;</span>
<span class="k">set</span> <span class="nb">rtp</span><span class="p">+=~</span><span class="sr">/.vim/</span>bundle<span class="sr">/powerline/</span>powerline<span class="sr">/bindings/</span><span class="k">vim</span>

<span class="c">&quot; Gists</span>
Bundle <span class="s1">&#39;mattn/webapi-vim&#39;</span>
Bundle <span class="s1">&#39;vim-scripts/Gist.vim&#39;</span>
Bundle <span class="s1">&#39;tpope/vim-fugitive&#39;</span>

<span class="c">&quot; Gists (Github settings)</span>
<span class="k">let</span> <span class="k">g</span>:github_user <span class="p">=</span> $GITHUB_USER
<span class="k">let</span> <span class="k">g</span>:github_token <span class="p">=</span> $GITHUB_TOKEN

<span class="c">&quot; HTML generation (in NORMAL mode Ctrl+y then , &lt;C-y,&gt;)</span>
Bundle <span class="s1">&#39;mattn/emmet-vim&#39;</span>

<span class="c">&quot; Rename variables and files in your code</span>
Bundle <span class="s1">&#39;vim-scripts/rename.vim&#39;</span>

<span class="c">&quot; tmux switcher</span>
<span class="c">&quot;</span>
http:<span class="sr">//</span>robots.thoughtbot.<span class="k">com</span><span class="sr">/post/</span><span class="m">53022241323</span>/seamlessly<span class="p">-</span>navigate<span class="p">-</span><span class="k">vim</span><span class="p">-</span>and<span class="p">-</span>tmux<span class="p">-</span>splits
Bundle <span class="s1">&#39;christoomey/vim-tmux-navigator&#39;</span>

<span class="c">&quot; Git gutter</span>
Bundle <span class="s1">&#39;airblade/vim-gitgutter&#39;</span>
<span class="k">let</span> <span class="k">g</span>:gitgutter_enabled <span class="p">=</span> <span class="m">1</span>
<span class="k">let</span> <span class="k">g</span>:gitgutter_eager <span class="p">=</span> <span class="m">0</span>
<span class="k">let</span> <span class="k">g</span>:gitgutter_sign_column_always <span class="p">=</span> <span class="m">1</span>
<span class="nb">highlight</span> clear SignColumn

<span class="c">&quot; File System</span>
Bundle <span class="s1">&#39;vim-scripts/The-NERD-tree&#39;</span>
map <span class="p">&lt;</span>leader<span class="p">&gt;</span>&#39; :NERDTreeToggle<span class="p">&lt;</span><span class="k">cr</span><span class="p">&gt;</span>

<span class="c">&quot; Snippets</span>
Bundle <span class="s1">&#39;MarcWeber/vim-addon-mw-utils&#39;</span>
Bundle <span class="s1">&#39;tomtom/tlib_vim&#39;</span>
Bundle <span class="s1">&#39;garbas/vim-snipmate&#39;</span>

<span class="c">&quot; SCSS, Sass &amp; Haml Syntax Support</span>
Bundle <span class="s1">&#39;tpope/vim-haml&#39;</span>

<span class="c">&quot; Surround text with HTML or punctuation</span>
Bundle <span class="s1">&#39;tpope/vim-surround&#39;</span>

<span class="c">&quot; HTML5 syntax</span>
Bundle <span class="s1">&#39;othree/html5.vim&#39;</span>

<span class="c">&quot; Tabularize</span>
Bundle <span class="s1">&#39;godlygeek/tabular&#39;</span>
map <span class="p">&lt;</span>Leader<span class="p">&gt;</span><span class="k">e</span> :Tabularize /<span class="p">=&lt;</span><span class="k">cr</span><span class="p">&gt;</span>
map <span class="p">&lt;</span>Leader<span class="p">&gt;</span><span class="k">c</span> :Tabularize /:<span class="p">&lt;</span><span class="k">cr</span><span class="p">&gt;</span>

<span class="c">&quot; JS Hint</span>
Bundle <span class="s1">&#39;Shutnik/jshint2.vim&#39;</span>
</pre></div>
</code></pre>
<h2><a name="useful-vim-featurescommands" class="anchor" href="#useful-vim-featurescommands"><span class="header-link"></span></a>Useful Vim features/commands</h2>
<p>Part of my Vim workflow is to use Vim as efficiently as possible. To try and
take advantage of all the things it does well (such as short key commands to
help make mundane tasks quicker and easier) and to find solutions to problems
that Vim might not handle so well. </p>
<p>Here follows are some such tips and tricks...</p>
<h3><a name="search-and-replace-across-multiple-files" class="anchor" href="#search-and-replace-across-multiple-files"><span class="header-link"></span></a>Search and Replace across multiple files</h3>
<p>Surprisingly this is quite a difficult task to achieve and is one of Vim&#39;s greatest failings.</p>
<p>There are two ways this can be done, and neither is perfect. </p>
<p>You&#39;ve got the Vim way and the Unix way.</p>
<h4><a name="the-vim-way" class="anchor" href="#the-vim-way"><span class="header-link"></span></a>The Vim Way</h4>
<p>There are a couple of potential work-arounds in Vim. One way is to use either multiple files already open 
(so multiple buffers are open) or multiple files specified as arguments when opening Vim.</p>
<p>This relies on either the <code>bufdo</code> or <code>argdo</code> command (depending on whether
you&#39;re going to use buffers or arguments)..</p>
<p><code>bufdo</code> executes a command for all buffers open, and <code>argdo</code> does the same for
files specified via arguments when opening Vim.</p>
<p>There is also <code>windo</code> if you have multiple windows open.</p>
<p>The command to run would be (I&#39;m going to use <code>bufdo</code> as I almost never open Vim
with files specified via arguments, I always use Ctrl-p to open files): </p>
<p><code>:bufdo %s/search/replace/ge | update</code></p>
<p>...the trick is the <code>e</code> flag which tells Vim to ignore any errors (which could
occur if a file you&#39;re searching doesn&#39;t find a match). </p>
<p>The first half of the command tells Vim to do the search and replace and updates
the buffers, but we don&#39;t <em>write</em> to the buffer! That&#39;s why we then pipe over to
the <code>update</code> command to write to the files (this only writes to the file if it
has been modified).</p>
<p>If you want to use the argument list but not have to pass all those names as
arguments when opening Vim then you can just use <code>:args *.txt</code> to add all txt
files to the argument list (note: doing this will open each of those files,
again one of the downsides of using Vim for this task).</p>
<p><strong>Problems?</strong></p>
<p>Again, search and replace across multiple files is really difficult for Vim
sadly.</p>
<p>One of the main issues is that Vim will open all the specified files (which
could be a lot of files!). You could limit the number of files it searches by
specifying a directory or subset of files to check, but if you don&#39;t know
where to search then your only option is to search the entire code base and
that&#39;s a crazy number of files (it would be for me working on the BBC News code base) to have open within Vim.</p>
<p>There are alternatives but they also aren&#39;t as great as you&#39;d hope, such as not using Vim at all...</p>
<h4><a name="the-unix-way" class="anchor" href="#the-unix-way"><span class="header-link"></span></a>The Unix Way</h4>
<p><code>sed -i -- &#39;s/search_pattern/replacement/&#39; *.txt &amp;&amp; rm *.txt--</code></p>
<p>...this uses
<a href="http://www.integralist.co.uk/posts/unix-commands/#sed-find-and-replace">sed</a>
along with the &#39;edit in place&#39; <code>-i</code> flag (which tells sed to apply the changes
to a temp file first and then overwrite the original file).</p>
<p>Typically the <code>-i</code> flag will be followed with a file extension so sed knows what
type of temp file needs to be saved to (e.g. <code>-i.bak</code> would save the changes
temporarily to a test1.txt.bak file), so I opted for <code>--</code>.</p>
<p>After that you pass in the search pattern and the replacement and then what
files to check against.</p>
<p>Finally we need to remove the temp files that have been created <code>rm *.txt--</code>.</p>
<p>Not completely ideal, I know, as it effectively has similar issues to the Vim way in
that you have to try and filter down files searched (although I&#39;d argue doing
this via the shell should/could be more efficient than from within Vim).</p>
<h4><a name="the-gnu-way" class="anchor" href="#the-gnu-way"><span class="header-link"></span></a>The GNU Way</h4>
<p>The very last way is the same as the previous solution but is the one I use
now...</p>
<p><code>gsed -i &#39;s/search_pattern/replacement/&#39; **/*.txt</code></p>
<p>...this is the GNU version of the sed command which you can install using <code>brew
install gnu-sed</code>.</p>
<p>Notice that you don&#39;t need to specify a temporary file to write to (and so no
extra files to have to remove).</p>
<p>This for me is the best way to handle this type of issue.</p>
<p>All of the above should cover the majority of solutions you&#39;ll find on the internet for this problem.</p>
<h3><a name="moving-between-brackets" class="anchor" href="#moving-between-brackets"><span class="header-link"></span></a>Moving between brackets</h3>
<p>It can be useful sometimes to be able to jump between opening and closing
brackets (especially when working on code), this is where <code>Shift-%</code> comes in.</p>
<h3><a name="auto-indenting" class="anchor" href="#auto-indenting"><span class="header-link"></span></a>Auto indenting</h3>
<p>This is one of those Vim commands most people (even experienced Vim users
aren&#39;t aware of). It&#39;s an essential tool for me when programming now and since
discovering it I find I use it all the time.</p>
<p>If we want to auto indent all content inside a code block then we can do this
one of two ways:</p>
<ol>
<li>whilst cursor is placed on either the opening or closing code block bracket</li>
<li>whilst cursor is somewhere inside the code block</li>
</ol>
<p>For the first scenario you can use: <code>=%</code></p>
<p>For the second scenario you can use: <code>=i{</code> or <code>=i}</code></p>
<h3><a name="changing-content" class="anchor" href="#changing-content"><span class="header-link"></span></a>Changing content</h3>
<p>Another small tip that really does save we a lot of time is when I&#39;m in the
middle of a word and I want to either edit or select that word.</p>
<p>What I used to do was move <code>b</code> to the start of the word and then either <code>ce</code> or <code>ve</code>.</p>
<p>But I discovered recently that I can skip the first <code>b</code> command. I can do what I
need to whilst my cursor is placed anywhere inside the word using: <code>ciw</code> (change
inside word) or <code>viw</code> (select inside word).</p>
<p>Also, I recently discovered that you can delete a specific number of characters using something 
like <code>c2l</code> or <code>d2l</code> (change or delete 2 characters). In this command <code>l</code> means &#39;letter&#39;. That can
be quite useful as well.</p>
<h3><a name="selecting-content" class="anchor" href="#selecting-content"><span class="header-link"></span></a>Selecting content</h3>
<p>Most Vim users probably know this but just in case you don&#39;t, to be able to
select content inside of a set of punctuation (such as a brackets or quotations)
then use: <code>vi(</code> or <code>vi&#39;</code> or <code>vi&quot;</code> (you get the idea).</p>
<h3><a name="using-the-register" class="anchor" href="#using-the-register"><span class="header-link"></span></a>Using the register</h3>
<p>One of the real annoying issues I have is when I have some content I want to
copy and paste to another place in my code. Imagine you have the following
code...</p>
<pre><code class="lang-js"><div class="highlight"><pre><span class="cm">/**</span>
<span class="cm"> * @param abc</span>
<span class="cm"> */</span>
<span class="kd">function</span> <span class="nx">someThing</span> <span class="p">(</span><span class="nx">def</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>
</code></pre>
<p>...I want to replace <code>def</code> with <code>abc</code> so the first thing I do is yank/copy the
<code>abc</code>, then move to the parenthesis, but rather than manually delete <code>def</code> and
then paste my content I&#39;ll do a <code>di(</code> to delete the content first. </p>
<p>This causes me a problem because it updates the register list (which tracks 
everything that has been yanked). Any time you change or delete content it gets 
copied to the register list. So if I was to paste now I&#39;d just end up pasting
<code>def</code> as the delete command has placed that at the top of my register list.</p>
<p>So I&#39;ll end up having to go back and re-copy <code>abc</code> and then head back again to
the parenthesis to paste it in.</p>
<p>My colleague showed me this alternative better workflow: copy <code>abc</code> and still delete
inside the parenthesis, but if you execute <code>:reg</code> and look at the list there
you&#39;ll see something like <code>&quot;1 abc</code>. I can then reuse that particular item by
typing <code>&quot;1p</code> (so I grab what&#39;s held at <code>&quot;1</code> and then use the paste command).</p>
<p>It might sound like I&#39;m doing more work by looking up what&#39;s in the register
list, but really I&#39;m saving myself time compared to moving my cursor back to the original
location and re-copying <code>abc</code> and then moving back to parenthesis and pasting.</p>
<h3><a name="buffer-management" class="anchor" href="#buffer-management"><span class="header-link"></span></a>Buffer management</h3>
<p>This should be common knowledge for Vim users: when you open a file then Vim
places the contents of that file inside of a buffer. When you edit the buffer
then the original file is left unchanged until the buffer itself is written back
to the file (e.g. <code>:w</code>).</p>
<p>When you have multiple files open then you have multiple buffers. To close the
current buffer you can run the command <code>:bd</code>.</p>
<p>You can also view all open buffers with <code>:ls</code>.</p>
<p>But the one trick I find most useful is to close all open buffers and this again
relies on <code>bufdo</code> which we saw earlier when looking at a global search and
replace solution.</p>
<p>If you run the command <code>:bufdo bd</code> then it&#39;ll simply run the close buffer
command <code>bd</code> for every buffer currently open. Simple.</p>
<p>Within my .vimrc file I&#39;ve mapped those last two items to more easily accessible keys...</p>
<pre><code class="lang-vim"><div class="highlight"><pre><span class="c">&quot; List Buffers</span>
map <span class="p">&lt;</span>leader<span class="p">&gt;</span>yt :<span class="k">ls</span><span class="p">&lt;</span><span class="k">cr</span><span class="p">&gt;</span>

<span class="c">&quot; Delete all Buffers (runs the delete buffer command on all open buffers)</span>
map <span class="p">&lt;</span>leader<span class="p">&gt;</span>yd :<span class="k">bufdo</span> <span class="k">bd</span><span class="p">&lt;</span><span class="k">cr</span><span class="p">&gt;</span>
</pre></div>
</code></pre>
<h3><a name="jump-list" class="anchor" href="#jump-list"><span class="header-link"></span></a>Jump List</h3>
<p>The &#39;jump list&#39; keeps a record of all your cursor positions/movements. It came
in handy whilst I was writing this post actually and I&#39;ll explain how in a
moment.</p>
<p>To view all cursor positions/movements just run the <code>:jumps</code> command.</p>
<p>To move backwards through each jump item use <code>Ctrl-o</code> and to move forward use
<code>Ctrl-i</code>. Straight forward enough.</p>
<p>The reason this was useful to me was I wanted to create a &#39;Table of Contents&#39;
for this post and so I already had the headers (e.g. <code>### Jump List</code>) written
out and so what I was doing was using the <code>/</code> find command to locate all <code>###</code>
and then copying the title and moving back to the top of the document to paste
it into a list.</p>
<p>The problem I was having was after I pasted the item at the top of this post&#39;s
source file, I couldn&#39;t remember the line number I had just come from. So
instead of pressing <code>n</code> to start moving back through all highlighted <code>###</code>
headers I instead just pressed <code>Ctrl-o</code> and it too me back to the last <code>###</code> I
had just moved from. Meaning I could continue on from where I left off.</p>
<p>As you can see, it&#39;s knowledge such as this that makes Vim users more efficient.
I might not use this technique often, but because I know it exists I can take
advantage of it when I do need it.</p>
<h3><a name="change-list" class="anchor" href="#change-list"><span class="header-link"></span></a>Change List</h3>
<p>The &#39;change list&#39; is the same as the &#39;<a href="#jump-list">jump list</a>&#39;. But as I&#39;m sure you&#39;ve already
guessed, it records any changes made to the document. </p>
<p>What might not be clear is that it only records changes made when inside INSERT mode.</p>
<p>So to view all changes run the command <code>:changes</code>.</p>
<p>To move back through the change list use <code>g;</code> and to move forward use <code>g,</code>.</p>
<p>Be aware that this isn&#39;t the same as (u)ndo or <code>Ctrl-r</code> (redo) as they move
backwards and forwards through changes and actually affect the list. The change
list just moves the cursor&#39;s position to the place of a change.</p>
<h3><a name="case-insensitive-searching" class="anchor" href="#case-insensitive-searching"><span class="header-link"></span></a>Case Insensitive Searching</h3>
<p>Although you can set a case-insensitive search (e.g. <code>/mySearchTerm</code>) via your .vimrc, 
you can also use the <code>\c</code> flag at the end of your search term <code>/mySearchTerm\c</code>.</p>
<h3><a name="regular-expressions" class="anchor" href="#regular-expressions"><span class="header-link"></span></a>Regular Expressions</h3>
<p>If you look at <a href="http://vimregex.com/"><a href="http://vimregex.com/">http://vimregex.com/</a></a> you&#39;ll realise that
Vim only supports a subset of modern Regex features.</p>
<p>To make things more awkward Vim also has an odd default engine which means
things like capturing groups <code>(stuff to be captured)</code> needs to be escaped like
so: <code>\(stuff to be captured\)</code> which is ugly and hard to have to remember
(considering nearly all programming languages don&#39;t require this type of syntax
modification).</p>
<p>So to resolve that you can tell Vim to use &quot;very magic mode&quot; (there are other
modes for Vim to use with Regular Expressions but this is the only one of
importance to me - and likely to you as well).</p>
<p>To use &quot;very magic mode&quot; just add <code>\v</code> to the beginning of your regex. </p>
<p>So imagine you want to capture the words &quot;very magic&quot; in standard Vim regex mode
you&#39;d need to write <code>:%s/\(very magic\)//gc</code> but we don&#39;t want to have to escape
the capturing group syntax so we do the following instead <code>:%s/\v(very magic)//gc</code></p>
<p>Note: referencing captured groups differs between programming languages. Some
use <code>$1</code> and others use <code>\1</code> (which makes them consistent with &#39;back
references&#39;). In Vim they use the latter <code>\1</code> style.</p>
<h3><a name="removing-line-spaces" class="anchor" href="#removing-line-spaces"><span class="header-link"></span></a>Removing line spaces</h3>
<p>Pressing <code>Shift-J</code> will remove a line break for you.</p>
<p>This doesn&#39;t sound like much of a tip but this is another of those commands I
end up using a lot.</p>
<p>So it&#39;ll convert...</p>
<pre><code><div class="highlight"><pre><span class="nx">Here</span> <span class="nx">is</span> <span class="nx">some</span> <span class="nx">text</span>
<span class="nx">that</span> <span class="nx">is</span> <span class="nx">split</span> <span class="nx">by</span> <span class="nx">a</span> <span class="nx">line</span> <span class="k">break</span>
</pre></div>
</code></pre>
<p>...into...</p>
<pre><code><div class="highlight"><pre><span class="nx">Here</span> <span class="nx">is</span> <span class="nx">some</span> <span class="nx">text</span> <span class="nx">that</span> <span class="nx">is</span> <span class="nx">split</span> <span class="nx">by</span> <span class="nx">a</span> <span class="nx">line</span> <span class="k">break</span>
</pre></div>
</code></pre>
<h3><a name="switching-case" class="anchor" href="#switching-case"><span class="header-link"></span></a>Switching case</h3>
<p>One thing I used to hate doing is going into INSERT mode to change either a
single character or word (or worse still, an entire sentence) into different
case.</p>
<p>The <code>~</code> tilda command does that for you. </p>
<p>So if your cursor is on a single character such as the &#39;t&#39; of the word &#39;today&#39; 
and you press <code>~</code> (you&#39;ll likely need to hold down the Shift key if
you&#39;re on a Mac) then the casing will switch to uppercase and become &#39;Today&#39;.</p>
<p>This can be done letter by letter or chunks of selected text.</p>
<h3><a name="moving-forward-and-backwards-by-code-not-words" class="anchor" href="#moving-forward-and-backwards-by-code-not-words"><span class="header-link"></span></a>Moving forward and backwards by code not words</h3>
<p>Something I didn&#39;t realise for a long time was that I could use the capitalised
version of most commands for them to do the opposite of what they normally do.</p>
<p>For example, <code>fa</code> will move the cursor to the first instance of the <code>a</code>
character. But <code>F</code> will move backwards for the first instance of <code>a</code> it can
find.</p>
<p>The reason this is important is when I&#39;m programming and I want to move
backwards or forwards I typically use the <code>w</code> and <code>e</code> keys, but programming
syntax can be a pain to jump through like that.</p>
<p>Consider (and this is a contrived example, so forgive me, I realise there are
better ways)...</p>
<pre><code class="lang-js"><div class="highlight"><pre><span class="k">this</span><span class="p">.</span><span class="nx">handlePrevImageCalculations</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">debounce</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</pre></div>
</code></pre>
<p>...if I want to get my cursor to just before <code>=</code> then pressing <code>e</code> would take about
three presses as it would stop at the end of <code>this</code> and then <code>.</code> and finally at
the end of <code>handlePrevImageCalculations</code>.</p>
<p>But using <code>E</code> just the once moves there by ignoring punctuation between words.</p>
<p>This is the same for <code>W</code> and <code>B</code>.</p>
<h3><a name="repeating-yourself" class="anchor" href="#repeating-yourself"><span class="header-link"></span></a>Repeating yourself</h3>
<p>Using the <code>.</code> command can be really useful for saving yourself time repeating
yourself. Whether you&#39;ve made an edit or you&#39;ve indented a line of code
(whatever it happens to be), pressing <code>.</code> will repeat that change. Try and get
into the habbit of using it.</p>
<p>To give you an example, I used the Surround plugin (described above) to wrap my
table of contents in square brackets using <code>ys$]</code> and for each line I just
pressed <code>.</code> and it meant I didn&#39;t have to think about which four characters I 
needed to type out multiple times.</p>
<h3><a name="appending-to-end-of-a-line" class="anchor" href="#appending-to-end-of-a-line"><span class="header-link"></span></a>Appending to end of a line</h3>
<p>This tip really does save me a lot of time.</p>
<p>When I wanted to add some content to the end of a line I would typically use <code>$</code>
and then <code>a</code> until I realised I could just press <code>A</code> and that would do the same
thing.</p>
<p>OK so it saves you one key stroke. But I do this type of movement ALL THE TIME
and so that&#39;s a lot of savings you end up making.</p>
<h3><a name="searching-for-current-word" class="anchor" href="#searching-for-current-word"><span class="header-link"></span></a>Searching for current word</h3>
<p>If you want to search for the word your cursor is currently on, don&#39;t do this:</p>
<ul>
<li>select word <code>yiw</code></li>
<li>press <code>/</code></li>
<li>paste copied word <code>p</code></li>
</ul>
<p>...instead just press <code>Shift-8</code> and that&#39;ll do all of that for you.</p>
<h2><a name="conclusion" class="anchor" href="#conclusion"><span class="header-link"></span></a>Conclusion</h2>
<p>So there you have it. This is my attempt to explain my Vim workflow and to
hopefully have shared some useful Vim tips and tricks.</p>
<p>If you want to see my full dotfile set-up (this includes my .vimrc and other Vim
configurations) then check out my public GitHub repo &quot;<a href="https://github.com/Integralist/Fresh-Install">Fresh
Install</a>&quot; which should tell you
everything you need to know (I update this a lot as I find better ways of doing
things).</p>
</div>

  <div class="comments">
    <a href="/posts/vim-workflow-part-deux/#comments">
      <span class="icon-bubbles"></span>
      Comments
    </a>
  </div>

  <div class="post-head group">
  <a href="/posts/refactoring-techniques/">
    <h1 class="post-title">Refactoring Techniques</h1>
  </a>
  <span class="post-date">2013 &#183; 11 &#183; 10</span>
</div>

<div class="post-body"><h2><a name="what-well-cover" class="anchor" href="#what-well-cover"><span class="header-link"></span></a>What we&#39;ll cover</h2>
<p><em>reading time: approx. 17mins</em></p>
<ul>
<li>Introduction</li>
<li>Languages</li>
<li>Why refactor?</li>
<li>When should refactor?</li>
<li>Tests</li>
<li>Refactoring Techniques<ul>
<li><a href="#rename-method">Rename Method</a></li>
<li><a href="#introduce-explaining-variable">Introduce Explaining Variable</a></li>
<li><a href="#inline-temp">Inline Temp</a></li>
<li><a href="#split-temp-variable">Split Temp Variable</a></li>
<li><a href="#replace-temp-with-query">Replace Temp With Query</a></li>
<li><a href="#replace-temp-with-chain">Replace Temp With Chain</a></li>
<li><a href="#extract-method">Extract Method</a></li>
<li><a href="#inline-method">Inline Method</a></li>
<li><a href="#move-method">Move Method</a></li>
<li><a href="#replace-method-with-method-object">Replace Method With Method Object</a></li>
<li><a href="#replace-loop-with-collection-closure-method">Replace Loop With Collection Closure Method</a></li>
<li><a href="#pull-up-method">Pull Up Method</a></li>
<li><a href="#form-template-method">Form Template Method</a></li>
<li><a href="#extract-surrounding-method">Extract Surrounding Method</a></li>
<li><a href="#self-encapsulate-field">Self Encapsulate Field</a></li>
<li><a href="#introduce-named-parameter">Introduce Named Parameter</a></li>
</ul>
</li>
<li>Conclusion</li>
</ul>
<h2><a name="introduction" class="anchor" href="#introduction"><span class="header-link"></span></a>Introduction</h2>
<p>Let&#39;s begin by considering: &quot;What is Refactoring?&quot;</p>
<p>The definition of refactoring is:</p>
<blockquote>
<p>a disciplined technique for restructuring an existing body of code, altering its internal structure without changing its external behaviour</p>
</blockquote>
<p>Refactoring is a term originated from the <a href="http://en.wikipedia.org/wiki/Smalltalk">Smalltalk</a> community of developers back in the mid-late nineties. </p>
<p>Two of the most prolific programmers of recent times, <a href="http://martinfowler.com/">Martin Fowler</a> and <a href="http://en.wikipedia.org/wiki/Kent_Beck">Kent Beck</a> literally wrote the book on the subject of refactoring called &quot;<a href="http://www.amazon.com/gp/product/0201485672">Refactoring: Improving the Design of Existing Code</a>&quot; (well, written by Martin with contributions from Kent).</p>
<p>In 2009 both Martin and Kent helped with a rewrite of the book that focused more on the Ruby language than the original book&#39;s target language of Java. This follow-up book was called &quot;<a href="http://www.amazon.com/Refactoring-Ruby-Edition-Jay-Fields/dp/0321603508">Refactoring: The Ruby Edition</a>&quot; and it&#39;s that book which is the primary driving force of this post.</p>
<p>Since reading the Ruby edition I wanted to have a short summarised version of some of the more commonly used refactoring techniques (mainly for my own reference). By that I mean the techniques described in the book that I find interesting and use a lot in my day to day programming life.</p>
<h2><a name="languages" class="anchor" href="#languages"><span class="header-link"></span></a>Languages</h2>
<p>These refactoring techniques aren&#39;t specific to the Ruby language. You can use them when working with JavaScript or PHP (or any other language for that matter). </p>
<p>Programming languages don&#39;t all offer identical APIs and so sometimes you might need to tweak the examples slightly to fit your environment. </p>
<p>Regardless, the idioms and syntax differences between languages become redundant when you just focus on the pattern(s) behind the proposed solution.</p>
<h2><a name="why-refactor" class="anchor" href="#why-refactor"><span class="header-link"></span></a>Why refactor?</h2>
<p>The purpose of refactoring is to improve the quality, clarity and maintainability of your code. Simple really.</p>
<p>But also, refactoring can be a great lesson in understanding an unfamiliar code base.</p>
<p>Think about it, if you inherit a poorly designed code base that you&#39;ve not seen before and you now need to either fix a bug or add a new feature, then implementing the code necessary would be a lot easier once you had refactored it to be in a more stable, maintainable and ultimately &#39;understandable&#39; state. </p>
<p>Otherwise you would be forced to retro fit your new code on top of a poorly designed foundation and that would be the start of a very unhappy relationship.</p>
<h2><a name="when-should-you-refactor" class="anchor" href="#when-should-you-refactor"><span class="header-link"></span></a>When should you refactor?</h2>
<p>You&#39;ll usually find the time you start refactoring the most is when you are fixing bugs or adding new features.</p>
<p>For example, you typically first need to understand the code that has already been written (regardless of whether it was you who wrote it originally or someone else). </p>
<p>The process of refactoring helps you better understand the code, in preparation for modifying it.</p>
<p>But don&#39;t fall into the trap of thinking that refactoring is something you set aside time for, or only consider at the start/end of a project. It&#39;s not. Refactoring should be done in small chunks throughout the entire life cycle of the project.</p>
<p>As the great <a href="http://www.cleancoder.com/">Uncle Bob</a> once said:</p>
<blockquote>
<p>leave a module in a better state than you found it</p>
</blockquote>
<p>...what this suggests is that refactoring is essential to your daily coding process.</p>
<h3><a name="tests" class="anchor" href="#tests"><span class="header-link"></span></a>Tests</h3>
<p>Before we get started, it&#39;s important to mention that you should have tests in place when you&#39;re refactoring. </p>
<p>You <em>can</em> refactor without tests, but realise that without tests to back you up then you can have no confidence in the refactoring you are implementing.</p>
<p>Refactoring can result in substantial changes to the code and architecture but still leave the top layer API the same. So while you&#39;re refactoring remember the old adage...</p>
<blockquote>
<p>program to an interface, not an implementation</p>
</blockquote>
<p>We want to avoid changing a public API where ever possible (as that&#39;s one of the tenets of refactoring).</p>
<p>If you don&#39;t have tests then I recommend you write some (now)... don&#39;t worry, I&#39;ll wait.</p>
<p>Remember, the process of writing tests (even for an application you don&#39;t know) will help solidify your understanding and expectations of the code you&#39;re about to work on.</p>
<p>Code should be tested regularly while refactoring to ensure you don&#39;t break anything. Keep the &#39;red, green, refactor&#39; feedback loop tight. Tests help confirm if your refactoring has worked or not. Without them you&#39;re effectively flying blind.</p>
<p>So although I won&#39;t explicitly mention it below when discussing the different refactoring techniques, it is implied that on every change to your code you should really be running the relevant tests to ensure no broken code appears.</p>
<h2><a name="refactoring-techniques" class="anchor" href="#refactoring-techniques"><span class="header-link"></span></a>Refactoring Techniques</h2>
<p>There are many documented refactoring techniques and I do not attempt to cover them all, as this post would end up becoming a book in itself. So I&#39;ve picked what I feel are the most common and useful refactoring techniques and I try my best to explain them in a short and concise way.</p>
<p>I&#39;ve put these techniques in order of how you might approach refactoring a piece of code, in a linear, top to bottom order. This is a personal preference and doesn&#39;t necessarily represent the best way to refactor.</p>
<p>Final note: with some of the techniques I have provided a basic code example, but to be honest some techniques are so simple they do not need any example. The <a href="#extract-method">Extract Method</a> is one such technique that although really useful and important, providing a code example would be a waste of time and space.</p>
<p>So without further ado, let&#39;s begin...</p>
<h3><a name="rename-method" class="anchor" href="#rename-method"><span class="header-link"></span></a>Rename Method</h3>
<p>The single most effective and simple refactoring you can implement is to rename a property/attribute, method or object.</p>
<p>Renaming identifiers can reduce the need for code comments and nearly always helps to promote greater clarity.</p>
<p>You&#39;ll find that renaming things is a fundamental part of other refactoring techniques to aid understanding of the code.</p>
<p>This technique relies on giving items a descriptive name to ensure the developer knows at a glance exactly what it does. The following technique <a href="#introduce-explaining-variable">Introduce Explaining Variable</a> is effectively the same.</p>
<h3><a name="introduce-explaining-variable" class="anchor" href="#introduce-explaining-variable"><span class="header-link"></span></a>Introduce Explaining Variable</h3>
<p>So here is a technique specifically based around the premise of renaming. </p>
<p>If you have a complicated expression (for example, you&#39;ll typically have a long winded set of conditions within an <code>if</code> statement) then place that complex expression into a temp variable and give it a descriptive identifier. </p>
<p>Note: this is the only technique that finds temps (i.e. local variables) acceptable. This is because temps are deemed to be less reusable than methods (due to their very nature being &#39;local&#39;) and so introducing temps is something that shouldn&#39;t be considered lightly. Maybe consider using the <a href="#extract-method">Extract Method</a> technique instead before using this particular technique. </p>
<p>Also, don&#39;t worry about performance until you know you have a performance issue to worry about. Developers will always suggest that calling methods is slower than running code inline, but good programming is about readability and maintainability, and extracted methods are not only easier to understand but are much more reusable by other methods. </p>
<p>So if you are considering using the <a href="#introduce-explaining-variable">Introduce Explaining Variable</a> technique, first decide whether the temp would be more useful if it was available to other methods (that way you could use <a href="#extract-method">Extract Method</a> instead and avoid defining a temp altogether).</p>
<h3><a name="inline-temp" class="anchor" href="#inline-temp"><span class="header-link"></span></a>Inline Temp</h3>
<p>Temp variables are a bit of a code smell as they make methods longer and can make the <a href="#extract-method">Extract Method</a> more awkward (as you&#39;d have to pass through more data to the extracted method).</p>
<p>Inline Temp effectively removes the temp variable altogether by just using the value assigned to it (I&#39;d only suggest doing this if the temp is only used once or if the resulting value has come from a method invocation).</p>
<p>Note: a temp by itself doesn&#39;t do any harm, and in some instances can actually make the code clearer (especially if using a result from a method invocation and the method identifier doesn&#39;t indicate the intent as well as it should).</p>
<p>But most likely you&#39;ll end up using this technique to aid the <a href="#extract-method">Extract Method</a> technique as less temp vars means less requirement to pass through additional parameters to the extracted method.</p>
<h3><a name="split-temp-variable" class="anchor" href="#split-temp-variable"><span class="header-link"></span></a>Split Temp Variable</h3>
<p>This technique aims to resolve the concern of violating the SRP (Single Responsibility Principle), although slightly tamer in the sense that SRP is aimed more at Classes/Objects and methods, not typically variable assignments.</p>
<p>But regardless if a temporary variable is assigned to more than once and it is not a loop variable or a collecting/accumulator variable then it is a temp considered to have too many responsibilities.</p>
<p><strong>For example</strong>: (this is a daft example, but what the heck)</p>
<pre><code class="lang-ruby"><div class="highlight"><pre><span class="n">temp</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">height</span> <span class="o">+</span> <span class="n">width</span><span class="p">)</span>
<span class="n">temp</span> <span class="o">=</span> <span class="n">height</span> <span class="o">*</span> <span class="n">width</span>
</pre></div>
</code></pre>
<p><strong>Becomes</strong>:</p>
<pre><code class="lang-ruby"><div class="highlight"><pre><span class="n">perimeter</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">height</span> <span class="o">+</span> <span class="n">width</span><span class="p">)</span>
<span class="n">area</span> <span class="o">=</span> <span class="n">height</span> <span class="o">*</span> <span class="n">width</span>
</pre></div>
</code></pre>
<p>As you can see, the temp variable was handling more responsibility than it should be and so by creating two appropriately distinct temps we ensure greater code clarity.</p>
<h3><a name="replace-temp-with-query" class="anchor" href="#replace-temp-with-query"><span class="header-link"></span></a>Replace Temp With Query</h3>
<p>This technique has a very similar intent to <a href="#inline-temp">Inline Temp</a> in that one of its primary focuses is to aid the <a href="#extract-method">Extract Method</a>.</p>
<p>The subtle but important difference between this technique and <a href="#inline-temp">Inline Temp</a> is that the complex expression assigned to the temp needs to be first moved to a method (where as the <a href="#inline-temp">Inline Temp</a> technique is different in that the temp may already be using a method invocation).</p>
<p>This technique can help to shorten a long method by not having to define lots of temp variables just to hold values.</p>
<p>If the extracted query method is given an identifier that aptly describes its purpose then the code still can be considered clear and descriptive. </p>
<p>Also, it is considered bad form to define a variable which changes once it has been set (hence moving to a method better indicates an unstable value). </p>
<p>Note: this technique can sometimes be made easier to implement once you&#39;ve used <a href="#split-temp-variable">Split Temp Variable</a>. </p>
<p>Remember this technique (as with other techniques) is an incremental step towards removing non-essential temps, so consider using <a href="#inline-temp">Inline Temp</a> afterwards, thus removing the need for the temp altogether.</p>
<h3><a name="replace-temp-with-chain" class="anchor" href="#replace-temp-with-chain"><span class="header-link"></span></a>Replace Temp With Chain</h3>
<p>This is yet another technique designed to rid your code of temp variables. </p>
<p>If you have a temp variable holding the result of calling an object&#39;s method, and follow the assignment by using that temp to carry out more method calls, then you should consider chaining method calls instead.</p>
<p>The implementation is quite simple, you just have to ensure the methods called return <code>self</code> (or <code>this</code> if using a language like JavaScript).</p>
<p>By allowing methods to chain we again have the opportunity to remove an unnecessary temps.</p>
<p><strong>For example</strong>:</p>
<pre><code class="lang-ruby"><div class="highlight"><pre><span class="k">class</span> <span class="nc">College</span>
    <span class="k">def</span> <span class="nf">create_course</span>
        <span class="nb">puts</span> <span class="s2">&quot;create course&quot;</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">add_student</span>
        <span class="nb">puts</span> <span class="s2">&quot;add student&quot;</span>
    <span class="k">end</span>
<span class="k">end</span>

<span class="n">temp</span> <span class="o">=</span> <span class="no">College</span><span class="o">.</span><span class="n">new</span>
<span class="n">temp</span><span class="o">.</span><span class="n">create_course</span>
<span class="n">temp</span><span class="o">.</span><span class="n">add_student</span>
<span class="n">temp</span><span class="o">.</span><span class="n">add_student</span>
<span class="n">temp</span><span class="o">.</span><span class="n">add_student</span>
</pre></div>
</code></pre>
<p><strong>Becomes</strong>:</p>
<pre><code class="lang-ruby"><div class="highlight"><pre><span class="k">class</span> <span class="nc">College</span>
    <span class="c1"># static method so can be accessed without creating an instance</span>
    <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">create_course</span>
        <span class="n">college</span> <span class="o">=</span> <span class="no">College</span><span class="o">.</span><span class="n">new</span>
        <span class="nb">puts</span> <span class="s2">&quot;create course&quot;</span>
        <span class="n">college</span> <span class="c1"># return new object instance</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">add_student</span>
        <span class="nb">puts</span> <span class="s2">&quot;add student&quot;</span>
        <span class="nb">self</span> <span class="c1"># refers to the new object instance</span>
    <span class="k">end</span>
<span class="k">end</span>

<span class="n">college</span> <span class="o">=</span> <span class="no">College</span><span class="o">.</span><span class="n">create_course</span>
                 <span class="o">.</span><span class="n">add_student</span>
                 <span class="o">.</span><span class="n">add_student</span>
                 <span class="o">.</span><span class="n">add_student</span>
</pre></div>
</code></pre>
<h3><a name="extract-method" class="anchor" href="#extract-method"><span class="header-link"></span></a>Extract Method</h3>
<p>Here it is! In my opinion &#39;<em>The</em>&#39; most used and important refactoring technique.</p>
<p>The implementation behind this technique is very simple. It consists of breaking up long methods by shifting overly complex chunks of code into new methods which have very descriptive identifiers. </p>
<p>But be careful with handling local variables as you&#39;ll need to pass them through to the extracted method and that can be difficult if there are lots of temps in use. Sometimes to facility the Extract Method you&#39;ll need to first incorporate other techniques such as <a href="#replace-temp-with-query">Replace Temp With Query</a> and <a href="#inline-temp">Inline Temp</a>.</p>
<h3><a name="inline-method" class="anchor" href="#inline-method"><span class="header-link"></span></a>Inline Method</h3>
<p>Sometimes you want the opposite of the <a href="#extract-method">Extract Method</a> technique. Imagine a method exists whose content is already simple and clear, and whose identifier adds no extra benefit. In this instance we&#39;re just making an extra call for no real benefit.</p>
<p>So to fix this problem we&#39;ll convert the method invocation into an inlined piece of code (unless of course the method is used in multiple places, in that case leave it where it is as having it in a separate method keeps our code DRY).</p>
<h3><a name="move-method" class="anchor" href="#move-method"><span class="header-link"></span></a>Move Method</h3>
<p>In a previous post about <a href="http://www.integralist.co.uk/posts/object-oriented-design-ood/#class-analysis">Object-Oriented Design</a> I explained that you should query your classes/objects to ensure the methods they define are actually where they should be.</p>
<p>The Move Method technique ensures this decoupling by simply moving the identified misplaced method onto the correct one.</p>
<p>Once the method has been moved you should clean up the previously passed parameters by seeing what can be moved over to the other object or whether additional data needs to be passed over now via the method invocation. </p>
<p>From the original class/object keep the original method in place while you test and change it so it now delegates to the method on the new object. Then slowly refactor by replacing delegating calls throughout your code base with direct calls to the method via its new host. </p>
<p>Finally, remove the old method altogether and the tests should tell you if you missed a replacement somewhere.</p>
<h3><a name="replace-method-with-method-object" class="anchor" href="#replace-method-with-method-object"><span class="header-link"></span></a>Replace Method With Method Object</h3>
<p>You may run into a problem where you have a long method you want to use <a href="#extract-method">Extract Method</a> on, but the number of temporary local variables are too great to allow you to utilise the <a href="#extract-method">Extract Method</a> technique (because passing around that many variables would be just as messy as the long method itself).</p>
<p>To resolve this issue you could look at different types of smaller refactors (such as <a href="#inline-temp">Inline Temp</a>) but in some cases it would actually be better to first move the contents of the long method into an entirely new object.</p>
<p>So the first thing to do is create a new class named after the long method and add the temp local vars as properties/attributes of the class/object.</p>
<p>Now when you try to implement <a href="#extract-method">Extract Method</a> you don&#39;t have to pass around the temp vars because they are now available throughout the class/object. </p>
<p>Then from within the original class/object you can delegate any calls to the original method on to the object (you&#39;ll still pass on the original arguments to the method within the new object but from there on the method extraction becomes easier).</p>
<h3><a name="replace-loop-with-collection-closure-method" class="anchor" href="#replace-loop-with-collection-closure-method"><span class="header-link"></span></a>Replace Loop With Collection Closure Method</h3>
<p>If you write a loop that parses a collection and interacts with the individual elements within the collection then move that interaction out into a separate closure based method (meaning you replace the loop with an Enumerable method). </p>
<p>This refactoring may not be as clear or impressive as other refactoring techniques but the motivation behind it is that you hide the ugly details of the loop behind a nicer iteration method, allowing the developer looking at the code to focus on the business logic instead.</p>
<p><strong>For example</strong>:</p>
<pre><code class="lang-ruby"><div class="highlight"><pre><span class="n">managers</span> <span class="o">=</span> <span class="o">[]</span>
<span class="n">employees</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">e</span><span class="o">|</span>
    <span class="n">managers</span> <span class="o">&lt;&lt;</span> <span class="n">e</span> <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">manager?</span>
<span class="k">end</span>
</pre></div>
</code></pre>
<p><strong>Becomes</strong>:</p>
<pre><code class="lang-ruby"><div class="highlight"><pre><span class="n">managers</span> <span class="o">=</span> <span class="n">employees</span><span class="o">.</span><span class="n">select</span> <span class="p">{</span> <span class="o">|</span><span class="n">e</span><span class="o">|</span> <span class="n">e</span><span class="o">.</span><span class="n">manager?</span> <span class="p">}</span>
</pre></div>
</code></pre>
<p>Ruby has a few of these types of enumerable methods but other languages such as PHP and JavaScript aren&#39;t so lucky. </p>
<p>JavaScript has a couple of accumulators: <code>Array#reduce</code> and <code>Array#reduceRight</code> but they aren&#39;t very useful as closure based collection methods compared to Ruby which has methods such as <code>Enumerable#inject</code>, <code>Enumerable#select</code> (seen in above example) or <code>Enumerable#collect</code>. </p>
<p>Note: in JavaScript you can implement a similar effect with clever use of closures.</p>
<h3><a name="pull-up-method" class="anchor" href="#pull-up-method"><span class="header-link"></span></a>Pull Up Method</h3>
<p>When you have duplicated code across two separate classes then the best refactoring technique to implement is to pull that duplicate code up into a super class so we DRY (Don&#39;t Repeat Yourself) out the code and allow it to be used in multiple places without duplication (meaning changes in future only have to happen in one place).</p>
<h3><a name="form-template-method" class="anchor" href="#form-template-method"><span class="header-link"></span></a>Form Template Method</h3>
<p>This is one of the quintessential refactoring techniques. It involves shifting duplicate code from within multiple methods into a super class. Then create sub classes with identical interfaces but the actual implementation can be unique to the sub class.</p>
<p>This could be implemented using standard Interfaces (as found in PHP), so you would just define empty methods the Interface should enforce but don&#39;t implement any logic or content within them.</p>
<p>But if you find yourself using the <a href="#pull-up-method">Pull Up Method</a> technique (which also reduces any duplication in pre-existing code) then you&#39;ll need an Abstract class instead, as you would have pulled up an actual implementation into the super class. </p>
<p>But even with an Abstract class, other methods defined can still just be an empty definition so sub classes can override them.</p>
<p>Ruby and JavaScript don&#39;t support Interfaces so you would need to implement this using Duck Typing (although in JavaScript you can implement a form of Interface - to see how read <a href="http://www.apress.com/9781590599082">Pro JavaScript Design Patterns</a>)</p>
<p>Note: this technique might be a bit confusing in the sense that it seems to be very similar to the <a href="#pull-up-method">Pull Up Method</a>. The difference is subtle but for this technique to be effective (such as implementation of interfaces and abstract classes - or similar concepts) means it must use other techniques (such as <a href="#pull-up-method">Pull Up Method</a>).</p>
<ul>
<li>Use <a href="#pull-up-method">Pull Up Method</a> to place duplicate code into the super class</li>
<li>Use <a href="#rename-method">Rename Method</a> to ensure sub classes have identical signatures to match to the super class interface</li>
</ul>
<h3><a name="extract-surrounding-method" class="anchor" href="#extract-surrounding-method"><span class="header-link"></span></a>Extract Surrounding Method</h3>
<p>If you find you have different methods which contain almost identical code but with a slight variant in the middle, then pull up the duplicated code into a single method and pass a code block to the newly created method which it yields to in order to execute the unique behaviour...</p>
<pre><code class="lang-ruby"><div class="highlight"><pre><span class="k">def</span> <span class="nf">do_something</span>
    <span class="nb">puts</span> <span class="mi">1</span>
    <span class="k">yield</span>
    <span class="nb">puts</span> <span class="mi">3</span>
<span class="k">end</span>

<span class="n">do_something</span> <span class="p">{</span> <span class="nb">puts</span> <span class="mi">2</span> <span class="p">}</span>
</pre></div>
</code></pre>
<p>This is actually a common pattern in Ruby known as the &#39;wrap around&#39; method. This technique is similar to the <a href="#form-template-method">Form Template Method</a>, but is different in that you can use it without forcing an inheritance model on your code.</p>
<p>Note: JavaScript doesn&#39;t have the ability to pass a code block but it can be replicated by passing a function that acts like a callback...</p>
<pre><code class="lang-js"><div class="highlight"><pre><span class="kd">function</span> <span class="nx">doSomething</span> <span class="p">(</span><span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
        <span class="nx">callback</span><span class="p">();</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>
<span class="p">}</span>

<span class="nx">doSomething</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>
</code></pre>
<p>...although in the latest versions of Node (as of November 2013) Generators are implemented and would allow JavaScript code to <code>yield</code> similar to how Ruby works.</p>
<h3><a name="self-encapsulate-field" class="anchor" href="#self-encapsulate-field"><span class="header-link"></span></a>Self Encapsulate Field</h3>
<p>When inheriting properties from a parent class/object then it can be more flexible if the parent class only allows access to the properties from within a getter/setter.</p>
<p>The motivation for this technique is that a sub class can override and modify the behaviour of the getter/setter without affecting the parent class&#39; implementation. Which is similar to how the Decorator design pattern works (e.g. modifying the behaviour without affecting the original).</p>
<p>This technique should only be used once you find the coupling between objects is becoming a problem. Otherwise direct access to properties and instance variables should be acceptable initially.</p>
<h3><a name="introduce-named-parameter" class="anchor" href="#introduce-named-parameter"><span class="header-link"></span></a>Introduce Named Parameter</h3>
<p>When method arguments are unclear then convert them into named parameters so they become clearer (and easier to remember). </p>
<p>Although Ruby supports named parameters...</p>
<pre><code class="lang-ruby"><div class="highlight"><pre><span class="k">def</span> <span class="nf">turnOnTheTV</span> <span class="p">(</span><span class="ss">channel</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="ss">volume</span><span class="p">:</span> <span class="mi">1</span><span class="p">);</span> <span class="k">end</span>
<span class="n">turnOnTheTV</span><span class="p">(</span><span class="ss">channel</span><span class="p">:</span> <span class="mi">101</span><span class="p">,</span> <span class="ss">volume</span><span class="p">:</span> <span class="mi">10</span><span class="p">)</span>
</pre></div>
</code></pre>
<p>...neither PHP or JavaScript do, so for PHP you can pass an associated Array and with JavaScript you can pass an Object/Hash.</p>
<p><strong>For example (JavaScript)</strong>:</p>
<pre><code class="lang-ruby"><div class="highlight"><pre><span class="n">function</span> <span class="n">turnOnTheTV</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">v</span><span class="p">){}</span>
<span class="n">turnOnTheTV</span><span class="p">(</span><span class="mi">101</span><span class="p">,</span> <span class="mi">10</span><span class="p">);</span>
</pre></div>
</code></pre>
<p><strong>Becomes</strong>:</p>
<pre><code class="lang-ruby"><div class="highlight"><pre><span class="n">function</span> <span class="n">turnOnTheTV</span> <span class="p">(</span><span class="n">config</span><span class="p">)</span> <span class="p">{</span>
    <span class="sr">//</span> <span class="n">config</span><span class="o">.</span><span class="n">channel</span> <span class="o">===</span> <span class="mi">101</span>
    <span class="o">//</span> <span class="n">config</span><span class="o">.</span><span class="n">volume</span>  <span class="o">===</span> <span class="mi">10</span>
<span class="p">}</span>
<span class="n">turnOnTheTV</span><span class="p">({</span> <span class="ss">channel</span><span class="p">:</span> <span class="mi">101</span><span class="p">,</span> <span class="ss">volume</span><span class="p">:</span> <span class="mi">10</span> <span class="p">});</span>
</pre></div>
</code></pre>
<p>Note: ECMAScript 6.0 (the latest JavaScript specification - which is still being worked on as of Nov 2013) implements named parameters.</p>
<h2><a name="conclusion" class="anchor" href="#conclusion"><span class="header-link"></span></a>Conclusion</h2>
<p>OK, so there are still many different refactoring techniques that I&#39;ve not included. But hopefully you&#39;ve found this quick reference useful so far.</p>
<p>Most of these techniques I do automatically now (as I&#39;ve committed them to muscle memory). But sometimes when I&#39;m carrying out a refactoring I get confused on the best technique I should use and so I&#39;ll refer to this reference to help me find an appropriate solution.</p>
</div>

  <div class="comments">
    <a href="/posts/refactoring-techniques/#comments">
      <span class="icon-bubbles"></span>
      Comments
    </a>
  </div>


<div class="pagination group">
  
    
    
  
    
    
      <a href="/page/1/" class="older"> &#8592; Older</a>
    
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
</div>
    </div>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.1/jquery.min.js" type="text/javascript"></script>
    <script src="/scripts/main.js" type="text/javascript"></script>
    <script src="/scripts/Imager.js" type="text/javascript"></script>
    <script>
        var _gaq=[['_setAccount','UA-33159515-1'],['_trackPageview']];
        (function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];
        g.src=('https:'==location.protocol?'//ssl':'//www')+'.google-analytics.com/ga.js';
        s.parentNode.insertBefore(g,s)}(document,'script'));
    </script>
  </body>
</html>

