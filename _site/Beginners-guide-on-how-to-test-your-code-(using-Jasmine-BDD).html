<!doctype html>
<!--[if IE 8]><html class="ie8" dir="ltr" lang="en"><![endif]-->
<!--[if IE 9]><html class="ie9" dir="ltr" lang="en"><![endif]-->
<!--[if gt IE 9]><!--> <html dir="ltr" lang="en"> <!--<![endif]-->
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="author" content="Mark McDonnell" />
        <title> Beginners guide on how to test your code | Integralist</title>
        <!--[if lt IE 9]>
        <script src="/Assets/Scripts/html5.js"></script>
        <![endif]-->
        <link rel="stylesheet" href="/Assets/Styles/pygment.css" media="all">
        <link rel="stylesheet" href="/Assets/Styles/layout.css" media="all">
        <!--[if (lt IE 9) & (!IEMobile)]>
        <link rel="stylesheet" href="/Assets/Styles/layout-480.css">
        <link rel="stylesheet" href="/Assets/Styles/layout-768.css">
        <![endif]-->
        
        <link rel="alternate" type="application/atom+xml" title="" href="http://feeds.feedburner.com/Integralist">
        
        
        <script>
            var _gaq=[['_setAccount','UA-33159515-1'],['_trackPageview']];
            (function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];
            g.src=('https:'==location.protocol?'//ssl':'//www')+'.google-analytics.com/ga.js';
            s.parentNode.insertBefore(g,s)}(document,'script'));
        </script>
        
    </head>
    <body>
        <header class="header container">
            <p class="header__title"><a href="/" class="header__homelink">integralist</a></p>
            <p class="header__strapline">BBC News Engineer: Object-Oriented Design principles using Ruby, PHP, BEM, AMD, TDD and BDD</p>
            <a href="#info" class="header__moreinfo">More info about me&hellip;</a>
        </header>
        <section class="articles container">
            <h1>Beginners guide on how to test your code</h1>
<div class="article__content">
    <ul>
<li>Introduction</li>
<li>Start how you mean to go on</li>
<li>The ‘write test first’ process</li>
<li>Other aspects of TDD/BDD</li>
<li>What do these test 'types' mean?</li>
<li>Using Jasmine</li>
<li>An example</li>
<li>Review of example</li>
<li>Conclusion</li>
</ul>


<h2>Introduction</h2>

<p>Any programmer worth a damn will tell you that you need to test your code.</p>

<p>There are different types of tests that inspect the different areas of your application:</p>

<ul>
<li>Unit Tests</li>
<li>Integration Tests</li>
<li>Acceptance Tests</li>
<li>Regression Tests</li>
</ul>


<p>Although there are multiple areas of an application that need to be tested, the principle for each is that you write a test for a piece of your applications code and see if it passes.</p>

<p>Within a test you write a number of ‘assertions’ (which means you’re expecting certain values to be returned at that point in a certain format or type) and if the code fails to produce the relevant value the assertion will fail and thus the test itself will fail.</p>

<p>There are different methodologies for testing your code, the two most famous are Test-Driven Development (TDD) and Behaviour-Driven Development (BDD). Both are very similar and differ in 'direction' more than anything.</p>

<p>Fundamentally TDD is about the developer and their perspective on testing a piece of code, where BDD is more about using language that management and stake holders can understand (so your tests are still written in code but uses more 'domain specific language' - e.g. instead of <code>assertEqual(x, y)</code> you would write <code>expect(x).toEqual(y)</code>).</p>

<h2>Start how you mean to go on</h2>

<p>Something else you normally hear from the TDD crowd is that you <em>should</em> write your tests first! That’s probably going to sound a bit alien to you because how can you write tests for code that doesn’t yet exist? Why would anyone do that?</p>

<p>Well, the reasoning behind it is quite logical when you think about it. Normally you’ll just start writing some code with no idea of how it should work, you just start hacking away and as you progress you go back and refactor sections and make it cleaner/more efficient and hopefully at the end you don’t need to change your code in any meaningful way to appease your users who may be using your code (e.g. if you’re building the next big JavaScript framework then your API is what your users will be relying on and if you discover there is a bug in your code and it means you have to go back and change the API because of it then that causes big concerns for your users).</p>

<p>So the idea of writing tests first is that you’re thinking about your API from the beginning. You’ll think about what the perfect API is for your code to produce and you’ll ensure you write code that fits that API (you won’t realise halfway through coding “ah crap, this doesn’t work as well as I had hoped it would, I’m going to have to change this”).</p>

<p>Although we’re not worrying about “writing tests first” in this article, I mention it so you are at least aware of the process.</p>

<h2>The ‘write test first’ process</h2>

<p>For those interested it goes a little like this:</p>

<ul>
<li>Write a unit-test</li>
<li>Run the test (it will obviously fail because there is no code for it to run against!)</li>
<li>Write the smallest amount of code for the unit-test to pass (we’re talking quick and dirty code here)</li>
<li>Run the test again and watch it pass</li>
<li>Once the test passes, go back and refactor your code so it’s how it should be (i.e. clean/efficient)</li>
<li>Run the test again and watch it pass</li>
</ul>


<h2>Other aspects of TDD/BDD</h2>

<p>Here are a few other aspects of testing worth mentioning before we get stuck into some examples: methods such as ‘setUp’ and ‘tearDown’ (which run before and after each test) are useful (for example…) because it means you can prepare each test to run from a fresh set-up.  This probably doesn’t make a lot of sense at the moment so I’ll demonstrate this later in our example code below, but trust me, when you’re testing your code it’s useful before each test (or after each test) to reset your environment.</p>

<p>There are also more complicated aspects such as mocks, stubs and spies which are useful when you start getting deep into testing application code where ‘state’ becomes relevant (e.g. using some of these features makes testing code in the deepest parts of your application a lot easier).</p>

<p>So with all this in mind, I would highly recommend you go and read a book titled ‘Test-Driven JavaScript Development’ by Christian Johansen (<a href="http://twitter.com/cjno">@cjno</a>) which covers all these topics in great detail.</p>

<h2>What do these test 'types' mean?</h2>

<h3>Unit Tests</h3>

<p>These are very atomic (i.e. small) tests that test a specific chunk of code.</p>

<h3>Integration Tests</h3>

<p>These are tests that ensure all the separate parts of your application code work when interacting with each other.</p>

<h3>Acceptance Tests</h3>

<p>These are tests that prove to management or your stake holders that the application is providing all the functionality they require (typically acceptance tests are written using BDD which uses domain specific language that makes it easy for management to write tests for the developer to implement).</p>

<h3>Regression Tests</h3>

<p>This is the process of running your unit tests again after fixing any integration tests to make sure your fixes haven't caused your unit tests to break.</p>

<h2>Using Jasmine</h2>

<p>For the purpose of this article we're going to focus on unit testing but we're going to use a BDD library called Jasmine to help run our tests. You can download it from here: <a href="http://pivotal.github.com/jasmine/">http://pivotal.github.com/jasmine/</a></p>

<p>The set-up is as follows:</p>

<ul>
<li>Create an HTML page</li>
<li>In this page insert the provided css file ‘jasmine.css’ + the two provided js files ‘jasmine.js’, ‘jasmine-html.js’</li>
<li>Then include your own JavaScript code ‘my-cool-library.js’</li>
<li>Then include your own ‘my-tests.js’</li>
<li>After that have an inline script which executes the Jasmine test runner…
      jasmine.getEnv().addReporter(new jasmine.TrivialReporter());
      jasmine.getEnv().execute();</li>
</ul>


<p>Within your own ‘my-tests.js’ file is where you’ll write your unit-tests.</p>

<p>Different unit-testing libraries have different API’s. Jasmine’s API is as follows…</p>

<div class="highlight"><pre><code class="javascript">   <span class="nx">describe</span><span class="p">(</span><span class="s1">&#39;test suite name&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(){</span>
        <span class="c1">// assertions for your code to try and pass</span>
        <span class="c1">// if any assertions fail then this entire suite fails</span>
    <span class="p">});</span>
</code></pre></div>


<h2>An example</h2>

<p>So now imagine your ‘my-cool-library.js’ consisted of an object whose API let the user add/remove or check for CSS classes on an element. Lets say the API was as follows…</p>

<div class="highlight"><pre><code class="javascript">   <span class="kd">var</span> <span class="nx">header</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;my-header&#39;</span><span class="p">);</span>
    <span class="nx">css</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">header</span><span class="p">,</span> <span class="s1">&#39;newclass&#39;</span><span class="p">)</span> <span class="c1">// --&gt; adds the class &#39;newclass&#39; to the specified element &#39;header&#39;</span>
    <span class="nx">css</span><span class="p">.</span><span class="nx">has</span><span class="p">(</span><span class="nx">header</span><span class="p">,</span> <span class="s1">&#39;newclass&#39;</span><span class="p">)</span> <span class="c1">// --&gt; returns a boolean value (true/false) depending on whether the class &#39;newclass&#39; is found</span>
    <span class="nx">css</span><span class="p">.</span><span class="nx">remove</span><span class="p">(</span><span class="nx">header</span><span class="p">,</span> <span class="s1">&#39;newclass&#39;</span><span class="p">)</span> <span class="c1">// --&gt; removes the class &#39;newclass&#39; from the specified element &#39;header&#39;</span>
    <span class="nx">css</span><span class="p">.</span><span class="nx">classes</span><span class="p">(</span><span class="nx">header</span><span class="p">)</span> <span class="c1">// --&gt; returns an Array of classes found on this element</span>
</code></pre></div>


<p>Your test suite for this code could look something like (don’t worry, we’ll discuss after)…</p>

<div class="highlight"><pre><code class="javascript">   <span class="c1">// Test Suite</span>
    <span class="nx">describe</span><span class="p">(</span><span class="s1">&#39;CSS tests&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        
        <span class="kd">var</span> <span class="nx">header</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;my-header&#39;</span><span class="p">);</span>
        
        <span class="nx">beforeEach</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="c1">// Reset the className before each spec is run</span>
            <span class="nx">header</span><span class="p">.</span><span class="nx">className</span> <span class="o">=</span> <span class="s1">&#39;myclassa myclassb&#39;</span><span class="p">;</span>
        <span class="p">});</span>
        
        <span class="c1">// Spec</span>
        <span class="nx">it</span><span class="p">(</span><span class="s1">&#39;should return an Array of class names&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="nx">expect</span><span class="p">(</span><span class="nx">css</span><span class="p">.</span><span class="nx">classes</span><span class="p">(</span><span class="nx">header</span><span class="p">)).</span><span class="nx">toEqual</span><span class="p">([</span><span class="s1">&#39;myclassa&#39;</span><span class="p">,</span> <span class="s1">&#39;myclassb&#39;</span><span class="p">]);</span>
            <span class="nx">expect</span><span class="p">(</span><span class="nx">css</span><span class="p">.</span><span class="nx">classes</span><span class="p">(</span><span class="nx">header</span><span class="p">).</span><span class="nx">length</span><span class="p">).</span><span class="nx">toBe</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
        <span class="p">});</span>
        
        <span class="c1">// Spec</span>
        <span class="nx">it</span><span class="p">(</span><span class="s1">&#39;should add class to element&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="nx">css</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">header</span><span class="p">,</span> <span class="s1">&#39;newclass&#39;</span><span class="p">);</span>
            <span class="nx">expect</span><span class="p">(</span><span class="nx">header</span><span class="p">.</span><span class="nx">className</span><span class="p">).</span><span class="nx">toBe</span><span class="p">(</span><span class="s1">&#39;myclassa myclassb newclass&#39;</span><span class="p">);</span>
        <span class="p">});</span>
        
        <span class="c1">// Spec</span>
        <span class="nx">it</span><span class="p">(</span><span class="s1">&#39;should return a boolean for whether the class is on the given element&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="nx">expect</span><span class="p">(</span><span class="nx">css</span><span class="p">.</span><span class="nx">has</span><span class="p">(</span><span class="nx">header</span><span class="p">,</span> <span class="s1">&#39;myclassa&#39;</span><span class="p">)).</span><span class="nx">toBeTruthy</span><span class="p">();</span>
            <span class="nx">expect</span><span class="p">(</span><span class="nx">css</span><span class="p">.</span><span class="nx">has</span><span class="p">(</span><span class="nx">header</span><span class="p">,</span> <span class="s1">&#39;newclass&#39;</span><span class="p">)).</span><span class="nx">toBeFalsy</span><span class="p">();</span> <span class="c1">// although in the previous spec we added &#39;newclass&#39; to the element, in this spec this assertion should return false because the beforeEach method above has reset the class list back to &#39;myclassa myclassb&#39;</span>
        <span class="p">});</span>
        
        <span class="c1">// Spec</span>
        <span class="nx">it</span><span class="p">(</span><span class="s1">&#39;should remove class from element&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="nx">css</span><span class="p">.</span><span class="nx">remove</span><span class="p">(</span><span class="nx">header</span><span class="p">,</span> <span class="s1">&#39;myclassb&#39;</span><span class="p">);</span>
            <span class="nx">expect</span><span class="p">(</span><span class="nx">header</span><span class="p">.</span><span class="nx">className</span><span class="p">).</span><span class="nx">toBe</span><span class="p">(</span><span class="s1">&#39;myclassa&#39;</span><span class="p">);</span>
        <span class="p">});</span>
        
    <span class="p">});</span>
</code></pre></div>


<p>…so a few things you’ll notice:</p>

<ul>
<li>We’ve grouped all our tests related to the CSS part of our code using Jasmine’s
      describe('test suite name', function(){ /<em> tests </em>/ });</li>
<li>We’re using a setUp method (which Jasmine calls <code>beforeEach</code>) to run some code to reset the class names before each test run (so we start from a clean slate for each test) - there is also a corresponding tearDown method which Jasmine calls <code>afterEach</code> (see documentation)</li>
<li>Each test is represented by <code>it('expectation of this test', function(){ /* assertions */ });</code></li>
<li>The assertions are handled by Jasmine’s <code>expect(expressions).matcher</code></li>
</ul>


<p>The assertions method <code>expect</code> takes an expression (e.g. some code to execute) and then the result of that code is passed to the <em>matcher</em>. Our tests consisted of a few matchers such as:</p>

<ul>
<li><code>toEqual()</code></li>
<li><code>toBe()</code></li>
<li><code>toBeTruthy()</code></li>
<li><code>toBeFalsey()</code></li>
</ul>


<p>Jasmine has a few more matchers which you can read more about in the documentation: <a href="https://github.com/pivotal/jasmine/wiki/Matchers">https://github.com/pivotal/jasmine/wiki/Matchers</a></p>

<p>You can even create your own matchers…</p>

<div class="highlight"><pre><code class="javascript">   <span class="c1">// Add our two new matchers. One to check if an object is an Array and the other to check if the result is a Number</span>
    <span class="c1">// You create these within the beforeEach method which is executed before each test is run</span>
    <span class="nx">beforeEach</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">addMatchers</span><span class="p">({</span>
            <span class="nx">toBeArray</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">expected</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">return</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">toString</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">actual</span><span class="p">);</span> <span class="o">===</span> <span class="s1">&#39;[object Array]&#39;</span> <span class="o">?</span> <span class="kc">true</span> <span class="o">:</span> <span class="kc">false</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">});</span>
        
        <span class="k">this</span><span class="p">.</span><span class="nx">addMatchers</span><span class="p">({</span>
            <span class="nx">toBeNumber</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">expected</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">return</span> <span class="sr">/\d+/</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">actual</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">});</span>
    <span class="p">});</span>
</code></pre></div>


<h2>Review of example</h2>

<p>We’ll look at one of the example tests and explain what’s happening so you get an idea of how Jasmine works, then from there you should be at least good to go in getting up and running and playing around with it yourself.</p>

<p>I’ve set-up an example of the code found in this post on Github: <a href="https://github.com/Integralist/Unit-testing-with-Jasmine-BDD">https://github.com/Integralist/Unit-testing-with-Jasmine-BDD</a> (which should also help you getting started)</p>

<p>So lets look at one of the tests…</p>

<div class="highlight"><pre><code class="javascript">   <span class="nx">it</span><span class="p">(</span><span class="s1">&#39;should add class to element&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">css</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">header</span><span class="p">,</span> <span class="s1">&#39;newclass&#39;</span><span class="p">);</span>
        <span class="nx">expect</span><span class="p">(</span><span class="nx">header</span><span class="p">.</span><span class="nx">className</span><span class="p">).</span><span class="nx">toBe</span><span class="p">(</span><span class="s1">&#39;myclassa myclassb newclass&#39;</span><span class="p">);</span>
    <span class="p">});</span>
</code></pre></div>


<p>…as you can see the test starts by describing what is expected of it. In this case it should add a class to the specified element.</p>

<p>Within the execution of the test itself we can see that we’re executing the <code>css.add()</code> method and telling it to add the class <code>newclass</code> to the element <code>header</code> (which as you can see in the full code above was an element with an id of <code>my-header</code> stored in the variable <code>header</code>).</p>

<p>After that code has executed we’re expecting the header element’s className value to be <code>myclassa myclassb newclass</code>.</p>

<p>If we were to run the test-runner.html file we should see all tests pass (this is demonstrated by the green bar and the message of <code>4 specs, 0 failure</code>).</p>

<p>To see the test suite fail then just amend one of the tests slightly to cause it to fail. For example in the above example we looked at change it to: <code>toBe(‘x myclassa myclassb newclass’)</code> and this will cause the test to fail because obviously the list of class names on the header element is not going to include the class name ‘x’ at the start.</p>

<p>Now when you run the test-runner.html file (remembering that now one of the tests will fail) you’ll see that instead of a nice clean green bar to highlight success you see a red bar and a drill down into the issue. If you do as I suggested above to cause the test to fail you’ll notice now Jasmine highlights exactly what the problem is to you…</p>

<p><a href="http://cl.ly/1z3b1g3U1z0e2r2U2c2H">See screenshot image</a></p>

<div class="highlight"><pre><code class="bash"> 4 specs, 1 failure in 0.014s
    &gt; CSS tests <span class="o">(</span>this is the name of the <span class="nb">test </span>suite that failed - as you could have multiple suites running this helps narrow it down<span class="o">)</span>
    &gt;&gt; should add class to element <span class="o">(</span>this tells you the exact <span class="nb">test </span>that fails<span class="o">)</span>
    &gt;&gt;&gt; Expected <span class="s1">&#39;myclassa myclassb newclass&#39;</span> to be <span class="s1">&#39;x myclassa myclassb newclass&#39;</span>. <span class="o">(</span>this tells you what the result actually was followed by what the <span class="nb">test </span>was expecting - so you can see where the result went wrong<span class="o">)</span>
    &gt;&gt;&gt;&gt; <span class="o">(</span>after this you get a stack trace of what was executed so you can see specifics of where the error occurred<span class="o">)</span>
</code></pre></div>


<h2>Conclusion</h2>

<p>Hopefully this has given you a taster for how easy it is to get started writing unit-tests for your code (even if you don’t take the “write tests first” approach).</p>

<p>There are many good unit-testing libraries available today and they each have their pros/cons as far as the API is concerned and the features they offer.</p>

<p>I personally prefer Jasmine because I love the simplicity of the terminology and API and the flexibility I have to include my own matchers.</p>

<p>There are also libraries that focus on the more on specific parts of the testing process such as ‘mocks’, ‘stubs’ and ‘spies’ (see Sinon.js <a href="http://sinonjs.org/">http://sinonjs.org/</a>).</p>

</div>

        </section>
        <section class="info container" id="info">
            <section class="info__section">
                <h3 class="info__title">Links</h3>
                <ul class="info__list">
                    <li><a href="http://www.github.com/integralist" target="_blank">GitHub</a></li>
                    <li><a href="http://www.twitter.com/integralist" target="_blank">Twitter</a></li>
                    <li><a href="http://integralist.co.uk/Resume/" target="_blank">Resume</a></li>
                </ul>
            </section>
            <section class="info__section">
                <h3 class="info__title">Skills</h3>
                <ul class="info__list">
                    <li>Practical Code Design and Architecture</li>
                    <li>Test/Behaviour Driven Development</li>
                    <li>Object-Oriented/Scalable CSS</li>
                    <li>Semantic/Efficient HTML</li>
                    <li>Modular JavaScript</li>
                </ul>
            </section>
            <section class="info__section">
                <h3 class="info__title">Enjoys</h3>
                <ul class="info__list">
                    <li>Gracie Jiu-Jitsu</li>
                    <li>Programming</li>
                    <li>Integral Theory</li>
                </ul>
            </section>
            <section class="info__section">
                <h3 class="info__title">Listens</h3>
                <ul class="info__list">
                    <li>LTJ Bukem</li>
                    <li>Clutch</li>
                    <li>Tool</li>
                    <li>Meshuggah</li>
                    <li>Russian Circles</li>
                    <li>Earthtone9</li>
                    <li>Will Haven</li>
                    <li>ISIS</li>
                </ul>
            </section>
        </section>
    </body>
</html>
