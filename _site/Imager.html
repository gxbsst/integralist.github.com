<!doctype html>
<!--[if IE 8]><html class="ie8" dir="ltr" lang="en"><![endif]-->
<!--[if IE 9]><html class="ie9" dir="ltr" lang="en"><![endif]-->
<!--[if gt IE 9]><!--> <html dir="ltr" lang="en"> <!--<![endif]-->
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="author" content="Mark McDonnell" />
        <title> Imager.js (BBC News responsive images solution) | Integralist</title>
        <!--[if lt IE 9]>
        <script src="/Assets/Scripts/html5.js"></script>
        <![endif]-->
        <link rel="stylesheet" href="/Assets/Styles/pygment.css" media="all">
        <link rel="stylesheet" href="/Assets/Styles/layout.css" media="all">
        <!--[if (lt IE 9) & (!IEMobile)]><![endif]-->
        
        <link rel="alternate" type="application/atom+xml" title="Integralist" href="http://feeds.feedburner.com/Integralist">
        
        
        <script>
            var _gaq=[['_setAccount','UA-33159515-1'],['_trackPageview']];
            (function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];
            g.src=('https:'==location.protocol?'//ssl':'//www')+'.google-analytics.com/ga.js';
            s.parentNode.insertBefore(g,s)}(document,'script'));
        </script>
        
    </head>
    <body>
        <header class="header container">
            <ul class="social-links">
                <li><a href="http://www.github.com/integralist" target="_blank" class="social-links__github"><span>GitHub</span></a></li>
                <li><a href="http://www.twitter.com/integralist" target="_blank" class="social-links__twitter"><span>Twitter</span></a></li>
            </ul>
            <p class="header__title"><a href="/" class="header__homelink">integralist</a></p>
            <p class="header__strapline">BBC News Engineer: Object-Oriented Design principles using Node, Ruby, PHP, BEM, AMD, BDD, TDD. <br>Loves Unix (Awk, Sed, Grep... etc) and Regular Expressions</p>
            <a href="#info" class="header__moreinfo">More info about me&hellip;</a>
        </header>
        <section class="articles container">
            <h1>Imager.js (BBC News responsive images solution)</h1>
<div class="article__content">
    <h2>What we'll cover <em>reading time: approx. 4mins</em></h2>

<ul>
<li>Introduction</li>
<li>What's the gist?</li>
<li>Anything more technical you can tell us?</li>
<li>So it's open-sourced and ready to use right?</li>
<li>What's left to do?</li>
<li>Conclusion</li>
</ul>


<h2>Introduction</h2>

<p>Previously <a href="http://twitter.com/tmaslen">Tom Maslen</a> wrote a quick summary of the <a href="http://responsivenews.co.uk/post/50092458307/images">responsive image loading strategy</a> used by BBC News. This post resulted in a lot of interest from the development community and so we wanted to follow up with another quick post which explored in more detail the actual implementation of this approach.</p>

<p><a href="http://twitter.com/addyosmani">Addy Osmani</a> from the Google Chrome team recently contacted us to express his interest in the technique we are using and so we decided it would be a good idea to go the open-source route and release a version of our approach so the developer community could benefit from an alternative solution to the responsive image problem (especially considering the pre-existing proposed specifications for 'srcset' and the 'Picture' element aren't yet widely implemented and the currently available polyfills aren't quite up to scratch yet either).</p>

<p>The original code was written back in 2011 (and was also heavily tied into the BBC infrastructure) so the first thing we needed to do was <a href="https://gist.github.com/Integralist/6157139">rewrite the code so it could more easily be understood</a> and then we could start work on open-sourcing it and improving it.</p>

<p>Moving forward we aim to collaborate further with Addy and the rest of the community on getting the process automated using the popular front-end JavaScript task runner <a href="http://gruntjs.com/">Grunt</a>.</p>

<h2>What's the gist?</h2>

<p>It's pretty simple really…</p>

<ol>
<li>Wherever you want an image to appear you use a <code>&lt;div&gt;</code></li>
<li>You give it a <code>class</code> and <code>data-src</code>, <code>data-width</code> attributes</li>
<li>Load and run the Imager.js code (we use a predetermined list of image sizes, but these are specific to BBC News and so can be changed to match your own requirements)</li>
<li>Imager replaces the div's with a transparent 1x1 Base64 encoded image.</li>
<li>Imager then replaces those with the most appropriately sized image (based on the current image and the user's screen dimensions and see if they correlate to our list of available image sizes).</li>
<li>Imager set-ups a resize event listener to check whether the image needs to be replaced with another more appropriately sized image.</li>
</ol>


<p>…fundamentally, that's it.</p>

<h2>Anything more technical you can tell us?</h2>

<p>The way we determine what size image to place onto the page is by taking the current screen width and then looking at the 'rendered' size of our image (using <code>myImageElement.clientWidth</code>). We then check if the rendered image size approximately matches one of the sizes available in our predefined list of image dimensions. Once we have a match we then parse the current image URL (which if using a RESTful format would look something like <code>http://your-image-service.com/horse/100/</code> -> and would return an image of a horse 100px wide), finally we replace the width in the URL with the new replacement width and update the image source to load that more appropriately sized image based from the new RESTful URL we set as the image source.</p>

<p>The code for Imager.js is quite small and pretty self explanatory (considering the break-down of the process listed above), so rather than me repeat the code line for line just <a href="https://gist.github.com/Integralist/6229170">take a look here</a>.</p>

<h2>So it's open-sourced and ready to use right?</h2>

<p>It's open-sourced <a href="https://github.com/BBC-News/Imager.js/">https://github.com/BBC-News/Imager.js/</a> and is usable but it currently relies on users having their own RESTful image service.</p>

<p>For the purpose of providing a simple demonstration we used the 3rd party service <a href="http://placehold.it/">Placehold.it</a>.</p>

<h2>What's left to do?</h2>

<p>Well, there are many things we want to do with Imager but the next step is to try and automate the process using <a href="http://gruntjs.com/">Grunt</a> and to supply a simple server-side script that helps users experiment with the code more easily.</p>

<p>But the beauty of the open-source community means we've already had a member of the <a href="http://yeoman.io/">Yeoman</a> team contributing code that helps cache the generation of images, as well as improve performance by replacing the use of <code>setTimeout</code> with a polyfill for <code>requestAnimationFrame</code> (not to mention some other small refactorings).</p>

<h2>Conclusion</h2>

<p>Here at BBC News we have found this approach provides us a good flexible foundation to incorporate responsive images without resorting to un-stable and un-implemented official solutions or polyfills.</p>

<p>Is this the <em>best</em> solution available today? Unlikely. But the more choice developers have at their disposal the better.</p>

<p>If you have any questions then feel free to open an issue on the Imager.js <a href="https://github.com/BBC-News/Imager.js/">GitHub repo</a>.</p>

</div>

        </section>
        <section class="info container" id="info">
            <section class="info__section">
                <h3 class="info__title">Links</h3>
                <ul class="info__list">
                    <li><a href="http://www.github.com/integralist" target="_blank">GitHub</a></li>
                    <li><a href="http://www.twitter.com/integralist" target="_blank">Twitter</a></li>
                    <li><a href="http://integralist.co.uk/Resume/" target="_blank">Resume</a></li>
                    <li><a href="https://speakerdeck.com/integralist/" target="_blank">Speaker Deck</a></li>
                    <li><a href="http://slid.es/markmcdonnell/" target="_blank">Slid.es</a></li>
                    <li><a href="http://uk.linkedin.com/pub/mark-mcdonnell/65/5/88" target="_blank">LinkedIn</a></li>
                </ul>
            </section>
            <section class="info__section">
                <h3 class="info__title">Abilities</h3>
                <ul class="info__list">
                    <li>Practical Code Design and Architecture</li>
                    <li>Test/Behaviour Driven Development</li>
                    <li>Object-Oriented/Scalable CSS</li>
                    <li>Semantic/Efficient HTML</li>
                    <li>Modular JavaScript</li>
                </ul>
            </section>
            <section class="info__section">
                <h3 class="info__title">Enjoys</h3>
                <ul class="info__list">
                    <li>Gracie Jiu-Jitsu</li>
                    <li>Programming</li>
                    <li>Integral Theory</li>
                </ul>
            </section>
            <section class="info__section">
                <h3 class="info__title">Listens</h3>
                <ul class="info__list">
                    <li>LTJ Bukem</li>
                    <li>Clutch</li>
                    <li>Tool</li>
                    <li>Meshuggah</li>
                    <li>Russian Circles</li>
                    <li>Earthtone9</li>
                    <li>Will Haven</li>
                    <li>ISIS</li>
                </ul>
            </section>
        </section>
        <script src="/Assets/Scripts/Imager.js"></script>
    </body>
</html>
